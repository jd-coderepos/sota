
\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  



\IEEEoverridecommandlockouts                              

\overrideIEEEmargins                                      




\usepackage{amsmath} 


\usepackage{amssymb}  \usepackage{color}
\usepackage[table,xcdraw]{xcolor}
\usepackage{siunitx}
\usepackage{hhline}
\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage{graphicx} 

\let\labelindent\relax
\usepackage{enumitem}

\usepackage{booktabs}
\usepackage{multirow}
\usepackage{xifthen}
\usepackage{nicefrac}

\usepackage[noadjust]{cite}
\renewcommand{\citepunct}{,\penalty\citepunctpenalty\,}
\renewcommand{\citedash}{\,--\,}

\usepackage{lipsum}
\usepackage{todonotes}

\makeatletter
\let\NAT@parse\undefined
\makeatother
\usepackage[bookmarks=false]{hyperref}

\usepackage{dblfloatfix}

\usepackage{fancyhdr}
\setlength{\headheight}{4pt}

\newcommand{\redtext}[1]{\textcolor{red}{{#1}}}
\newcommand{\bluetext}[1]{\textcolor{blue}{{#1}}}
\newcommand{\timtext}[1]{\textcolor{purple}{{#1}}}
\newcommand{\bennytext}[1]{\textcolor{orange}{{#1}}}

\usetikzlibrary{positioning}
\newcommand\updateRate[3]{
    \begin{tikzpicture}[every node/.style={inner sep=0,outer sep=0}]]
        \node[anchor=east] at (0, 0) (a1) {#1};\node[above right=-0.01 and 0.45 of a1, anchor=east, align=right, font=\tiny, color=gray] (a2) {#2};\node[below right=0.1 and 0.0 of a2, anchor=east, align=right, font=\tiny, color=gray] (a3) {#3};\end{tikzpicture}
}

\title{\LARGE \bf
PanopticNDT: Efficient and Robust Panoptic Mapping}

\def\theauthors{Daniel Seichter, Benedict Stephan, Söhnke Benedikt Fischedick, Steffen Müller, Leonard Rabes, and \\Horst-Michael Gross}
\author{\theauthors \thanks{Authors are with Neuroinformatics and Cognitive Robotics Lab, Technische Universit\"at Ilmenau, 98693 Ilmenau, Germany. Contact: \hfill\newline
{\scriptsize{\tt daniel.seichter@tu-ilmenau.de}, ORCID: {\tt
\href{https://orcid.org/0000-0002-3828-2926}{0000-0002-3828-2926}}}}\thanks{This work has received funding from the German Federal Ministry of Education and Research (BMBF) to the project MORPHIA (16SV8426).}}

\makeatletter
\newcommand\thefontsize[1]{Fontsize for \string#1 : {#1 \f@size pt}}
\IEEEtriggercmd{\reset@font\normalfont\fontsize{7.9pt}{8.9pt}\selectfont}
\makeatother
\IEEEtriggeratref{1}

\makeatletter
\def\appendixtitle{
    \twocolumn[\begin{center}\vskip0.25in{\LARGE [\thesection~Appendix]\
\label{eq:panoptic_label_2d}
P(\boldsymbol{u}) =\left\{\begin{aligned}
        &\langle \underset{\boldsymbol{u}^\prime \in \{\boldsymbol{i} | Z(\boldsymbol{i}) = Z(\boldsymbol{u})\}}{\mathrm{mode}(L(\boldsymbol{u}^\prime))}, Z(\boldsymbol{u}) \rangle &\,& L(\boldsymbol{u}) \in \mathcal{L}^{\text{Th}} \\
        &\langle L(\boldsymbol{u}),  0 \rangle &\,&\mathrm{otherwise.}
    \end{aligned}
\right.v = \langle v^{\text{Shape}}, v^{\text{Occ}}, v^L, v^Z, v^P \rangle

\label{eq:utov}
v = \mathrm{utov}(\boldsymbol{u}) := \mathrm{findnode}(\boldsymbol{T}\boldsymbol{K}^{-1}\left[\boldsymbol{u},1\right]^TD(\boldsymbol{u}))    

    \begin{gathered}
        M^{\tilde{z}}(\boldsymbol{u}^\prime) = \left\{\begin{aligned}
            & 1 &\,& \mathrm{isthing}(v) \land \mathrm{isintopz}(v, \tilde{z}) \\
            & 0 &\,& \mathrm{otherwise}
        \end{aligned}
    \right.\\\boldsymbol{u^\prime} \in \mathrm{vtou}(v), \quad v \in \mathcal{V}, \quad \tilde{z} \in \mathcal{Z}^{\text{3D}}.
    \end{gathered}

    \label{eq:main:isthing}
    \begin{gathered}
        \mathrm{isthing}(v) := \frac{\sum_{l \in \mathcal{L}^{\text{St}}} h^L_l(v)
        }{\sum_{l \in \mathcal{L}} h^L_l(v)
        } < \theta^{\text{St}}.
    \end{gathered}

    \begin{gathered}
        \mathrm{isintopz}(v, z) := \frac{\sum\limits_{i = 0}^{\mathrm{argsort}^{\uparrow}(h^Z(v))_i = z} h^Z_i(v)
        }{\sum\limits_{i \in \mathcal{Z}^{\text{3D}}} h^Z_i(v)
        } \ge 1 - \theta^{\text{B}}.
    \end{gathered}

    J(z_a, z_b) = \mathrm{IoU}(\{\boldsymbol{u}^\prime | M^{z_a}(\boldsymbol{u}^\prime){=}1\}, \{\boldsymbol{u}^\prime | Z^P(\boldsymbol{u}^\prime){=}z_b\}).

    \label{eq:main:matching}
    \hat{z} = \left\{\begin{aligned}
            &\operatornamewithlimits{\mathrm{argmax}}_{\tilde{z} \in \mathcal{Z}^{\text{3D}}}(J(\tilde{z}, z)) &\,&\operatornamewithlimits{\mathrm{max}}_{\tilde{z} \in \mathcal{Z}^{\text{3D}}}(J(\tilde{z}, z)) > \theta^{\text{M}} \\
            &\mathrm{newz}(z) &\,& \operatornamewithlimits{\mathrm{max}}_{\tilde{z} \in \mathcal{Z}^{\text{3D}}}(J(\tilde{z}, z)) \le \theta^{\text{N}} \\
            &0 &\,& \hspace{1mm}\mathrm{otherwise}\\
        \end{aligned}
    \right.
 
    \label{eq:main:instance_update}
    \begin{gathered}
        h^Z_{\hat{Z}(\boldsymbol{u}^\prime)}(\mathrm{utov}(\boldsymbol{u}^\prime)) \mathrel{+}= S^P(\boldsymbol{u}^\prime)
        ,\;\;\,
        n^Z(\mathrm{utov}(\boldsymbol{u}^\prime)) \mathrel{+}= 1
        \\
        \boldsymbol{u}^\prime \in \left\{ \boldsymbol{u} | \hat{Z}(\boldsymbol{u}) \neq 0 \land S^P(\boldsymbol{u}) > \theta^Z \right\}.
    \end{gathered}
 
    \label{eq:main:semantic_update}
    \begin{gathered}
        h^L_{L^P(\boldsymbol{u}^\prime)}(\mathrm{utov}(\boldsymbol{u}^\prime)) \mathrel{+}= S^{L^P}(\boldsymbol{u}^\prime)
        ,\;
        n^L(\mathrm{utov}(\boldsymbol{u}^\prime)) \mathrel{+}= 1\\\boldsymbol{u}^\prime \in \left\{ \boldsymbol{u} | S^{L^P}(\boldsymbol{u}) > \theta^L \right\}.
    \end{gathered}

\label{eq:panoptic_label_3d}
\hspace*{-2mm}
P(v) =\left\{\begin{aligned}
        &\langle \underset{l \in \mathcal{L}^{\text{Th}}}{\mathrm{argmax}}(\underset{v^\prime \in \{i | \hat{Z}(i) = \hat{Z}(v)\}}{\mathrm{sum}(h_l^L(v^\prime)))}, \hat{Z}(v) \rangle &\,& \hspace{-2mm}\mathrm{pthing}(v) \\
        &\langle \hat{L}(v),  0 \rangle &\,&\hspace{-2mm}\mathrm{otherw.}
    \end{aligned}
\right.
    \label{eq:main:propthing}
    \mathrm{pthing}(v) := \mathrm{isthing}(v) \land \frac{n^Z(v)}{n^L(v)} \ge \theta^{O}
2mm]
        \begin{tabular}[c]{@{}l@{}}\color[HTML]{737373}tsdf\_integrator/\\ use\_instance\_classification\end{tabular}                          & false   & true     & true      \-1mm]\footnotesize(5cm)};\node[left=7.5mm of pred_ndt_10_panoptic, rotate=90, anchor=mid, align=center] (l) {\footnotesize \bf PanopticNDT\-1mm]\footnotesize Multi-TSDFs};\coordinate (p) at ();\node[rotate=90, anchor=mid, align=center] at (l.mid |- p) (lsf) {\footnotesize Single frame\2.5mm]
    \begin{tikzpicture}[inner sep=0pt]     
        \newcommand{\includeimageddd}[1]{\includegraphics[height=1.8cm, trim={0 0.5cm 0 3.2cm}, clip]{#1}}\newcommand{\includeimagedd}[1]{\includegraphics[height=1.8cm]{#1}}\node (pred_ndt_05_panoptic) {\includeimageddd{img/examples/scannet_example_0/pred_ndt_05_panoptic.png}};\node[right=0.5mm of pred_ndt_05_panoptic] (pred_ndt_05_semantic) {\includeimageddd{img/examples/scannet_example_1/pred_ndt_05_semantic.png}};\node[right=0.5mm of pred_ndt_05_semantic] (pred_ndt_05_instance) {\includeimageddd{img/examples/scannet_example_1/pred_ndt_05_instance.png}};\node[right=4mm of pred_ndt_05_instance] (pred_ndt_05_panoptic_2d) {\includeimagedd{img/examples/scannet_example_1/pred_ndt_05_backprojection_05180_panoptic.png}};\node[right=2mm of pred_ndt_05_panoptic_2d] (pred_ndt_05_semantic_2d) {\includeimagedd{img/examples/scannet_example_1/pred_ndt_05_backprojection_05180_semantic.png}};\node[right=2mm of pred_ndt_05_semantic_2d] (pred_ndt_05_instance_2d) {\includeimagedd{img/examples/scannet_example_1/pred_ndt_05_backprojection_05180_instance.png}};\node[below=5mm of pred_ndt_05_panoptic] (pred_ndt_10_panoptic) {\includeimageddd{img/examples/scannet_example_1/pred_ndt_10_panoptic.png}};\node[right=0.5mm of pred_ndt_10_panoptic] (pred_ndt_10_semantic) {\includeimageddd{img/examples/scannet_example_1/pred_ndt_10_semantic.png}};\node[right=0.5mm of pred_ndt_10_semantic] (pred_ndt_10_instance) {\includeimageddd{img/examples/scannet_example_1/pred_ndt_10_instance.png}};\node[right=4mm of pred_ndt_10_instance] (pred_ndt_10_panoptic_2d) {\includeimagedd{img/examples/scannet_example_1/pred_ndt_10_backprojection_05180_panoptic.png}};\node[right=2mm of pred_ndt_10_panoptic_2d] (pred_ndt_10_semantic_2d) {\includeimagedd{img/examples/scannet_example_1/pred_ndt_10_backprojection_05180_semantic.png}};\node[right=2mm of pred_ndt_10_semantic_2d] (pred_ndt_10_instance_2d) {\includeimagedd{img/examples/scannet_example_1/pred_ndt_10_backprojection_05180_instance.png}};\node[below=5mm of pred_ndt_10_panoptic] (pred_pmtsdf_panoptic) {\includeimageddd{img/examples/scannet_example_1/pred_pmtsdf_panoptic.png}};\node[right=0.5mm of pred_pmtsdf_panoptic] (pred_pmtsdf_semantic) {\includeimageddd{img/examples/scannet_example_1/pred_pmtsdf_semantic.png}};\node[right=0.5mm of pred_pmtsdf_semantic] (pred_pmtsdf_instance) {\includeimageddd{img/examples/scannet_example_1/pred_pmtsdf_instance.png}};\node[right=4mm of pred_pmtsdf_instance] (pred_pmtsdf_panoptic_2d) {\includeimagedd{img/examples/scannet_example_1/pred_pmtsdf_backprojection_05180_panoptic.png}};\node[right=2mm of pred_pmtsdf_panoptic_2d] (pred_pmtsdf_semantic_2d) {\includeimagedd{img/examples/scannet_example_1/pred_pmtsdf_backprojection_05180_semantic.png}};\node[right=2mm of pred_pmtsdf_semantic_2d] (pred_pmtsdf_instance_2d) {\includeimagedd{img/examples/scannet_example_1/pred_pmtsdf_backprojection_05180_instance.png}};\node[above=5mm of pred_ndt_05_panoptic_2d] (emsanet_panoptic) {\includeimagedd{img/examples/scannet_example_1/emsanet_thresholded_panoptic.png}};\node[above=5mm of pred_ndt_05_semantic_2d] (emsanet_semantic) {\includeimagedd{img/examples/scannet_example_1/emsanet_thresholded_semantic.png}};\node[above=5mm of pred_ndt_05_instance_2d] (emsanet_instance) {\includeimagedd{img/examples/scannet_example_1/emsanet_thresholded_instance.png}};\node[above=2mm of emsanet_panoptic] (gt_panoptic) {\phantom{\includeimagedd{img/examples/scannet_example_1/rgb.png}}};\node at (gt_ndt_05_panoptic |- gt_panoptic) (rgb) {\includeimagedd{img/examples/scannet_example_1/rgb.png}};\node at (gt_ndt_05_semantic |- gt_panoptic) (depth) {\includeimagedd{img/examples/scannet_example_1/depth.png}};\node[below=2.5mm of pred_pmtsdf_instance_2d, anchor=mid] (l) {\scriptsize 2D instance};\node[anchor=mid] at (l -| pred_pmtsdf_semantic_2d){\scriptsize 2D semantic};\node[anchor=mid] at (l -| pred_pmtsdf_panoptic_2d){\scriptsize 2D panoptic};\node[anchor=mid] at (l -| pred_pmtsdf_instance){\scriptsize 3D instance};\node[anchor=mid] at (l -| pred_pmtsdf_semantic){\scriptsize 3D semantic};\node[anchor=mid] at (l -| pred_pmtsdf_panoptic){\scriptsize 3D panoptic};\node[below=2mm of rgb, anchor=mid] {\scriptsize RGB};\node[below=2mm of depth, anchor=mid] {\scriptsize Depth};\node[left=2.5mm of emsanet_panoptic, rotate=90, anchor=mid] {\scriptsize EMSANet};\node[left=2.5mm of pred_ndt_05_panoptic, rotate=90, anchor=mid] {\scriptsize EMSANet};\node[left=2.5mm of pred_ndt_10_panoptic, rotate=90, anchor=mid] {\scriptsize EMSANet};\node[left=2.5mm of pred_pmtsdf_panoptic, rotate=90, anchor=mid] {\scriptsize EMSANet};\node[left=7.5mm of pred_ndt_05_panoptic, rotate=90, anchor=mid, align=center] (l) {\footnotesize PanopticNDT\-1mm]\footnotesize\bf (10cm)};\node[left=7.5mm of pred_pmtsdf_panoptic, rotate=90, anchor=mid, align=center] (l) {\footnotesize Panoptic\-1mm]\footnotesize(given camera pose)};\coordinate (p) at ([yshift=-2.5mm]lsf.north west |- emsanet_panoptic.south west);\draw[gray!80, dashed, thick] (p) -- (p -| emsanet_instance.south east);\draw[gray!80, dashed, thick] ([yshift=-2.5mm]pred_ndt_05_panoptic.south west) -- ([yshift=-2.5mm]pred_ndt_05_instance_2d.south east);\draw[gray!80, dashed, thick] ([yshift=-2.5mm]pred_ndt_10_panoptic.south west) -- ([yshift=-2.5mm]pred_ndt_10_instance_2d.south east);\end{tikzpicture}\vspace{-3mm}\caption{Qualitative results for \emph{scene\_0757\_00}~(top) and \emph{scene\_0761\_00}~(bottom) of the hidden ScanNetV2 test split. The upper part for each scene shows the thresholded predictions of EMSANet~\cite{emsanet2022ijcnn}~(see Sec.~\ref{sec:experiments:implementation}). The lower part for each scene compares our proposed PanopticNDT with voxel sizes 5\si{\centi\meter} and 10\si{\centi\meter} to Panoptic Multi-TSDFs~\cite{panoptic-multi-tsdf-2022-icra}. Best viewed in color at 300\%. Black indicates \emph{void/no\_instance}, for the semantic colors, we refer to Fig.~\ref{fig:experiments:hypersim_radar_chart}. Panoptic labels are visualized by small color differences based on the semantic color.}        
    \label{fig:appendix:qualitative_results_scannet}
\end{figure*}
 }{}

\end{document}