\documentclass[copyright]{eptcs}
\providecommand{\event}{TermGraph 2011}







\def\textmu{}

\makeatletter
\@ifundefined{lhs2tex.lhs2tex.sty.read}{\@namedef{lhs2tex.lhs2tex.sty.read}{}\newcommand\SkipToFmtEnd{}\newcommand\EndFmtInput{}\long\def\SkipToFmtEnd#1\EndFmtInput{}}\SkipToFmtEnd

\newcommand\ReadOnlyOnce[1]{\@ifundefined{#1}{\@namedef{#1}{}}\SkipToFmtEnd}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{stmaryrd}
\DeclareFontFamily{OT1}{cmtex}{}
\DeclareFontShape{OT1}{cmtex}{m}{n}
  {<5><6><7><8>cmtex8
   <9>cmtex9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmtex10}{}
\DeclareFontShape{OT1}{cmtex}{m}{it}
  {<-> ssub * cmtt/m/it}{}
\newcommand{\texfamily}{\fontfamily{cmtex}\selectfont}
\DeclareFontShape{OT1}{cmtt}{bx}{n}
  {<5><6><7><8>cmtt8
   <9>cmbtt9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmbtt10}{}
\DeclareFontShape{OT1}{cmtex}{bx}{n}
  {<-> ssub * cmtt/bx/n}{}
\newcommand{\tex}[1]{\text{\texfamily#1}}	

\newcommand{\Sp}{\hskip.33334em\relax}


\newcommand{\Conid}[1]{\mathit{#1}}
\newcommand{\Varid}[1]{\mathit{#1}}
\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
\newcommand{\plus}{\mathbin{+\!\!\!+}}
\newcommand{\bind}{\mathbin{>\!\!\!>\mkern-6.7mu=}}
\newcommand{\rbind}{\mathbin{=\mkern-6.7mu<\!\!\!<}}\newcommand{\sequ}{\mathbin{>\!\!\!>}}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}
\usepackage{polytable}

\@ifundefined{mathindent}{\newdimen\mathindent\mathindent\leftmargini}{}

\def\resethooks{\global\let\SaveRestoreHook\empty
  \global\let\ColumnHook\empty}
\newcommand*{\savecolumns}[1][default]{\g@addto@macro\SaveRestoreHook{\savecolumns[#1]}}
\newcommand*{\restorecolumns}[1][default]{\g@addto@macro\SaveRestoreHook{\restorecolumns[#1]}}
\newcommand*{\aligncolumn}[2]{\g@addto@macro\ColumnHook{\column{#1}{#2}}}

\resethooks

\newcommand{\onelinecommentchars}{\quad-{}- }
\newcommand{\commentbeginchars}{\enskip\{-}
\newcommand{\commentendchars}{-\}\enskip}

\newcommand{\visiblecomments}{\let\onelinecomment=\onelinecommentchars
  \let\commentbegin=\commentbeginchars
  \let\commentend=\commentendchars}

\newcommand{\invisiblecomments}{\let\onelinecomment=\empty
  \let\commentbegin=\empty
  \let\commentend=\empty}

\visiblecomments

\newlength{\blanklineskip}
\setlength{\blanklineskip}{0.66084ex}

\newcommand{\hsindent}[1]{\quad}\let\hspre\empty
\let\hspost\empty
\newcommand{\NB}{\textbf{NB}}
\newcommand{\Todo}[1]{\textbf{To do:}~#1}

\EndFmtInput
\makeatother
\ReadOnlyOnce{polycode.fmt}\makeatletter

\newcommand{\hsnewpar}[1]{{\parskip=0pt\parindent=0pt\par\vskip #1\noindent}}

\newcommand{\hscodestyle}{}



\newcommand{\sethscode}[1]{\expandafter\let\expandafter\hscode\csname #1\endcsname
   \expandafter\let\expandafter\endhscode\csname end#1\endcsname}



\newenvironment{compathscode}{\par\noindent
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \let\hspre\pboxed}{\endpboxed\let\hspost\pboxed}{\endpboxed\parray}{\endparray\parray}{\endparray\pboxed}{\endpboxed\def\column##1##2{}\let\>\undefined\let\<\undefined\let\\\undefined
   \newcommand\>[1][]{}\newcommand\<[1][]{}\newcommand\ }

\newcommand{\inlinehs}{\sethscode{inlinehscode}}



\newenvironment{joincode}{\let\orighscode=\hscode
   \let\origendhscode=\endhscode
   \def\endhscode{\def\hscode{\endgroup\def\@currenvir{hscode}\\}\begingroup}
\orighscode\def\hscode{\endgroup\def\@currenvir{hscode}}}{\origendhscode
   \global\let\hscode=\orighscode
   \global\let\endhscode=\origendhscode}

\makeatother
\EndFmtInput
\ReadOnlyOnce{agda.fmt}


\RequirePackage[T1]{fontenc}
\RequirePackage[utf8x]{inputenc}
\RequirePackage{ucs}
\RequirePackage{amsfonts}

\providecommand\mathbbm{\mathbb}

\DeclareUnicodeCharacter{737}{\textsuperscript{l}}
\DeclareUnicodeCharacter{8718}{\ensuremath{\blacksquare}}
\DeclareUnicodeCharacter{8759}{::}
\DeclareUnicodeCharacter{9669}{\ensuremath{\triangleleft}}
\DeclareUnicodeCharacter{8799}{\ensuremath{\stackrel{\scriptscriptstyle ?}{=}}}
\DeclareUnicodeCharacter{10214}{\ensuremath{\llbracket}}
\DeclareUnicodeCharacter{10215}{\ensuremath{\rrbracket}}

\providecommand\textepsilon{}
\providecommand\textmu{}






\renewcommand\Varid[1]{\mathord{\textsf{#1}}}
\let\Conid\Varid
\newcommand\Keyword[1]{\textsf{\textbf{#1}}}
\EndFmtInput



\DeclareUnicodeCharacter{10230}{\ensuremath{\rightarrow}} \DeclareUnicodeCharacter{8271}{\ensuremath{\fcmp}} 

\DeclareUnicodeCharacter{"228D}{\ensuremath{\kern-0.2em\scriptscriptstyle{\sqcup}\kern-0.2em}} \DeclareUnicodeCharacter{"2192}{\ensuremath{\rightarrow}} \DeclareUnicodeCharacter{"21C9}{\rightrightarrows} \DeclareUnicodeCharacter{"22A5}{\ensuremath{\RELbot}} \DeclareUnicodeCharacter{"03A3}{\ensuremath{\Sigma}} \DeclareUnicodeCharacter{"03BB}{\ensuremath{\lambda}} 

\DeclareUnicodeCharacter{"211B}{\ensuremath{\mathcal{R}\kern-0.2em}} \DeclareUnicodeCharacter{"212F}{{\it{e}}} \DeclareUnicodeCharacter{"2113}{{\it{l}}} 

\DeclareUnicodeCharacter{9585}{\ensuremath{\RELlresR}} \DeclareUnicodeCharacter{9586}{\ensuremath{\RELrresR}} 


\DeclareUnicodeCharacter{10231}{\ensuremath{\longleftrightarrow}} 

\DeclareUnicodeCharacter{8614}{\ensuremath{\mapsto}} 

\DeclareUnicodeCharacter{8636}{\ensuremath{\leftharpoonup}} 


\DeclareUnicodeCharacter{9001}{\ensuremath{\langle}} 

\DeclareUnicodeCharacter{9002}{\ensuremath{\rangle}} 

\DeclareUnicodeCharacter{9587}{\ensuremath{\RELsyqInfixOP}} \DeclareUnicodeCharacter{9659}{\ensuremath{\rhd}} 


\DeclareUnicodeCharacter{9661}{\ensuremath{\triangledown}} \DeclareUnicodeCharacter{9665}{\ensuremath{\triangleleft}} 



\DeclareUnicodeCharacter{9733}{\ensuremath{\star}} 


\DeclareUnicodeCharacter{739}{\ensuremath{{}^{*}}} 

\DeclareUnicodeCharacter{9312}{\ensuremath{\triv}} 

\DeclareUnicodeCharacter{8600}{\ensuremath{\searrow}} 

\DeclareUnicodeCharacter{8601}{\ensuremath{\swarrow}} 



\DeclareUnicodeCharacter{915}{\ensuremath{\Gamma}} \DeclareUnicodeCharacter{945}{\ensuremath{\alpha}} \DeclareUnicodeCharacter{946}{\ensuremath{\beta}} \DeclareUnicodeCharacter{947}{\ensuremath{\gamma}} \DeclareUnicodeCharacter{948}{\ensuremath{\delta}} \DeclareUnicodeCharacter{966}{\ensuremath{\phi}} 

\renewcommand{\hscodestyle}{\small}


\makeatletter
\def\mkcommand#1{\expandafter\gdef\csname #1\endcsname}
\makeatother


\title{Dependently-Typed Formalisation of Typed Term Graphs}
\def\titlerunning{Dependently-Typed Formalisation of Typed Term Graphs}




\def\authorrunning{Wolfram Kahl}
\author{Wolfram Kahl
\institute{McMaster University,
Hamilton, Ontario, Canada,
\email{kahl@cas.mcmaster.ca}
}
}


\usepackage{latexsym,amssymb}
       \usepackage{graphicx}

\def\CGpicRaw#1#2{\includegraphics#2{pictures/#1.ps}}
\def\CGpic#1{\CGpicRaw{#1}{[scale=0.3]}}
\def\CGpicO#1#2{\CGpicRaw{#1}{[scale=0.3,#2]}}


\usepackage{breakurl} 

\usepackage{comment}

\usepackage{rmthm}
\renewcommand{\theoremclosing}{}


\makeatletter
\def\@thmcountersep{.}
\makeatother


\newtheorem{Def}{Definition}[section]

\usepackage{theref}
\def\TheRefWithPageRef#1{}

\newref{Def}{Def.\null{}}

\newdef{The}{Theorem}
\newdef{Lem}{Lemma}
\newdef{Prop}{Proposition}
\newref{Prop}{Prop.\null{}}
\newdef{Cor}{Corollary}
\newdef{Conv}{Convention}
\newdef{Fact}{Fact}


\def\sectionname{Sect.\null{}}
\usepackage{sectref}

\usepackage{slimfuzz}
\def\fcmp{{\scriptstyle\comp}}


\usepackage{RelNotation}
\RELsquareSymbols

\usepackage{formac}
\usepackage{qed}
\let\QED=\qed


\usepackage{objA}
\usepackage{CalABC}

\renewcommand{\arraystretch}{1.1}










\newcommand{\tlowername}[2]{#2}

\newcommand{\tcase}[1]{\makebox[23pt]{\raisebox{2.5pt}{#1{20}}}}

\newcommand{\Tcase}[2]{\makebox[23pt]{\raisebox{2.5pt}{}}}

\newcommand{\tbicase}[1]{\makebox[23pt]{\raisebox{1pt}{#1{20}}}}

\newcommand{\Tbicase}[3]{\makebox[23pt]{\raisebox{-7pt}{}}}






\newcommand{\AR}[1]{\begin{picture}(#1,0)\put(0,0){\vector(1,0){#1}}\end{picture}}

\newcommand{\DOTAR}[1]{\NUMBEROFDOTS=#1\divide\NUMBEROFDOTS by 3\begin{picture}(#1,0)\multiput(0,0)(3,0){\NUMBEROFDOTS}{\circle*{1}}\put(#1,0){\vector(1,0){0}}\end{picture}}


\newcommand{\MONO}[1]{\begin{picture}(#1,0)\put(0,0){\vector(1,0){#1}}\put(2,-2){\line(0,1){4}}\end{picture}}

\newcommand{\EPI}[1]{\begin{picture}(#1,0)(-#1,0)\put(-#1,0){\vector(1,0){#1}}\put(-6,-2){\line(0,1){4}}\end{picture}}

\newcommand{\BIMO}[1]{\begin{picture}(#1,0)(-#1,0)\put(-#1,0){\vector(1,0){#1}}\put(-6,-2){\line(0,1){4}}\put(-#1,-2){\hspace{2pt}\line(0,1){4}}\end{picture}}

\newcommand{\BIAR}[1]{\begin{picture}(#1,4)\put(0,0){\vector(1,0){#1}}\put(0,4){\vector(1,0){#1}}\end{picture}}

\newcommand{\EQL}[1]{\begin{picture}(#1,0)\put(0,1){\line(1,0){#1}}\put(0,-1){\line(1,0){#1}}\end{picture}}

\newcommand{\ADJAR}[1]{\begin{picture}(#1,4)\put(0,0){\vector(1,0){#1}}\put(#1,4){\vector(-1,0){#1}}\end{picture}}




\newcommand{\ar}{\tcase{\AR}}

\newcommand{\Ar}[1]{\Tcase{\AR}{#1}}

\newcommand{\dotar}{\tcase{\DOTAR}}

\newcommand{\Dotar}[1]{\Tcase{\DOTAR}{#1}}


\def\mono{\tcase{\MONO}}

\newcommand{\Mono}[1]{\Tcase{\MONO}{#1}}

\newcommand{\epi}{\tcase{\EPI}}

\newcommand{\Epi}[1]{\Tcase{\EPI}{#1}}

\newcommand{\bimo}{\tcase{\BIMO}}

\newcommand{\Bimo}[1]{\Tcase{\BIMO}{#1}}

\newcommand{\iso}{\Tcase{\AR}{\cong}}

\newcommand{\Iso}[1]{\Tcase{\AR}{\cong{#1}}}

\newcommand{\biar}{\tbicase{\BIAR}}

\newcommand{\Biar}[2]{\Tbicase{\BIAR}{#1}{#2}}

\newcommand{\eql}{\tcase{\EQL}}

\newcommand{\adjar}{\tbicase{\ADJAR}}

\newcommand{\Adjar}[2]{\Tbicase{\ADJAR}{#1}{#2}}






\newcommand{\BKAR}[1]{\begin{picture}(#1,0)\put(#1,0){\vector(-1,0){#1}}\end{picture}}

\newcommand{\BKDOTAR}[1]{\NUMBEROFDOTS=#1\divide\NUMBEROFDOTS by 3\begin{picture}(#1,0)\multiput(#1,0)(-3,0){\NUMBEROFDOTS}{\circle*{1}}\put(0,0){\vector(-1,0){0}}\end{picture}}


\newcommand{\BKMONO}[1]{\begin{picture}(#1,0)(-#1,0)\put(0,0){\vector(-1,0){#1}}\put(-2,-2){\line(0,1){4}}\end{picture}}

\newcommand{\BKEPI}[1]{\begin{picture}(#1,0)\put(#1,0){\vector(-1,0){#1}}\put(6,-2){\line(0,1){4}}\end{picture}}

\newcommand{\BKBIMO}[1]{\begin{picture}(#1,0)\put(#1,0){\vector(-1,0){#1}}\put(6,-2){\line(0,1){4}}\put(#1,-2){\hspace{-2pt}\line(0,1){4}}\end{picture}}

\newcommand{\BKBIAR}[1]{\begin{picture}(#1,4)\put(#1,0){\vector(-1,0){#1}}\put(#1,4){\vector(-1,0){#1}}\end{picture}}

\newcommand{\BKADJAR}[1]{\begin{picture}(#1,4)\put(0,4){\vector(1,0){#1}}\put(#1,0){\vector(-1,0){#1}}\end{picture}}





\newcommand{\bkar}{\tcase{\BKAR}}

\newcommand{\Bkar}[1]{\Tcase{\BKAR}{#1}}

\newcommand{\bkdotar}{\tcase{\BKDOTAR}}

\newcommand{\Bkdotar}[1]{\Tcase{\BKDOTAR}{#1}}

\newcommand{\bkmono}{\tcase{\BKMONO}}

\newcommand{\Bkmono}[1]{\Tcase{\BKMONO}{#1}}

\newcommand{\bkepi}{\tcase{\BKEPI}}

\newcommand{\Bkepi}[1]{\Tcase{\BKEPI}{#1}}

\newcommand{\bkbimo}{\tcase{\BKBIMO}}

\newcommand{\Bkbimo}[1]{\Tcase{\BKBIMO}{\hspace{9pt}#1}}

\newcommand{\bkiso}{\Tcase{\BKAR}{\cong}}

\newcommand{\Bkiso}[1]{\Tcase{\BKAR}{\cong{#1}}}

\newcommand{\bkbiar}{\tbicase{\BKBIAR}}

\newcommand{\Bkbiar}[2]{\Tbicase{\BKBIAR}{#1}{#2}}

\newcommand{\bkeql}{\tcase{\EQL}}

\newcommand{\bkadjar}{\tbicase{\BKADJAR}}

\newcommand{\Bkadjar}[2]{\Tbicase{\BKADJAR}{#1}{#2}}






\newcommand{\lowername}[2]{#2}

\newcommand{\hcase}[2]{\makebox[0pt]{\raisebox{-1pt}[0pt][0pt]{#1{#2}}}}

\newcommand{\Hcase}[3]{\makebox[0pt]
{\raisebox{-1pt}[0pt][0pt]{\textstyle{#2}}}}

\newcommand{\hcasE}[3]{\makebox[0pt]{\raisebox{-2pt}[0pt][0pt]{\lowername{#1{#3}}{#2}}}}

\newcommand{\hbicase}[2]{\makebox[0pt]{\raisebox{-2.5pt}[0pt][0pt]{#1{#2}}}}

\newcommand{\Hbicase}[4]{\makebox[0pt]
{\raisebox{-10.5pt}[0pt][0pt]{\textstyle{#2}}}}






\newcommand{\EAR}[1]{\begin{picture}(#1,0)\put(0,0){\vector(1,0){#1}}\end{picture}}

\newcommand{\EDOTAR}[1]{\truex{100}\truey{300}\NUMBEROFDOTS=#1\divide\NUMBEROFDOTS by \value{y}\begin{picture}(#1,0)\multiput(0,0)(\value{y},0){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(#1,0){\vector(1,0){0}}\end{picture}}


\newcommand{\EMONO}[1]{\begin{picture}(#1,0)\put(0,0){\vector(1,0){#1}}\truex{300}\truey{600}\put(\value{x},-\value{x}){\line(0,1){\value{y}}}\end{picture}}

\newcommand{\EEPI}[1]{\begin{picture}(#1,0)(-#1,0)\put(-#1,0){\vector(1,0){#1}}\truex{300}\truey{600}\truez{800}\put(-\value{z},-\value{x}){\line(0,1){\value{y}}}\end{picture}}

\newcommand{\EBIMO}[1]{\begin{picture}(#1,0)(-#1,0)\put(-#1,0){\vector(1,0){#1}}\truex{300}\truey{600}\truez{800}\put(-\value{z},-\value{x}){\line(0,1){\value{y}}}\put(-#1,-\value{x}){\hspace{3pt}\line(0,1){\value{y}}}\end{picture}}

\newcommand{\EBIAR}[1]{\truex{400}\begin{picture}(#1,\value{x})\put(0,0){\vector(1,0){#1}}\put(0,\value{x}){\vector(1,0){#1}}\end{picture}}

\newcommand{\EEQL}[1]{\begin{picture}(#1,0)\truex{200}\put(0,\value{x}){\line(1,0){#1}}\put(0,0){\line(1,0){#1}}\end{picture}}

\newcommand{\EADJAR}[1]{\truex{400}\begin{picture}(#1,\value{x})\put(0,0){\vector(1,0){#1}}\put(#1,\value{x}){\vector(-1,0){#1}}\end{picture}}




\newcommand{\earv}[1]{\hcase{\EAR}{#100}}

\newcommand{\ear}{\hspace{\SOURCE\unitlength}\hcase{\EAR}{\ARROWLENGTH}}

\newcommand{\Earv}[2]{\Hcase{\EAR}{#1}{#200}}

\newcommand{\Ear}[1]{\hspace{\SOURCE\unitlength}\Hcase{\EAR}{#1}{\ARROWLENGTH}}

\newcommand{\eaRv}[2]{\hcasE{\EAR}{#1}{#200}}

\newcommand{\eaR}[1]{\hspace{\SOURCE\unitlength}\hcasE{\EAR}{#1}{\ARROWLENGTH}}

\newcommand{\edotarv}[1]{\hcase{\EDOTAR}{#100}}

\newcommand{\edotar}{\hspace{\SOURCE\unitlength}\hcase{\EDOTAR}{\ARROWLENGTH}}

\newcommand{\Edotarv}[2]{\Hcase{\EDOTAR}{#1}{#200}}

\newcommand{\Edotar}[1]{\hspace{\SOURCE\unitlength}\Hcase{\EDOTAR}{#1}{\ARROWLENGTH}}

\newcommand{\edotaRv}[2]{\hcasE{\EDOTAR}{#1}{#200}}

\newcommand{\edotaR}[1]{\hspace{\SOURCE\unitlength}\hcasE{\EDOTAR}{#1}{\ARROWLENGTH}}

\newcommand{\emonov}[1]{\hcase{\EMONO}{#100}}

\newcommand{\emono}{\hspace{\SOURCE\unitlength}\hcase{\EMONO}{\ARROWLENGTH}}

\newcommand{\Emonov}[2]{\Hcase{\EMONO}{#1}{#200}}

\newcommand{\Emono}[1]{\hspace{\SOURCE\unitlength}\Hcase{\EMONO}{#1}{\ARROWLENGTH}}

\newcommand{\emonOv}[2]{\hcasE{\EMONO}{#1}{#200}}

\newcommand{\emonO}[1]{\hspace{\SOURCE\unitlength}\hcasE{\EMONO}{#1}{\ARROWLENGTH}}

\newcommand{\eepiv}[1]{\hcase{\EEPI}{#100}}

\newcommand{\eepi}{\hspace{\SOURCE\unitlength}\hcase{\EEPI}{\ARROWLENGTH}}

\newcommand{\Eepiv}[2]{\Hcase{\EEPI}{#1}{#200}}

\newcommand{\Eepi}[1]{\hspace{\SOURCE\unitlength}\Hcase{\EEPI}{#1}{\ARROWLENGTH}}

\newcommand{\eepIv}[2]{\hcasE{\EEPI}{#1}{#200}}

\newcommand{\eepI}[1]{\hspace{\SOURCE\unitlength}\hcasE{\EEPI}{#1}{\ARROWLENGTH}}

\newcommand{\ebimov}[1]{\hcase{\EBIMO}{#100}}

\newcommand{\ebimo}{\hspace{\SOURCE\unitlength}\hcase{\EBIMO}{\ARROWLENGTH}}

\newcommand{\Ebimov}[2]{\Hcase{\EBIMO}{#1}{#200}}

\newcommand{\Ebimo}[1]{\hspace{\SOURCE\unitlength}\Hcase{\EBIMO}{#1}{\ARROWLENGTH}}

\newcommand{\ebimOv}[2]{\hcasE{\EBIMO}{#1}{#200}}

\newcommand{\ebimO}[1]{\hspace{\SOURCE\unitlength}\hcasE{\EBIMO}{#1}{\ARROWLENGTH}}

\newcommand{\eisov}[1]{\Hcase{\EAR}{\cong}{#100}}

\newcommand{\eiso}{\hspace{\SOURCE\unitlength}\Hcase{\EAR}{\cong}{\ARROWLENGTH}}

\newcommand{\Eisov}[2]{\Hcase{\EAR}{\cong#1}{#200}}

\newcommand{\Eiso}[1]{\hspace{\SOURCE\unitlength}\Hcase{\EAR}{\cong#1}{\ARROWLENGTH}}

\newcommand{\eisOv}[2]{\hcasE{\EAR}{\cong#1}{#200}}

\newcommand{\eisO}[1]{\hspace{\SOURCE\unitlength}\hcasE{\EAR}{\cong#1}{\ARROWLENGTH}}

\newcommand{\ebiarv}[1]{\hbicase{\EBIAR}{#100}}

\newcommand{\ebiar}{\hspace{\SOURCE\unitlength}\hbicase{\EBIAR}{\ARROWLENGTH}}

\newcommand{\Ebiarv}[3]{\Hbicase{\EBIAR}{#1}{#2}{#300}}

\newcommand{\Ebiar}[2]{\hspace{\SOURCE\unitlength}\Hbicase{\EBIAR}{#1}{#2}{\ARROWLENGTH}}

\newcommand{\eeqlv}[1]{\hcase{\EEQL}{#100}}

\newcommand{\eeql}{\hspace{\SOURCE\unitlength}\hbicase{\EEQL}{\ARROWLENGTH}}

\newcommand{\eadjarv}[1]{\hbicase{\EADJAR}{#100}}

\newcommand{\eadjar}{\hspace{\SOURCE\unitlength}\hbicase{\EADJAR}{\ARROWLENGTH}}

\newcommand{\Eadjarv}[3]{\Hbicase{\EADJAR}{#1}{#2}{#300}}

\newcommand{\Eadjar}[2]{\hspace{\SOURCE\unitlength}\Hbicase{\EADJAR}{#1}{#2}{\ARROWLENGTH}}






\newcommand{\WAR}[1]{\begin{picture}(#1,0)\put(#1,0){\vector(-1,0){#1}}\end{picture}}

\newcommand{\WDOTAR}[1]{\truex{100}\truey{300}\NUMBEROFDOTS=#1\divide\NUMBEROFDOTS by \value{y}\begin{picture}(#1,0)\multiput(#1,0)(-\value{y},0){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(0,0){\vector(-1,0){0}}\end{picture}}

\newcommand{\WMONO}[1]{\begin{picture}(#1,0)(-#1,0)\put(0,0){\vector(-1,0){#1}}\truex{300}\truey{600}\put(-\value{x},-\value{x}){\line(0,1){\value{y}}}\end{picture}}

\newcommand{\WEPI}[1]{\begin{picture}(#1,0)\put(#1,0){\vector(-1,0){#1}}\truex{300}\truey{600}\truez{800}\put(\value{z},-\value{x}){\line(0,1){\value{y}}}\end{picture}}

\newcommand{\WBIMO}[1]{\begin{picture}(#1,0)\put(#1,0){\vector(-1,0){#1}}\truex{300}\truey{600}\truez{800}\put(\value{z},-\value{x}){\line(0,1){\value{y}}}\put(#1,-\value{x}){\hspace{-3pt}\line(0,1){\value{y}}}\end{picture}}

\newcommand{\WBIAR}[1]{\truex{400}\begin{picture}(#1,\value{x})\put(#1,0){\vector(-1,0){#1}}\put(#1,\value{x}){\vector(-1,0){#1}}\end{picture}}

\newcommand{\WADJAR}[1]{\truex{400}\begin{picture}(#1,\value{x})\put(0,\value{x}){\vector(1,0){#1}}\put(#1,0){\vector(-1,0){#1}}\end{picture}}




\newcommand{\warv}[1]{\hcase{\WAR}{#100}}

\newcommand{\war}{\hspace{\SOURCE\unitlength}\hcase{\WAR}{\ARROWLENGTH}}

\newcommand{\Warv}[2]{\Hcase{\WAR}{#1}{#200}}

\newcommand{\War}[1]{\hspace{\SOURCE\unitlength}\Hcase{\WAR}{#1}{\ARROWLENGTH}}

\newcommand{\waRv}[2]{\hcasE{\WAR}{#1}{#200}}

\newcommand{\waR}[1]{\hspace{\SOURCE\unitlength}\hcasE{\WAR}{#1}{\ARROWLENGTH}}

\newcommand{\wdotarv}[1]{\hcase{\WDOTAR}{#100}}

\newcommand{\wdotar}{\hspace{\SOURCE\unitlength}\hcase{\WDOTAR}{\ARROWLENGTH}}

\newcommand{\Wdotarv}[2]{\Hcase{\WDOTAR}{#1}{#200}}

\newcommand{\Wdotar}[1]{\hspace{\SOURCE\unitlength}\Hcase{\WDOTAR}{#1}{\ARROWLENGTH}}

\newcommand{\wdotaRv}[2]{\hcasE{\WDOTAR}{#1}{#200}}

\newcommand{\wdotaR}[1]{\hspace{\SOURCE\unitlength}\hcasE{\WDOTAR}{#1}{\ARROWLENGTH}}

\newcommand{\wmonov}[1]{\hcase{\WMONO}{#100}}

\newcommand{\wmono}{\hspace{\SOURCE\unitlength}\hcase{\WMONO}{\ARROWLENGTH}}

\newcommand{\Wmonov}[2]{\Hcase{\WMONO}{#1}{#200}}

\newcommand{\Wmono}[1]{\hspace{\SOURCE\unitlength}\Hcase{\WMONO}{#1}{\ARROWLENGTH}}

\newcommand{\wmonOv}[2]{\hcasE{\WMONO}{#1}{#200}}

\newcommand{\wmonO}[1]{\hspace{\SOURCE\unitlength}\hcasE{\WMONO}{#1}{\ARROWLENGTH}}

\newcommand{\wepiv}[1]{\hcase{\WEPI}{#100}}

\newcommand{\wepi}{\hspace{\SOURCE\unitlength}\hcase{\WEPI}{\ARROWLENGTH}}

\newcommand{\Wepiv}[2]{\Hcase{\WEPI}{#1}{#200}}

\newcommand{\Wepi}[1]{\hspace{\SOURCE\unitlength}\Hcase{\WEPI}{#1}{\ARROWLENGTH}}

\newcommand{\wepIv}[2]{\hcasE{\WEPI}{#1}{#200}}

\newcommand{\wepI}[1]{\hspace{\SOURCE\unitlength}\hcasE{\WEPI}{#1}{\ARROWLENGTH}}

\newcommand{\wbimov}[1]{\hcase{\WBIMO}{#100}}

\newcommand{\wbimo}{\hspace{\SOURCE\unitlength}\hcase{\WBIMO}{\ARROWLENGTH}}

\newcommand{\Wbimov}[2]{\Hcase{\WBIMO}{#1}{#200}}

\newcommand{\Wbimo}[1]{\hspace{\SOURCE\unitlength}\Hcase{\WBIMO}{#1}{\ARROWLENGTH}}

\newcommand{\wbimOv}[2]{\hcasE{\WBIMO}{#1}{#200}}

\newcommand{\wbimO}[1]{\hspace{\SOURCE\unitlength}\hcasE{\WBIMO}{#1}{\ARROWLENGTH}}

\newcommand{\wisov}[1]{\Hcase{\WAR}{\cong}{#100}}

\newcommand{\wiso}{\hspace{\SOURCE\unitlength}\Hcase{\WAR}{\cong}{\ARROWLENGTH}}

\newcommand{\Wisov}[2]{\Hcase{\WAR}{\cong#1}{#200}}

\newcommand{\Wiso}[1]{\hspace{\SOURCE\unitlength}\Hcase{\WAR}{#1}{\ARROWLENGTH}}

\newcommand{\wisOv}[2]{\hcasE{\WAR}{\cong#1}{#200}}

\newcommand{\wisO}[1]{\hspace{\SOURCE\unitlength}\hcasE{\WAR}{#1}{\ARROWLENGTH}}

\newcommand{\wbiarv}[1]{\hbicase{\WBIAR}{#100}}

\newcommand{\wbiar}{\hspace{\SOURCE\unitlength}\hbicase{\WBIAR}{\ARROWLENGTH}}

\newcommand{\Wbiarv}[3]{\Hbicase{\WBIAR}{#1}{#2}{#300}}

\newcommand{\Wbiar}[2]{\hspace{\SOURCE\unitlength}\Hbicase{\WBIAR}{#1}{#2}{\ARROWLENGTH}}

\newcommand{\weqlv}[1]{\hbicase{\EEQL}{#100}}

\newcommand{\weql}{\hspace{\SOURCE\unitlength}\hbicase{\EEQL}{\ARROWLENGTH}}

\newcommand{\wadjarv}[1]{\hbicase{\WADJAR}{#100}}

\newcommand{\wadjar}{\hspace{\SOURCE\unitlength}\hbicase{\WADJAR}{\ARROWLENGTH}}

\newcommand{\Wadjarv}[3]{\Hbicase{\WADJAR}{#1}{#2}{#300}}

\newcommand{\Wadjar}[2]{\hspace{\SOURCE\unitlength}\Hbicase{\WADJAR}{#1}{#2}{\ARROWLENGTH}}







\newcommand{\vcase}[2]{#1{#2}}

\newcommand{\Vcase}[3]{\makebox[0pt]{\makebox[0pt][r]{\raisebox{0pt}[0pt][0pt]{}}}#1{#3}}

\newcommand{\vcasE}[3]{\makebox[0pt]{#1{#3}\makebox[0pt][l]{\raisebox{0pt}[0pt][0pt]{\hspace{2pt}}}}}

\newcommand{\vbicase}[2]{\makebox[0pt]{{#1{#2}}}}

\newcommand{\Vbicase}[4]{\makebox[0pt]{\makebox[0pt][r]{\raisebox{0pt}[0pt][0pt]{\hspace{4pt}}}#1{#4}\makebox[0pt][l]{\raisebox{0pt}[0pt][0pt]{\hspace{5pt}}}}}







\newcommand{\SAR}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,#1){\vector(0,-1){#1}}\end{picture}}}\end{picture}}

\newcommand{\SDOTAR}[1]{\truex{100}\truey{300}\NUMBEROFDOTS=#1\divide\NUMBEROFDOTS by \value{y}\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\multiput(0,#1)(0,-\value{y}){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(0,0){\vector(0,-1){0}}\end{picture}}}\end{picture}}

\newcommand{\SMONO}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,#1){\vector(0,-1){#1}}\truex{300}\truey{600}\put(0,#1){\begin{picture}(0,0)\put(-\value{x},-\value{x}){\line(1,0){\value{y}}}\end{picture}}\end{picture}}}\end{picture}}


\newcommand{\SEPI}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,#1){\vector(0,-1){#1}}\truex{300}\truey{600}\truez{800}\put(-\value{x},\value{z}){\line(1,0){\value{y}}}\end{picture}}}\end{picture}}

\newcommand{\SBIMO}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,#1){\vector(0,-1){#1}}\truex{300}\truey{600}\truez{800}\put(0,#1){\begin{picture}(0,0)\put(-\value{x},-\value{x}){\line(1,0){\value{y}}}\end{picture}}\put(-\value{x},\value{z}){\line(1,0){\value{y}}}\end{picture}}}\end{picture}}

\newcommand{\SBIAR}[1]{\begin{picture}(0,0)\truex{200}\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(-\value{x},#1){\vector(0,-1){#1}}\put(\value{x},#1){\vector(0,-1){#1}}\end{picture}}}\end{picture}}

\newcommand{\SEQL}[1]{\begin{picture}(0,0)\truex{100}\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(-\value{x},#1){\line(0,-1){#1}}\put(\value{x},#1){\line(0,-1){#1}}\end{picture}}}\end{picture}}

\newcommand{\SADJAR}[1]{\begin{picture}(0,0)\truex{200}\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(-\value{x},#1){\vector(0,-1){#1}}\put(\value{x},0){\vector(0,1){#1}}\end{picture}}}\end{picture}}




\newcommand{\sarv}[1]{\vcase{\SAR}{#100}}

\newcommand{\sar}{\sarv{50}}

\newcommand{\Sarv}[2]{\Vcase{\SAR}{#1}{#200}}

\newcommand{\Sar}[1]{\Sarv{#1}{50}}

\newcommand{\saRv}[2]{\vcasE{\SAR}{#1}{#200}}

\newcommand{\saR}[1]{\saRv{#1}{50}}

\newcommand{\sdotarv}[1]{\vcase{\SDOTAR}{#100}}

\newcommand{\sdotar}{\sdotarv{50}}

\newcommand{\Sdotarv}[2]{\Vcase{\SDOTAR}{#1}{#200}}

\newcommand{\Sdotar}[1]{\Sdotarv{#1}{50}}

\newcommand{\sdotaRv}[2]{\vcasE{\SDOTAR}{#1}{#200}}

\newcommand{\sdotaR}[1]{\sdotaRv{#1}{50}}

\newcommand{\smonov}[1]{\vcase{\SMONO}{#100}}

\newcommand{\smono}{\smonov{50}}

\newcommand{\Smonov}[2]{\Vcase{\SMONO}{#1}{#200}}

\newcommand{\Smono}[1]{\Smonov{#1}{50}}

\newcommand{\smonOv}[2]{\vcasE{\SMONO}{#1}{#200}}

\newcommand{\smonO}[1]{\smonOv{#1}{50}}

\newcommand{\sepiv}[1]{\vcase{\SEPI}{#100}}

\newcommand{\sepi}{\sepiv{50}}

\newcommand{\Sepiv}[2]{\Vcase{\SEPI}{#1}{#200}}

\newcommand{\Sepi}[1]{\Sepiv{#1}{50}}

\newcommand{\sepIv}[2]{\vcasE{\SEPI}{#1}{#200}}

\newcommand{\sepI}[1]{\sepIv{#1}{50}}

\newcommand{\sbimov}[1]{\vcase{\SBIMO}{#100}}

\newcommand{\sbimo}{\sbimov{50}}

\newcommand{\Sbimov}[2]{\Vcase{\SBIMO}{#1}{#200}}

\newcommand{\Sbimo}[1]{\Sbimov{#1}{50}}

\newcommand{\sbimOv}[2]{\vcasE{\SBIMO}{#1}{#200}}

\newcommand{\sbimO}[1]{\sbimOv{#1}{50}}

\newcommand{\sisov}[1]{\vcasE{\SAR}{\cong}{#100}}

\newcommand{\siso}{\sisov{50}}

\newcommand{\Sisov}[2]{\Vbicase{\SAR}{#1\hspace{-2pt}}{\hspace{-2pt}\cong}{#200}}

\newcommand{\Siso}[1]{\Sisov{#1}{50}}

\newcommand{\sbiarv}[1]{\vbicase{\SBIAR}{#100}}

\newcommand{\sbiar}{\sbiarv{50}}

\newcommand{\Sbiarv}[3]{\Vbicase{\SBIAR}{#1}{#2}{#300}}

\newcommand{\Sbiar}[2]{\Sbiarv{#1}{#2}{50}}

\newcommand{\seqlv}[1]{\vbicase{\SEQL}{#100}}

\newcommand{\seql}{\seqlv{50}}

\newcommand{\sadjarv}[1]{\vbicase{\SADJAR}{#100}}

\newcommand{\sadjar}{\sadjarv{50}}

\newcommand{\Sadjarv}[3]{\Vbicase{\SADJAR}{#1}{#2}{#300}}

\newcommand{\Sadjar}[2]{\Sadjarv{#1}{#2}{50}}






\newcommand{\NAR}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,0){\vector(0,1){#1}}\end{picture}}}\end{picture}}

\newcommand{\NDOTAR}[1]{\truex{100}\truey{300}\NUMBEROFDOTS=#1\divide\NUMBEROFDOTS by \value{y}\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\multiput(0,0)(0,\value{y}){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(0,#1){\vector(0,1){0}}\end{picture}}}\end{picture}}


\newcommand{\NMONO}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,0){\vector(0,1){#1}}\truex{300}\truey{600}\put(-\value{x},\value{x}){\line(1,0){\value{y}}}\end{picture}}}\end{picture}}

\newcommand{\NEPI}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,0){\vector(0,1){#1}}\truex{300}\truey{600}\truez{800}\put(0,#1){\begin{picture}(0,0)\put(-\value{x},-\value{z}){\line(1,0){\value{y}}}\end{picture}}\end{picture}}}\end{picture}}

\newcommand{\NBIMO}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(0,0){\vector(0,1){#1}}\truex{300}\truey{600}\truez{800}\put(-\value{x},\value{x}){\line(1,0){\value{y}}}\put(0,#1){\begin{picture}(0,0)\put(-\value{x},-\value{z}){\line(1,0){\value{y}}}\end{picture}}\end{picture}}}\end{picture}}

\newcommand{\NBIAR}[1]{\begin{picture}(0,0)\truex{200}\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(-\value{x},0){\vector(0,1){#1}}\put(\value{x},0){\vector(0,1){#1}}\end{picture}}}\end{picture}}

\newcommand{\NADJAR}[1]{\begin{picture}(0,0)\truex{200}\put(0,0){\makebox(0,0){\begin{picture}(0,#1)\put(\value{x},#1){\vector(0,-1){#1}}\put(-\value{x},0){\vector(0,1){#1}}\end{picture}}}\end{picture}}




\newcommand{\narv}[1]{\vcase{\NAR}{#100}}

\newcommand{\nar}{\narv{50}}

\newcommand{\Narv}[2]{\Vcase{\NAR}{#1}{#200}}

\newcommand{\Nar}[1]{\Narv{#1}{50}}

\newcommand{\naRv}[2]{\vcasE{\NAR}{#1}{#200}}

\newcommand{\naR}[1]{\naRv{#1}{50}}

\newcommand{\ndotarv}[1]{\vcase{\NDOTAR}{#100}}

\newcommand{\ndotar}{\ndotarv{50}}

\newcommand{\Ndotarv}[2]{\Vcase{\NDOTAR}{#1}{#200}}

\newcommand{\Ndotar}[1]{\Ndotarv{#1}{50}}

\newcommand{\ndotaRv}[2]{\vcasE{\NDOTAR}{#1}{#200}}

\newcommand{\ndotaR}[1]{\ndotaRv{#1}{50}}

\newcommand{\nmonov}[1]{\vcase{\NMONO}{#100}}

\newcommand{\nmono}{\nmonov{50}}

\newcommand{\Nmonov}[2]{\Vcase{\NMONO}{#1}{#200}}

\newcommand{\Nmono}[1]{\Nmonov{#1}{50}}

\newcommand{\nmonOv}[2]{\vcasE{\NMONO}{#1}{#200}}

\newcommand{\nmonO}[1]{\nmonOv{#1}{50}}

\newcommand{\nepiv}[1]{\vcase{\NEPI}{#100}}

\newcommand{\nepi}{\nepiv{50}}

\newcommand{\Nepiv}[2]{\Vcase{\NEPI}{#1}{#200}}

\newcommand{\Nepi}[1]{\Nepiv{#1}{50}}

\newcommand{\nepIv}[2]{\vcasE{\NEPI}{#1}{#200}}

\newcommand{\nepI}[1]{\nepIv{#1}{50}}

\newcommand{\nbimov}[1]{\vcase{\NBIMO}{#100}}

\newcommand{\nbimo}{\nbimov{50}}

\newcommand{\Nbimov}[2]{\Vcase{\NBIMO}{#1}{#200}}

\newcommand{\Nbimo}[1]{\Nbimov{#1}{50}}

\newcommand{\nbimOv}[2]{\vcasE{\NBIMO}{#1}{#200}}

\newcommand{\nbimO}[1]{\nbimOv{#1}{50}}

\newcommand{\nisov}[1]{\vcasE{\NAR}{\cong}{#100}}

\newcommand{\niso}{\nisov{50}}

\newcommand{\Nisov}[2]{\Vbicase{\NAR}{#1\hspace{-2pt}}{\hspace{-2pt}\cong}{#200}}

\newcommand{\Niso}[1]{\Nisov{#1}{50}}

\newcommand{\nbiarv}[1]{\vbicase{\NBIAR}{#100}}

\newcommand{\nbiar}{\nbiarv{50}}

\newcommand{\Nbiarv}[3]{\Vbicase{\NBIAR}{#1}{#2}{#300}}

\newcommand{\Nbiar}[2]{\Nbiarv{#1}{#2}{50}}

\newcommand{\neqlv}[1]{\vbicase{\SEQL}{#100}}

\newcommand{\neql}{\neqlv{50}}

\newcommand{\nadjarv}[1]{\vbicase{\NADJAR}{#100}}

\newcommand{\nadjar}{\nadjarv{50}}

\newcommand{\Nadjarv}[3]{\Vbicase{\NADJAR}{#1}{#2}{#300}}

\newcommand{\Nadjar}[2]{\Nadjarv{#1}{#2}{50}}





\newcommand{\fdcase}[3]{\begin{picture}(0,0)\put(0,-150){#1}\truex{200}\truey{600}\truez{600}\put(-\value{x},-\value{x}){\makebox(0,\value{z})[r]{}}\put(\value{x},-\value{y}){\makebox(0,\value{z})[l]{}}\end{picture}}

\newcommand{\fdbicase}[3]{\begin{picture}(0,0)\put(0,-150){#1}\truex{800}\truey{50}\put(-\value{x},\value{y}){}\truex{200}\truey{950}\put(\value{x},-\value{y}){}\end{picture}}







\newcommand{\NEAR}{\begin{picture}(0,0)\put(-2900,-2900){\vector(1,1){5800}}\end{picture}}

\newcommand{\NEDOTAR}{\truex{100}\truey{212}\NUMBEROFDOTS=5800\divide\NUMBEROFDOTS by \value{y}\begin{picture}(0,0)\multiput(-2900,-2900)(\value{y},\value{y}){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(2900,2900){\vector(1,1){0}}\end{picture}}

\newcommand{\NEMONO}{\begin{picture}(0,0)\put(-2900,-2900){\vector(1,1){5800}}\put(-2900,-2900){\begin{picture}(0,0)\truex{141}\put(\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\NEEPI}{\begin{picture}(0,0)\put(-2900,-2900){\vector(1,1){5800}}\put(2900,2900){\begin{picture}(0,0)\truex{545}\put(-\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\NEBIMO}{\begin{picture}(0,0)\put(-2900,-2900){\vector(1,1){5800}}\put(2900,2900){\begin{picture}(0,0)\truex{545}\put(-\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}
\put(-2900,-2900){\begin{picture}(0,0)\truex{141}\put(\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\NEBIAR}{\begin{picture}(0,0)\put(-2900,-2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},\value{x}){\vector(1,1){5800}}\put(\value{x},-\value{x}){\vector(1,1){5800}}\end{picture}}\end{picture}}

\newcommand{\NEEQL}{\begin{picture}(0,0)\put(-2900,-2900){\begin{picture}(0,0)\truex{70}\put(-\value{x},\value{x}){\line(1,1){5800}}\put(\value{x},-\value{x}){\line(1,1){5800}}\end{picture}}\end{picture}}

\newcommand{\NEADJAR}{\begin{picture}(0,0)\put(-2900,-2900){\begin{picture}(0,0)\truex{141}\put(\value{x},-\value{x}){\vector(1,1){5800}}\end{picture}}\put(2900,2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},\value{x}){\vector(-1,-1){5800}}\end{picture}}\end{picture}}

\newcommand{\NEARV}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(#1,#1)\put(0,0){\vector(1,1){#1}}\end{picture}}}\end{picture}}




\newcommand{\near}{\fdcase{\NEAR}{}{}}

\newcommand{\Near}[1]{\fdcase{\NEAR}{#1}{}}

\newcommand{\neaR}[1]{\fdcase{\NEAR}{}{#1}}

\newcommand{\nedotar}{\fdcase{\NEDOTAR}{}{}}

\newcommand{\Nedotar}[1]{\fdcase{\NEDOTAR}{#1}{}}

\newcommand{\nedotaR}[1]{\fdcase{\NEDOTAR}{}{#1}}

\newcommand{\nemono}{\fdcase{\NEMONO}{}{}}

\newcommand{\Nemono}[1]{\fdcase{\NEMONO}{#1}{}}

\newcommand{\nemonO}[1]{\fdcase{\NEMONO}{}{#1}}

\newcommand{\neepi}{\fdcase{\NEEPI}{}{}}

\newcommand{\Neepi}[1]{\fdcase{\NEEPI}{#1}{}}

\newcommand{\neepI}[1]{\fdcase{\NEEPI}{}{#1}}

\newcommand{\nebimo}{\fdcase{\NEBIMO}{}{}}

\newcommand{\Nebimo}[1]{\fdcase{\NEBIMO}{#1}{}}

\newcommand{\nebimO}[1]{\fdcase{\NEBIMO}{}{#1}}

\newcommand{\neiso}{\fdcase{\NEAR}{\hspace{-2pt}\cong}{}}

\newcommand{\Neiso}[1]{\fdcase{\NEAR}{\hspace{-2pt}\cong}{#1}}

\newcommand{\nebiar}{\fdbicase{\NEBIAR}{}{}}

\newcommand{\Nebiar}[2]{\fdbicase{\NEBIAR}{#1}{#2}}

\newcommand{\neeql}{\fdbicase{\NEEQL}{}{}}

\newcommand{\neadjar}{\fdbicase{\NEADJAR}{}{}}

\newcommand{\Neadjar}[2]{\fdbicase{\NEADJAR}{#1}{#2}}




\newcommand{\nearv}[1]{\fdcase{\NEARV{#100}}{}{}}

\newcommand{\Nearv}[2]{\fdcase{\NEARV{#200}}{#1}{}}

\newcommand{\neaRv}[2]{\fdcase{\NEARV{#200}}{}{#1}}







\newcommand{\SWAR}{\begin{picture}(0,0)\put(2900,2900){\vector(-1,-1){5800}}\end{picture}}

\newcommand{\SWDOTAR}{\truex{100}\truey{212}\NUMBEROFDOTS=5800\divide\NUMBEROFDOTS by \value{y}\begin{picture}(0,0)\multiput(2900,2900)(-\value{y},-\value{y}){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(-2900,-2900){\vector(-1,-1){0}}\end{picture}}

\newcommand{\SWMONO}{\begin{picture}(0,0)\put(2900,2900){\vector(-1,-1){5800}}\put(2900,2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\SWEPI}{\begin{picture}(0,0)\put(2900,2900){\vector(-1,-1){5800}}\put(-2900,-2900){\begin{picture}(0,0)\truex{525}\put(\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\SWBIMO}{\begin{picture}(0,0)\put(2900,2900){\vector(-1,-1){5800}}\put(2900,2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\put(-2900,-2900){\begin{picture}(0,0)\truex{525}\put(\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\SWBIAR}{\begin{picture}(0,0)\put(2900,2900){\begin{picture}(0,0)\truex{141}\put(\value{x},-\value{x}){\vector(-1,-1){5800}}\put(-\value{x},\value{x}){\vector(-1,-1){5800}}\end{picture}}\end{picture}}

\newcommand{\SWADJAR}{\begin{picture}(0,0)\put(-2900,-2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},\value{x}){\vector(1,1){5800}}\end{picture}}\put(2900,2900){\begin{picture}(0,0)\truex{141}\put(\value{x},-\value{x}){\vector(-1,-1){5800}}\end{picture}}\end{picture}}

\newcommand{\SWARV}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(#1,#1)\put(#1,#1){\vector(-1,-1){#1}}\end{picture}}}\end{picture}}




\newcommand{\swar}{\fdcase{\SWAR}{}{}}

\newcommand{\Swar}[1]{\fdcase{\SWAR}{#1}{}}

\newcommand{\swaR}[1]{\fdcase{\SWAR}{}{#1}}

\newcommand{\swdotar}{\fdcase{\SWDOTAR}{}{}}

\newcommand{\Swdotar}[1]{\fdcase{\SWDOTAR}{#1}{}}

\newcommand{\swdotaR}[1]{\fdcase{\SWDOTAR}{}{#1}}

\newcommand{\swmono}{\fdcase{\SWMONO}{}{}}

\newcommand{\Swmono}[1]{\fdcase{\SWMONO}{#1}{}}

\newcommand{\swmonO}[1]{\fdcase{\SWMONO}{}{#1}}

\newcommand{\swepi}{\fdcase{\SWEPI}{}{}}

\newcommand{\Swepi}[1]{\fdcase{\SWEPI}{#1}{}}

\newcommand{\swepI}[1]{\fdcase{\SWEPI}{}{#1}}

\newcommand{\swbimo}{\fdcase{\SWBIMO}{}{}}

\newcommand{\Swbimo}[1]{\fdcase{\SWBIMO}{#1}{}}

\newcommand{\swbimO}[1]{\fdcase{\SWBIMO}{}{#1}}

\newcommand{\swiso}{\fdcase{\SWAR}{\hspace{-2pt}\cong}{}}

\newcommand{\Swiso}[1]{\fdcase{\SWAR}{\hspace{-2pt}\cong}{#1}}

\newcommand{\swbiar}{\fdbicase{\SWBIAR}{}{}}

\newcommand{\Swbiar}[2]{\fdbicase{\SWBIAR}{#1}{#2}}

\newcommand{\sweql}{\fdbicase{\NEEQL}{}{}}

\newcommand{\swadjar}{\fdbicase{\SWADJAR}{}{}}

\newcommand{\Swadjar}[2]{\fdbicase{\SWADJAR}{#1}{#2}}




\newcommand{\swarv}[1]{\fdcase{\SWARV{#100}}{}{}}

\newcommand{\Swarv}[2]{\fdcase{\SWARV{#200}}{#1}{}}

\newcommand{\swaRv}[2]{\fdcase{\SWARV{#200}}{}{#1}}







\newcommand{\sdcase}[3]{\begin{picture}(0,0)\put(0,-150){#1}\truex{100}\truez{600}\put(\value{x},\value{x}){\makebox(0,\value{z})[l]{}}\truex{300}\truey{800}\put(-\value{x},-\value{y}){\makebox(0,\value{z})[r]{}}\end{picture}}

\newcommand{\sdbicase}[3]{\begin{picture}(0,0)\put(0,-150){#1}\truex{250}\truey{600}\truez{850}\put(\value{x},\value{x}){\makebox(0,\value{y})[l]{}}\put(-\value{x},-\value{z}){\makebox(0,\value{y})[r]{}}\end{picture}}







\newcommand{\SEAR}{\begin{picture}(0,0)\put(-2900,2900){\vector(1,-1){5800}}\end{picture}}

\newcommand{\SEDOTAR}{\truex{100}\truey{212}\NUMBEROFDOTS=5800\divide\NUMBEROFDOTS by \value{y}\begin{picture}(0,0)\multiput(-2900,2900)(\value{y},-\value{y}){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(2900,-2900){\vector(1,-1){0}}\end{picture}}

\newcommand{\SEMONO}{\begin{picture}(0,0)\put(-2900,2900){\vector(1,-1){5800}}\put(-2900,2900){\begin{picture}(0,0)\truex{141}\put(\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\SEEPI}{\begin{picture}(0,0)\put(-2900,2900){\vector(1,-1){5800}}\put(2900,-2900){\begin{picture}(0,0)\truex{525}\put(-\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\SEBIMO}{\begin{picture}(0,0)\put(-2900,2900){\vector(1,-1){5800}}\put(-2900,2900){\begin{picture}(0,0)\truex{141}\put(\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\put(2900,-2900){\begin{picture}(0,0)\truex{525}\put(-\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\SEBIAR}{\begin{picture}(0,0)\put(-2900,2900){\begin{picture}(0,0)\truex{141}
\put(-\value{x},-\value{x}){\vector(1,-1){5800}}\put(\value{x},\value{x}){\vector(1,-1){5800}}\end{picture}}\end{picture}}

\newcommand{\SEEQL}{\begin{picture}(0,0)\put(-2900,2900){\begin{picture}(0,0)\truex{70}\put(-\value{x},-\value{x}){\line(1,-1){5800}}\put(\value{x},\value{x}){\line(1,-1){5800}}\end{picture}}\end{picture}}


\newcommand{\SEADJAR}{\begin{picture}(0,0)\put(-2900,2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},-\value{x}){\vector(1,-1){5800}}\end{picture}}\put(2900,-2900){\begin{picture}(0,0)\truex{141}\put(\value{x},\value{x}){\vector(-1,1){5800}}\end{picture}}\end{picture}}

\newcommand{\SEARV}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(#1,#1)\put(0,#1){\vector(1,-1){#1}}\end{picture}}}\end{picture}}




\newcommand{\sear}{\sdcase{\SEAR}{}{}}

\newcommand{\Sear}[1]{\sdcase{\SEAR}{#1}{}}

\newcommand{\seaR}[1]{\sdcase{\SEAR}{}{#1}}

\newcommand{\sedotar}{\sdcase{\SEDOTAR}{}{}}

\newcommand{\Sedotar}[1]{\sdcase{\SEDOTAR}{#1}{}}

\newcommand{\sedotaR}[1]{\sdcase{\SEDOTAR}{}{#1}}

\newcommand{\semono}{\sdcase{\SEMONO}{}{}}

\newcommand{\Semono}[1]{\sdcase{\SEMONO}{#1}{}}

\newcommand{\semonO}[1]{\sdcase{\SEMONO}{}{#1}}

\newcommand{\seepi}{\sdcase{\SEEPI}{}{}}

\newcommand{\Seepi}[1]{\sdcase{\SEEPI}{#1}{}}

\newcommand{\seepI}[1]{\sdcase{\SEEPI}{}{#1}}

\newcommand{\sebimo}{\sdcase{\SEBIMO}{}{}}

\newcommand{\Sebimo}[1]{\sdcase{\SEBIMO}{#1}{}}

\newcommand{\sebimO}[1]{\sdcase{\SEBIMO}{}{#1}}

\newcommand{\seiso}{\sdcase{\SEAR}{\hspace{-2pt}\cong}{}}

\newcommand{\Seiso}[1]{\sdcase{\SEAR}{\hspace{-2pt}\cong}{#1}}

\newcommand{\sebiar}{\sdbicase{\SEBIAR}{}{}}

\newcommand{\Sebiar}[2]{\sdbicase{\SEBIAR}{#1}{#2}}

\newcommand{\seeql}{\sdbicase{\SEEQL}{}{}}

\newcommand{\seadjar}{\sdbicase{\SEADJAR}{}{}}

\newcommand{\Seadjar}[2]{\sdbicase{\SEADJAR}{#1}{#2}}





\newcommand{\searv}[1]{\sdcase{\SEARV{#100}}{}{}}

\newcommand{\Searv}[2]{\sdcase{\SEARV{#200}}{#1}{}}

\newcommand{\seaRv}[2]{\sdcase{\SEARV{#200}}{}{#1}}






\newcommand{\NWAR}{\begin{picture}(0,0)\put(2900,-2900){\vector(-1,1){5800}}\end{picture}}

\newcommand{\NWDOTAR}{\truex{100}\truey{212}\NUMBEROFDOTS=5800\divide\NUMBEROFDOTS by \value{y}\begin{picture}(0,0)\multiput(2900,-2900)(-\value{y},\value{y}){\NUMBEROFDOTS}{\circle*{\value{x}}}\put(-2900,2900){\vector(-1,1){0}}\end{picture}}

\newcommand{\NWMONO}{\begin{picture}(0,0)\put(2900,-2900){\vector(-1,1){5800}}\put(2900,-2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\NWEPI}{\begin{picture}(0,0)\put(2900,-2900){\vector(-1,1){5800}}\put(-2900,2900){\begin{picture}(0,0)\truex{525}\put(\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\NWBIMO}{\begin{picture}(0,0)\put(2900,-2900){\vector(-1,1){5800}}\put(2900,-2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},\value{x}){\makebox(0,0){}}\end{picture}}\put(-2900,2900){\begin{picture}(0,0)\truex{525}\put(\value{x},-\value{x}){\makebox(0,0){}}\end{picture}}\end{picture}}

\newcommand{\NWBIAR}{\begin{picture}(0,0)\put(2900,-2900){\begin{picture}(0,0)\truex{141}\put(\value{x},\value{x}){\vector(-1,1){5800}}\end{picture}}\put(2900,-2900){\begin{picture}(0,0)\truex{141}
\put(-\value{x},-\value{x}){\vector(-1,1){5800}}\end{picture}}\end{picture}}

\newcommand{\NWADJAR}{\begin{picture}(0,0)\put(-2900,2900){\begin{picture}(0,0)\truex{141}\put(\value{x},\value{x}){\vector(1,-1){5800}}\end{picture}}\put(2900,-2900){\begin{picture}(0,0)\truex{141}\put(-\value{x},-\value{x}){\vector(-1,1){5800}}\end{picture}}\end{picture}}

\newcommand{\NWARV}[1]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(#1,#1)\put(#1,0){\vector(-1,1){#1}}\end{picture}}}\end{picture}}




\newcommand{\nwar}{\sdcase{\NWAR}{}{}}

\newcommand{\Nwar}[1]{\sdcase{\NWAR}{#1}{}}

\newcommand{\nwaR}[1]{\sdcase{\NWAR}{}{#1}}

\newcommand{\nwdotar}{\sdcase{\NWDOTAR}{}{}}

\newcommand{\Nwdotar}[1]{\sdcase{\NWDOTAR}{#1}{}}

\newcommand{\nwdotaR}[1]{\sdcase{\NWDOTAR}{}{#1}}

\newcommand{\nwmono}{\sdcase{\NWMONO}{}{}}

\newcommand{\Nwmono}[1]{\sdcase{\NWMONO}{#1}{}}

\newcommand{\nwmonO}[1]{\sdcase{\NWMONO}{}{#1}}

\newcommand{\nwepi}{\sdcase{\NWEPI}{}{}}

\newcommand{\Nwepi}[1]{\sdcase{\NWEPI}{#1}{}}

\newcommand{\nwepI}[1]{\sdcase{\NWEPI}{}{#1}}

\newcommand{\nwbimo}{\sdcase{\NWBIMO}{}{}}

\newcommand{\Nwbimo}[1]{\sdcase{\NWBIMO}{#1}{}}

\newcommand{\nwbimO}[1]{\sdcase{\NWBIMO}{}{#1}}

\newcommand{\nwiso}{\sdcase{\NWAR}{\hspace{-2pt}\cong}{}}

\newcommand{\Nwiso}[1]{\sdcase{\NWAR}{\hspace{-2pt}\cong}{#1}}

\newcommand{\nwbiar}{\sdbicase{\NWBIAR}{}{}}

\newcommand{\Nwbiar}[2]{\sdbicase{\NWBIAR}{#1}{#2}}

\newcommand{\nweql}{\sdbicase{\SEEQL}{}{}}

\newcommand{\nwadjar}{\sdbicase{\NWADJAR}{}{}}

\newcommand{\Nwadjar}[2]{\sdbicase{\NWADJAR}{#1}{#2}}




\newcommand{\nwarv}[1]{\sdcase{\NWARV{#100}}{}{}}

\newcommand{\Nwarv}[2]{\sdcase{\NWARV{#200}}{#1}{}}

\newcommand{\nwaRv}[2]{\sdcase{\NWARV{#200}}{}{#1}}








\newcommand{\ENEAR}[2]{\makebox[0pt]{\begin{picture}(0,0)\put(0,-150){\makebox(0,0){\begin{picture}(0,0)\put(-6600,-3300){\vector(2,1){13200}}\truex{200}\truey{800}\truez{600}\put(-\value{x},\value{x}){\makebox(0,\value{z})[r]{}}\put(\value{x},-\value{y}){\makebox(0,\value{z})[l]{}}\end{picture}}}\end{picture}}}

\newcommand{\enear}{\ENEAR{}{}}

\newcommand{\Enear}[1]{\ENEAR{#1}{}}

\newcommand{\eneaR}[1]{\ENEAR{}{#1}}

\newcommand{\ESEAR}[2]{\makebox[0pt]{\begin{picture}(0,0)\put(0,-150){\makebox(0,0){\begin{picture}(0,0)\put(-6600,3300){\vector(2,-1){13200}}\truex{200}\truey{800}\truez{600}\put(\value{x},\value{x}){\makebox(0,\value{z})[l]{}}\put(-\value{x},-\value{y}){\makebox(0,\value{z})[r]{}}\end{picture}}}\end{picture}}}

\newcommand{\esear}{\ESEAR{}{}}

\newcommand{\Esear}[1]{\ESEAR{#1}{}}

\newcommand{\eseaR}[1]{\ESEAR{}{#1}}

\newcommand{\WNWAR}[2]{\makebox[0pt]{\begin{picture}(0,0)\put(0,-150){\makebox(0,0){\begin{picture}(0,0)\put(6600,-3300){\vector(-2,1){13200}}\truex{200}\truey{800}\truez{600}\put(\value{x},\value{x}){\makebox(0,\value{z})[l]{}}\put(-\value{x},-\value{y}){\makebox(0,\value{z})[r]{}}\end{picture}}}\end{picture}}}

\newcommand{\wnwar}{\WNWAR{}{}}

\newcommand{\Wnwar}[1]{\WNWAR{#1}{}}

\newcommand{\wnwaR}[1]{\WNWAR{}{#1}}

\newcommand{\WSWAR}[2]{\makebox[0pt]{\begin{picture}(0,0)\put(0,-150){\makebox(0,0){\begin{picture}(0,0)\put(6600,3300){\vector(-2,-1){13200}}\truex{200}\truey{800}\truez{600}\put(-\value{x},\value{x}){\makebox(0,\value{z})[r]{}}\put(\value{x},-\value{y}){\makebox(0,\value{z})[l]{}}\end{picture}}}\end{picture}}}

\newcommand{\wswar}{\WSWAR{}{}}

\newcommand{\Wswar}[1]{\WSWAR{#1}{}}

\newcommand{\wswaR}[1]{\WSWAR{}{#1}}









\newcommand{\NNEAR}[2]{\raisebox{-1pt}[0pt][0pt]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,0)\put(-3300,-6600){\vector(1,2){6600}}\truex{100}\truez{600}\put(-\value{x},\value{x}){\makebox(0,\value{z})[r]{}}\put(\value{x},-\value{z}){\makebox(0,\value{z})[l]{}}\end{picture}}}\end{picture}}}

\newcommand{\nnear}{\NNEAR{}{}}

\newcommand{\Nnear}[1]{\NNEAR{#1}{}}

\newcommand{\nneaR}[1]{\NNEAR{}{#1}}

\newcommand{\SSWAR}[2]{\raisebox{-1pt}[0pt][0pt]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,0)\put(3300,6600){\vector(-1,-2){6600}}\truex{100}\truez{600}\put(-\value{x},\value{x}){\makebox(0,\value{z})[r]{}}\put(\value{x},-\value{z}){\makebox(0,\value{z})[l]{}}\end{picture}}}\end{picture}}}

\newcommand{\sswar}{\SSWAR{}{}}

\newcommand{\Sswar}[1]{\SSWAR{#1}{}}

\newcommand{\sswaR}[1]{\SSWAR{}{#1}}

\newcommand{\SSEAR}[2]{\raisebox{-1pt}[0pt][0pt]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,0)\put(-3300,6600){\vector(1,-2){6600}}\truex{200}\truez{600}\put(\value{x},\value{x}){\makebox(0,\value{z})[l]{}}\put(-\value{x},-\value{z}){\makebox(0,\value{z})[r]{}}\end{picture}}}\end{picture}}}

\newcommand{\ssear}{\SSEAR{}{}}

\newcommand{\Ssear}[1]{\SSEAR{#1}{}}

\newcommand{\sseaR}[1]{\SSEAR{}{#1}}

\newcommand{\NNWAR}[2]{\raisebox{-1pt}[0pt][0pt]{\begin{picture}(0,0)\put(0,0){\makebox(0,0){\begin{picture}(0,0)\put(3300,-6600){\vector(-1,2){6600}}\truex{200}\truez{600}\put(\value{x},\value{x}){\makebox(0,\value{z})[l]{}}\put(-\value{x},-\value{z}){\makebox(0,\value{z})[r]{}}\end{picture}}}\end{picture}}}

\newcommand{\nnwar}{\NNWAR{}{}}

\newcommand{\Nnwar}[1]{\NNWAR{#1}{}}

\newcommand{\nnwaR}[1]{\NNWAR{}{#1}}









\newcommand{\Necurve}[2]{\begin{picture}(0,0)\truex{1300}\truey{2000}\truez{200}\put(0,\value{x}){\oval(#200,\value{y})[t]}\put(0,\value{x}){\makebox(0,0){\begin{picture}(#200,0)\put(#200,0){\vector(0,-1){\value{z}}}\put(0,0){\line(0,-1){\value{z}}}\end{picture}}}\truex{2500}\put(0,\value{x}){\makebox(0,0)[b]{}}\end{picture}}

\newcommand{\necurve}[1]{\Necurve{}{#1}}

\newcommand{\Nwcurve}[2]{\begin{picture}(0,0)\truex{1300}\truey{2000}\truez{200}\put(0,\value{x}){\oval(#200,\value{y})[t]}\put(0,\value{x}){\makebox(0,0){\begin{picture}(#200,0)\put(#200,0){\line(0,-1){\value{z}}}\put(0,0){\vector(0,-1){\value{z}}}\end{picture}}}\truex{2500}\put(0,\value{x}){\makebox(0,0)[b]{}}\end{picture}}

\newcommand{\nwcurve}[1]{\Nwcurve{}{#1}}

\newcommand{\Securve}[2]{\begin{picture}(0,0)\truex{1300}\truey{2000}\truez{200}\put(0,-\value{x}){\oval(#200,\value{y})[b]}\put(0,-\value{x}){\makebox(0,0){\begin{picture}(#200,0)\put(#200,0){\vector(0,1){\value{z}}}\put(0,0){\line(0,1){\value{z}}}\end{picture}}}\truex{2500}\put(0,-\value{x}){\makebox(0,0)[t]{}}\end{picture}}

\newcommand{\securve}[1]{\Securve{}{#1}}

\newcommand{\Swcurve}[2]{\begin{picture}(0,0)\truex{1300}\truey{2000}\truez{200}\put(0,-\value{x}){\oval(#200,\value{y})[b]}\put(0,-\value{x}){\makebox(0,0){\begin{picture}(#200,0)\put(#200,0){\line(0,1){\value{z}}}\put(0,0){\vector(0,1){\value{z}}}\end{picture}}}\truex{2500}\put(0,-\value{x}){\makebox(0,0)[t]{}}\end{picture}}

\newcommand{\swcurve}[1]{\Swcurve{}{#1}}










\newcommand{\Escurve}[2]{\begin{picture}(0,0)\truex{1400}\truey{2000}\truez{200}\put(\value{x},0){\oval(\value{y},#200)[r]}\put(\value{x},0){\makebox(0,0){\begin{picture}(0,#200)\put(0,0){\vector(-1,0){\value{z}}}\put(0,#200){\line(-1,0){\value{z}}}\end{picture}}}\truex{2500}\put(\value{x},0){\makebox(0,0)[l]{}}\end{picture}}

\newcommand{\escurve}[1]{\Escurve{}{#1}}

\newcommand{\Encurve}[2]{\begin{picture}(0,0)\truex{1400}\truey{2000}\truez{200}\put(\value{x},0){\oval(\value{y},#200)[r]}\put(\value{x},0){\makebox(0,0){\begin{picture}(0,#200)\put(0,0){\line(-1,0){\value{z}}}\put(0,#200){\vector(-1,0){\value{z}}}\end{picture}}}\truex{2500}\put(\value{x},0){\makebox(0,0)[l]{}}\end{picture}}

\newcommand{\encurve}[1]{\Encurve{}{#1}}

\newcommand{\Wscurve}[2]{\begin{picture}(0,0)\truex{1300}\truey{2000}\truez{200}\put(-\value{x},0){\oval(\value{y},#200)[l]}\put(-\value{x},0){\makebox(0,0){\begin{picture}(0,#200)\put(0,0){\vector(1,0){\value{z}}}\put(0,#200){\line(1,0){\value{z}}}\end{picture}}}\truex{2400}\put(-\value{x},0){\makebox(0,0)[r]{}}\end{picture}}

\newcommand{\wscurve}[1]{\Wscurve{}{#1}}

\newcommand{\Wncurve}[2]{\begin{picture}(0,0)\truex{1300}\truey{2000}\truez{200}\put(-\value{x},0){\oval(\value{y},#200)[l]}\put(-\value{x},0){\makebox(0,0){\begin{picture}(0,#200)\put(0,0){\line(1,0){\value{z}}}\put(0,#200){\vector(1,0){\value{z}}}\end{picture}}}\truex{2400}\put(-\value{x},0){\makebox(0,0)[r]{}}\end{picture}}

\newcommand{\wncurve}[1]{\Wncurve{}{#1}}








\newcommand{\Freear}[8]{\begin{picture}(0,0)\put(#400,#500){\vector(#6,#7){#800}}\truex{#200}\truey{#300}\put(\value{x},\value{y}){}\end{picture}}

\newcommand{\freear}[5]{\Freear{}{0}{0}{#1}{#2}{#3}{#4}{#5}}





\newcount\SCALE 

\newcount\NUMBER 

\newcount\LINE 

\newcount\COLUMN 

\newcount\WIDTH 

\newcount\SOURCE 

\newcount\ARROW 

\newcount\TARGET 

\newcount\ARROWLENGTH 

\newcount\NUMBEROFDOTS 

\newcounter{x}

\newcounter{y}

\newcounter{z}

\newcounter{horizontal}

\newcounter{vertical}

\newskip\itemlength 

\newskip\firstitem 

\newskip\seconditem 

\newcommand{\printarrow}{}








\newcommand{\truex}[1]{\NUMBER=#1\multiply\NUMBER by 100\divide\NUMBER by \SCALE \setcounter{x}{\NUMBER}}

\newcommand{\truey}[1]{\NUMBER=#1\multiply\NUMBER by 100\divide\NUMBER by \SCALE \setcounter{y}{\NUMBER}}

\newcommand{\truez}[1]{\NUMBER=#1\multiply\NUMBER by 100\divide\NUMBER by \SCALE \setcounter{z}{\NUMBER}}


\newcommand{\changecounters}[1]{\SOURCE=\ARROW \ARROW=\TARGET \settowidth{\itemlength}{#1}\ifdim \itemlength > 2800\unitlength \addtolength{\itemlength}{-2800\unitlength}\TARGET=\itemlength \divide\TARGET by 1310\multiply\TARGET by 100\divide\TARGET by \SCALE \else \TARGET=0\fi \ARROWLENGTH=5000\advance\ARROWLENGTH by -\SOURCE \advance\ARROWLENGTH by -\TARGET \advance\SOURCE by -\TARGET}

\newcommand{\initialize}[1]{\LINE=0\COLUMN=0\WIDTH=0\ARROW=0\TARGET=0\changecounters{#1}\renewcommand{\printarrow}{#1}\begin{center}\vspace{10pt}\begin{picture}(0,0)}

\newcommand{\DIAG}[1]{\SCALE=100\setlength{\unitlength}{655sp}\initialize{\mbox{}}}

\newcommand{\DIAGV}[2]{\SCALE=#1\setlength{\unitlength}{655sp}\multiply\unitlength by \SCALE \divide\unitlength by 100\initialize{\mbox{}}}

\newcommand{\n}[1]{\changecounters{\mbox{}}\put(\COLUMN,\LINE){\makebox(0,0){\printarrow}}\thinlines \renewcommand{\printarrow}{\mbox{}}\advance\COLUMN by 4000}

\newcommand{\nn}[1]{\put(\COLUMN,\LINE){\makebox(0,0){\printarrow}}\thinlines \ifnum \WIDTH < \COLUMN \WIDTH=\COLUMN \else \fi \advance\LINE by -4000\COLUMN=0\ARROW=0\TARGET=0\changecounters{\mbox{}}\renewcommand{\printarrow}{\mbox{}}}

\newcommand{\conclude}{\put(\COLUMN,\LINE){\makebox(0,0){\printarrow}}\thinlines \ifnum \WIDTH < \COLUMN \WIDTH=\COLUMN \else \fi \setcounter{horizontal}{\WIDTH}\setcounter{vertical}{-\LINE}\end{picture}}

\newcommand{\diag}{\conclude \raisebox{0pt}[0pt][\value{vertical}\unitlength]{}\hspace*{\value{horizontal}\unitlength}\vspace{10pt}\end{center}\setlength{\unitlength}{1pt}}

\newcommand{\diagv}[3]{\conclude \NUMBER=#1\rule{0pt}{\NUMBER pt}\hspace*{-#2pt}\raisebox{0pt}[0pt][\value{vertical}\unitlength]{}\hspace*{\value{horizontal}\unitlength}\NUMBER=#3\advance\NUMBER by 10\vspace*{\NUMBER pt}\end{center}\setlength{\unitlength}{1pt}}

\newcommand{\N}[1]{\raisebox{0pt}[7pt][0pt]{}}

\newcommand{\movename}[3]{\hspace{#2pt}\raisebox{#3pt}[5pt][2pt]{\raisebox{#3pt}{}}\hspace{-#2pt}}

\newcommand{\movearrow}[3]{\makebox[0pt]{\hspace{#2pt}\hspace{#2pt}\raisebox{#3pt}[0pt][0pt]{\raisebox{#3pt}{}}}}

\newcommand{\movevertex}[3]{\mbox{\hspace{#2pt}\raisebox{#3pt}{\raisebox{#3pt}{}}\hspace{-#2pt}}}

\newcommand{\crosslength}[2]{\settowidth{\firstitem}{#1}\settowidth{\seconditem}{#2}\ifdim\firstitem < \seconditem \itemlength=\seconditem \else \itemlength=\firstitem \fi \divide\itemlength by 2\hspace{\itemlength}}

\def\cross#1#2{\crosslength{\mbox{}}{\mbox{}}\begin{picture}(0,0)\put(0,0){\makebox(0,0){}}\thinlines \put(0,0){\makebox(0,0){}}\thinlines \end{picture}\crosslength{\mbox{}}{\mbox{}}}

\newcommand{\B}{\thicklines}




\newcommand{\adj}{\begin{picture}(9,6)\put(1,3){\line(1,0){6}}\put(7,0){\line(0,1){6}}\end{picture}}

\newcommand{\com}{\begin{picture}(12,8)\put(6,4){\oval(8,8)[b]}\put(6,4){\oval(8,8)[r]}\put(6,8){\vector(-1,0){2}}\end{picture}}

\newcommand{\Nat}[3]{\raisebox{-2pt}{\begin{picture}(34,15)\put(2,10){\vector(1,0){30}}\put(2,0){\vector(1,0){30}}\put(13,2){}\put(20,3){}\put(4,11){}\put(4,1){}\end{picture}}}

\def\nat{\raisebox{-2pt}{\begin{picture}(34,10)\put(2,10){\vector(1,0){30}}\put(2,0){\vector(1,0){30}}\put(13,2){}\end{picture}}}

\newcommand{\Binat}[5]{\raisebox{-7.5pt}{\begin{picture}(34,25)\put(2,20){\vector(1,0){30}}\put(2,10){\vector(1,0){30}}\put(2,0){\vector(1,0){30}}\put(13,12){}\put(13,2){}\put(20,13){}\put(20,3){}\put(4,21){}\put(4,11){}\put(4,1){}\end{picture}}}

\newcommand{\binat}{\raisebox{-7.5pt}{\begin{picture}(34,20)\put(2,20){\vector(1,0){30}}\put(2,10){\vector(1,0){30}}\put(2,0){\vector(1,0){30}}\put(13,12){}\put(13,2){}\end{picture}}}

 
\usepackage{CAT}
\usepackage{ALG}
\def\AlgAll#1#2{{#1}^{#2}}
\def\UAlgDed#1#2{{#1}^{#2}}
\def\RestrRedAlgCat#1#2#3{{#1}^{{#2}{|}_{#3}}}

\usepackage{squareDiags}
\def\Chi{X}

\def\Node{\CalN}
\def\Edge{\CalE}
\def\cgIn{\mathsf{In}}
\def\cgOut{\mathsf{Out}}
\def\NLab{\mathsf{NLab}}
\def\ELab{\mathsf{ELab}}
\def\cgSrc{\mathsf{src}}
\def\cgTrg{\mathsf{trg}}
\def\cgNLab{\mathsf{nLab}}
\def\cgELab{\mathsf{eLab}}
\def\exch{\mathbb{X}}
\def\exchU#1{\mathbb{X}_{#1}}
\def\munit{\triv}
\Tdef{Nabla}{\nabla}
\TdefA{NablaU}{#1}{\nabla_{\kern-.2ex{#1}}}
\Tdef{bang}{!}
\TdefA{bangU}{#1}{\bang_{#1}}



\usepackage{dsfont}
\def\triv{\mathds{1}}




\def\etal{\textsl{et al.\null{}}}



\usepackage{edcomms}





\makeatletter
\setlength\leftmargini  {0.93em}
\def\@listI{\leftmargin\leftmargini
            \labelsep 0.3em
            \labelwidth\leftmargini
            \advance\labelwidth-\labelsep
            \parsep 0\p@ \@plus1\p@ \@minus\p@
            \topsep 2\p@ \@plus1\p@ \@minus1\p@
            \itemsep1\p@}
\let\@listi\@listI
\@listi
\makeatother


\def\Cleft{\big\{\;}\def\Cright{\;\big\}}

\def\BMAkern{\kern-5.7pt}


\def\bbbone{{\mathchoice {\rm 1\mskip-4mu l} {\rm 1\mskip-4mu l}
{\rm 1\mskip-4.5mu l} {\rm 1\mskip-5mu l}}}

\def\triv{\bbbone}

\makeindex


\pagestyle{headings}
\mathindent0pt
\begin{document}

\maketitle
\pagestyle{headings}

\begin{abstract}
We employ the dependently-typed programming language Agda2
to explore formalisation of untyped and typed term graphs
directly as set-based graph structures,
via the gs-monoidal categories of Corradini and Gadducci,
and as nested \ensuremath{\Keyword{let}}-expressions using Pouillard and Pottier's
\ensuremath{\Conid{NotSoFresh}} library of variable-binding abstractions.
\end{abstract}


\ignore{\begin{keywords}
typed term graphs
dependently typed programming
gs-monoidal categories
variable binding
code graphs

Dependently typed programming,
Typed term graph,
Code graph,
Variable binding,
GS-monoidal categories
\end{keywords}
}

\section{Introduction}

The Coconut project \cite{Anand-Kahl-2009b,Anand-Kahl-2009a}
uses ``code graphs'' \cite{Kahl-Anand-Carette-2005},
a variant of term graphs in the spirit of
``jungles'' \cite{Hoffmann-Plump-1991,Corradini-Rossi-1991},
as intermediate presentation for the generation of
highly optimised assembly code.
This is currently implemented in Haskell,
and we use the Haskell type system in an embedded domain-specific
language (EDSL) for creating such code graphs
via what appears to be standard Haskell function definitions,
with \ensuremath{\Keyword{let}}-definitions introducing sharing,
and with functions representing assembly-level operations
constructing hyperedges \cite{Anand-Kahl-2009b}.
However, since Haskell does not support full dependent typing,
the intermediate term graph datatype interface,
supporting graph navigation, traversal, and manipulation operations,
cannot preserve the connection with the Haskell-level typing of the assembly
operations.
Therefore, although EDSL-created code graphs are
\emph{well-typed by construction, as certified by the type checker},
this does not hold anymore for code graphs that are the result
of internal operations.
Those internal operations either require separate proof
that they preserve well-typedness,
or they need to perform run-time checks, at considerable run-time cost.

In addition, our code-graph-creation EDSL has a second
``simulator'' implementation, which turns the EDSL expressions
into Haskell functions that implement a ``machine simulation''.
Since the code graph representation has lost its connection
with the Haskell-level typing,
it is ``unintuitively hard'' to use the simulation machinery
for code graphs that result from code graph manipulation operations.

Mainly for these reasons, we are now exploring implementation
of code graphs in a dependently typed programming language,
where there is no need to ``loose'' the type information
when moving to a graph representation,
and where even stronger assertions about operations on code graphs
than just type preservation can be proven \emph{inside} the
implementing system.

We start, in \sectref{AgdaIntro}, with a quick introduction to
the dependently typed programming language
(and proof checker) Agda \cite{Norell-2007}.
This is followed by formalisations of set-based mathematical
definitions
of untyped (\sectref{Jungle}) and typed (\sectref{CodeGraph}) term
graphs,
and then a summary of the gs-monoidal category view on these term
graphs in \sectref{GSMonCat}.
Finally, we present two formalisations of acyclic term graphs
as (differently structured) nested \ensuremath{\Keyword{let}}-expressions
(Sections \sectrawref{Let} and \sectrawref{SeqLet}).



\section{Introduction to Agda: Types, Sets, Equality}\sectlabel{AgdaIntro}

The Agda home page\footnote{\url{http://wiki.portal.chalmers.se/agda/}} states:

\begin{quotation}
\textbf{Agda is a dependently typed functional programming language.} It has inductive families, i.e., data types which depend on values, such as the type of vectors of a given length. It also has parametrised modules, mixfix operators, Unicode characters, and an interactive Emacs interface which can assist the programmer in writing the program.

\textbf{Agda is a proof assistant.} It is an interactive system for writing and checking proofs. Agda is based on intuitionistic type theory, a foundational system for constructive mathematics developed by the Swedish logician Per Martin-Lf. It has many similarities with other proof assistants based on dependent types, such as Coq, Epigram, Matita and NuPRL. 
\end{quotation}

\noindent
Syntactically and ``culturally'', Agda is quite close to Haskell.
However, since Agda is strongly normalising and has no \ensuremath{\bot }
values, the underlying semantics is quite different.
Also, since Agda is dependently typed,
it does not have the distinction that Haskell has between
terms, types, and kinds (the ``types of the types'').
The Agda constant \ensuremath{\Conid{Set}} corresponds to the Haskell kind \ensuremath{\Varid{*}};
it is the type of all ``normal'' datatypes.
For example, the Agda standard library defines the type \ensuremath{\Conid{Bool}} as follows:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{20}{@{}>{\hspre}l<{\hspost}@{}}\column{29}{@{}>{\hspre}l<{\hspost}@{}}\column{35}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Keyword{data}\;\Conid{Bool}\;\mathbin{:}\;\Conid{Set}\;{}\<[20]\>[20]{}\Keyword{where}\;{}\<[29]\>[29]{}\Varid{true}\;{}\<[35]\>[35]{}\mathbin{:}\;\Conid{Bool}{}\<[E]\\
\>[29]{}\Varid{false}\;\mathbin{:}\;\Conid{Bool}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
Since \ensuremath{\Conid{Set}} needs again a type, there is \ensuremath{\Conid{Set}},
with \ensuremath{\Conid{Set}\;\mathbin{:}\;\Conid{Set}}, etc., resulting in a hierarchy of ``universes''.
Since version 2.2.8, Agda supports \emph{universe polymorphism},
with universes \ensuremath{\Conid{Set}\;\Varid{i}} where \ensuremath{\Varid{i}} is an element of the following
special-purpose variant of the natural numbers:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{20}{@{}>{\hspre}l<{\hspost}@{}}\column{28}{@{}>{\hspre}l<{\hspost}@{}}\column{33}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Keyword{data}\;\Conid{Level}\;\mathbin{:}\;\Conid{Set}\;{}\<[20]\>[20]{}\Keyword{where}\;{}\<[28]\>[28]{}\Varid{zero}\;\mathbin{:}\;\Conid{Level}{}\<[E]\\
\>[28]{}\Varid{suc}\;{}\<[33]\>[33]{}\mathbin{:}\;(\Varid{i}\;\mathbin{:}\;\Conid{Level})\;\Varid{}\;\Conid{Level}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
With this, the conventional usage turns into syntactic sugar,
so that \ensuremath{\Conid{Set}} is now \ensuremath{\Conid{Set}\;\Varid{zero}}, and \ensuremath{\Conid{Set}\;\mathrel{=}\;\Conid{Set}\;(\Varid{suc}\;\Varid{zero})}.
\ignore{
With universe polymorphism enabled, we may quantify over
\ensuremath{\Conid{Level}}-typed variables that occur as \ensuremath{\Conid{Level}} arguments of \ensuremath{\Conid{Set}}.
Universe polymorphism is essential for being able to talk about
both ``small'' and ``large'' categories or relation algebras,
or, for another example, also
for being able to treat diagrams of graphs and graph homomorphisms
as graphs again.
We therefore use universe polymorphism throughout this paper.
}For example, the standard library includes the following
universe-polymorphic definition for the parameterised \ensuremath{\Conid{Maybe}} type: 

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{45}{@{}>{\hspre}l<{\hspost}@{}}\column{53}{@{}>{\hspre}l<{\hspost}@{}}\column{61}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Keyword{data}\;\Conid{Maybe}\;\{\mskip0.5mu \Varid{a}\;\mathbin{:}\;\Conid{Level}\mskip0.5mu\}\;(\Conid{A}\;\mathbin{:}\;\Conid{Set}\;\Varid{a})\;\mathbin{:}\;\Conid{Set}\;\Varid{a}\;{}\<[45]\>[45]{}\Keyword{where}\;{}\<[53]\>[53]{}\Varid{just}\;{}\<[61]\>[61]{}\mathbin{:}\;(\Varid{x}\;\mathbin{:}\;\Conid{A})\;\Varid{}\;\Conid{Maybe}\;\Conid{A}{}\<[E]\\
\>[53]{}\Varid{nothing}\;\mathbin{:}\;\Conid{Maybe}\;\Conid{A}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
\ensuremath{\Conid{Maybe}} has two parameters, \ensuremath{\Varid{a}} and \ensuremath{\Conid{A}},
where dependent typing is used since the type of the second parameter
depends on the first parameter.
The use of \ensuremath{\{\mskip0.5mu \Varid{...}\mskip0.5mu\}} flags \ensuremath{\Varid{a}} as an \emph{implicit parameter}
that can be elided where its type is implied by the call site of \ensuremath{\Conid{Maybe}}.
This happens in the occurrences of \ensuremath{\Conid{Maybe}\;\Conid{A}} in the types of the data
constructors \ensuremath{\Varid{just}} and \ensuremath{\Varid{nothing}}:
In \ensuremath{\Conid{Maybe}\;\Conid{A}}, the value of the first, implicit parameter of \ensuremath{\Conid{Maybe}}
can only be \ensuremath{\Varid{a}}, the level of the set \ensuremath{\Conid{A}}.

The same applies to implicit function arguments,
and in most cases, implicit arguments or parameters
are determined by later arguments respectively parameters.
Frequently, implicit arguments correspond quite precisely
to that part of the context of mathematical statements
that is frequently left implicit by mathematicians,
so that the reader may be advised to skip implicit arguments at first
reading of a type,
and return to them for clarification where necessary for understanding
the types of the explicit parameters.

While the Hindley-Milner typing of Haskell and ML
allows function definitions without declaration of the function type,
and type signatures without declaration of the universally quantified
type variables,
in Agda, almost all types and variables need to be declared,
but implicit parameters and the type checking machinery used to
resolve them alleviate that burden significantly.
For example, the original definition writes only
\ensuremath{\Conid{Maybe}\;\{\mskip0.5mu \Varid{a}\mskip0.5mu\}\;(\Conid{A}\;\mathbin{:}\;\Conid{Set}\;\Varid{a})\;\mathbin{:}\;\Conid{Set}\;\Varid{a}},
since the type of \ensuremath{\Varid{a}} will be inferred from \ensuremath{\Varid{a}}'s use
as argument to \ensuremath{\Conid{Set}}.



\medskip
The ``programming types'' like \ensuremath{\Conid{Maybe}}
can be freely mixed with ``formula types'',
inspired by the Curry-Howard-correspondence of ``formulae as types,
proofs as terms''.
The formula types of true formulae contain their proofs,
while the formula types of false formulae are empty.

The standard library type of propositional equality
has (besides two implicit parameters) one explicit parameter
and one explicit argument; the definition therefore gives rise to
types like the type ``\ensuremath{\Varid{2}\;\Varid{}\;\Varid{1}\;\Varid{+}\;\Varid{1}}'', which can be shown to be inhabited
using the definition of natural numbers \ensuremath{\Varid{1}} and \ensuremath{\Varid{2}} and natural number
addition \ensuremath{\Varid{+}},
and the type ``\ensuremath{\Varid{2}\;\Varid{}\;\Varid{3}}'', which is an empty type,
since it has no proof.

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{58}{@{}>{\hspre}l<{\hspost}@{}}\column{68}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{data}\;\Varid{\char95 \char95 }\;\{\mskip0.5mu \Varid{a}\;\mathbin{:}\;\Conid{Level}\mskip0.5mu\}\;\{\mskip0.5mu \Conid{A}\;\mathbin{:}\;\Conid{Set}\;\Varid{a}\mskip0.5mu\}\;(\Varid{x}\;\mathbin{:}\;\Conid{A})\;\mathbin{:}\;\Conid{A}\;\Varid{}\;\Conid{Set}\;\Varid{a}\;{}\<[58]\>[58]{}\Keyword{where}\;{}\<[68]\>[68]{}\Varid{refl}\;\mathbin{:}\;\Varid{x}\;\Varid{}\;\Varid{x}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
The underscore characters occurring in the name \ensuremath{\Varid{\char95 \char95 }}
declare mixfix syntax with argument positions for
explicit parameters and arguments;
this mixfix syntax is already used in the type of the single
constructor.
The definition introduces types \ensuremath{\Varid{x}\;\Varid{}\;\Varid{y}} for any \ensuremath{\Varid{x}} and \ensuremath{\Varid{y}} of type \ensuremath{\Conid{A}},
but only the types \ensuremath{\Varid{x}\;\Varid{}\;\Varid{x}} are inhabited,
and they contain the single element \ensuremath{\Varid{refl}\;\{\mskip0.5mu \Varid{a}\mskip0.5mu\}\;\{\mskip0.5mu \Conid{A}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{x}\mskip0.5mu\}}.

\medskip
In Agda, as in other type theories without quotient types,
sets with equality are typically modelled as \emph{setoids},
that is, carrier types equipped with an equivalence.
This closely corresponds to the non-primitive nature of the
``equality'' test \ensuremath{(\mathrel{=}}{}\ensuremath{\mathrel{=})\;\mathbin{:}\;\Conid{Eq}\;\Varid{a}\;\Rightarrow \;\Varid{a}\;\to \;\Varid{a}\;\to \;\Conid{Bool}} in Haskell.
A setoid is a dependent record consisting of
a \ensuremath{\Conid{Carrier}} set, a relation \ensuremath{\Varid{\char95 \char95 }} on that carrier,
and a proof that the relation \ensuremath{\Varid{\char95 \char95 }} is an equivalence relation:
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{11}{@{}>{\hspre}l<{\hspost}@{}}\column{25}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Keyword{record}\;\Conid{Setoid}\;\Varid{c}\;\Varid{}\;\mathbin{:}\;\Conid{Set}\;(\Varid{suc}\;(\Varid{c}\;\Varid{}\;\Varid{}))\;\Keyword{where}{}\<[E]\\
\>[B]{}\hsindent{3}{}\<[3]\>[3]{}\Keyword{field}\;{}\<[11]\>[11]{}\Conid{Carrier}\;{}\<[25]\>[25]{}\mathbin{:}\;\Conid{Set}\;\Varid{c}{}\<[E]\\
\>[11]{}\Varid{\char95 \char95 }\;{}\<[25]\>[25]{}\mathbin{:}\;\Conid{Rel}\;\Conid{Carrier}\;\Varid{}{}\<[E]\\
\>[11]{}\Varid{isEquivalence}\;\mathbin{:}\;\Conid{IsEquivalence}\;\Varid{\char95 \char95 }{}\<[E]\\
\>[B]{}\hsindent{3}{}\<[3]\>[3]{}\Keyword{open}\;\Conid{IsEquivalence}\;\Varid{isEquivalence}\;\Keyword{public}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
An Agda record is also a module that may contain other material
besides its \ensuremath{\Keyword{field}}s;
the ``\ensuremath{\Keyword{open}}'' clause makes the fields of the equivalence proof
available as if they were fields of \ensuremath{\Conid{Setoid}}.
This language feature enables incremental extension of smaller theories
to larger theories at very low notational cost.

Whenever we allow arbitrary node or edge sets,
and we want to prove, for example, isomorphism of certain graphs,
we actually need setoids and not just sets.
For such contexts, we introduce the following abbreviation
for extracting the carrier set from a setoid:
\savecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Varid{\char95 }\;\mathbin{:}\;\{\mskip0.5mu \Varid{c}\;\Varid{}\;\mathbin{:}\;\Conid{Level}\mskip0.5mu\}\;\Varid{}\;\Conid{Setoid}\;\Varid{c}\;\Varid{}\;\Varid{}\;\Conid{Set}\;\Varid{c}{}\<[E]\\
\>[B]{}\Varid{}\;\Varid{s}\;\Varid{}\;\mathrel{=}\;\Conid{Setoid.Carrier}\;\Varid{s}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\ignore{
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Keyword{record}\;\Conid{}\;\{\mskip0.5mu \Varid{a}\;\Varid{b}\;\mathbin{:}\;\Conid{Level}\mskip0.5mu\}\;(\Conid{A}\;\mathbin{:}\;\Conid{Set}\;\Varid{a})\;(\Conid{B}\;\mathbin{:}\;\Conid{A}\;\Varid{}\;\Conid{Set}\;\Varid{b})\;\mathbin{:}\;\Conid{Set}\;(\Varid{a}\;\Varid{}\;\Varid{b})\;\Keyword{where}{}\<[E]\\
\>[B]{}\hsindent{3}{}\<[3]\>[3]{}\Varid{constructor}\;\anonymous ,\anonymous {}\<[E]\\
\>[B]{}\hsindent{3}{}\<[3]\>[3]{}\Keyword{field}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{proj}\;\mathbin{:}\;\Conid{A}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{proj}\;\mathbin{:}\;\Conid{B}\;\Varid{proj}{}\<[E]\ColumnHook
\end{hscode}\resethooks


\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Varid{}\;\mathbin{:}\;\Varid{}\;\{\mskip0.5mu \Varid{a}\;\Varid{b}\mskip0.5mu\}\;\{\mskip0.5mu \Conid{A}\;\mathbin{:}\;\Conid{Set}\;\Varid{a}\mskip0.5mu\}\;\Varid{}\;(\Conid{A}\;\Varid{}\;\Conid{Set}\;\Varid{b})\;\Varid{}\;\Conid{Set}\;(\Varid{a}\;\Varid{}\;\Varid{b}){}\<[E]\\
\>[B]{}\Varid{}\;\mathrel{=}\;\Conid{}\;\anonymous {}\<[E]\ColumnHook
\end{hscode}\resethooks
}




\section{Set-Based Term Graphs}\sectlabel{Jungle}

We now present a simple definition of term graphs
that is intentionally kept close to conventional mathematical
formulations.
To reduce complexity and improve readability of this initial
formalisation, we present untyped term graphs here;
a typed variant will be shown in \sectref{CodeGraph}.

In the context of an arity-indexed label type \ensuremath{\Conid{Label}\;\mathbin{:}\;\Conid{}\;\Varid{}\;\Conid{Set}},
we first define a type \ensuremath{\Conid{DHG}} of directed hypergraphs with one putput
per edge, indexed by input and output arities of the whole graph,
with the following components (since Agda records are also modules,
they can contain additional material besides their \ensuremath{\Keyword{field}}s):
\begin{itemize}
\item A setoid \ensuremath{\Conid{Inner}} of non-input nodes. (For simplicity, we do not
  emply universe polymorphism here, and all our setoids are of type
  \ensuremath{\Conid{Setoid}\;\Varid{zero}\;\Varid{zero}}.)

  For technical reasons, we find it more convenient
  to have the non-input nodes separate from the input nodes.
  Otherwise we would have had to include an explicit injection
  from the input positions to the complete node set.

\item The setoid \ensuremath{\Conid{Node}} of all nodes is then derived as the disjoint
  union of \ensuremath{\Conid{Inner}} with the setoid of input positions,
  which is obtained from \ensuremath{\Conid{Fin}\;\Varid{m}}, the set of natural numbers smaller
  than \ensuremath{\Varid{m}}.

\item The second \ensuremath{\Keyword{field}} is the \ensuremath{\Varid{n}}-element vector of \ensuremath{\Varid{output}} nodes,
  which can be either input nodes or inner nodes.

\item For symmetry, we also provide the \ensuremath{\Varid{m}}-element vector of \ensuremath{\Varid{input}}
  nodes, constructed using \ensuremath{\Varid{allFin}\;\Varid{m}} which is the vector (i.e.,
  array) containing all \ensuremath{\Varid{m}} elements of the set \ensuremath{\Conid{Fin}\;\Varid{m}} in sequence,
  i.e., \ensuremath{\Varid{0}}, \ensuremath{\Varid{1}}, \ldots, \ensuremath{\Varid{m}\;\Varid{-}\;\Varid{1}}.

\item \ensuremath{\Conid{Edge}} is the setoid of hyperedges.

\item \ensuremath{\Varid{eInfo}} maps each edge to a dependent tuple
  consisting of an arity \ensuremath{\Varid{k}}, a \ensuremath{\Varid{k}}-ary label, and a \ensuremath{\Varid{k}}-element
  vector of edge input nodes.

\item \ensuremath{\Varid{eOut}} maps each edge to its output node,
  which cannot be an input node of the \ensuremath{\Conid{Jungle}},
  and therefore has to be an \ensuremath{\Conid{Inner}} node.
  (The function arrow between setoids is optically not distinguishable
  from the general function type arrow, but is technically a different
  symbol. Since setoids cannot be used as types, no confusion can arise.)

\item We derive the function \ensuremath{\Varid{eLabel}} that maps each edge \ensuremath{\Varid{e}}
  to its edge label. Since the arity of that label is not known in
  advance,
  the function \ensuremath{\Varid{eLabel}} returns a dependent pair consisting
  of the label arity \ensuremath{\Varid{k}} and a \ensuremath{\Varid{k}}-ary label.

\item We also derive the function \ensuremath{\Varid{eIn}} that maps each edge \ensuremath{\Varid{e}}
  to the vector of input nodes of \ensuremath{\Varid{e}};
  the type of this vector depends on the arity of \ensuremath{\Varid{e}},
  which is the first component (\ensuremath{\Varid{proj}}) of the dependent tuple
  \ensuremath{\Varid{eLabel}\;\Varid{e}}.

\end{itemize}

\kern-2.9ex
\noindent
\begin{minipage}[t]{0.49\textwidth}
\savecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{18}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{record}\;\Conid{DHG}\;(\Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{})\;\mathbin{:}\;\Conid{Set}\;\Keyword{where}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Conid{Inner}\;\mathbin{:}\;\Conid{Setoid}\;\Varid{zero}\;\Varid{zero}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Conid{Node}\;\mathrel{=}\;\Conid{Fin.setoid}\;\Varid{m}\;\Varid{}\;\Conid{Inner}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Varid{output}\;\mathbin{:}\;\Conid{Vec}\;\Varid{}\;\Conid{Node}\;\Varid{}\;\Varid{n}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Conid{Edge}\;\mathbin{:}\;\Conid{Setoid}\;\Varid{zero}\;\Varid{zero}{}\<[E]\\
\>[12]{}\Varid{eInfo}\;\mathbin{:}\;\Varid{}\;\Conid{Edge}\;\Varid{}\;{}\<[E]\\
\>[12]{}\hsindent{6}{}\<[18]\>[18]{}\Varid{}\;\Conid{}\;[\mskip1.5mu \Varid{k}\;\Varid{}\;\Conid{}\mskip1.5mu]\;(\Conid{Label}\;\Varid{k}\;\Varid{}\;\Conid{Vec}\;\Varid{}\;\Conid{Node}\;\Varid{}\;\Varid{k}){}\<[E]\ColumnHook
\end{hscode}\resethooks

\kern-1.8ex
\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{18}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[12]{}\Varid{eOut}\;{}\<[18]\>[18]{}\mathbin{:}\;\Conid{Edge}\;\Varid{}\;\Conid{Inner}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\kern3.8ex
\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[5]{}\Varid{eLabel}\;\mathbin{:}\;\Varid{}\;\Conid{Edge}\;\Varid{}\;\Varid{}\;\Conid{}\;[\mskip1.5mu \Varid{k}\;\Varid{}\;\Conid{}\mskip1.5mu]\;\Conid{Label}\;\Varid{k}{}\<[E]\\
\>[5]{}\Varid{eLabel}\;\Varid{e}\;\mathrel{=}\;\Conid{Product.map}\;\Varid{id}\;\Varid{proj}\;(\Varid{eInfo}\;\Varid{e}){}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{input}\;\mathbin{:}\;\Conid{Vec}\;\Varid{}\;\Conid{Node}\;\Varid{}\;\Varid{m}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{input}\;\mathrel{=}\;\Conid{Vec.map}\;\Varid{inj}\;(\Varid{allFin}\;\Varid{m}){}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{eLabel}\;\mathbin{:}\;\Varid{}\;\Conid{Edge}\;\Varid{}\;\Varid{}\;\Conid{}\;[\mskip1.5mu \Varid{k}\;\Varid{}\;\Conid{}\mskip1.5mu]\;\Conid{Label}\;\Varid{k}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{eLabel}\;\Varid{e}\;\mathrel{=}\;\Conid{Product.map}\;\Varid{id}\;\Varid{proj}\;(\Varid{eInfo}\;\Varid{e}){}\<[E]\\blanklineskip]\>[3]{}\Varid{dupJungle}\;\mathbin{:}\;\{\mskip0.5mu \Varid{m}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Jungle}\;\Varid{m}\;(\Varid{m}\;\Varid{+}\;\Varid{m}){}\<[E]\\
\>[3]{}\Varid{dupJungle}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\mathrel{=}\;\Varid{wire}\;(\Varid{allFin}\;\Varid{m}\;\plus \;\Varid{allFin}\;\Varid{m}){}\<[E]\\blanklineskip]\>[3]{}\Varid{exchJungle}\;\mathbin{:}\;(\Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{})\;\Varid{}\;\Conid{Jungle}\;(\Varid{m}\;\Varid{+}\;\Varid{n})\;(\Varid{n}\;\Varid{+}\;\Varid{m}){}\<[E]\\
\>[3]{}\Varid{exchJungle}\;\Varid{m}\;\Varid{n}\;\mathrel{=}\;\Varid{wire}\;(\Conid{Vec.map}\;(\Varid{raise}\;\Varid{m})\;(\Varid{allFin}\;\Varid{n})\;\plus \;\Conid{Vec.map}\;(\Varid{inject+}\;\Varid{n})\;(\Varid{allFin}\;\Varid{m})){}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
Separating the inner nodes from the inputs
in particular has the advantage
that for sequential composition,
we can just use the disjoint union of the two \ensuremath{\Conid{Inner}} node sets:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{7}{@{}>{\hspre}l<{\hspost}@{}}\column{13}{@{}>{\hspre}l<{\hspost}@{}}\column{15}{@{}>{\hspre}l<{\hspost}@{}}\column{53}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{seqJungle}\;\mathbin{:}\;\{\mskip0.5mu \Varid{k}\;\Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Jungle}\;\Varid{k}\;\Varid{m}\;\Varid{}\;\Conid{Jungle}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{Jungle}\;\Varid{k}\;\Varid{n}{}\<[E]\\
\>[3]{}\Varid{seqJungle}\;\{\mskip0.5mu \Varid{k}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{n}\mskip0.5mu\}\;\Varid{g}\;\Varid{g}\;\mathrel{=}\;\Keyword{let}{}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Keyword{open}\;\Conid{Jungle}{}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathbin{:}\;{}\<[13]\>[13]{}\Varid{}\;\Conid{Node}\;\Varid{g}\;\Varid{}\;\Varid{}\;\Conid{Fin}\;\Varid{k}\;\Varid{}\;(\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}\;\Varid{}\;{}\<[53]\>[53]{}\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}){}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathrel{=}\;\Conid{Sum.map}\;\Varid{id}\;\Varid{inj}{}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathbin{:}\;\Varid{}\;{}\<[15]\>[15]{}\Conid{Node}\;\Varid{g}\;\Varid{}\;\Varid{}\;\Conid{Fin}\;\Varid{k}\;\Varid{}\;(\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}\;\Varid{}\;{}\<[53]\>[53]{}\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}){}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathrel{=}\;[\mskip1.5mu (\Varid{}\;\Varid{i}\;\Varid{}\;\Varid{h}\;(\Conid{Vec.lookup}\;\Varid{i}\;(\Varid{output}\;\Varid{g}))),\Varid{inj}\;\Varid{}\;\Varid{inj}\mskip1.5mu]\;\Varid{}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{in}\;\Keyword{record}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{}\{\mskip0.5mu \Conid{Inner}\;\mathrel{=}\;\Conid{Inner}\;\Varid{g}\;\Varid{}\;\Conid{Inner}\;\Varid{g}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Varid{output}\;\mathrel{=}\;\Conid{Vec.map}\;\Varid{h}\;(\Varid{output}\;\Varid{g}){}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Conid{Edge}\;\mathrel{=}\;\Conid{Edge}\;\Varid{g}\;\Varid{}\;\Conid{Edge}\;\Varid{g}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Varid{eInfo}\;\mathrel{=}\;[\mskip1.5mu \Varid{productMap}\;(\Conid{Vec.map}\;\Varid{h})\;\Varid{}\;\Varid{eInfo}\;\Varid{g},\Varid{productMap}\;(\Conid{Vec.map}\;\Varid{h})\;\Varid{}\;\Varid{eInfo}\;\Varid{g}\mskip1.5mu]\;\Varid{}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Conid{EOut}\;\mathrel{=}\;\Conid{EOut}\;\Varid{g}\;\Varid{}\;\Conid{EOut}\;\Varid{g}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{}\mskip0.5mu\}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
Parallel composition works similarly;
here the input positions need to be adapted.

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{7}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{parJungle}\;\mathbin{:}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Jungle}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{Jungle}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{Jungle}\;(\Varid{m}\;\Varid{+}\;\Varid{m})\;(\Varid{n}\;\Varid{+}\;\Varid{n}){}\<[E]\\
\>[3]{}\Varid{parJungle}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{n}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{n}\mskip0.5mu\}\;\Varid{g}\;\Varid{g}\;\mathrel{=}\;\Keyword{let}{}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Keyword{open}\;\Conid{Jungle}{}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathbin{:}\;\Varid{}\;\Conid{Node}\;\Varid{g}\;\Varid{}\;\Varid{}\;\Conid{Fin}\;(\Varid{m}\;\Varid{+}\;\Varid{m})\;\Varid{}\;(\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}\;\Varid{}\;\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}){}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathrel{=}\;\Conid{Sum.map}\;(\Varid{inject+}\;\Varid{m})\;\Varid{inj}{}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathbin{:}\;\Varid{}\;\Conid{Node}\;\Varid{g}\;\Varid{}\;\Varid{}\;\Conid{Fin}\;(\Varid{m}\;\Varid{+}\;\Varid{m})\;\Varid{}\;(\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}\;\Varid{}\;\Varid{}\;\Conid{Inner}\;\Varid{g}\;\Varid{}){}\<[E]\\
\>[3]{}\hsindent{4}{}\<[7]\>[7]{}\Varid{h}\;\mathrel{=}\;\Conid{Sum.map}\;(\Varid{raise}\;\Varid{m})\;\Varid{inj}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{in}\;\Keyword{record}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{}\{\mskip0.5mu \Conid{Inner}\;\mathrel{=}\;\Conid{Inner}\;\Varid{g}\;\Varid{}\;\Conid{Inner}\;\Varid{g}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Varid{output}\;\mathrel{=}\;\Conid{Vec.map}\;\Varid{h}\;(\Varid{output}\;\Varid{g})\;\plus \;\Conid{Vec.map}\;\Varid{h}\;(\Varid{output}\;\Varid{g}){}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Conid{Edge}\;\mathrel{=}\;\Conid{Edge}\;\Varid{g}\;\Varid{}\;\Conid{Edge}\;\Varid{g}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Varid{eInfo}\;\mathrel{=}\;[\mskip1.5mu \Varid{productMap}\;(\Conid{Vec.map}\;\Varid{h})\;\Varid{}\;\Varid{eInfo}\;\Varid{g},\Varid{productMap}\;(\Conid{Vec.map}\;\Varid{h})\;\Varid{}\;\Varid{eInfo}\;\Varid{g}\mskip1.5mu]\;\Varid{}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{};\Conid{EOut}\;\mathrel{=}\;\Conid{EOut}\;\Varid{g}\;\Varid{}\;\Conid{EOut}\;\Varid{g}{}\<[E]\\
\>[5]{}\hsindent{2}{}\<[7]\>[7]{}\mskip0.5mu\}{}\<[E]\ColumnHook
\end{hscode}\resethooks


\section{Typed Code Graphs}\sectlabel{CodeGraph}

Coconut code graphs \cite{Kahl-Anand-Carette-2005} have types
associated with nodes,
and hyperedges may have not only multiple inputs,
but also multiple outputs, to be able to model operations
that yield multiple results;
the typing of the input and output nodes
needs to be compatible with the operations indicated by the edge labels.

For simplicity, we assume here a global set \ensuremath{\Conid{Type}\;\mathbin{:}\;\Conid{Set}} of node
types, and dispense with using setoids in this section.
An edge label is now indexed by vectors of input and output types,
so we assume \ensuremath{\Conid{Label}\;\mathbin{:}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Vec}\;\Conid{Type}\;\Varid{m}\;\Varid{}\;\Conid{Vec}\;\Conid{Type}\;\Varid{n}\;\Varid{}\;\Conid{Set}},
and also define the dependent record type \ensuremath{\Conid{EdgeType}} for collecting these indices:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{6}{@{}>{\hspre}l<{\hspost}@{}}\column{13}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{record}\;\Conid{EdgeType}\;\mathbin{:}\;\Conid{Set}\;\Keyword{where}{}\<[E]\\
\>[3]{}\hsindent{3}{}\<[6]\>[6]{}\Keyword{field}\;{}\<[13]\>[13]{}\Varid{inArity}\;\mathbin{:}\;\Conid{}{}\<[E]\\
\>[13]{}\Varid{outArity}\;\mathbin{:}\;\Conid{}{}\<[E]\\
\>[13]{}\Varid{inTypes}\;\mathbin{:}\;\Conid{Vec}\;\Conid{Type}\;\Varid{inArity}{}\<[E]\\
\>[13]{}\Varid{outTypes}\;\mathbin{:}\;\Conid{Vec}\;\Conid{Type}\;\Varid{outArity}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
An edge label then is such an index collection together
with a label drawn from the corresponding label set;
the \ensuremath{\Keyword{open}} declaration makes the \ensuremath{\Conid{EdgeType}} fields available
for \ensuremath{\Conid{EdgeLabel}} elements as if this was a record extension:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{record}\;\Conid{EdgeLabel}\;\mathbin{:}\;\Conid{Set}\;\Keyword{where}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Varid{eType}\;\mathbin{:}\;\Conid{EdgeType}{}\<[E]\\
\>[12]{}\Varid{label}\;\mathbin{:}\;\Conid{Label}\;(\Conid{EdgeType.inTypes}\;\Varid{eType})\;(\Conid{EdgeType.outTypes}\;\Varid{eType}){}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{open}\;{}\<[12]\>[12]{}\Conid{EdgeType}\;\Varid{eType}\;\Keyword{public}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
For typed term graphs,
there are many different ways to deal with node typing,
and for any given way, different views are useful in different
contexts.
We will keep a node typing function as a \ensuremath{\Keyword{field}},
and derive from this an indexed view of typed nodes,
using the following general construct:
Given a set \ensuremath{\Conid{A}} and a typing function \ensuremath{\Varid{type}} for \ensuremath{\Conid{A}},
the \ensuremath{\Conid{Type}}-indexed set \ensuremath{\Conid{Typed}\;\Conid{A}\;\Varid{type}}
associates with every type \ensuremath{\Varid{ty}}
all elements of \ensuremath{\Conid{A}} that have type \ensuremath{\Varid{ty}};
formally, an element of \ensuremath{\Conid{Typed}\;\Conid{A}\;\Varid{type}\;\Varid{ty}}
is a dependent pair consisting of an element \ensuremath{\Varid{a}\;\mathbin{:}\;\Conid{A}}
together with a proof that \ensuremath{\Varid{type}\;\Varid{a}\;\Varid{}\;\Varid{ty}}:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Conid{Typed}\;\mathbin{:}\;(\Conid{A}\;\mathbin{:}\;\Conid{Set})\;\Varid{}\;(\Conid{A}\;\Varid{}\;\Conid{Type})\;\Varid{}\;\Conid{Type}\;\Varid{}\;\Conid{Set}{}\<[E]\\
\>[3]{}\Conid{Typed}\;\Conid{A}\;\Varid{type}\;\Varid{ty}\;\mathrel{=}\;\Conid{}\;[\mskip1.5mu \Varid{a}\;\Varid{}\;\Conid{A}\mskip1.5mu]\;(\Varid{type}\;\Varid{a}\;\Varid{}\;\Varid{ty}){}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
Since the Agda standard library does not provide a variant of \ensuremath{\Conid{Vec}}
where the element types may depend on their positions,
we directly use dependently typed functions starting from these
positions instead,
producing ``typed vectors'' with elements type according to the
argument type vector \ensuremath{\Varid{v}}:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Conid{TypedVec}\;\mathbin{:}\;(\Conid{A}\;\mathbin{:}\;\Conid{Set})\;\Varid{}\;(\Conid{A}\;\Varid{}\;\Conid{Type})\;\Varid{}\;\{\mskip0.5mu \Varid{k}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Vec}\;\Conid{Type}\;\Varid{k}\;\Varid{}\;\Conid{Set}{}\<[E]\\
\>[3]{}\Conid{TypedVec}\;\Conid{A}\;\Varid{type}\;\{\mskip0.5mu \Varid{k}\mskip0.5mu\}\;\Varid{v}\;\mathrel{=}\;(\Varid{i}\;\mathbin{:}\;\Conid{Fin}\;\Varid{k})\;\Varid{}\;\Conid{Typed}\;\Conid{A}\;\Varid{type}\;(\Conid{Vec.lookup}\;\Varid{i}\;\Varid{v}){}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
The \ensuremath{\Conid{EdgeInfo}} associated with each hyperedge
then contains, besides an \ensuremath{\Conid{EdgeLabel}},
two such ``typed node vectors'',
typed according to the label's typing information
(for modularity, this definition is kept outside the code graph
 definition and parameterised with the type \ensuremath{\Conid{Nodes}} for ``typed node
 vectors'' to be supplied there):

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{21}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{record}\;\Conid{EdgeInfo}\;(\Conid{Nodes}\;\mathbin{:}\;\{\mskip0.5mu \Varid{k}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Vec}\;\Conid{Type}\;\Varid{k}\;\Varid{}\;\Conid{Set})\;\mathbin{:}\;\Conid{Set}\;\Keyword{where}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Varid{eLab}\;{}\<[21]\>[21]{}\mathbin{:}\;\Conid{EdgeLabel}{}\<[E]\\
\>[12]{}\Varid{eInput}\;{}\<[21]\>[21]{}\mathbin{:}\;\Conid{Nodes}\;(\Conid{EdgeLabel.inTypes}\;\Varid{eLab}){}\<[E]\\
\>[12]{}\Varid{eOutput}\;{}\<[21]\>[21]{}\mathbin{:}\;\Conid{Nodes}\;(\Conid{EdgeLabel.outTypes}\;\Varid{eLab}){}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{open}\;{}\<[12]\>[12]{}\Conid{EdgeLabel}\;\Varid{eLab}\;\Keyword{public}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
A \ensuremath{\Conid{CodeGraph}} is now defined roughly analogous to a \ensuremath{\Conid{Jungle}},
with the following differences worth pointing out:
\begin{itemize}
\item Code graphs can be considered as ``generalised hyperedges'',
  and therefore have an \ensuremath{\Conid{EdgeType}} derived from the \ensuremath{\Conid{CodeGraph}} type
  parameters. Keeping the current parameters eases the implementation
  of the categorical view, in comparison with using the \ensuremath{\Conid{EdgeType}} as
  a parameter instead.

\item We only need to explicitly represent the typing of the inner
  nodes; from this we can derive the typing of all \ensuremath{\Conid{Node}}s
  by looking up the typing of the input positions in \ensuremath{\Varid{inTypes}}.

\item A \ensuremath{\Conid{TypedNode}\;\Varid{ty}} is a \ensuremath{\Conid{Node}} with type \ensuremath{\Varid{ty}};
  an element of \ensuremath{\Conid{TypedNodes}\;\Varid{v}} is a ``typed node vector''
  according to the type vector \ensuremath{\Varid{v}}.

\item The \ensuremath{\Conid{CodeGraph}} field \ensuremath{\Varid{output}} and each individual edge
  interface use \ensuremath{\Conid{TypedNode}} ``vectors''.

\item We can still provide lower-level interfaces to edges;
  we show functions that extract the edge label,
  edge input arity,
  and edge input \ensuremath{\Conid{Node}} vectors (discarding the type information),
  both dependently-typed and existentially-typed with respect to the
  vector length.
  (The corresponding functions \ensuremath{\Varid{eOut}} etc.\null are not shown.)
\end{itemize}

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{10}{@{}>{\hspre}l<{\hspost}@{}}\column{11}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{22}{@{}>{\hspre}l<{\hspost}@{}}\column{34}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{record}\;\Conid{CodeGraph}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;(\Varid{inTypes}\;\mathbin{:}\;\Conid{Vec}\;\Conid{Type}\;\Varid{m})\;(\Varid{outTypes}\;\mathbin{:}\;\Conid{Vec}\;\Conid{Type}\;\Varid{n})\;\mathbin{:}\;\Conid{Set}\;\Keyword{where}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{cgType}\;\mathbin{:}\;\Conid{EdgeType}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{cgType}\;\mathrel{=}\;\Keyword{record}\;{}\<[22]\>[22]{}\{\mskip0.5mu \Varid{inArity}\;{}\<[34]\>[34]{}\mathrel{=}\;\Varid{m}{}\<[E]\\
\>[22]{};\Varid{outArity}\;{}\<[34]\>[34]{}\mathrel{=}\;\Varid{n}{}\<[E]\\
\>[22]{};\Varid{inTypes}\;{}\<[34]\>[34]{}\mathrel{=}\;\Varid{inTypes}{}\<[E]\\
\>[22]{};\Varid{outTypes}\;{}\<[34]\>[34]{}\mathrel{=}\;\Varid{outTypes}\mskip0.5mu\}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Conid{Node}\;\mathrel{=}\;\Conid{Fin}\;\Varid{m}\;\Varid{}\;\Conid{Inner}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Conid{TypedNode}\;\mathbin{:}\;\Conid{Type}\;\Varid{}\;\Conid{Set}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Conid{TypedNode}\;\mathrel{=}\;\Conid{Typed}\;\Conid{Node}\;\Varid{nType}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Varid{output}\;\mathbin{:}\;\Conid{TypedNodes}\;\Varid{outTypes}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{field}\;{}\<[12]\>[12]{}\Conid{Edge}\;\mathbin{:}\;\Conid{Set}{}\<[E]\\
\>[12]{}\Varid{eInfo}\;\mathbin{:}\;\Conid{Edge}\;\Varid{}\;\Conid{EdgeInfo}\;\Conid{TypedNodes}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{eInArity}\;\mathbin{:}\;\Conid{Edge}\;\Varid{}\;\Conid{}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{eInArity}\;\mathrel{=}\;\Conid{EdgeInfo.inArity}\;\Varid{}\;\Varid{eInfo}{}\<[E]\\blanklineskip]\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{eIn}\;{}\<[11]\>[11]{}\mathbin{:}\;\Conid{Edge}\;\Varid{}\;\Conid{}\;[\mskip1.5mu \Varid{k}\;\Varid{}\;\Conid{}\mskip1.5mu]\;(\Conid{Vec}\;\Conid{Node}\;\Varid{k}){}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Varid{eIn}\;\Varid{e}\;\mathrel{=}\;\Varid{eInArity}\;\Varid{e},\Varid{eIn}\;\Varid{e}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
Again, \ensuremath{\Varid{eOut}} is not guaranteed to reach all nodes,
and, due to the possibility of multi-output operations,
this cannot be amended by joining the \ensuremath{\Conid{Inner}} and \ensuremath{\Conid{Edge}} sets as in jungles.
This and other degrees of generality contained in this definition
can be useful for certain purposes,
but also can be forbidden for other purposes
by adding appropriate constraints.

We show the function for producing primitive one-edge code graphs:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{15}{@{}>{\hspre}l<{\hspost}@{}}\column{31}{@{}>{\hspre}l<{\hspost}@{}}\column{42}{@{}>{\hspre}l<{\hspost}@{}}\column{67}{@{}>{\hspre}c<{\hspost}@{}}\column{67E}{@{}l@{}}\column{71}{@{}>{\hspre}c<{\hspost}@{}}\column{71E}{@{}l@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{prim}\;\mathbin{:}\;(\Varid{}\;\mathbin{:}\;\Conid{EdgeLabel})\;\Varid{}\;\Conid{CodeGraph}\;(\Conid{EdgeLabel.inTypes}\;\Varid{})\;(\Conid{EdgeLabel.outTypes}\;\Varid{}){}\<[E]\\
\>[3]{}\Varid{prim}\;\Varid{}\;\mathrel{=}\;\Keyword{record}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\{\mskip0.5mu \Conid{Inner}\;{}\<[15]\>[15]{}\mathrel{=}\;\Conid{Fin}\;(\Conid{EdgeLabel.outArity}\;\Varid{}){}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{};\Varid{output}\;{}\<[15]\>[15]{}\mathrel{=}\;\Varid{}\;\Varid{i}\;\Varid{}\;(\Varid{inj}\;\Varid{i},\Varid{refl}){}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{};\Conid{Edge}\;{}\<[15]\>[15]{}\mathrel{=}\;\Varid{}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{};\Varid{eInfo}\;{}\<[15]\>[15]{}\mathrel{=}\;\Varid{}\;\anonymous \;\Varid{}\;\Keyword{record}\;{}\<[31]\>[31]{}\{\mskip0.5mu \Varid{eLab}\;{}\<[42]\>[42]{}\mathrel{=}\;\Varid{}{}\<[E]\\
\>[31]{};\Varid{eInput}\;{}\<[42]\>[42]{}\mathrel{=}\;\Varid{}\;\Varid{i}\;\Varid{}\;(\Varid{inj}\;\Varid{i},\Varid{refl}){}\<[E]\\
\>[31]{};\Varid{eOutput}\;{}\<[42]\>[42]{}\mathrel{=}\;\Varid{}\;\Varid{i}\;\Varid{}\;(\Varid{inj}\;\Varid{i},\Varid{refl}){}\<[67]\>[67]{}\mskip0.5mu\}{}\<[67E]\>[71]{}\mskip0.5mu\}{}\<[71E]\ColumnHook
\end{hscode}\resethooks

\noindent
While type-checking the three propositional equality proofs \ensuremath{\Varid{refl}} in here,
Agda actually proves that the mentioned types are indeed equal:
An Agda program can only produce \ensuremath{\Conid{CodeGraph}} values that are
correctly typed,
both on the external interface, and internally at each port of each edge.


\section{GS-Monoidal Categories}\sectlabel{GSMonCat}


Corradini and Gadducci
proposed \emph{gs-monoidal categories}
for modelling acyclic term graphs \cite{Corradini-Gadducci-1999-APTG};
extended discussion of how code graphs fit into this framework
is contained in \cite{Kahl-Anand-Carette-2005}.
Here we only present a quick summary,
and tie this into the formalisation in \sectref{Jungle}.

In a category theory context,
we write ``''
to declare that morphism  goes from object  to object
,
and use ``'' as the associative binary \emph{composition} operator;
composition of two morphisms  and
 is defined iff ,
and then .
Furthermore, the identity morphism for object 
is written .


\ensuremath{\Conid{Jungle}} can be seen to define morphisms
of an untyped term graph category
where objects are natural numbers.
(For \ensuremath{\Conid{CodeGraph}}, the collection of Objects is \ensuremath{\Conid{}\;[\mskip1.5mu \Varid{k}\;\Varid{}\;\Conid{}\mskip1.5mu]\;(\Conid{Vec}\;\Conid{Type}\;\Varid{k})}.)

In the \ensuremath{\Conid{Jungle}} category,
a morphism from  to  is an element of \ensuremath{\Conid{Jungle}\;\Varid{m}\;\Varid{n}},
that is, a term graph with  input nodes and  output nodes.
More precisely, such a morphism is an isomorphism class of jungles,
since node and edge identities do not matter;
we will define a \ensuremath{\Conid{Setoid}} where the \ensuremath{\Conid{Carrier}} is \ensuremath{\Conid{Jungle}\;\Varid{m}\;\Varid{n}}
and equivalence proofs are \ensuremath{\Conid{Jungle}} isomorphisms.

Composition  ``glues'' together
the output nodes of  with the respective input nodes of ,
as we have implemented in \ensuremath{\Varid{seqJungle}}.
The identity on  consists only of  input nodes which are also,
in the same sequence, output nodes, and no edges,
and is therefore constructed as a wiring graph:

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{25}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{idJungle}\;\mathbin{:}\;\{\mskip0.5mu \Varid{m}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;{}\<[25]\>[25]{}\Conid{Jungle}\;\Varid{m}\;\Varid{m}{}\<[E]\\
\>[3]{}\Varid{idJungle}\;\mathrel{=}\;\Varid{wire}\;(\Varid{allFin}\;\anonymous ){}\<[E]\ColumnHook
\end{hscode}\resethooks

\begin{Def}\Deflabel{ssmc}
A \emph{symmetric strict monoidal category} \cite{MacLane-1971}
consists of a category ,
a strictly associative monoidal bifunctor 
with  as its strict unit,
and a transformation 
that associates with every two objects  and 
an arrow 
with:
\BCM
\begin{array}[b]{rcl@{\hskip1em}rcl}
    (F \otimes G) \RELcomp \exch_{\objC,\objD} &=&
    \exch_{\objA,\objB} \RELcomp (G \otimes F)
\enskip,&
    \exch_{\objA,\objB} \RELcomp \exch_{\objB,\objA} &=&
    \RELid_{\objA} \otimes \RELid_{\objB}
\enskip,\\blanklineskip]\>[3]{}\Conid{Args}\;\Varid{}\;\Varid{m}\;\Varid{n}\;\mathrel{=}\;\Conid{Vec}\;(\Conid{Arg}\;\Varid{}\;\Varid{m})\;\Varid{n}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
The datatype \ensuremath{\Conid{TG}} has the same reading as \ensuremath{\Conid{TG}},
but a simpler structure:
\begin{itemize}
\item If all nodes have been declared, \ensuremath{\Conid{Output}\;\Varid{as}} assembles the
  vector of output nodes.

\item \ensuremath{\Conid{Let}\;\Varid{x}\;\Varid{f}\;\Varid{v}\;\Varid{u}},
  which, in more conventional notation, would read
  ``\textbf{let} \ensuremath{\Varid{x}\;\mathrel{=}\;\Varid{f}\;(\Varid{v})} \textbf{in} \ensuremath{\Varid{u}}'',
  binds a new node \ensuremath{\Varid{x}} to an edge labelled \ensuremath{\Varid{f}} with input nodes \ensuremath{\Varid{v}},
  and makes \ensuremath{\Varid{x}} visible in the remaining term graph suffix \ensuremath{\Varid{u}}.
\end{itemize}

\restorecolumns
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{15}{@{}>{\hspre}l<{\hspost}@{}}\column{49}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Keyword{data}\;\Conid{TG}\;\Conid{E}\;\Varid{}\;(\Varid{m}\;\mathbin{:}\;\Conid{})\;\mathbin{:}\;\Conid{}\;\Varid{}\;\Conid{Set}\;\Keyword{where}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Conid{Output}\;\mathbin{:}\;{}\<[15]\>[15]{}\{\mskip0.5mu \Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Args}\;\Varid{}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{TG}\;\Conid{E}\;\Varid{}\;\Varid{m}\;\Varid{n}{}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Conid{Let}\;{}\<[12]\>[12]{}\mathbin{:}\;{}\<[15]\>[15]{}\{\mskip0.5mu \Varid{}\;\mathbin{:}\;\Conid{World}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{k}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;{}\<[E]\\
\>[12]{}\Varid{}\;{}\<[15]\>[15]{}(\Varid{x}\;\mathbin{:}\;\Conid{E}\;\Varid{}\;\Varid{})\;{}\<[49]\>[49]{}\mbox{\onelinecomment  \textbf{let} \ensuremath{\Varid{x}}}{}\<[E]\\
\>[12]{}\Varid{}\;{}\<[15]\>[15]{}(\Varid{f}\;\mathbin{:}\;\Conid{Label}\;\Varid{k})\;(\Varid{v}\;\mathbin{:}\;\Conid{Args}\;\Varid{}\;\Varid{m}\;\Varid{k})\;{}\<[49]\>[49]{}\mbox{\onelinecomment   \ensuremath{\Varid{f}\;(\Varid{v})} }{}\<[E]\\
\>[12]{}\Varid{}\;{}\<[15]\>[15]{}(\Varid{u}\;\mathbin{:}\;\Conid{TG}\;\Conid{E}\;\Varid{}\;\Varid{m}\;\Varid{n})\;{}\<[49]\>[49]{}\mbox{\onelinecomment  \textbf{in} \ensuremath{\Varid{u}}}{}\<[E]\\
\>[12]{}\Varid{}\;{}\<[15]\>[15]{}\Conid{TG}\;\Conid{E}\;\Varid{}\;\Varid{m}\;\Varid{n}{}\<[E]\ColumnHook
\end{hscode}\resethooks


\noindent
We first show that primitive and wiring graphs are easily programmed:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{5}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{prim}\;\mathbin{:}\;\{\mskip0.5mu \Varid{k}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{Label}\;\Varid{k}\;\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{k}\;\Varid{1}{}\<[E]\\
\>[3]{}\Varid{prim}\;\{\mskip0.5mu \Varid{k}\mskip0.5mu\}\;\Varid{f}\;\mathrel{=}\;\Conid{Let}\;\Varid{strongOf}\;\Varid{f}\;(\Conid{Vec.map}\;\Conid{Input}\;(\Conid{Vec.allFin}\;\Varid{k}))\;(\Conid{Output}\;[\mskip1.5mu \Conid{V}\;\Varid{nameOf}\mskip1.5mu]){}\<[E]\\
\>[3]{}\hsindent{2}{}\<[5]\>[5]{}\Keyword{where}\;\Keyword{open}\;\Conid{FreshPack}\;\Varid{fresh}{}\<[E]\\blanklineskip]\>[3]{}\Varid{idWire}\;\mathbin{:}\;\{\mskip0.5mu \Varid{k}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\{\mskip0.5mu \Conid{E}\;\mathbin{:}\;\anonymous \mskip0.5mu\}\;\{\mskip0.5mu \Varid{}\;\mathbin{:}\;\Conid{World}\mskip0.5mu\}\;\Varid{}\;\Conid{TG}\;\Conid{E}\;\Varid{}\;\Varid{k}\;\Varid{k}{}\<[E]\\
\>[3]{}\Varid{idWire}\;\{\mskip0.5mu \Varid{k}\mskip0.5mu\}\;\mathrel{=}\;\Varid{wire}\;(\Conid{Vec.allFin}\;\Varid{k}){}\<[E]\\blanklineskip]\>[3]{}\Varid{term}\;\mathbin{:}\;\{\mskip0.5mu \Varid{k}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\{\mskip0.5mu \Conid{E}\;\mathbin{:}\;\anonymous \mskip0.5mu\}\;\{\mskip0.5mu \Varid{}\;\mathbin{:}\;\Conid{World}\mskip0.5mu\}\;\Varid{}\;\Conid{TG}\;\Conid{E}\;\Varid{}\;\Varid{k}\;\Varid{0}{}\<[E]\\
\>[3]{}\Varid{term}\;\mathrel{=}\;\Varid{wire}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]\ColumnHook
\end{hscode}\resethooks


\noindent
With these definitions,
we can reconstruct the term graph \ensuremath{\Conid{TG0}} from above
via the gs-monoidal interface,
with sequential composition \ensuremath{\Varid{seqTG}} and parallel composition \ensuremath{\Varid{parTG}} defined below:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[B]{}\Varid{tg0}\;\mathrel{=}\;\Varid{seqTG}\;(\Varid{parTG}\;(\Varid{seqTG}\;(\Varid{prim}\;\Conid{F})\;\Varid{dup})\;(\Varid{prim}\;\Conid{G}))\;(\Varid{prim}\;\Conid{H}){}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
For the analogous function to \ensuremath{\Varid{strengthenTG}},
which replaces each link \ensuremath{\Varid{x}} in a \ensuremath{\Conid{Let}} construct
with a fresh link,
we present an easy generalisation
to serve dual purposes:
\begin{itemize}
\item Starting from weak links, \ensuremath{\Varid{strengthenTG}\;\{\mskip0.5mu \Varid{\char95 \char95 }\mskip0.5mu\}\;\Varid{id}} is proper
  strengthening;
\item starting from strong links,
  \ensuremath{\Varid{strengthenTG}\;\{\mskip0.5mu \Varid{\char95 \char95 }\mskip0.5mu\}\;\Conid{StrongPack.weakOf}} is renaming with fresh
  names with respect to the new world \ensuremath{\Varid{}}.
\end{itemize}

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{8}{@{}>{\hspre}l<{\hspost}@{}}\column{11}{@{}>{\hspre}l<{\hspost}@{}}\column{18}{@{}>{\hspre}l<{\hspost}@{}}\column{42}{@{}>{\hspre}c<{\hspost}@{}}\column{42E}{@{}l@{}}\column{45}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{strengthenTG}\;{}\<[18]\>[18]{}\mathbin{:}\;\{\mskip0.5mu \Conid{E}\;\mathbin{:}\;\anonymous \mskip0.5mu\}\;\Varid{}\;(\Conid{E}\;\Varid{}\;\Varid{\char95 \char95 })\;{}\<[E]\\
\>[18]{}\Varid{}\;\{\mskip0.5mu \Varid{}\;\Varid{}\;\mathbin{:}\;\Conid{World}\mskip0.5mu\}\;\Varid{}\;\Conid{Fresh}\;\Varid{}\;\Varid{}\;\Conid{CEnv}\;(\Conid{Name}\;\Varid{})\;\Varid{}\;{}\<[E]\\
\>[18]{}\Varid{}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;\Varid{}\;\Conid{TG}\;\Conid{E}\;\Varid{}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}{}\<[E]\\
\>[3]{}\Varid{strengthenTG}\;\Varid{weak}\;\Varid{fr}\;\Conid{}\;(\Conid{Output}\;\Varid{as})\;\mathrel{=}\;\Conid{Output}\;(\Varid{mapVarArgs}\;(\Varid{lookupCEnv}\;\Conid{})\;\Varid{as}){}\<[E]\\
\>[3]{}\Varid{strengthenTG}\;\Varid{weak}\;\Varid{fr}\;\Conid{}\;(\Conid{Let}\;\Varid{x}\;\Varid{f}\;\Varid{as}\;\Varid{u})\;{}\<[E]\\
\>[3]{}\hsindent{5}{}\<[8]\>[8]{}\mathrel{=}\;{}\<[11]\>[11]{}\Keyword{let}\;\Conid{}\;\mathrel{=}\;\Varid{mapCEnv}\;\Varid{importWith}\;\Conid{}{}\<[42]\>[42]{},{}\<[42E]\>[45]{}\Varid{weak}\;\Varid{x}\;\Varid{}\;\Varid{nameOf}{}\<[E]\\
\>[11]{}\Keyword{in}\;\Conid{Let}\;\Varid{strongOf}\;\Varid{f}\;(\Varid{mapVarArgs}\;(\Varid{lookupCEnv}\;\Conid{})\;\Varid{as})\;(\Varid{strengthenTG}\;\Varid{weak}\;\Varid{nextOf}\;\Conid{}\;\Varid{u}){}\<[E]\\
\>[3]{}\hsindent{5}{}\<[8]\>[8]{}\Keyword{where}\;\Keyword{open}\;\Conid{FreshPack}\;\Varid{fr}{}\<[E]\ColumnHook
\end{hscode}\resethooks


\noindent
Both sequential and parallel composition
are implemented by inserting the material of one graph
between the innermost \ensuremath{\Conid{Let}} and the \ensuremath{\Conid{Output}} of the other graph.
We define a general helper function for this purpose:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{11}{@{}>{\hspre}l<{\hspost}@{}}\column{14}{@{}>{\hspre}l<{\hspost}@{}}\column{17}{@{}>{\hspre}l<{\hspost}@{}}\column{20}{@{}>{\hspre}l<{\hspost}@{}}\column{70}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{inLet}\;{}\<[11]\>[11]{}\mathbin{:}\;{}\<[14]\>[14]{}\{\mskip0.5mu \Varid{}\;\Varid{}\;\mathbin{:}\;\Conid{World}\mskip0.5mu\}\;\Varid{}\;(\Varid{s}\;\mathbin{:}\;\Varid{}\;\Varid{}\;\Varid{})\;\Varid{}\;\Conid{Fresh}\;\Varid{}\;\Varid{}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;{}\<[E]\\
\>[11]{}\Varid{}\;{}\<[14]\>[14]{}({}\<[17]\>[17]{}\{\mskip0.5mu \Varid{}\;\mathbin{:}\;\Conid{World}\mskip0.5mu\}\;\Varid{}\;(\Varid{s}\;\mathbin{:}\;\Varid{}\;\Varid{}\;\Varid{})\;\Varid{}\;\Conid{Fresh}\;\Varid{}{}\<[E]\\
\>[17]{}\Varid{}\;{}\<[20]\>[20]{}\Conid{Args}\;\Varid{}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n})\;{}\<[E]\\
\>[11]{}\Varid{}\;{}\<[20]\>[20]{}\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}\;\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}{}\<[E]\\
\>[3]{}\Varid{inLet}\;\Varid{s}\;\Varid{fr}\;\Conid{F}\;(\Conid{Let}\;\Varid{x}\;\Varid{f}\;\Varid{t}\;\Varid{u})\;\mathrel{=}\;\Conid{Let}\;\Varid{x}\;\Varid{f}\;\Varid{t}\;(\Varid{inLet}\;(\Varid{s}\;\Varid{}\;\Varid{x})\;\Varid{fr}\;\Conid{F}\;\Varid{u})\;{}\<[70]\>[70]{}\Keyword{where}\;\Varid{fr}\;\mathrel{=}\;\Conid{StrongPack.nextOf}\;\Varid{x}{}\<[E]\\
\>[3]{}\Varid{inLet}\;\Varid{s}\;\Varid{fr}\;\Conid{F}\;(\Conid{Output}\;\Varid{as})\;\mathrel{=}\;\Conid{F}\;\Varid{s}\;\Varid{fr}\;\Varid{as}{}\<[E]\ColumnHook
\end{hscode}\resethooks


\noindent
We first implement fork,
which walks the only primitively available fresh link
\ensuremath{\Varid{fresh}} past all the \ensuremath{\Conid{Let}}s of \ensuremath{\Varid{g}},
uses the resulting fresh link \ensuremath{\Varid{fr}} to rename \ensuremath{\Varid{g}},
and afterwards adapts the output list \ensuremath{\Varid{as}} of \ensuremath{\Varid{g}}
to the inner world of the renamed \ensuremath{\Varid{g}},
so that the two output lists can be concatenated:

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{6}{@{}>{\hspre}l<{\hspost}@{}}\column{12}{@{}>{\hspre}l<{\hspost}@{}}\column{26}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{forkTG}\;{}\<[12]\>[12]{}\mathbin{:}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;{}\<[E]\\
\>[12]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}\;{}\<[E]\\
\>[12]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}\;{}\<[E]\\
\>[12]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;(\Varid{n}\;\Varid{+}\;\Varid{n}){}\<[E]\\
\>[3]{}\Varid{forkTG}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{n}\mskip0.5mu\}\;\{\mskip0.5mu \Varid{n}\mskip0.5mu\}\;\Varid{g}\;\Varid{g}\;\mathrel{=}\;\Varid{inLet}\;\Varid{}\;\Varid{fresh}\;{}\<[E]\\
\>[3]{}\hsindent{3}{}\<[6]\>[6]{}(\Varid{}\;\{\mskip0.5mu \Varid{}\mskip0.5mu\}\;\Varid{s}\;\Varid{fr}\;\Varid{as}\;\Varid{}\;\Varid{inLet}\;\Varid{}\;\Varid{fr}\;{}\<[E]\\
\>[6]{}\hsindent{20}{}\<[26]\>[26]{}(\Varid{}\;\Varid{s}\;\anonymous \;\Varid{as}\;\Varid{}\;\Conid{Output}\;(\Varid{mapVarArgs}\;(\Varid{import}\;(\Varid{-}\;\Varid{s}))\;\Varid{as}\;\plus \;\Varid{as}))\;{}\<[E]\\
\>[6]{}\hsindent{20}{}\<[26]\>[26]{}(\Varid{strengthenTG}\;\{\mskip0.5mu \Varid{\char95 \char95 }\mskip0.5mu\}\;\Conid{StrongPack.weakOf}\;\Varid{fr}\;\Varid{emptyCEnv}\;\Varid{g}){}\<[E]\\
\>[3]{}\hsindent{3}{}\<[6]\>[6]{})\;\Varid{g}{}\<[E]\ColumnHook
\end{hscode}\resethooks


\noindent
The implementation of parallel composition
then relies on fork in the same way as that for TG:

\noindent
\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{11}{@{}>{\hspre}l<{\hspost}@{}}\column{26}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{parTG}\;{}\<[11]\>[11]{}\mathbin{:}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;{}\<[26]\>[26]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}\;{}\<[E]\\
\>[11]{}\Varid{}\;\{\mskip0.5mu \Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;{}\<[26]\>[26]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}\;{}\<[E]\\
\>[26]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;(\Varid{m}\;\Varid{+}\;\Varid{m})\;(\Varid{n}\;\Varid{+}\;\Varid{n}){}\<[E]\\
\>[3]{}\Varid{parTG}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\Varid{g}\;\{\mskip0.5mu \Varid{m}\mskip0.5mu\}\;\Varid{g}\;\mathrel{=}\;\Varid{forkTG}\;(\Varid{extendTG}\;\Varid{m}\;\Varid{g})\;(\Varid{shiftTG}\;\Varid{m}\;\Varid{g}){}\<[E]\ColumnHook
\end{hscode}\resethooks


\noindent
Sequential composition follows the same pattern as \ensuremath{\Varid{forkTG}},
and first traverses the declarations of \ensuremath{\Varid{g}}, which are preserved,
but uses the helper function \ensuremath{\Varid{mapArgsTG}}
to properly replace any occurrence of inputs
in argument and output lists of the renamed \ensuremath{\Varid{g}}
with the corresponding output nodes of \ensuremath{\Varid{g}},
after adapting them to the respective nested world.

\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}\column{3}{@{}>{\hspre}l<{\hspost}@{}}\column{6}{@{}>{\hspre}l<{\hspost}@{}}\column{11}{@{}>{\hspre}l<{\hspost}@{}}\column{26}{@{}>{\hspre}l<{\hspost}@{}}\column{E}{@{}>{\hspre}l<{\hspost}@{}}\>[3]{}\Varid{seqTG}\;{}\<[11]\>[11]{}\mathbin{:}\;\{\mskip0.5mu \Varid{k}\;\Varid{m}\;\Varid{n}\;\mathbin{:}\;\Conid{}\mskip0.5mu\}\;{}\<[E]\\
\>[11]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{k}\;\Varid{m}\;{}\<[E]\\
\>[11]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{m}\;\Varid{n}\;{}\<[E]\\
\>[11]{}\Varid{}\;\Conid{TG}\;\Varid{\char95 \char95 }\;\Varid{}\;\Varid{k}\;\Varid{n}{}\<[E]\\
\>[3]{}\Varid{seqTG}\;\Varid{g}\;\Varid{g}\;\mathrel{=}\;\Varid{inLet}\;\Varid{}\;\Varid{fresh}\;{}\<[E]\\
\>[3]{}\hsindent{3}{}\<[6]\>[6]{}(\Varid{}\;\{\mskip0.5mu \Varid{}\mskip0.5mu\}\;\Varid{s}\;\Varid{fr}\;\Varid{as}\;\Varid{}\;\Varid{mapArgsTG}\;\Varid{}\;{}\<[E]\\
\>[6]{}\hsindent{20}{}\<[26]\>[26]{}(\Varid{}\;\Varid{s}\;\Varid{as}\;\Varid{}\;\Varid{seqArgs}\;(\Varid{mapVarArgs}\;(\Varid{import}\;(\Varid{-}\;\Varid{s}))\;\Varid{as})\;\Varid{as})\;{}\<[E]\\
\>[6]{}\hsindent{20}{}\<[26]\>[26]{}(\Varid{strengthenTG}\;\{\mskip0.5mu \Varid{\char95 \char95 }\mskip0.5mu\}\;\Conid{StrongPack.weakOf}\;\Varid{fr}\;\Varid{emptyCEnv}\;\Varid{g}){}\<[E]\\
\>[3]{}\hsindent{3}{}\<[6]\>[6]{})\;\Varid{g}{}\<[E]\ColumnHook
\end{hscode}\resethooks

\noindent
Finally, it is also reasonably easy to convert
a \ensuremath{\Conid{TG'}} term graph into a \ensuremath{\Conid{Jungle}}
with \ensuremath{\Conid{Fin}\;\Varid{k}} as \ensuremath{\Conid{Inner}} node set and as \ensuremath{\Conid{Edge}} set,
where \ensuremath{\Varid{k}} is the number of \ensuremath{\Conid{Let}} declarations.




\section{Conclusion and Outlook}

Formalising mathematical definitions of term graphs and their
operations in Agda
is a remarkably straight-forward exercise,
and, due to the dependent typing of Agda,
also carries over to typed term graphs much more easily than
in the more restricted type systems of Haskell or higher-order logic.

The remarkable abstract interface to variable binding provided by
Pouillard and Pottier's \ensuremath{\Conid{NotSoFresh}} Agda library
\cite{Pouillard-Pottier-2010}
also makes name-binding representations of term graphs
conveniently accessible to mechanised reasoning and programmed manipulation.
Typing is easily added to our \ensuremath{\Conid{TG}} and \ensuremath{\Conid{TG}} datatypes ---
the original \ensuremath{\Conid{Tm}} datatype provided as \ensuremath{\Conid{NotSoFresh}} example
includes typing, but we omitted it here to improve readability.

Implementing additional term graph operations, manipulations, and conversion functions,
and proving the algebraic properties of the term graph operations
is ongoing work.

Future work will strive to base
code-graph based optimised-code generation algorithms
for the Coconut project \cite{Anand-Kahl-2009b}
on our Agda formalisations of code graphs,
with a fully verifying tool chain as ultimate goal.





\begin{thebibliography}{HFBV97}
\providecommand{\bibitemdeclare}[2]{}
\providecommand{\bibitemend}{}
\providecommand{\bibliographystart}{}
\providecommand{\bibliographyend}{}
\providecommand{\urlprefix}{Available at }
\providecommand{\url}[1]{\texttt{#1}}
\providecommand{\href}[2]{\texttt{#2}}
\providecommand{\urlalt}[2]{\href{#1}{#2}}
\providecommand{\doi}[1]{doi:\urlalt{http://dx.doi.org/#1}{#1}}
\providecommand{\bibinfo}[2]{#2}
\bibliographystart

\bibitemdeclare{inproceedings}{Ariola-Klop-1994}
\bibitem[AK94]{Ariola-Klop-1994}
\bibinfo{author}{Zena~M. Ariola} \& \bibinfo{author}{Jan~Willem Klop}
  (\bibinfo{year}{1994}): \emph{\bibinfo{title}{Cyclic Lambda Graph
  Rewriting}}.
\newblock In: {\sl \bibinfo{booktitle}{Proceedings, Ninth Annual IEEE Symposium
  on Logic in Computer Science}}. \bibinfo{organization}{IEEE Computer Society
  Press}, \bibinfo{address}{Paris, France}, pp. \bibinfo{pages}{416--425}.
\bibitemend

\bibitemdeclare{inproceedings}{Anand-Kahl-2007_AGTIVE}
\bibitem[AK08]{Anand-Kahl-2007_AGTIVE}
\bibinfo{author}{Christopher~Kumar Anand} \& \bibinfo{author}{Wolfram Kahl}
  (\bibinfo{year}{2008}): \emph{\bibinfo{title}{Code Graph Transformations for
  Verifiable Generation of {SIMD}-Parallel Assembly Code}}.
\newblock In \bibinfo{editor}{Andy Sch{\"u}rr}, \bibinfo{editor}{Manfred Nagl}
  \& \bibinfo{editor}{Albert Z{\"u}ndorf}, editors: {\sl
  \bibinfo{booktitle}{Applications of Graph Transformations with Industrial
  Relevance, {AGTIVE 2007}}}. {\sl \bibinfo{series}{LNCS}}
  \bibinfo{volume}{5088}, pp. \bibinfo{pages}{217--232},
  \doi{10.1007/978-3-540-89020-1}.
\bibitemend

\bibitemdeclare{article}{Anand-Kahl-2009b}
\bibitem[AK09a]{Anand-Kahl-2009b}
\bibinfo{author}{Christopher~K. Anand} \& \bibinfo{author}{Wolfram Kahl}
  (\bibinfo{year}{2009}): \emph{\bibinfo{title}{An Optimized {Cell BE} Special
  Function Library Generated by {Coconut}}}.
\newblock {\sl \bibinfo{journal}{IEEE Transactions on Computers}}
  \bibinfo{volume}{58}(\bibinfo{number}{8}), pp. \bibinfo{pages}{1126--1138},
  \doi{10.1109/TC.2008.223}.
\bibitemend

\bibitemdeclare{incollection}{Anand-Kahl-2009a}
\bibitem[AK09b]{Anand-Kahl-2009a}
\bibinfo{author}{Christopher~K. Anand} \& \bibinfo{author}{Wolfram Kahl}
  (\bibinfo{year}{2009}): \emph{\bibinfo{title}{Synthesizing and Verifying
  Multicore Parallelism in Categories of Nested Code Graphs}}.
\newblock In \bibinfo{editor}{Michael Alexander} \& \bibinfo{editor}{William
  Gardner}, editors: {\sl \bibinfo{booktitle}{Process Algebra for Parallel and
  Distributed Processing}}, chapter~\bibinfo{chapter}{1}. {\sl
  \bibinfo{series}{CRC Computational Science Series}}~\bibinfo{volume}{2},
  \bibinfo{publisher}{Chapman \& Hall}, pp. \bibinfo{pages}{3--45}.
\bibitemend

\bibitemdeclare{article}{Corradini-Gadducci-1999-APTG}
\bibitem[CG99]{Corradini-Gadducci-1999-APTG}
\bibinfo{author}{Andrea Corradini} \& \bibinfo{author}{Fabio Gadducci}
  (\bibinfo{year}{1999}): \emph{\bibinfo{title}{An Algebraic Presentation of
  Term Graphs, via GS-Monoidal Categories}}.
\newblock {\sl \bibinfo{journal}{Applied Categorical Structures}}
  \bibinfo{volume}{7}(\bibinfo{number}{4}), pp. \bibinfo{pages}{299--331}.
\bibitemend

\bibitemdeclare{inproceedings}{Corradini-Rossi-1991}
\bibitem[CR93]{Corradini-Rossi-1991}
\bibinfo{author}{Andrea Corradini} \& \bibinfo{author}{Francesca Rossi}
  (\bibinfo{year}{1993}): \emph{\bibinfo{title}{Hyperedge replacement jungle
  rewriting for term-rewriting systems and logic programming}}.
\newblock In \bibinfo{editor}{B.~Courcelle} \& \bibinfo{editor}{G.~Rozenberg},
  editors: {\sl \bibinfo{booktitle}{Selected Papers of the International
  Workshop on Computing by Graph Transformation, {Bordeaux, France, March
  21--23, 1991}}}. \bibinfo{publisher}{Elsevier}, pp. \bibinfo{pages}{7--48},
  \doi{10.1016/0304-3975(93)90063-Y}.
\newblock \bibinfo{note}{Theoretical Computer Science {\bf 109} (1--2)}.
\bibitemend

\bibitemdeclare{book}{Freyd-Scedrov-1990}
\bibitem[FS90]{Freyd-Scedrov-1990}
\bibinfo{author}{Peter~J. Freyd} \& \bibinfo{author}{Andre Scedrov}
  (\bibinfo{year}{1990}): \emph{\bibinfo{title}{Categories, Allegories}}.
\newblock {\sl \bibinfo{series}{North-Holland Mathematical
  Library}}~\bibinfo{volume}{39}, \bibinfo{publisher}{North-Holland},
  \bibinfo{address}{Amsterdam}.
\bibitemend

\bibitemdeclare{phdthesis}{Gonzalia-2006}
\bibitem[Gon06]{Gonzalia-2006}
\bibinfo{author}{Carlos Gonzal{\'{\i}}a} (\bibinfo{year}{2006}):
  \emph{\bibinfo{title}{Relations in Dependent Type Theory}}.
\newblock \bibinfo{type}{Ph.D. thesis}, \bibinfo{school}{Department of Computer
  Science and Engineering, Chalmers University of Technology, G\"oteborg
  University}.
\newblock \bibinfo{note}{Technical Report No.~14D}.
\bibitemend

\bibitemdeclare{incollection}{Haeberer-Frias-Baum-Veloso-1997}
\bibitem[HFBV97]{Haeberer-Frias-Baum-Veloso-1997}
\bibinfo{author}{Armando Haeberer}, \bibinfo{author}{Marcelo Frias},
  \bibinfo{author}{Gabriel Baum} \& \bibinfo{author}{Paulo Veloso}
  (\bibinfo{year}{1997}): \emph{\bibinfo{title}{Fork Algebras}}.
\newblock In \bibinfo{editor}{Chris Brink}, \bibinfo{editor}{Wolfram Kahl} \&
  \bibinfo{editor}{Gunther Schmidt}, editors: {\sl
  \bibinfo{booktitle}{Relational Methods in Computer Science}},
  chapter~\bibinfo{chapter}{4}. \bibinfo{series}{Advances in Computing
  Science}, \bibinfo{publisher}{Springer}, \bibinfo{address}{Wien, New York},
  pp. \bibinfo{pages}{54--69}.
\bibitemend

\bibitemdeclare{article}{Hoffmann-Plump-1991}
\bibitem[HP91]{Hoffmann-Plump-1991}
\bibinfo{author}{Berthold Hoffmann} \& \bibinfo{author}{Detlef Plump}
  (\bibinfo{year}{1991}): \emph{\bibinfo{title}{Implementing Term Rewriting by
  Jungle Evaluation}}.
\newblock {\sl \bibinfo{journal}{Informatique th\'eorique et
  applications/Theoretical Informatics and Applications}}
  \bibinfo{volume}{25}(\bibinfo{number}{5}), pp. \bibinfo{pages}{445--472}.
\bibitemend

\bibitemdeclare{inproceedings}{Huet-Saibi-1998}
\bibitem[HS98]{Huet-Saibi-1998}
\bibinfo{author}{G{\'e}rard Huet} \& \bibinfo{author}{Amokrane Sa{\"{\i}}bi}
  (\bibinfo{year}{1998}): \emph{\bibinfo{title}{Constructive Category Theory}}.
\newblock In: {\sl \bibinfo{booktitle}{Proceedings of the Joint CLICS-TYPES
  Workshop on Categories and Type Theory, Goteborg}}. \doi{10.1.1.39.4193}.
\bibitemend

\bibitemdeclare{inproceedings}{Huet-Saibi-2000}
\bibitem[HS00]{Huet-Saibi-2000}
\bibinfo{author}{G{\'e}rard Huet} \& \bibinfo{author}{Amokrane Sa{\"{\i}}bi}
  (\bibinfo{year}{2000}): \emph{\bibinfo{title}{Constructive Category Theory}}.
\newblock In \bibinfo{editor}{Gordon~D. Plotkin}, \bibinfo{editor}{Colin
  Stirling} \& \bibinfo{editor}{Mads Tofte}, editors: {\sl
  \bibinfo{booktitle}{Proof, language, and interaction: Essays in honour of
  {Robin Milner}}}. \bibinfo{series}{Foundations Of Computing Series},
  \bibinfo{publisher}{MIT Press}, pp. \bibinfo{pages}{239--275}.
\bibitemend

\bibitemdeclare{inproceedings}{Kahl-Anand-Carette-2005}
\bibitem[KAC06]{Kahl-Anand-Carette-2005}
\bibinfo{author}{Wolfram Kahl}, \bibinfo{author}{Christopher~Kumar Anand} \&
  \bibinfo{author}{Jacques Carette} (\bibinfo{year}{2006}):
  \emph{\bibinfo{title}{Control-Flow Semantics for Assembly-Level Data-Flow
  Graphs}}.
\newblock In \bibinfo{editor}{Wendy McCaull}, \bibinfo{editor}{Michael Winter}
  \& \bibinfo{editor}{Ivo D{\"u}ntsch}, editors: {\sl \bibinfo{booktitle}{8th
  Intl.\null{} Seminar on Relational Methods in Computer Science, {RelMiCS 8,
  Feb.\null{} 2005}}}. {\sl \bibinfo{series}{LNCS}} \bibinfo{volume}{3929},
  \bibinfo{publisher}{Springer}, pp. \bibinfo{pages}{147--160}.
\bibitemend

\bibitemdeclare{inproceedings}{Kanda-1981}
\bibitem[Kan81]{Kanda-1981}
\bibinfo{author}{Akira Kanda} (\bibinfo{year}{1981}):
  \emph{\bibinfo{title}{Constructive Category Theory (No. 1)}}.
\newblock In \bibinfo{editor}{Jozef Gruska} \& \bibinfo{editor}{Michal Chytil},
  editors: {\sl \bibinfo{booktitle}{Mathematical Foundations of Computer
  Science, {MFCS '81}}}. {\sl \bibinfo{series}{LNCS}} \bibinfo{volume}{118},
  \bibinfo{publisher}{Springer}, pp. \bibinfo{pages}{563--577},
  \doi{10.1007/3-540-10856-4_125}.
\bibitemend

\bibitemdeclare{book}{MacLane-1971}
\bibitem[ML71]{MacLane-1971}
\bibinfo{author}{Saunders Mac~Lane} (\bibinfo{year}{1971}):
  \emph{\bibinfo{title}{Categories for the Working Mathematician}}.
\newblock \bibinfo{publisher}{Springer-Verlag}.
\bibitemend

\bibitemdeclare{article}{Maraist-Oderski-Wadler-1998}
\bibitem[MOW98]{Maraist-Oderski-Wadler-1998}
\bibinfo{author}{John Maraist}, \bibinfo{author}{Martin Oderski} \&
  \bibinfo{author}{Philip Wadler} (\bibinfo{year}{1998}):
  \emph{\bibinfo{title}{The Call-by-Need Lambda Calculus}}.
\newblock {\sl \bibinfo{journal}{J.\null{} Functional Programming}}
  \bibinfo{volume}{8}(\bibinfo{number}{3}), pp. \bibinfo{pages}{275--317}.
\bibitemend

\bibitemdeclare{phdthesis}{Norell-2007}
\bibitem[Nor07]{Norell-2007}
\bibinfo{author}{Ulf Norell} (\bibinfo{year}{2007}):
  \emph{\bibinfo{title}{Towards a Practical Programming Language Based on
  Dependent Type Theory}}.
\newblock \bibinfo{type}{Ph.D. thesis}, \bibinfo{school}{Department of Computer
  Science and Engineering, Chalmers University of Technology}.
\newblock \urlprefix\url{http://www.cs.chalmers.se/~ulfn/papers/thesis.html}.
\bibitemend

\bibitemdeclare{inproceedings}{Pouillard-Pottier-2010}
\bibitem[PP10]{Pouillard-Pottier-2010}
\bibinfo{author}{Nicolas Pouillard} \& \bibinfo{author}{Fran\c{c}ois Pottier}
  (\bibinfo{year}{2010}): \emph{\bibinfo{title}{A fresh look at programming
  with names and binders}}.
\newblock In: {\sl \bibinfo{booktitle}{{ICFP 2010}, Intl.\null{} Conf.\null{}
  on Functional Programming}}. \bibinfo{publisher}{ACM}, \bibinfo{address}{New
  York, NY, USA}, pp. \bibinfo{pages}{217--228}, \doi{10.1145/1863543.1863575}.
\newblock
  \urlprefix\url{http://nicolaspouillard.fr/publis/pouillard-pottier-fresh-look-agda-2010/}.
\bibitemend

\bibitemdeclare{inproceedings}{Turner-1982}
\bibitem[Tur82]{Turner-1982}
\bibinfo{author}{David~A. Turner} (\bibinfo{year}{1982}):
  \emph{\bibinfo{title}{Recursion Equations as a Programming Language}}.
\newblock In \bibinfo{editor}{J.~Darlington}, editor: {\sl
  \bibinfo{booktitle}{Functional Programming and its Applications: An Advanced
  Course}}. \bibinfo{publisher}{Cambridge Univ.\null{} Press}, pp.
  \bibinfo{pages}{1--27}.
\bibitemend

\bibliographyend
\end{thebibliography}
 \end{document}
