\documentclass{article}

\PassOptionsToPackage{numbers, compress}{natbib}






\usepackage[final]{neurips_2019}



\usepackage[utf8]{inputenc} \usepackage[T1]{fontenc}    \usepackage{hyperref}       \usepackage{url}            \usepackage{booktabs}       \usepackage{amsfonts}       \usepackage{nicefrac}       \usepackage{microtype}      

\usepackage{subcaption}
\usepackage{boldline}
\usepackage{cuted}
\usepackage{capt-of}
\usepackage[font=small]{caption}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{acronym}
\usepackage{verbatim}
\usepackage{xspace}
\usepackage{enumitem}
\usepackage{makecell}
\usepackage{setspace}
\usepackage{multirow}
\usepackage{balance}
\usepackage[compact]{titlesec}
\usepackage{setspace}
\usepackage{titlesec}
\usepackage[export]{adjustbox}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\abs}[1]{\left\lvert#1\right\rvert}

\makeatletter
\DeclareRobustCommand\onedot{\futurelet\@let@token\@onedot}
\def\@onedot{\ifx\@let@token.\else.\null\fi\xspace}
\def\eg{\emph{e.g}\onedot} \def\Eg{\emph{E.g}\onedot}
\def\ie{\emph{i.e}\onedot} \def\Ie{\emph{I.e}\onedot}
\def\cf{\emph{c.f}\onedot} \def\Cf{\emph{C.f}\onedot}
\def\etc{\emph{etc}\onedot} \def\vs{\emph{vs}\onedot}
\def\wrt{w.r.t\onedot} \def\dof{d.o.f\onedot}
\def\etal{\emph{et al}\onedot}
\makeatother

\setlength\floatsep{0.2\baselineskip plus 3pt minus 2pt}
\setlength\textfloatsep{0.2\baselineskip plus 3pt minus 2pt}
\setlength\dbltextfloatsep{0.2\baselineskip plus 3pt minus 2 pt}
\setlength\intextsep{0.2\baselineskip plus 3pt minus 2 pt}


\def\sectionautorefname{\S}
\def\subsectionautorefname{\S}
\def\subsubsectionautorefname{\S}

\title{PerspectiveNet: 3D Object Detection from\\a Single RGB Image via Perspective Points}

\author{Siyuan Huang \\
  Department of Statistics\\
  \texttt{huangsiyuan@ucla.edu}\\
  \And
  Yixin Chen\\
  Department of Statistics\\
  \texttt{ethanchen@ucla.edu}\\
  \And
  Tao Yuan\\
  Department of Statistics\\
  \texttt{taoyuan@ucla.edu}\\
  \AND
  Siyuan Qi\\
  Department of Computer Science\\
  \texttt{syqi@cs.ucla.edu}\\
  \And
  Yixin Zhu\\
  Department of Statistics\\
  \texttt{yixin.zhu@ucla.edu}\\
  \And
  Song-Chun Zhu\\
  Department of Statistics\\
  \texttt{sczhu@stat.ucla.edu}\\
}

\begin{document}
\maketitle

\setstretch{0.98}

\begin{abstract}
Detecting 3D objects from a single RGB image is intrinsically ambiguous, thus requiring appropriate prior knowledge and intermediate representations as constraints to reduce the uncertainties and improve the consistencies between the 2D image plane and the 3D world coordinate. To address this challenge, we propose to adopt perspective points as a new intermediate representation for 3D object detection, defined as the 2D projections of local Manhattan 3D keypoints to locate an object; these perspective points satisfy geometric constraints imposed by the perspective projection. We further devise PerspectiveNet, an end-to-end trainable model that simultaneously detects the 2D bounding box, 2D perspective points, and 3D object bounding box for each object from a single RGB image. PerspectiveNet yields three unique advantages: (i) 3D object bounding boxes are estimated based on perspective points, bridging the gap between 2D and 3D bounding boxes \emph{without} the need of category-specific 3D shape priors. (ii) It predicts the perspective points by a \emph{template-based} method, and a perspective loss is formulated to maintain the perspective constraints. (iii) It maintains the consistency between the 2D perspective points and 3D bounding boxes via a \emph{differentiable} projective function. Experiments on SUN RGB-D dataset show that the proposed method significantly outperforms existing RGB-based approaches for 3D object detection.
\end{abstract}

\section{Introduction}
\label{sec:intro}

\begin{quote}
    If one hopes to achieve a full understanding of a system as complicated as a nervous system, \ldots, or even a large computer program, then one must be prepared to contemplate different kinds of explanation at different levels of description that are linked, at least in principle, into a cohesive whole, even if linking the levels in complete details is impractical. \hfill---~David Marr~\cite{marr1982vision}, pp. 20--21
\end{quote}

In a classic view of computer vision, David Marr~\cite{marr1982vision} conjectured that the perception of a 2D image is an \emph{explicit} multi-phase information process, involving (i) an early vision system of perceiving textures~\cite{julesz1962visual,zhu1998filters} and textons~\cite{julesz1981textons,zhu2005textons} to form a primal sketch as a perceptually lossless conversion from the raw image~\cite{guo2003towards,guo2007primal}, (ii) a mid-level vision system to construct 2.1D (multiple layers with partial occlusion)~\cite{nitzberg19902,wang1993layered,wang1994representing} and 2.5D~\cite{marr1978representation} sketches, and (iii) a high-level vision system that recovers the full 3D~\cite{binford1971visual,brooks1981symbolic,kanade1981recovery}. In particular, he highlighted the importance of different levels of organization and the internal representation~\cite{broadbent1985question}.

In parallel, the school of Gestalt Laws~\citep{wertheimer1912experimentelle,wagemans2012century,wagemans2012century2,kohler1920physischen,kohler1938physical,wertheimer1923untersuchungen,wertheimer1938laws,koffka2013principles} and perceptual organization~\cite{lowe2012perceptual,pentland1987perceptual} aims to resolve the 3D reconstruction problem from a single RGB image without forming the depth cues; but rather, they often use some sorts of priors---groupings and structural cues~\cite{waltz1975understanding,barrow1981interpreting} that are likely to be invariant over wide ranges of viewpoints~\cite{lowe1987three}, resulting in the birth of the SIFT feature~\cite{lowe2004distinctive}. Later, from a Bayesian perspective at a scene level, such priors, independent of any 3D scene structures, were found in the human-made scenes, known as the Manhattan World assumption~\cite{coughlan2003manhattan}. Importantly, further studies found that such priors help to improve object detection~\cite{coughlan1999manhattan}.

In this paper, inspired by these two classic schools in computer vision, we seek to test the following two hypotheses using modern computer vision methods: (i) Could an \emph{intermediate representation} facilitate modern computer vision tasks? (ii) Is such an intermediate representation a better and more \emph{invariant prior} compared to the priors obtained directly from specific tasks?

In particular, we tackle the challenging task of 3D object detection from a single RGB image. Despite the recent success in 2D scene understanding (\eg,~\cite{ren2015faster,he2017mask}, there is still a significant performance gap for 3D computer vision tasks based on a single 2D image. Recent modern approaches directly regress the 3D bounding boxes~\cite{chen2016monocular,mousavian20173d,huang2018cooperative} or reconstruct the 3D objects with specific 3D object priors~\cite{kundu20183d,huang2018holistic,yao20183d,he2019mono3d++}. In contrast, we propose an end-to-end trainable framework, PerspectiveNet, that sequentially estimates the 2D bounding box, 2D perspective points, and 3D bounding box for each object with a local Manhattan assumption~\cite{xiao2014reconstructing}, in which the perspective points serve as the intermediate representation, defined as the 2D projections of local Manhattan 3D keypoints to locate an object.

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/overview.pdf}
    \end{center}
    \caption{Traditional 3D object detection methods directly estimate (c) the 3D object bounding boxes from (a) the 2D bounding boxes, which suffer from the uncertainties between the 2D image plane and the 3D world. The proposed PerspectiveNet utilizes (b) the 2D perspective points as the intermediate representation to bridge the gap. The perspective points are the 2D perspective projection of the 3D bounding box corners, containing rich 3D information (\eg, positions, orientations). The red dots indicate the perspective points of the bed that are challenging to emerge based on the visual features, but could be inferred by the context (correlations and topology) among other perspective points.}
    \label{fig:overview}
\end{figure}

The proposed method offers three unique advantages. First, the use of perspective points as the \emph{intermediate representation} bridges the gap between 2D and 3D bounding boxes \emph{without} utilizing any extra category-specific 3D shape priors. As shown in \autoref{fig:overview}, it is often challenging for learning-based methods to estimate the 3D bounding boxes from 2D images directly; regressing 3D bounding boxes from 2D input is a highly under-constrained problem and can be easily influenced by appearance variations of shape, texture, lighting, and background. To alleviate this issue, we adopt the perspective points as an intermediate representation to represent the local Manhattan frame that each 3D object aligns with. Intuitively, the perspective points of an object are \emph{3D geometric constraints in the 2D space}. More specifically, the 2D perspective points for each object are defined as the perspective projection of the 3D object bounding box (concatenated with its center), and each 3D box aligns within a 3D local Manhattan frame. These perspective points are fused into the 3D branch to predict the 3D attributes of the 3D bounding boxes.

Second, we devise a \emph{template-based} method to efficiently and robustly estimate the perspective points. Existing methods~\cite{newell2016stacked,lee2017roomnet,zou2018layoutnet,he2017mask,suwajanakorn2018discovery} usually exploit heatmap or probability distribution map as the representation to learn the location of visual points (\eg, object keypoint, human skeleton, room layout), relying heavily on the view-dependent visual features, thus insufficient to resolve occlusions or large rotation/viewpoint changes in complex scenes; see an example in \autoref{fig:overview} (b) where the five perspective points (in red) are challenging to emerge from pure visual features but could be inferred by the correlations and topology among other perspective points. To tackle this problem, we treat each set of 2D perspective points as the low dimensional embedding of its corresponding set of 3D points with a constant topology; such an embedding is learned by predicting the perspective points as a mixture of sparse templates. A perspective loss is formulated to impose the perspective constraints; the details are described in \autoref{sec:perspective}.

Third, the consistency between the 2D perspective points and 3D bounding boxes can be maintained by a \emph{differentiable} projective function; it is end-to-end trainable, from the 2D region proposals, to the 2D bounding boxes, to the 2D perspective points, and to the 3D bounding boxes.

In the experiment, we show that the proposed PerspectiveNet outperforms previous methods with a large margin on SUN RGB-D dataset~\cite{song2015sun}, demonstrating its efficacy on 3D object detection.

\setstretch{0.97}

\section{Related Work}

\paragraph{3D object detection from a single image}

Detecting 3D objects from a single RGB image is a challenging problem, particularly due to the intrinsic ambiguity of the problem. Existing methods could be categorized into three streams: (i) geometry-based methods that estimate the 3D bounding boxes with geometry and 3D world priors~\cite{zhao2011image,zhao2013scene,choi2013understanding,lin2013holistic,zhang2014panocontext}; (ii) learning-based methods that incorporate category-specific 3D shape prior~\cite{izadinia2016im2cad,huang2018holistic,he2019mono3d++} or extra 2.5D information (depth, surface normal, and segmentation)~\cite{kundu20183d,yao20183d,xu2018multi} to detect 3D bounding boxes or reconstruct the 3D object shape; and (iii) deep learning methods that directly estimates the 3D object bounding boxes from 2D bounding boxes~\cite{chen20153d,chen2016monocular,mousavian20173d,huang2018cooperative}. To make better estimations, various techniques have been devised to enforce consistencies between the estimated 3D and the input 2D image. \citet{huang2018cooperative} proposed a two-stage method to learn the 3D objects and 3D layout cooperatively. \citet{kundu20183d} proposed a 3D object detection and reconstruction method using category-specific object shape prior by render-and-compare. Different from these methods, the proposed PerspectiveNet is a one-stage end-to-end trainable 3D object detection framework using perspective points as an intermediate representation; the perspective points naturally bridge the gap between the 2D and 3D bounding boxes without any extra annotations, category-specific 3D shape priors, or 2.5D maps.

\paragraph{Manhattan World assumption}

Human-made environment, from the layout of a city to structures such as buildings, room, furniture, and many other objects, could be viewed as a set of parallel and orthogonal planes, known as the Manhattan World (MW) assumption~\cite{coughlan1999manhattan}. Formally, it indicates that most human-made structures could be approximated by planar surfaces that are parallel to one of the three principal planes of a common orthogonal coordinate system. This strict Manhattan World assumption is later extended by a Mixture of Manhattan Frame (MMF)~\cite{straub2014mixture} to represent more complex real-world scenes (\eg, city layouts, rotated objects). In literature, MW and MMF have been adopted in vanish points (VPs) estimation and camera calibration~\cite{schindler2004atlanta,kroeger2015joint}, orientation estimation~\cite{bosse2003vanishing,straub2015real,ghanem2015robust}, layout estimation~\cite{hedau2009recovering,lee2009geometric,hedau2010thinking,schwing2012efficient,zou2018layoutnet}, and 3D scene reconstruction~\cite{delage2007automatic,furukawa2009manhattan,xiao2013basic,xiao2014reconstructing,ren2016three,liu2017single}. In this work, we extend the MW to local Manhattan assumption where the cuboids are aligned with the vertical (gravity) direction but with arbitrary horizontal orientation (also see \citet{xiao2014reconstructing}), and perspective points are adopted as the intermediate representation for 3D object detection.

\paragraph{Intermediate 3D representation}

Intermediate 3D representations are bridges that narrow the gap and maintain the consistency between the 2D image plane and 3D world. Among them, 2.5D sketches have been broadly used in reconstructing the 3D shapes~\cite{wu2017marrnet,von2018,genre2018} and 3D scenes~\cite{tulsiani2017factoring,huang2018holistic}. Other recent alternative intermediate 3D representations include: (i) \citet{wu2016single} uses pre-annotated and category-specific object keypoints as an intermediate representation, and (ii) \citet{tekin2018real} uses projected corners of 3D bounding boxes in learning the 6D object pose. In this paper, we explore the perspective points as an intermediate representation of 2D and 3D bounding boxes, and provide an efficient learning framework for 3D object detection.

\section{Learning Perspective Points for 3D Object Detection}

\subsection{Overall Architecture}

As shown in \autoref{fig:framework}, the proposed PerspectiveNet contains a backbone architecture for feature extraction over the entire image, a region proposal network (RPN)~\cite{ren2015faster} that proposes regions of interest (RoIs), and a network head including three region-wise parallel branches.
For each proposed box, its RoI feature is fed into the three network branches to predict: (i) the object class and the 2D bounding box offset, (ii) the 2D perspective points (projected 3D box corners and object center) as a weighted sum of predicted perspective templates, and (iii) the 3D box size, orientation, and its distance from the camera. Detected 3D boxes are reconstructed by the projected object center, distance, box size, and rotation.
The overall architecture of the PerspectiveNet resembles the R-CNN structure, and we refer readers to~\cite{ren2015faster,girshick2015fast,he2017mask} for more details of training R-CNN detectors.

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/framework_v3.pdf}
    \end{center}
    \vspace{-6pt}
    \caption{The proposed framework of the PerspectiveNet. Given an RGB Image, the backbone of PerspectiveNet extracts global features and propose candidate 2D bounding boxes (RoIs). For each proposed box, its RoI feature is fed into three network branches to predict: (i) the object class and the 2D box offset, (ii) 2D perspective templates (projected 3D box corners and object center) and the corresponding coefficients, and (iii) the 3D box size, orientation, and its distance from the camera. Detected 3D boxes are reconstructed by the projected object center, distance, box size, and rotation. By projecting the detected 3D boxes to 2D and comparing them with 2D perspective points, the network imposes and learns a consistency between the 2D inputs and 3D estimations.}
    \label{fig:framework}
    \vspace{6pt}
\end{figure}

During training, we define a multi-task loss on each proposed RoI as
\begin{equation}
    \mathcal{L} = \mathcal{L}_{cls} + \mathcal{L}_{2D} + \mathcal{L}_{pp} + \mathcal{L}_{p} + \mathcal{L}_{3D} + \mathcal{L}_{proj},
\end{equation}
where the classification loss $\mathcal{L}_{cls}$ and 2D bounding box loss $\mathcal{L}_{2D}$ belong to the 2D bounding box branch and are identical to those defined in 2D R-CNNs~\cite{ren2015faster,he2017mask}. $\mathcal{L}_{pp}$ and $\mathcal{L}_{p}$ are defined on the perspective point branch (\autoref{sec:perspective}), $\mathcal{L}_{3D}$ is defined on the 3D bounding box branch (see \autoref{sec:3dbox}), and the $\mathcal{L}_{proj}$ is defined on maintaining the 2D-3D projection consistency (see \autoref{sec:consistency}).

\setstretch{0.98}

\subsection{Perspective Point Estimation}
\label{sec:perspective}

The perspective point branch estimates the set of 2D perspective points for each RoI. Formally, the 2D perspective points of an object are the 2D projections of local Manhattan 3D keypoints to locate that object, and they satisfy certain geometric constraints imposed by the perspective projection. In our case, the perspective points (\autoref{fig:overview}(b)) include the 2D projections of the 3D bounding box corners and the 3D object center. The perspective points are predicted using a template-based regression and learned by a mean squared error and a perspective loss detailed below.

\subsubsection{Template-based Regression}

Most of the existing methods~\cite{newell2016stacked,lee2017roomnet,zou2018layoutnet,he2017mask,suwajanakorn2018discovery} estimate visual keypoints with heatmaps, where each map predicts the location for a certain keypoint. However, predicting perspective points by heatmaps has two major problems: (i) Heatmap prediction for different keypoints is independent, thus fail to capture the topology correlations among the perspective points. (ii) Heatmap prediction for each keypoint relies heavily on the visual feature such as corners, which may be difficult to detect (see an example in \autoref{fig:overview}(b)). In contrast, each set of 2D perspective points can be treated as a low dimensional embedding of a set of 3D points with a particular topology, thus inferring such points relies more on the relation and topology among the points instead of just the visual features.

To tackle these problems, we avoid dense per-pixel predictions. Instead, we estimate the perspective points by a mixture of sparse templates~\cite{olshausen1996emergence,wu2010learning}. The sparse templates are more robust when facing unfamiliar scenes or objects. Ablative experiments show that the proposed template-based method provides a more accurate estimation of perspective points than heatmap-based methods; see \autoref{sec:ablative}.

Specifically, we project both the 3D object center and eight 3D bounding box corners to 2D with camera parameters to generate the ground-truth 2D perspective points $P_{gt} \in \mathbb{R}^{2 \times 9}$. Since a portion of the perspective points usually lies out of the RoI, we calculate the location of the perspective points in an extended (doubled) size of RoI and normalize the locations to $[0, 1]$.

We predict the perspective points by a linear combination of templates; see \autoref{fig:perspective}. The perspective point branch has a $C \times K \times 2 \times 9$ dimensional output for the templates $T$, and a $C \times K$ dimensional output for the coefficients $w$, where $K$ denotes the number of templates for each class and $C$ denotes the number of object classes. The templates $T$ is scaled to $[0, 1]$ by a sigmoid nonlinear function, and the coefficients $w$ is normalized by a softmax function. The estimated perspective points $\hat{P} \in \mathbb{R}^{C \times 2 \times 9}$ can be computed by a linear combination: 
\begin{equation}
    \hat{P_i} = \sum^{K}_{k=1} w_{ik}\,T_{ik}, \quad{} \forall i = 1, \cdots, C.
\end{equation}

\setstretch{1}

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/manhattan.pdf}
    \end{center}
    \caption{Perspective point estimation. (a) The perspective points are estimated by a mixture of templates through a linear combination. Each template encodes geometric cues including orientations and viewpoints. (b) The perspective loss enforces each set of 2D perspective points to be the perspective projection of a (vertical) 3D cuboid. For a vertical cuboid, the projected vertical edges (\ie, $ae$, $bf$, $cg$, and $dh$) should be parallel or near parallel (under small camera tilting angles). For 3D parallel lines that are perpendicular to the gravity direction, the vanishing points of their 2D projections should coincide (\eg, $u1$ and $u2$).}
    \label{fig:perspective}
\end{figure}

The template design is both class-specific and instance-specific: (i) Class-specific: we decouple the prediction of the perspective point and the object class, allowing the network to learn perspective points for every class without competition among classes. (ii) Instance-specific: the templates are inferred for each RoI; hence, they are specific to each object instance. The templates are automatically learned for each object instance from data with the end-to-end learning framework; thus, both the templates and coefficients for each instance are optimizable and can better fit the training data.

The average mean squared error (MSE) loss is defined as $\mathcal{L}_{pp} = \text{MSE} (\hat{P}_c, P_{gt})$. For an RoI associated with ground-truth class $c$, $\mathcal{L}_{pp}$ is only defined on the $c$'s perspective points during training; perspective point outputs from other classes do not contribute to the loss. In inference, we rely on the dedicated classification branch to predict the class label to select the output perspective points.

\subsubsection{Perspective Loss}

Under the assumption that each 3D bounding box aligns with a local Manhattan frame, we regularize the estimation of the perspective points to satisfy the constraint of perspective projection. Each set of mutually parallel lines in 3D can be projected into 2D as intersecting lines; see \autoref{fig:perspective} (b). These intersecting lines should converge at the same vanishing point. Therefore, the desired algorithm would penalize the distance between the intersection points from the two sets of intersecting lines. For example in \autoref{fig:perspective} (b), we select line $ad$ and line $eh$ as a pair of lines, $bc$ and $fg$ as another, and compute the distance between their intersection point $u_1$ and $u_2$. Additionally, since we assume each 3D local Manhattan frame aligns with the vertical (gravity) direction, we enforce the edges in gravity direction (\ie, $ae$, $bf$, $cg$, and $dh$) to be parallel by penalizing the large slope variance.

The perspective loss is computed as $\mathcal{L}_{p} = \mathcal{L}_{d1} + \mathcal{L}_{d2} + \mathcal{L}_{grav}$, where $\mathcal{L}_{grav}$ penalizes the slope variance in gravity direction, $\mathcal{L}_{d1}$ and $\mathcal{L}_{d2}$ penalize the intersection point distance for the two perpendicular directions along the gravity direction.

\subsection{3D Bounding Box Estimation}
\label{sec:3dbox}

Estimating 3D bounding boxes is a two-step process. In the first step, the 3D branch estimates the 3D attributes, including the distance between the camera center and the 3D object center, as well as the 3D size and orientation following \citet{huang2018cooperative}. Since the perspective point branch encodes rich 3D geometric features, the 3D attribute estimator aggregates the feature from perspective point branch with a soft gated function between $[0, 1]$ to improve the prediction. The gated function serves as a soft-attention mechanism that decides how much information from perspective points should contribute to the 3D prediction.

In the second step, with the estimated projected 3D bounding boxes center (\ie, the first estimated perspective point) and the 3D attributes, we compose the 3D bounding boxes by the inverse projection from the 2D image plane to the 3D world following \citet{huang2018cooperative} given camera parameters.

The 3D loss is computed by the sum of individual losses of 3D attributes and a joint loss of 3D bounding box $\mathcal{L}_{3D} = \mathcal{L}_{dis} + \mathcal{L}_{size} + \mathcal{L}_{ori} + \mathcal{L}_{box3d}$.

\setstretch{1}

\subsection{2D-3D Consistency}
\label{sec:consistency}

In contrast to prior work~\cite{wu2016single,rezende2016unsupervised,yan2016perspective,mousavian20173d,wu2017marrnet,huang2018cooperative} that enforces the consistency between estimated 3D objects and 2D image, we devise a new way to impose a re-projection consistency loss between 3D bounding boxes and perspective points. Specifically, we compute the 2D projected perspective points $P_{proj}$ by projecting the 3D bounding box corners back to 2D image plane and computing the distance with respect to ground-truth perspective points $\mathcal{L}_{proj} = \text{MSE} (P_{proj}, P_{gt})$. Comparing with prior work to maintain the consistency between 2D and 3D bounding boxes by approximating the 2D projection of 3D bounding boxes~\cite{mousavian20173d,huang2018cooperative}, the proposed method uses the \emph{exact} projection of projected 3D boxes to establish the consistency, capturing a more precise 2D-3D relationship.

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/result.jpg}
    \end{center}
    \vspace{-6pt}
    \caption{Qualitative results (top 50\%). For every three columns as a group: (Left) The RGB image with 2D detection results. (Middle) The RGB image with estimated perspective points. (Right) The results in 3D point cloud; point cloud is used for visualization only.}
    \label{fig:result}
    \vspace{6pt}
\end{figure}

\section{Implementation Details}
\label{sec:details}

\paragraph{Network Backbone} Inspired by \citet{he2017mask}, we use the combination of residual network (ResNet)~\cite{he2016deep} and feature pyramid network (FPN)~\cite{lin2017feature} to extract the feature from the entire image. A region proposal network (RPN)~\cite{ren2015faster} is used to produce object proposals (\ie, RoI). A RoIAlign~\cite{he2017mask} module is adopted to extract a smaller features map ($256 \times 7\times7$) for each proposal.

\paragraph{Network Head} The network head consists of three branches, and each branch has its individual feature extractor and predictor. Three feature extractors have the same architecture of two fully connected (FC) layers; each FC layer is followed by a ReLU function. The feature extractors take the $256 \times 7 \times 7$ dimensional RoI features as the input and output a 1024 dimensional vector.

The predictor in the 2D branch has two separate FC layers to predict a $C$ dimensional object class probabilities and a $C \times 4$ dimensional 2D bounding box offset. The predictor in the perspective point branch predicts $C\times K \times 2 \times 9$ dimensional templates and $C \times K$ dimensional coefficients with two FC layers and their corresponding nonlinear activation functions (\ie, sigmoid, softmax). The soft gate in the 3D branch consists of an FC layer (1024-1) and a sigmoid function to generate the weight for feature aggregation. The predictor in the 3D branch consists of three FC layers to predict the size, the distance from the camera, and the orientation of the 3D bounding box.

\setstretch{1}

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/ap_30.pdf}
    \end{center}
    \caption{Precision-Recall (PR) curves for 3D object detection on SUN RGB-D}
    \label{fig:pr_30}
\end{figure}

\section{Experiments}

\textbf{Dataset}\quad{} We conduct comprehensive experiments on SUN RGB-D~\cite{song2015sun} dataset. The SUN RGB-D dataset has a total of 10,335 images, in which 5,050 are test images. It has a rich annotation of scene categories, camera pose, and 3D bounding boxes. We evaluate the 3D object detection results of the proposed PerspectiveNet, make comparisons with the state-of-the-art methods, and further examine the contribution of each module in ablative experiments.

\textbf{Experimental Setup}\quad{} To prepare valid data for training the proposed model, we discard the images with no 3D objects or incorrect correspondence between 2D and 3D bounding boxes, resulting 4783 training images and 4220 test images. We detect 30 categories of objects following \citet{huang2018cooperative}.

\textbf{Reproduciblity Details}\quad{} During training, an RoI is considered positive if it has the IoU with a ground-truth box of at least 0.5. $\mathcal{L}_{pp}$, $\mathcal{L}_{p}$, $\mathcal{L}_{3D}$, and $\mathcal{L}_{proj}$ are only defined on positive RoIs. Each image has N sampled RoIs, where the ratio of positive to negative is 1:3 following the protocol presented in \citet{girshick2015fast}.

We resize the images so that the shorter edges are all 800 pixels. To avoid over-fitting, a data augmentation procedure is performed by randomly flipping the images or randomly shifting the 2D bounding boxes with corresponding labels during the training. We use SGD for optimization with a batch size of 32 on a desktop with 4 Nvidia TITAN RTX cards (8 images each card). The learning rate starts at 0.01 and decays by 0.1 at 30,000 and 35,000 iterations. We implement our framework based on the code of \citet{massa2018mrcnn}. It takes 6 hours to train, and the trained PerspectiveNet provides inference in real-time (20 FPS) using a single GPU.

Since the consistency loss and perspective loss can be substantial during the early stage of the training process, we add them to the joint loss when the learning rate decays twice. The hyper-parameter (\eg, the weights of losses, the architecture of network head) is tuned empirically by a local search.

\textbf{Evaluation Metric}\quad{} We evaluate the performance of 3D object detection using the metric presented in \citet{song2015sun}. Specifically, we first calculate the 3D Intersection over Union (IoU) between the predicted 3D bounding boxes and the ground-truth 3D bounding boxes, and then compute the mean average precision (mAP). Following \citet{huang2018cooperative}, we set the 3D IoU threshold as 0.15 in the absence of depth information. 

\textbf{Qualitative Results}\quad{} The qualitative results of 2D object detection, 2D perspective point estimation, and 3D object detection are shown in \autoref{fig:result}. Note that the proposed method performs accurate 3D object detection in some challenging scenes. For the perspective point estimation, even though some of the perspective points are not aligned with image features, the proposed method can still localize their positions robustly. 

\textbf{Quantitative Results}\quad{} Since the state-of-the-art method~\cite{huang2018cooperative} learns the camera extrinsic parameters jointly, we provide two protocals for evaluations for a fair comparison: (i) PerspectiveNet given ground-truth camera extrinsic parameter (\emph{full}), and (ii) PerspectiveNet without ground-truth camera extrinsic parameter by learning it jointly following~\cite{huang2018cooperative} (\emph{w/o.~cam}).

We learn the detector for 30 object categories and report the precision-recall (PR) curve of 10 main categories in \autoref{fig:pr_30}. We calculate the area under the curve to compute AP; \autoref{tab:detection_img} shows the comparisons of APs of the proposed models with existing approaches (see supplementary materials for the APs of all 30 categories).

\setstretch{0.93}

Note that the critical difference between the proposed model and the state-of-the-art method~\cite{huang2018cooperative} is the intermediate representation to learn the 2D-3D consistency. \citet{huang2018cooperative} uses 2D bounding boxes to enforce a 2D-3D consistency by minimizing the differences between projected 3D boxes and detected 2D boxes. In contrast, the proposed intermediate representation has a clear advantage since projected 3D boxes often are not 2D rectangles, and perspective points eliminate such errors.

Quantitatively, our full model improves the mAP of the state-of-the-art method~\cite{huang2018cooperative} by 14.71\%, and the model without the camera extrinsic parameter improves by 10.91\%. The significant improvement of the mAP demonstrates the efficacy of the proposed intermediate representation. We defer more analysis on how each component contributes to the overall performance in \autoref{sec:ablative}.

\begin{table}[b!]
    \caption{Comparisons of 3D object detection on SUN RGB-D (AP).}
    \setlength{\tabcolsep}{4pt}
    \centering
    \resizebox{\textwidth}{!}{
    \begin{tabular}{l c c c c c c c c c c c}
        \Xhline{2\arrayrulewidth}
         & bed & chair & sofa & table & desk & toilet  & bin  & sink & shelf & lamp & mAP\\
        \hline
        3DGP~\cite{choi2013understanding} & 5.62 & 2.31 & 3.24 & 1.23 & - & -  & - & - & - & - & -  \\
        HoPR~\cite{huang2018holistic} & 58.29 & 13.56 & 28.37 & 12.12 & 4.79 & 16.50  & 0.63 & 2.18 & 1.29 & 2.41 & 14.01  \\
        CooP~\cite{huang2018cooperative} & 63.58 & 17.12 & 41.22 & 26.21  &  9.55  & 58.55 & 10.19 & 5.34 & 3.01 & 1.75  & 23.65\\
        \hline
        Ours (w/o. cam) & 71.39 & 34.94 & 55.63 & 34.10 & 14.23 & 73.73 & 17.47 & 34.41 & 4.21 & 9.54 & 34.96\\
        Ours (full) & \textbf{79.69} & \textbf{40.42} & \textbf{62.35} & \textbf{44.12} & \textbf{20.19} & \textbf{81.22} & \textbf{22.42} & \textbf{41.35} & \textbf{8.29} & \textbf{13.14} & \textbf{39.09}\\
        \Xhline{2\arrayrulewidth}
    \end{tabular}}
    \label{tab:detection_img}
\end{table}

\subsection{Ablative Analysis}
\label{sec:ablative}

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/bad.pdf}
    \end{center}
    \vspace{-6pt}
    \caption{Heatmaps vs. templates for perspective point prediction. (Left) Estimated by heatmap-based method. (Right) Estimated by the proposed template-based method.}
    \label{fig:heatmap}
\end{figure}

In this section, we analyze each major component of the model to examine its contribution to the overall significant performance gain. Specifically, we design six variants of the proposed model.\\
$\bullet$ $S_1$: The model trained without the perspective point branch, using the 2D offset to predict the 3D center of the object following \citet{huang2018cooperative}. \\
$\bullet$ $S_2$: The model that aggregates the feature from the perspective point branch and 3D branch directly without the gate function. \\
$\bullet$ $S_3$: The model that aggregates the feature from the perspective point branch and 3D branch with a gate function that only outputs 0 or 1 (hard gate). \\
$\bullet$ $S_4$: The model trained without the perspective loss. \\
$\bullet$ $S_5$: The model trained without the consistency loss. \\
$\bullet$ $S_6$: The model trained without the perspective branch, perspective loss, or consistency loss.\\
\autoref{tab:analysis} shows the mAP for each variant of the proposed model. The mAP drops 3.86\% without the perspective point branch ($S_1$), 1.66\% without the consistency loss ($S_5$), indicating that the perspective point and re-projection consistency influence the most to the proposed framework. In addition, the switch of gate function ($S_2$, $S_3$) and perspective loss ($S_4$) contribute less to the final performance. Since $S_6$ is still higher than the state-of-the-art result~\cite{huang2018cooperative} with 9.32\%, we conjecture this performance gain may come from the one-stage (vs. two-stage) end-to-end training framework and the usage of ground-truth camera parameter; we will further investigate this in future work.

\begin{table}[b!]
    \caption{Ablative analysis of the proposed model on SUN RGB-D. We evaluate the mAP for 3D object detection.}
    \setlength{\tabcolsep}{16pt}
    \centering
    \resizebox{\textwidth}{!}{
    \begin{tabular}{l|c|c|c|c|c|c|c}
        \Xhline{2\arrayrulewidth}
        \hline
        Setting & $S_1$ & $S_2$ & $S_3$ & $S_4$ & $S_5$ & $S_6$ & Full \\
        \hline
        mAP & 35.23 & 38.63 & 38.87 & 39.01 & 37.43 & 32.97 & \textbf{39.09} \\ 
        \Xhline{2\arrayrulewidth}
    \end{tabular}}
    \label{tab:analysis}
\end{table}

\subsection{Heatmaps vs. Templates}

As discussed in \autoref{sec:perspective}, we test two different methods for the perspective point estimation: (i) dense prediction as heatmaps following the human pose estimation mechanism in \citet{he2017mask} by adding a parallel heatmap prediction branch, and (ii) template-based regression by the proposed method. The qualitative results (see \autoref{fig:heatmap}) show that the heatmap-based estimation suffers severely from occlusion and topology change among the perspective points, whereas the proposed template-based regression eases the problem significantly by learning robust sparse templates, capturing consistent topological relations. We also evaluate the quantitative results by computing the average absolute distance between the ground-truth and estimated perspective points. The heatmap-based method has a 10.25 pix error, while the proposed method only has a 6.37 pix error, which further demonstrates the efficacy of the proposed template-based perspective point estimation.

\setstretch{1}

\subsection{Failure Cases}

In a large portion of the failure cases, the perspective point estimation and the 3D box estimation fail at the same time; see \autoref{fig:result_fail}. It implies that the perspective point estimation and the 3D box estimation are highly coupled, which supports the assumptions that the perspective points encode richer 3D information, and the 3D branch learns meaningful knowledge from the 2D branch. In future work, we may need a more sophisticated and general 3D prior to infer the 3D locations of objects for such challenging cases.

\begin{figure}[t!]
    \begin{center}
        \includegraphics[width=\linewidth]{fig/result_fail.png}
    \end{center}
    \vspace{-3pt}
    \caption{Some failure cases. The perspective point estimation and the 3D box estimation fail at the same time.}
    \label{fig:result_fail}
    \vspace{9pt}
\end{figure}

\subsection{Discussions and Future Work}

\paragraph{Comparison with optimization-based methods.}

Assume the estimated 3D size or distance is given, it is possible to compute the 3D bounding box with an optimization-based method like efficient PnP. However, the optimization-based methods are sensitive to the accuracy of the given known variables. It is more suitable for tasks with smaller solution spaces (\eg, 6-DoF pose estimation where the 3D shapes of objects are fixed). However, it would be difficult for tasks with larger solution spaces (\eg, 3D object detection where the 3D size, distance, and object pose could vary significantly). Therefore, we argue that directly estimating each variable with constraints imposed among them is a more natural and more straightforward solution.

\paragraph{Potential incorporation with depth information.}

The PerspectiveNet estimates the distance between the 3D object center and camera center based on the color image only (pure RGB without any depth information). If the depth information was also provided, the proposed method should be able to make a much more accurate distance prediction.

\paragraph{Potential application to outdoor environment.}

It would be interesting to see how the proposed method would perform on outdoor 3D object detection datasets like KITTI~\cite{geiger2013vision}. The differences between the indoor and outdoor datasets for the task of 3D object detection lie in various aspects, including the diversity of object categories, the variety of object dimension, the severeness of the occlusion, the range of the camera angles, and the range of the distance (depth). We hope to adopt the PerspectiveNet in future to the outdoor scenarios.

\section{Conclusion}

We propose the PerspectiveNet, an end-to-end differentiable framework for 3D object detection from a single RGB image. It uses perspective points as an intermediate representation between 2D input and 3D estimations. The PerspectiveNet adopts an R-CNN structure, where the region-wise branches predict 2D boxes, perspective points, and 3D boxes. Instead of using a direct regression of 2D-3D relations, we further propose a template-based regression for estimating the perspective points, which enforces a better consistency between the predicted 3D boxes and the 2D image input. The experiments show that the proposed method significantly improves existing RGB-based methods.

\paragraph{Acknowledgments}

This work reported herein is supported by MURI ONR N00014-16-1-2007, DARPA XAI N66001-17-2-4029, ONR N00014-19-1-2153, and an NVIDIA GPU donation grant.

\newpage
\setstretch{1}
\bibliographystyle{unsrtnat}
\setlength{\bibsep}{4pt}
\bibliography{neurips_2019}

\end{document}
