
\thmsimu


\begin{proof}
  Let $B$ be a binary relation on processes defined as follows
  \[
  (\PV , Q) \in B
  \iff
  \derive{\SYSV}{\GA} \text{ and }
  \exists \ptp{n} \in \PARTS{\SYSV} . \, \Proj{\GA}{n} = \PV \text{ and }
  \restri{\SYSV}{n} = Q
  \]
  Let us show that $B$ is a simulation.
  \begin{itemize}
  \item If $\Proj{\GA}{n} \ltsarrow{\PSEND{a}{\SORTV}} \PV_1$
    then $\Proj{\GA}{n} \equiv \PSEND{a}{\SORTV} \PSEP \PV_1 \PINCH \PV_2 $
    and by Lemmas~\ref{lem:gvsproj} and~\ref{lem:gvssys}
    we have that $\restri{\SYSV}{n} = \PSEND{a}{\SORTV} \PSEP Q_1 \PINCH Q_2$
    and thus $\restri{\SYSV}{n} \ltsarrow{\PSEND{a}{\SORTV}} Q_1$

    Now we have to show that $(\PV_1 , Q_1) \in B$, i.e.
    \[
    \derive{\SYSV'}{\GA'} \text{ with } 
    \Proj{\GA'}{n} = \PV_1 \text{ and }
    \restri{\SYSV'}{n} = Q_1
    \]
    Pose
    \[\SYSV' \equiv
    \PBOX{n}{Q_1} \PPAR \QUEUE{a}{\SORTV} \PPAR
    \PPROD{\ptp{m}\neq \ptp{n} \in \PARTS{\SYSV}}{\restri{\SYSV}{m}}
    \]
    by Lemma~\ref{lem:subred}, $\derive{\SYSV'}{\GA'}$,
    and by Corollary~\ref{cor:subred}, we have
    $\Proj{\GA'}{n} = \PV_1$, as required.

\item If $\Proj{\GA}{n} \ltsarrow{\PRECEIVE{a}{\SORTV}} \PV_1$
    then $\Proj{\GA}{n} \equiv \PRECEIVE{a}{\SORTV} \PSEP \PV_1 \POUTCH \PV_2 $
    and by Lemmas~\ref{lem:gvsproj} and~\ref{lem:gvssys}
    we have that $\restri{\SYSV}{n} = \PRECEIVE{a}{\SORTV} \PSEP Q_1 \POUTCH Q_2$
    and thus $\restri{\SYSV}{n} \ltsarrow{\PRECEIVE{a}{\SORTV}} Q_1$
    
    Now we have to show that $(\PV_1 , Q_1) \in B$, i.e.
    \[
    \derive{\SYSV'}{\GA'} \text{ with } 
    \Proj{\GA'}{n} = \PV_1 \text{ and }
    \restri{\SYSV'}{n} = Q_1
    \]
    Pose
    \[
    \SYSV \equiv 
    \PBOX{n}{\PRECEIVE{a}{\SORTV} \PSEP Q_1 \POUTCH Q_2} \PPAR
    \QUEUE{a}{\SORTV \cdot \rho} \PPAR
    \PPROD{\ptp{m}\neq \ptp{n} \in \PARTS{\SYSV}}{\restri{\SYSV}{m}}
    \]
    and 
    \[
    \SYSV' \equiv 
    \PBOX{n}{Q_1} \PPAR 
    \QUEUE{a}{\rho} \PPAR
    \PPROD{\ptp{m}\neq\ptp{n} \in \PARTS{\SYSV}}{\restri{\SYSV}{m}}
    \]
    
    by Lemma~\ref{lem:subred}, $\derive{\SYSV'}{\GA'}$,
    and by Corollary~\ref{cor:subred}, we have
    $\Proj{\GA'}{n} = \PV_1$, as required.
    
  \item If  $\Proj{\GA}{n} \ltsarrow{\labend} \PV_1$
    then $\Proj{\GA}{n} \equiv \PEND$ and $\PV_1 = \PEND$,
    thus $\ptp{n} \not\in \PARTS{\GA}$
    and by Lemma~\ref{lem:partis} this means that $\restri{\SYSV}{n} = \PEND$,
    we then have $\restri{\SYSV}{n} \ltsarrow{\labend} \PEND$.
  \end{itemize}
\end{proof}





\begin{lemma}\label{lem:sysproj}
  The following holds:
  \begin{enumerate}
  \item \label{en:lem:sysproj1}
    If $\derive{\PBOX{n}{\PSEND{a}{\SORTV} \PSEP \PV \PINCH \PV'} \PPAR \SYSV}{\GA}$
    then $\Proj{\GA}{n} \equiv \PSEND{a}{\SORTV} \PSEP Q \PINCH Q' $
   
  \item \label{en:lem:sysproj2}
    If $\derive{\PBOX{n}{\PRECEIVE{a}{\SORTV} \PSEP \PV \POUTCH \PV'} \PPAR \SYSV}{\GA}$
    then either $\Proj{\GA}{n} \equiv \PRECEIVE{a}{\SORTV} \PSEP Q \POUTCH Q'$,
    or  $\derive{\PBOX{n}{\PV'} \PPAR \SYSV}{\GA}$
  \end{enumerate}
\end{lemma}
\begin{proof}
  The proof of~\ref{en:lem:sysproj1} is by Lemma~\ref{lem:svsg},
  and the proof of~\ref{en:lem:sysproj2}
  is by Lemma~\ref{lem:svsg} and rule \rulename{$\gipoutch$}.
\end{proof}
\medskip






\thmbisim

\begin{proof}
For this proof we pose
$T = \PPROD{\ptp{m} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
\PPROD{\ptp{b} \in \CHANS{\GA}}{\QUEUE{b}{\Projc{\GA}{b}}}$.

\proocase{$\SYSV$ sends}
Assume $\SYSV \equiv \SYSV_0 \PPAR \SYSV_1$,
$\SYSV_0 \ltsarrow{\labsend}$ and
$\SYSV_1 \ltsarrow{\labpush}$.
We have
\begin{equation}\label{eq:corr1}
  \SYSV \equiv \PBOX{n}{\PSEND{a}{\SORTV} \PSEP \PV \PINCH \PV'}
  \PPAR \QUEUE{a}{\rho}
  \PPAR \SYSV''
\end{equation}
and 
\begin{equation}\label{eq:corr2}
  \SYSV' \equiv \PBOX{n}{\PV}
  \PPAR \QUEUE{a}{\rho \cdot \SORTV}
  \PPAR \SYSV''
\end{equation}
By Lemma~\ref{lem:sysproj}, $\Proj{\GA}{n} \equiv \PSEND{a}{\SORTV} \PSEP Q \PINCH Q'$,
thus $\Proj{\GA}{n} \ltsarrow{\labsend}$,
and by Lemma~\ref{lem:qproj} $\Projc{\GA}{a} = \rho$.

We then have (note that $\chan{a} \in \CHANS{\GA}$)
\begin{equation}\label{eq:corr3}
  T \equiv
  \PBOX{n}{\PSEND{a}{\SORTV} \PSEP Q \PINCH Q'} \PPAR
  \QUEUE{a}{\rho} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA} }{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}
and by definition of $\ltsarrow{}$,
\begin{equation}\label{eq:corr4}
  T' \equiv
  \PBOX{n}{Q} \PPAR
  \QUEUE{a}{\rho \cdot \SORTV} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA} }{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}


Let us now show that
\begin{equation}\label{eq:corr5}
  \derive{\SYSV'}{\GA'} \text{ with }
  T' \equiv  \PPROD{\ptp{m} \in \PARTS{\GA'}}{\PBOX{m}{\Proj{\GA'}{m}}} \PPAR
  \PPROD{\ptp{b} \in \CHANS{\GA'}}{\QUEUE{b}{\Projc{\GA'}{b}}}
\end{equation}
By Lemma~\ref{lem:subred} we know that $\derive{\SYSV'}{\GA'}$,
we have that
$\Proj{\GA'}{n} \equiv Q$, by Corollary~\ref{cor:subred}, and
$\Projc{\GA'}{a} \equiv \rho \cdot \SORTV$ by Lemma~\ref{lem:qproj}.

\proocase{$T$ sends}
Assume $T \equiv T_0 \PPAR T_1$, $T_0 \ltsarrow{\labsend}$ and 
$T_1 \ltsarrow{\labpush}$. We have
\begin{equation}\label{eq:corrA}
  T \equiv
  \PBOX{n}{\PSEND{a}{\SORTV} \PSEP Q \PINCH Q'} \PPAR
  \QUEUE{a}{\rho} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA}}{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}
and
\begin{equation}\label{eq:corra}
  T' \equiv
  \PBOX{n}{Q} \PPAR
  \QUEUE{a}{\rho \cdot \SORTV} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA}}{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}

By Lemma~\ref{lem:simu}, we have $\restri{\SYSV}{n} \ltsarrow{\labsend}$,
and since, by Lemma~\ref{lem:chans}, $\chan{a} \in \CHANS{\GA} \Rightarrow \chan{a} \in \CHANS{\SYSV}$, there is a queue $\chan{a}$ in $\SYSV$. Note that a queue $\chan{a}$ can always make
a transition $\QUEUE{a}{\rho'} \ltsarrow{\labpush}$ (regardless of $\rho'$).
By Lemma~\ref{lem:qproj}, $\restric{\SYSV}{a} = \rho$.

Therefore, we must have
\begin{equation}
  \label{eq:corrb}
  \SYSV \equiv
  \PBOX{n}{\PSEND{a}{\SORTV} \PSEP \PV \PINCH \PV'} \PPAR
  \QUEUE{a}{\rho} \PPAR \SYSV''
\end{equation}

And by definition of $\ltsarrow{}$, we have
\begin{equation}
  \label{eq:corrc}
  \SYSV' \equiv
  \PBOX{n}{\PV} \PPAR
   \QUEUE{a}{\rho \cdot \SORTV } \PPAR \SYSV''
\end{equation}

Finally, we have
\begin{equation}
  \label{eq:corrd}
  \derive{\SYSV'}{\GA'}
  \text{ with }
  T' \equiv
  \PPROD{\ptp{m} \in \PARTS{\GA'}}{\PBOX{m}{\Proj{\GA'}{m}}} \PPAR
  \PPROD{\ptp{b} \in \CHANS{\GA'}}{\QUEUE{b}{\Projc{\GA'}{b}}}
\end{equation}
by Lemma~\ref{lem:subred}.

\proocase{$\SYSV$ receives}
Assume $\SYSV \equiv \SYSV_0 \PPAR \SYSV_1$,
$\SYSV_0 \ltsarrow{\labrec}$ and
$\SYSV_1 \ltsarrow{\labpop}$.
We have
\begin{equation}\label{eq:corr11}
  \SYSV \equiv \PBOX{n}{\PRECEIVE{a}{\SORTV} \PSEP \PV \POUTCH \PV'}
  \PPAR \QUEUE{a}{\SORTV \cdot \rho}
  \PPAR \SYSV''
\end{equation}
and 
\begin{equation}\label{eq:corr12}
  \SYSV' \equiv \PBOX{n}{\PV}
  \PPAR \QUEUE{a}{\rho}
  \PPAR \SYSV''
\end{equation}
By Lemma~\ref{lem:sysproj} and~\eqref{eq:corr11}, we have either
\begin{equation}
  \label{eq:corr13}
  \Proj{\GA}{n} \equiv \PRECEIVE{a}{\SORTV} \PSEP Q \POUTCH Q'
\end{equation}
or
\begin{equation}
  \label{eq:corr14}
  \derive{
    \PBOX{n}{\PV'}
    \PPAR \QUEUE{a}{\SORTV \cdot \rho}
    \PPAR \SYSV''
  }
  {\GA}
\end{equation}
However, by assumption we have $\derive{\SYSV}{\GA}$, with $\SYSV$ as in~\eqref{eq:corr11},
therefore~\eqref{eq:corr14} cannot hold by Lemma~\ref{lem:qbranch}.

By Lemma~\ref{lem:qproj}, we have that $\Projc{\GA}{a} \ltsarrow{\labpop}$
and by~\eqref{eq:corr13}, $\Proj{\GA}{n} \ltsarrow{\PRECEIVE{a}{\SORTV}}$.
By definition of $\ltsarrow{}$, we have
\begin{equation}
  \label{eq:corr15}
  T \equiv
  \PBOX{n}{\PRECEIVE{a}{\SORTV} \PSEP Q \PINCH Q'} \PPAR
  \QUEUE{a}{\SORTV \cdot \rho} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA}}{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}

Let us now show that
\begin{equation}
  \label{eq:corr16}
  \derive{\SYSV'}{\GA'}
  \text{ with }
  T' \equiv
  \PPROD{\ptp{m} \in \PARTS{\GA'}}{\PBOX{m}{\Proj{\GA'}{m}}} \PPAR
  \PPROD{\ptp{b} \in \CHANS{\GA'}}{\QUEUE{b}{\Projc{\GA'}{b}}}
\end{equation}
By Lemma~\ref{lem:subred} we know that $\derive{\SYSV'}{\GA'}$,
we have that
$\Proj{\GA'}{n} \equiv Q$, by Corollary~\ref{cor:subred}, and
$\Projc{\GA'}{a} \equiv \SORTV \cdot \rho$ by Lemma~\ref{lem:qproj}.

\proocase{$T$ receives}
Assume $T \equiv T_0 \PPAR T_1$, $T_0 \ltsarrow{\labrec}$ and 
$T_1 \ltsarrow{\labpop}$. We have
\begin{equation}\label{eq:corrAR}
  T \equiv
  \PBOX{n}{\PRECEIVE{a}{\SORTV} \PSEP Q \PINCH Q'} \PPAR
  \QUEUE{a}{\SORTV \cdot \rho} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA}}{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}
and
\begin{equation}\label{eq:corraR}
  T' \equiv
  \PBOX{n}{Q} \PPAR
  \QUEUE{a}{\rho} \PPAR
  \PPROD{\ptp{m} \neq \ptp{n} \in \PARTS{\GA}}{\PBOX{m}{\Proj{\GA}{m}}} \PPAR
  \PPROD{\ptp{b} \neq \chan{a} \in \CHANS{\GA}}{\QUEUE{b}{\Projc{\GA}{b}}}
\end{equation}
\end{proof}
By Lemma~\ref{lem:simu}, we have $\restri{\SYSV}{n} \ltsarrow{\PRECEIVE{a}{\SORTV}}$,
and by Lemma~\ref{lem:qproj}, we have $\restric{\SYSV}{a} = \rho$,
therefore
\begin{equation}
  \label{eq:corr21}
  \SYSV \equiv \PBOX{n}{\PRECEIVE{a}{\SORTV} \PSEP \PV \POUTCH \PV'}
  \PPAR \QUEUE{a}{\SORTV \cdot \rho}
  \PPAR \SYSV''
\end{equation}
and 
\begin{equation}
  \label{eq:corr22}
  \SYSV \equiv \PBOX{n}{\PV}
  \PPAR \QUEUE{a}{\rho}
  \PPAR \SYSV''
\end{equation}

We now have to show that
\begin{equation}
  \label{eq:corr23}
  \derive{\SYSV'}{\GA'}
  \text{ with }
  T' \equiv
  \PPROD{\ptp{m} \in \PARTS{\GA'}}{\PBOX{m}{\Proj{\GA'}{m}}} \PPAR
  \PPROD{\ptp{b} \in \CHANS{\GA'}}{\QUEUE{b}{\Projc{\GA'}{b}}}
\end{equation}
as before, we have $\Proj{\GA'}{n} = \PV$ by Corollary~\ref{cor:subred} and
$\Projc{\GA'}{a} = \rho$ by Lemma~\ref{lem:qproj}.

\proocase{End}
If $\SYSV \ltsarrow{\labend} \SYSV$, then $\SYSV \equiv \PEND$ and $\GA \equiv \GEND$,
and vice versa if  $T \ltsarrow{\labend} T$.


\begin{lemma}\label{lem:qbranch}

  If 
  \[
  \derive{
    \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP \PV \POUTCH \PV'} \PPAR 
    \QUEUE{a}{\SORTV \cdot \rho} \PPAR
    \SYSV}{\GA}
  \]
  is derivable then
  \[
  \derive{\PBOX{r}{\PV'} \PPAR 
    \QUEUE{a}{\SORTV \cdot \rho}\PPAR
    \SYSV}{\GA'}
  \] is \emph{not} derivable.
\end{lemma}

\begin{proof}
  Assume $\PV' \equiv \PRECEIVE{b}{\SORTV} \PSEP \PV''$.
  We show that we must have
  \[
  \GA \equiv (\GSEND{\GSTAR}{r}{a}{\SORTV} \GSEP \GA_0 \GPAR \GA_1) \GWS \GA_2
  \]
  and the derivation of $\GA$ must have the following form
  \[
  \inferrule* [Left=\rulename{$\gigws$}]
  {
    \inferrule* [Left=\rulename{$\gipar$}]
    {
      \inferrule* [Left=\rulename{$\gipoutch$}]
      {
        \inferrule* [Left=\rulename{$\gipsep$}]
        {
          \inferrule*
          {\vdots}
          {
            \judgeC{\chanset_0}{\emptyctx}{C}{
              \PBOX{r}{\PV_0} \PPAR 
              \QUEUE{a}{\rho_0} \PPAR
              \SYSV_{00}}{\GA_0} 
          }
        }
        {
          \judgeC{\chanset_0}{\emptyctx}{C}{
            \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP \PV_0} \PPAR 
            \QUEUE{a}{\SORTV \cdot \rho_0} \PPAR
            \SYSV_{00}}{\GSEND{\GSTAR}{r}{a}{\SORTV} \GSEP \GA_0}
        }
      }
      {
        \judgeC{\chanset_0}{\emptyctx}{C}{
          \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP \PV_0 \POUTCH \PV'_0} \PPAR 
          \QUEUE{a}{\SORTV \cdot \rho_0} \PPAR
          \SYSV_{00}}{\GSEND{\GSTAR}{r}{a}{\SORTV} \GSEP \GA_0}
      }
      \\
      \inferrule*
      {\vdots}
      {
        \judgeC{\chanset_1}{\emptyctx}{C}{\SYSV_{01}}{\GA_1}
      }
    }
    {
      \judge{\emptyctx}{C}{
        \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP \PV_0 \POUTCH \PV'_0} \PPAR 
        \QUEUE{a}{\SORTV \cdot \rho_0} \PPAR
        \SYSV_0}{\GSEND{\GSTAR}{r}{a}{\SORTV} \GSEP \GA_0 \GPAR \GA_1}
    }
    \\
    \inferrule*
    {\vdots}
    {\GA_2}
  }
  {
    \derive{
      \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP \PV \POUTCH \PV'} \PPAR 
      \QUEUE{a}{\SORTV \cdot \rho} \PPAR
      \SYSV}{\GA}
  }
  \]
where we must have
\begin{itemize}
\item $\onestep{\SYSV}$ or $\GA_1 = \GA_2 = \GEND$ and
  $\onestep{\SYSV_0}$ or $\SYSV_{01} \equiv \PEND$.
\item $\Ssplit{\SYSV} = (\PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP \PV_0 \POUTCH \PV'_0} \PPAR 
  \QUEUE{a}{\SORTV \cdot \rho_0} \PPAR
  \SYSV_0 , \_)$ (the second part of the split does not matter)
\item $\coname{b} \not\in \fire{\SYSV}$ (by Lemma~\ref{lem:twooutsQ})
\item $\chanset_0 \cap \chanset_1 = \varnothing$ and $\chan{b} \not\in \chanset_2$
  because of rules \rulename{$\gipar$} and \rulename{$\gipoutch$}
\end{itemize}

Now let us discuss a derivation for $\GA'$.
Since we have  $\coname{b} \not\in \fire{\SYSV}$, we must have
$\Ssplit{\PBOX{r}{\PV'} \PPAR 
\QUEUE{a}{\SORTV \cdot \rho} \PPAR
\SYSV} = (\SYSV_1 , \SYSV_2)$ such that $\restri{\SYSV_1}{r} = \PV'$,
and $\restric{\SYSV_1}{a} = \SORTV \cdot \rho$,
if the split does exist.
If it does, we have
$\spjudge{\Psi}{\Theta}{\PBOX{r}{\PV'} \PPAR 
  \QUEUE{a}{\SORTV \cdot \rho}\PPAR
  \SYSV}{\Omega}$ such that $\forall N \in \Psi \, . \, \ptp{r} \not\in N$. Therefore, the
split for the rest of the system is the same as in the other derivation.

Again, we can divide the system using \rulename{$\gipar$} if need be such that we get
\[
\judgeC{\chanset_0}{\emptyctx}{C}{
  \PBOX{r}{\PV'_0} \PPAR 
  \QUEUE{a}{\SORTV \cdot \rho_0} \PPAR
  \SYSV_{00}}{\GSEND{\GSTAR}{r}{a}{\SORTV} \GSEP \GA_0}
\]
with $\noonestep{\SYSV_{00}}$ therefore no rule is applicable for
this judgement, and the derivation does not exist.

\end{proof}



\begin{lemma}\label{lem:twoouts}
  Let $\SYSV$ a system such $\noonestep{\SYSV}$, and
  $ \chan{a,b} \not\in \fire{\SYSV}$
  the following is \emph{not} derivable
  \[
  T \equiv
    \PBOX{s_1}{\PSEND{a}{\SORTV} \PSEP \PV_1} \PPAR
    \PBOX{s_2}{\PSEND{b}{\SORTV'} \PSEP \PV_2} \PPAR
    \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP Q \POUTCH \PRECEIVE{b}{\SORTV'} \PSEP Q '} \PPAR
    \SYSV
  \]
\end{lemma}
\begin{proof}
  We show this by contradiction.
  Given $T$ as above, the only rule applicable is \rulename{$\gipoutch$} on $\ptp{r}$
  either selecting the branch on $\chan{a}$ or on $\chan{b}$.
  Therefore, the following should be derivable
  \[
  \inferrule* [Left=\rulename{$\gipoutch$}]
  {
    \inferrule* [Left=\rulename{$\gipsep$}]
    {
      \inferrule
      {
        \vdots
      }
      {
        \derive{ \PBOX{s_1}{\PV_1} \PPAR
          \PBOX{s_2}{\PSEND{b}{\SORTV'} \PSEP \PV_2} \PPAR
          \PBOX{r}{Q} \PPAR
          \SYSV}
        {\GA}
      }
    }
    {
      \derive{ \PBOX{s_1}{\PSEND{a}{\SORTV} \PSEP \PV_1} \PPAR
        \PBOX{s_2}{\PSEND{b}{\SORTV'} \PSEP \PV_2} \PPAR
        \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP Q} \PPAR
        \SYSV}
      {\GSEND{s_1}{r}{a}{\SORTV} \GSEP \GA}
    }
  }
{
  \derive{T}{\GSEND{s_1}{r}{a}{\SORTV} \GSEP \GA}
}
\]
and, we must have $\chan{a, b} \in \chanset$ and
$\onestep{\PBOX{s_1}{\PV_1} \PPAR
          \PBOX{r}{Q} \PPAR
          \SYSV}$.
And the other derivation as the form:
\[
\inferrule* [Left=\rulename{$\gipoutch$}]
{
  \inferrule* [Left=\rulename{$\gipsep$}]
  {
    \inferrule
    {
      \vdots
    }
    {
      \derive{
        \PBOX{s_1}{\PSEND{a}{\SORTV} \PSEP\PV_1} \PPAR
        \PBOX{s_2}{\PV_2} \PPAR
        \PBOX{r}{Q} \PPAR
        \SYSV}
      {\GA}
    }
  }
  {
    \derive{
      \PBOX{s_1}{\PSEND{a}{\SORTV} \PSEP \PV_1} \PPAR
      \PBOX{s_2}{\PSEND{b}{\SORTV'} \PSEP \PV_2} \PPAR
      \PBOX{r}{\PRECEIVE{b}{\SORTV'} \PSEP Q'} \PPAR
      \SYSV}
    {\GSEND{s_2}{r}{b}{\SORTV'} \GSEP \GA'}
  }
}
{
  \derive{T}{\GSEND{s_2}{r}{b}{\SORTV'} \GSEP \GA'}
}
\]
where we have $\chan{a, b} \in \chanset$ and
$\onestep{\PBOX{s_2}{\PV_2} \PPAR
  \PBOX{r}{Q} \PPAR
  \SYSV}$.
However, this is clearly in contradiction with Theorem~\ref{thm:RUNIQUE}, i.e.\
\[
\GSEND{s_1}{r}{a}{\SORTV} \GSEP \GA
\not\equiv
\GSEND{s_2}{r}{b}{\SORTV'} \GSEP \GA'
\]
\end{proof}

\begin{lemma}\label{lem:twooutsQ}
  Let $\SYSV$ a system such $\noonestep{\SYSV}$, and
  $ \chan{a,b} \not\in \fire{\SYSV}$
  the following is \emph{not} derivable
  \[
  T \equiv
  \PBOX{s_1}{\PSEND{a}{\SORTV} \PSEP \PV_1} \PPAR
  \QUEUE{b}{\SORTV' \cdot \rho} \PPAR
  \PBOX{r}{\PRECEIVE{a}{\SORTV} \PSEP Q \POUTCH \PRECEIVE{b}{\SORTV'} \PSEP Q '} \PPAR
  \SYSV
  \]
\end{lemma}
\begin{proof}
  The proof is similar to the one of Lemma~\ref{lem:twooutsQ}
  where $\QUEUE{b}{\SORTV' \cdot \rho}$ replaces  
  $\PBOX{s_2}{\PSEND{b}{\SORTV'} \PSEP \PV_2}$.
\end{proof}

%