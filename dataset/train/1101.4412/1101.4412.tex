




With the exponential growth of digital content and available information,
Peer-to-Peer systems have become the most important protocol class for data
distribution \cite{ipoque}.

Among the wide variety of Peer-to-Peer protocols (Kazaa, DirectConnect,
eDonkey, Kademlia, Gnutella), the BitTorrent protocol has proven to be the
nowadays ``killer protocol''.  With over 30\% of the Internet traffic
\cite{ipoque}, BitTorrent is the most heavily used protocol in the Internet.
The use of simple yet powerful techniques such as tit-for-tat or
rarest-piece-first have selected BitTorrent as the best choice for large data
distribution.

In order to keep up with recent advances in Internet technology, streaming and
content distribution, Peer-to-Peer systems (and BitTorrent) have to adapt and
develop new, attractive and useful features. Extensive measurements, coupled
with carefully crafted scenarios and dissemination are important for
discovering the weak/strong spots in Peer-to-Peer based data distribution and
ensuring efficient transfer.

In this paper we present a framework for running, commanding and managing
BitTorrent swarms. The purpose is to have access to a easy-to-use system for
deploying simple to complex scenarios, make extensive measurements and collect
and analyze swarm information (such as protocol messages, transfer speed,
connected peers) \cite{bt-swarm-analysis}.

\subsection{BitTorrent Keywords}

The heart of the BitTorrent protocol is a \textbf{torrent file}. The torrent
file is a meta-information file containing information regarding the content to
be shared/distributed. Any participant (\textbf{peer}) has to have access to
the torrent file.

An initial peer needs to have access to the complete file for bootstrapping the
transfer. This peer is called the \textbf{initial seeder}. A peer that has
access to the complete content and it's only uploading it is called a
\textbf{seeder}. A peer who is downloading and uploading and has incomplete 
access to the file, is called a \textbf{leecher}.



A collection of peers (seeder or leechers) who are  participating in a transfer 
based on torrent file forms a \textbf{swarm}

The core of the BitTorrent protocol is the \textit{tit for tat} mechanism,
also called \textit{optimistic unchoking} allowing for upload bandwidth to be
exchanged for download bandwidth. A peer is hoping another peer will provide
data, but in case this peer doesn't upload, it will be \textit{choked}.
Another important mechanism for BitTorrent is \textit{rarest piece first}
allowing rapid distribution of content across peers. If a piece of the content
is owned by a small group of peers it will be rapidly requested in order to
increase its availability and, thus, the overall swarm speed and performance.

\subsection{Swarm Management Framework}

\textit{The swarm management framework} is a service-based infrastructure that
allows easy configuration and commanding of BitTorrent clients on a variety of
systems. A client application (\textit{commander}) is used to send
commands/requests to all stations running a particular BitTorrent client. Each
station runs a \textit{dedicated service} that interprets the requests and
manages the local BitTorrent client accordingly.

The framework is designed to be as flexible and expandable as possible. As of
this point it allows running/testing a variety of scenarios and swarms. Based
on the interest of the one designing and running the scenario, one may
configure the BitTorrent client implementation for a particular station, alter
the churn rate by configuring entry/exit times in the swarm, add rate limiting
constraints, alter swarm size, file size etc. Its high reconfigurability allows
one to run relevant scenarios and collect important information to be analyzed
and disseminated.

Through automation and client instrumentation the management framework allows
rapid collection of status and logging information from BitTorrent clients.
The major advantages of the framework are:
\begin{itemize}
  \item \textit{automation} -- user interaction is only required for starting the
clients and investigating their current state;
  \item \textit{complete control} -- the swarm management framework allows the
user/experimenter to specify swarm and client characteristics and to define
the context/environment where the scenario is deployed;
  \item \textit{full client information} -- instrumented clients output detailed
information regarding the inner protocol implementation and transfer
evolution; information are gathered from all client and used for subsequent
analysis.
\end{itemize}

\subsection{Information collection}

Based on the infrastructure we present a novel approach involving client-side
information collection regarding client and protocol implementation. We have
instrumented a libtorrent-rasterbar client~\cite{libtorrent} and a
Tribler~\cite{tribler} client to provide verbose information regarding
BitTorrent protocol implementation.  These results are collected (see
Section~\ref{sec:storage}) and subsequently processed and analysed through a
rendering interface (see Section~\ref{sec:processing}).

Swarm measured data are usually collected from trackers. While this offers a
global view of the swarm it has little information about client-centric
properties such as protocol implementation, neighbour set, number of connected
peers, etc. A more thorough approach has been presented by Iosup et
al.~\cite{mprobe}, using network probes to interrogate various clients.

Our approach, while not as scalable as the above mentioned one, aims to collect
client-centric data, store and analyse it in order to provide information on
the impact of network topology, protocol implementation and peer
characteristics. Our infrastructure provides micro-analysis, rather than
macro-analysis of a given swarm. We focus on detailed peer-centric properties,
rather than less-detailed global, tracker-centric information. The data
provided by controlled instrumented peers in a given swarm is retrieved,
parsed and stored for subsequent analysis. Section~\ref{sec:architecture}
details the modules and information flow in our infrastructure.

We differentiate between two kinds of BitTorrent messages, thoroughly
described in Section~\ref{sec:messages}: \textit{status messages}, which
clients provide periodically to report the current sessionâ€™s download state,
and \textit{verbose messages} that contain protocol messages exchanged between
peers (chokes, unchokes, peer connections, pieces transfer etc.).

As BitTorrent clients for our experiments, we chose the
libtorrent-rasterbar~\cite{libtorrent} implementation and
Tribler~\cite{tribler}. In our studies~\cite{bt-vi}, libtorrent-rasterbar has
proven to be the fastest BitTorrent client, while Tribler is one of the most
feature rich client from a scientific point of view. Each client outputs
information in a specific format such that a different message parser is
required for each client. Detailed information on the messages and client
instrumentation are presented in Section~\ref{sec:messages}.

Depending on the level of control of the swarm, we define two types of
environments. A \textit{controlled environment}, or \textit{internal swarm}
uses only instrumented controlled clients. We have complete control over the
network infrastructure and peers. A \textit{free environment} or
\textit{external swarm} is usually created outside the infrastructure, and
consists of a larger number of peers, some of which are the instrumented
controlled clients. Our experiments so far have focused on \textit{controlled
environments}; we aim to extend our investigations to \textit{free environment
swarms}.

\subsection{P2P-Next}

This paper is part of the research efforts within the P2P-Next FP7 project
\cite{p2p-next}.

