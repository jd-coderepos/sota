\documentclass[12pt,a4paper]{article}
\usepackage[margin=1in,nohead]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{ae}
\usepackage{graphicx}
\usepackage[american]{babel}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage{wasysym}
\usepackage{paralist}
\usepackage{multirow}

\newtheorem{Def}{Definition}
\newtheorem{Theorem}{Theorem}
\newtheorem{Lemma}[Theorem]{Lemma}
\newtheorem{Corollary}[Theorem]{Corollary}
\newtheorem{Proposition}[Theorem]{Proposition}
\newtheorem{Conjecture}[Theorem]{Conjecture}
\newtheorem{StCj}[Theorem]{Statement/Conjecture}

\newcommand{\sgn}{\operatorname{sgn}}
\newcommand{\out}{\operatorname{out}}
\newcommand{\len}{\operatorname{len}}
\newcommand{\capp}{\operatorname{cap}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\dist}{\operatorname{dist}}
\newcommand{\eps}{\varepsilon}
\newcommand{\vE}{\vec{E}}
\newcommand{\EG}{\vec{E}(G)}
\newcommand{\E}{\mathbb{E}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\N}{\mathbb{N}}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\U}{\mathcal{U}}
\renewcommand{\:}{\colon}
\DeclareMathOperator{\LA}{LA}
\DeclareMathOperator{\RLA}{RLA}
\DeclareMathOperator{\MLA}{MLA}
\DeclareMathOperator{\URG}{URG}
\DeclareMathOperator{\URN}{URFN}
\DeclareMathOperator{\FIID}{FIID}

\title{Local algorithms for the maximum flow and minimum cut in bounded-degree networks}
\author{Endre Cs\'oka\thanks{Alfr\'ed R\'enyi Institute of Mathematics. Supported by the NRDI grant KKP~138270.}, Andr\'as Pongr\'acz\thanks{Alfr\'ed R\'enyi Institute of Mathematics. Supported by the NRDI grant KKP~138270. \newline
Competing interests: The authors declare none.}}
\date{}

\begin{document}

\maketitle

\begin{abstract}

We show a deterministic constant-time local algorithm for constructing an approximately maximum flow and minimum fractional cut in multisource-multitarget networks with bounded degrees and bounded edge capacities. 
Locality means that the decision we make about each edge only depends on its constant radius neighborhood. 
We show two applications of the algorithms: one is related to the Aldous-Lyons Conjecture, and the other is about approximating the neighborhood distribution of graphs by bounded-size graphs. 
The scope of our results can be extended to unimodular random graphs and networks. 
As a corollary, we generalize the Maximum Flow Minimum Cut Theorem to unimodular random flow networks. 

\end{abstract}

\section{Introduction}

A deterministic local algorithm () on a graph means that we make a decision at each vertex or edge depending on the isomorphism class of its constant-radius neighborhood of that vertex or edge. 
It is a special case of the more commonly used notion of a random local algorithm (), where we assign independent uniform random seeds from  to each vertex, and we make a decision at each vertex or edge depending on its constant-radius seeded neighborhood. 
For example, choosing the set of vertices with higher seeds than all of its neighbors is an  that finds an independent set of expected size . 

Local algorithms were defined by Linial \cite{Linial} as distributed algorithms whose complexity is measured by the number of synchronized rounds regardless of the computational time and space. 
The notion of a local algorithm as defined above means local algorithm in Linial's sense with a constant number of rounds. 

In this paper, we consider graphs with degrees bounded by a constant . 
We note that in this case,  and  coincide with deterministic and randomized constant-time distributed algorithms, respectively. 
Research on local algorithms was pioneered by Angluin \cite{Angluin}, Linial \cite{Linial}, and Naor and Stockmeyer \cite{NaSt}. 
Angluin \cite{Angluin} studied the limitations of anonymous networks without any unique identifiers. 
Linial \cite{Linial} proved some negative results for the case where each node has a unique identifier. 
Naor and Stockmeyer \cite{NaSt} presented the first nontrivial positive results. 
For more about local algorithms, see the survey paper by Suomela \cite{Suomela}.

A mixed local algorithm () is a probability distribution on local algorithms. 
Equivalently, we draw a global random seed  from a uniform distribution on the unit interval, which can be accessed by all vertices. 
The decision depends on the constant radius neighborhood of the vertex or edge, and the global seed . 


For typical problems, we may only expect approximate solutions from local algorithms rather than strictly optimal ones. 
For example, we say that we can find an almost maximum independent set if for each , there exists a local algorithm that outputs an independent set, and the size of this set is at most  less than the size of the maximum independent set, where  is the vertex set of the graph. 

It is well-understood that randomness can be a useful addition to local algorithms, notably to break the symmetry. 
For instance, a deterministic local algorithm must make the same decision on every vertex or edge of a vertex- or edge transitive graph, say a cycle. 
Hence, a correct  (or even a correct ) aimed at finding an independent set always chooses the empty set on a nonempty transitive graph: it must put either no vertex or all vertices in the set, and the latter is an incorrect option for an independent set. 
However, we already mentioned a much better  based on a trivial idea that finds an independent set with expected relative size  on a cycle, or in general at least  if  is the maximum degree of the graph. 

It is perhaps less obvious how mixing could be advantageous. 
In the present paper, we provide an  that finds a nearly minimum cut in graphs (in fact, in networks). 
In the parallel paper \cite{Csoka}, it is shown that this is not possible to do by using an : there is a positive barrier  for the relative error depending only on the maximum degree  that cannot be broken by any . 
That is, no  finds a cut whose relative size is closer to the optimum than  for all graphs of maximum degree . 
For a more detailed comparison of the power of different variants of local algorithms, see \cite{Csoka}. 








The main results of the present paper is the construction of a deterministic local algorithm for finding a nearly maximum flow and for finding a nearly minimum fractional cut in networks with bounded cost function on bounded-degree graphs. 
That is, for any ,  and  there is an  that computes a flow in any network with cost bounded by  and degrees bounded by , whose relative value is at most  apart from the maximum, and similarly an  that computes a fractional cut whose relative value is at most  apart from the minimum. 
The above-mentioned  for finding a nearly minimum cut is a mixture of s derived from the above  for nearly minimum fractional cut and a global seed  with a uniform distribution on . 
For those who are interested in standard (non-distributed) algorithms rather than the distributed local algorithms considered in the present paper, these results provide a linear-time algorithm for finding a nearly maximum flow and a nearly minimum cut in the bounded degree and bounded cost function setting. 
Namely, the local algorithm can be executed in all vertices of the graph (sequentially rather than in parallel), each execution requiring  time, which yields an  total runtime. 

As the error rate is normalized by the number of nodes, these results are only meaningful if we allow any number of sources and targets. 
If we only allowed 1, or even  sources or targets, then the trivial algorithm that constructs the all-zero flow and the empty cut for large enough graphs (dealing with small networks by using a catalogue) would solve the problem up to any prescribed relative error . 
Hence, even though we need not add any technical assumptions to our theorems because of this observation, it is still better to imagine large networks whose sources and sinks make up at least a constant proportion of the nodes when reading the assertions and proofs in this paper. 



Local algorithms are useful for parameter testing, as well. 
We give a brief overview about parameter testing and the theory of very large graphs; for more details, cf. the survey paper and book \cite{Lovasz, Lovaszbook} by Lov\'asz. 
Parameter testing is an important concept in the theory of bounded degree graphs \cite{BeSchSh, BObT, CzuShaSo, Elek2, Elek, LOW, MaRo, NgOn}. 
For a graph parameter, a tester is an algorithm which gets the constant radius neighborhoods of a constant number of random nodes as input, and outputs a number that estimates the parameter. 
We call a parameter testable if for each , there exists a tester which estimates the true parameter with at most  error with probability at least .

Many of the examined parameters come from optimization problems. 
The relative size of the maximum matching, the maximum independent set, or the minimum vertex cover normalized by the number of nodes, are standard examples. 
In these problems, if we have a random local algorithm which provides an almost optimal structure, e.g.\ an almost maximum independent set, then it is easy to make a tester for the parameter. 
Nguyen and Onak \cite{NgOn} proved the testability of several problems using randomized local algorithms.



In the final section, we generalize our results from finite to unimodular random graphs and networks. 
The 
As a corollary, we obtain the highly nontrivial generalization of the Maximum Flow Minimum Cut Theorem to unimodular random flow networks. 
Furthermore, we show an application related to the Aldous-Lyons Conjecture. 
Namely, we prove that if the conjecture is either true or very far from being true. 
We note that since the first draft of this paper was created, Lov√°sz has proved a very general Maximum Flow Minimum Cut Theorem. 
In that paper~\cite{Lovaszmeasure}, flows and cuts were defined on Markov spaces, and it was shown that there is a measurable minimum cut whose value coincides with that of a flow. 
The proof relies on classical results in functional analysis such as the Hahn-Banach theorem, making it non-constructive. 
In contrast, the result of the present paper, albeit in a restricted scope compared to~\cite{Lovaszmeasure}, are constructive, describing local algorithms that compute asymptotically optimal flows and fractional cuts. 
It is unknown whether such local algorithms exist beyond the realm of unimodular random flow networks with bounded degree. 


\section{Model and results}

Throughout the paper,  is a fixed positive integer, and degrees in graphs are bounded by . 
An input network  consists of a graph  and a capacity function  defined on the edges. 
The graph  has maximum degree at most , and its vertices are separated into the disjoint union of the sets  (source),  (regular) and  (target). The binary relation  is the set of directed edges of . 
It is symmetrical, that is, . 
We have a nonnegative capacity function . 
The total capacity of all edges is denoted by . 
We usually work under the condition that flow capacities are bounded by some fixed constant . 
That is,  for every edge . 


Throughout the paper we use the terms "graph", "path" and "edge" in the directed sense. 
Let , , , and . 
For an edge , let  denote the reversed edge.

A function  is called a flow if it satisfies the following conditions.

The value of a flow  is

Denote a maximum flow by , or simply by  is there is no ambiguity about which network is considered.

A partition  with  is called a cut. 
We can refer to the cut by the subset  in the partition containing the targets. 
As fractional cuts play an important role in the present paper, it is often more convenient for us to represent  as an indicator function. 
Hence, the alternative definition of a cut is a function  such that  and .
The value of a cut is

The Maximum Flow Minimum Cut Theorem~\cite{FoFu} states that


We define a \emph{fractional cut} of a network  as a function  such that

The value of a fractional cut is defined as


Clearly, every cut  is a fractional cut. 
There is no clash between the value of  as a fractional cut and the original definition of the value of  as a cut: 

Although fractional cuts properly generalize cuts, the value of any fractional cut is a convex combination of values of cuts. 
If  is a fractional cut, then for all ,  is a cut, and for a uniform random  from ,



These two observations imply that it makes no difference to consider the minimum fractional cut instead of the minimum cut, that is, .


\subsection{Local flow and local cut algorithms}

The rooted -neighborhood of a vertex  or edge , denoted by  and , means the (vertex- or edge-)rooted induced subnetwork of the vertices at distance at most  from  or , rooted at  or , respectively. 
The set of all possible -neighborhoods (up to isomorphism) are denoted by  and , respectively. 
As we restrict our attention to graphs all of whose vertices have degree at most , there are only finitely many possible underlying rooted graph structures in  and ; with infinitely many possible different cost functions, of course, forming a compact set if we assume that a universal bound  is given. 
A function  is called a local flow algorithm, if for each network , the induced mapping  is a flow. 
Similarly, a function  is called a local cut algorithm, if for each network  the induced function  is a cut. 
A function  is called a local fractional cut algorithm, if for each network  the induced function  is a fractional cut. 


\begin{Theorem} \label{localg}
For all , there is an  and a local flow algorithm  such that 

In particular, assuming a universal bound  on the expected capacity, for all , there is an  and a local flow algorithm  such that 

\end{Theorem}

\begin{Corollary}\label{cor:integerflow}
Let  be a mapping that assigns an independent uniform random seed in  to the vertices of a network. 
Assuming a universal bound  on the  expected capacity and that all capacities are integers, for all , there is an  and a random local flow algorithm  defined on the seeded neighborhoods such that 

and such that all values of the output flow are integers. 
\end{Corollary}

\begin{Proposition} \label{localgfraccut}
Assuming a universal bound  on the capacity function, for each  there exists a local fractional cut algorithm such that 
 \end{Proposition}

In other words, maximum flow is approximable in , maximum integer flow is approximable in , and minimum fractional cut is approximable in . 
As an easy consequence, we obtain an algorithm in  that approximates a minimum cut. 

\begin{Theorem} \label{localgcut}
Assuming a universal bound  on the capacity function, for all , there is an  and a probability distribution  of local cut algorithms  such that 

\end{Theorem}

We mention that with a more accurate calculation, the ideas of this paper could be refined to yield an algorithm for each problem using radius  (if  is small enough).

\begin{Corollary} \label{testable}
Assuming a universal bound  on the capacity function, the network parameter  is testable. 
Namely, for all  there exist  and a function  satisfying that if the vertices  are chosen independently with uniform distribution, then

\end{Corollary}

We note that for all , having an approximation with less than  error in expectation is a stronger requirement than having this error with at least  probability. 
But these conditions are equivalent if the error is bounded.


\subsection{Applications on distributions of neighborhoods}\label{subsec:AL}

Let  denote the set of all graphs with degrees bounded by .
Let  denote the distribution of the -neighborhood of a random vertex of a graph .
We call a family  of graphs \textbf{nice} if it is union-closed and closed under taking spanned subgraphs, excluding the empty graph. 
Formally, ,  and , where  denotes nonempty spanned subgraph. 
Let us denote the closure of the set of all -neighborhood distributions in  by 


\begin{Theorem} \label{separation}
Assume that  holds for a nice family  of graphs, a graph  and .
Then for all , there exists an , a subset , and a graph  such that 

\end{Theorem}

This theorem is shown in a slightly more general form in Subsection~\ref{subs:pumping}, giving an explicit bound on , where  is a certain kind of distance of  from .

Lov√°sz \cite{Lovaszbook} asked to find, for every radius  and error bound , an explicit  such that the -neighborhood distribution of each graph can be -approximated by a graph of size at most . Formally,


Without requiring an effective bound, it is obvious that such a bound  and family of graphs exist, as the set  is compact. 
It is still open whether, say, a recursive function exists that computes such a bound. 
It is also unclear how to compute the graph  from ; see \cite{Lovaszbook} for details.

Instead of , we only require that \emph{each component} of  has size at most . This version is very close to the original question, because the -neighborhood distribution of such a graph is a convex combination of the -neighborhood distributions of the components, and each convex combination can be approximated by a graph with a bounded number of small components.

Let  denote the smallest value of  satisfying the modified conditions. 
The following corollary shows that if there exists an arbitrarily large error bound  such that for all , we can find an explicit upper bound on , then it provides explicit upper bounds on  for all  and , as well.

\begin{Corollary} \label{smallgraph}
For all , , and , there exists an  such that . \end{Corollary}


\section{Proofs}

\subsection{Proof of Theorem~\ref{localg} and Corollaries~\ref{cor:integerflow} and \ref{testable}}

An augmenting path of a flow  is a directed path  from  to  with  for each edge . The capacity of  means . We identify an augmenting path  with the flow , 
which we also call path-flow. Augmenting on such a path  means the incrementation of  by . 
The length of a path  is the number of its edges, denoted by . 

\begin{Lemma} \label{approx1}
If a flow  has no augmenting path of length at most , then

\end{Lemma}

\begin{proof}
The function  is a flow on the network , where . 
This flow can be decomposed into the sum of path-flows  and a circulation  that follow the directions of the flow , i.e., for every  and  we have . 
For example, we can do it by the Ford-Fulkerson algorithm \cite{FoFu} on the network . 
Thus


\end{proof}

The next lemma is well-known. 
It is crucial to us as this lemma guarantees that the local flow algorithm constructed in the proof of Theorem~\ref{localg} halts. 

\begin{Lemma}\label{lem:nonewshort}
If a flow  has no augmenting path  with , then augmenting on a path of length  does not create a new augmenting path of length at most .
\end{Lemma}

\begin{proof}
Let the residual graph of a network  with respect to a flow  be the graph . 
Then the augmenting paths of  can be identified with the paths in  from  to . 
Therefore, the length of the shortest path in  from  to  is . 
Let the forwardness of an edge of  be defined as the difference of the distances of its endpoint and starting point from  in . 
Augmenting on a shortest path adds only such edges to the residual graph on which  decreases, which are the reverse edges of the path. 
All these edges have forwardness  (calculated before augmenting). 
So if a path becomes an augmenting path at this augmenting step, then all its edges have forwardnesses at most 1 and contain an edge with forwardness . 
As the total forwardness is , the length of the path is at least . 
\end{proof}

Let us fix a length , and let us call the paths of length at most  \textbf{short paths}.
Let us choose a uniform random seed  independently for every short path . 
We may assume that these seeds are all different, as it is an almost sure event. 
The label of  is . 
Hence, if we order the short paths by label, then shorter ones always precede longer paths. 
In other words, we first partially ordered the short paths by length, and then extended the partial order to a total order by randomly sorting paths of the same length. 

We define a \textbf{chain} as a sequence  of short paths with increasing random labels such that for all  there exists a common undirected edge of  and  (henceforth: these paths intersect each other). 

\begin{Lemma} \label{spread}
For each  and  there exists a  such that for every graph  and undirected edge  of , the probability that there exists a chain  for which  contains  is at most .
\end{Lemma}

\begin{proof}
There exists an upper bound  for the number of short paths that intersect a given short path. 
Hence, there are at most  sequences of short paths  for which  is in  and  the path  intersects . 
All these sequences contain  paths of the same length. 
The ordering of their labels is drawn randomly from  permutations. 
So the probability that the labels are decreasing is . This event is necessary for the sequence to be a chain. Denote the number of chains in the lemma by the random variable  (with respect to the random labelling). Then 


which proves the lemma for some large enough number .
\end{proof}

We prove Theorem~\ref{localg} after a series of lemmas. 
Consider the variant of the Edmonds--Karp algorithm where we augment on the short paths in the order of their label. In other words, we start from the empty flow, we take all short paths  in increasing order of , and with each path, we increase the actual flow  by . 
We denote this algorithm by  and the resulting flow by .

Consider now the variant of the previous algorithm where we skip augmenting on each path which can be obtained as the last element of any chain of length . 
We denote this algorithm by  and the resulting flow by . The next lemma shows that  is a local algorithm.

\begin{Lemma} \label{f2local}
For each edge  and random seed , we have

\end{Lemma}

\begin{proof}
Let us execute the two algorithms  and  in parallel. 
We adjust the timeline of the latter one so that whenever  augments on a short path  that is not fully contained in , then we make an idle step. 
If at a point, the two flows differ at an edge , then there must have been a path  through  on which the two algorithms augmented by different values. 
There are three possible reasons to it:
\begin{enumerate}
\item  is not in ;
\item  can be obtained as the last term of some chain of length  in , but not in ;
\item  has an edge  in  at which the values of the two flows were different before taking .
\end{enumerate}

Assume that at the end, the two flows are different on . 
Using the previous observation initially with , let us take a short path through  on which the two augmentations were different, and consider which of the three reasons occurred. 
As long as it is the third one, repeat the step with setting  as the  of the previous step. 
Since by each step we jump to an earlier point of the execution of the algorithms, we must get a reason different from the third one eventually. 
Denote the considered paths, in order of appearance during the execution of , by , where  is the path where reason 1 or 2 applies, and  were considered for reason 3. 
(That is, in the above description, we found  first and  last.)


Assume that reason 1 applies to .
The set of all edges of the  paths  is connected. 
This set contains at most  edges. 
On the other hand, it must contain  and an edge at least  away from , so , and consequently . Thus the last  short paths  is a chain with a connected edge set with size at most  containing , so this chain is in . 
Therefore, neither executions should have been augmented on , a contradiction. 

Now assume that reason 2 applies to . 
Then choose a chain of length  as described in reason 2, ending with , and append the sequence  to it. 
The last  short paths of the sequence obtained forms a chain that yields the same contradiction as in the previous case.
\end{proof}

Let  be the output of  and . 
With  being the function guaranteed by Lemma~\ref{spread}, let . 
We show the following chain of inequalities. 


First we prove the second inequality of \eqref{eq1}.
As  contains no short augmenting path, by using Lemma~\ref{approx1} we obtain


To prove the first inequality of \eqref{eq1}, we need the following lemma.

\begin{Lemma} \label{diff}
If , then there exists a short path through  which is the last term of a chain of length .
\end{Lemma}

\begin{proof}
Let us consider the executions of  and  in parallel so that at the same time these take the same augmenting path.
If at a point of the executions, the two flows differ in an edge , then there must have been a path  through  on which the two algorithms augmented by different values. 
There are two possible reasons to it:
\begin{enumerate}
\item  is the last term of a chain of length ;
\item  has an edge  on which the values of the two flows were different before taking .
\end{enumerate}
Assume that at the end, the two flows are different at . 
Using the previous observation, let us take a path  through  on which the two augmentation were different, and consider which of the two reasons occurred. 
As long as it is reason 2, repeat the step with choosing  as the  of the previous step. 
Since by each step we jump to an earlier point of the execution of the algorithms, we must get reason 1 eventually. 
Denote the paths considered during the process by . 
The path  is the last term of a chain of length . 
Hence, by appending the sequence  and keeping the last  elements of the chain obtained, we arrive at a chain of length  whose last term is .
\end{proof}

\begin{proof}[Proof of Theorem~\ref{localg}]
Clearly . 
If , then by Lemma~\ref{diff}, there exists a chain of length . 
By Lemma~\ref{spread} this has probability at most , and when it occurs, the difference  is at most . Therefore,



which finishes the proof of \eqref{eq1}.

The function  is a convex combination of flows, hence it is a flow, and . 
Furthermore,  depends only on , so it can be calculated by a local algorithm. Consequently, this algorithm satisfies the first inequality \eqref{Thm1eq} in Theorem~\ref{localg}. 

The second inequality \eqref{Thm1eqbounded} obviously holds for the local flow algorithm constructed above by substituting  into  in \eqref{Thm1eq}, since .
\end{proof}

\begin{proof}[Proof of Corollary~\ref{cor:integerflow}]
We claim that the flow  constructed in the proof of Theorem~\ref{localg} is appropriate. 
Indeed, it uses the technique of augmenting paths, which produces an integer flow if the edge capacities are integers.
Furthermore, in the proof of Theorem~\ref{localg}, we have shown that the flow obtained is nearly optimal in expectation. 
\end{proof}

Hence, a nearly maximum integer flow (provided an integer cost function, of course) can be approximated in . 
We show that it cannot be approximated by an algorithm in . 

\begin{center}
\includegraphics[scale=0.5]{flowpic}
\end{center}

Let  be a network with one source  and one target . 
The target is only linked to a regular vertex , and the source is connected to  by two disjoint paths of length 2. 
If all edge capacities are 1, then the minimum cut is  with value 1. 
There is of course a maximum flow with value 1 in this network: all four edges directed away from the source are at  capacity and the edge  is at full capacity 1. 
However, the maximum integer flow that can be obtained by an  in this network is the all-zero flow. 
Indeed, the two edges incident with the source are symmetrical, hence any flow algorithm in  must assign the same value to them (vertices do not have private seeds to break the symmetry). 
This common value cannot be 1, as otherwise we would obtain a flow with value 2. 
Thus an  must assign 0 to both edges incident with the source, yielding the all-zero flow. 

\begin{proof}[Proof of Corollary~\ref{testable}]
Let  be the flow constructed by the local algorithm of the proof of Theorem~\ref{localg} with error bound  in \eqref{Thm1eqbounded}, which therefore satisfies , and let  be the radius used there plus . 
Let 


where  denotes the indicator function of the event that the vertex  is in the set of sources  of the network, that is, 


As , the variance of \eqref{gdef} is at most , therefore \eqref{gdef} stochastically converges to its expected value as  tends to infinity. 
This expected value is

This implies that, for large enough , these ,  and  satisfy the requirements.
\end{proof}


\subsection{Proof of Proposition~\ref{localgfraccut} and Theorem~\ref{localgcut}}\label{subsec:fraccut}

Fractional cuts are easier to work with than cuts, because just like flows, they are closed under convex combinations. 
Hence, we first show how to construct a local fractional cut algorithm by using our local flow algorithm. 
Then we reduce the problem of minimum cut to minimum fractional cut. 

\begin{proof}[Proof of Proposition~\ref{localgfraccut}]
Let us execute the local flow algorithm as in Theorem~\ref{localg} with error bound . Denote the resulting flow by .

We define the -residual graph as


Let . 
Denote the length of the shortest path from  to a vertex  in the graph  by . 
If there is no such path then . 
We define the fractional cut  as

This is a local fractional cut algorithm, because we need to execute the local flow algorithm for each edge only in the -neighborhood of  in order to compute .

Observe that







Notice that the value of a fractional cut  is additive in , because




Using this observation with , and using \eqref{fraceq}, we get



We call an edge  \textbf{bad} if there exists a short augmenting path in  finishing with the edge . 
Or equivalently,  is bad if  and there exists a path in  from  to  of length at most . 
Consider the terms . If , then  because .
By , unless if  is bad, this implies . 
Therefore, \underline{if  is not bad}, then either  or  is at most , and both are , thus


As , there exist at most  edge-disjoint augmenting paths with capacity at least . 
Each short augmenting path intersect at most  number of short augmenting paths, which yields that there are at most  number of short augmenting paths with capacity at least . 
Therefore, there exist at most  number of bad edges. 
Combining this estimation with \eqref{term2a} and with the fact that the graph has at most  number of edges, we obtain


Consider now the terms of the sum

Assume that  is not bad. If , then \eqref{Gfdef} shows that , therefore \eqref{fracconstr} implies . Hence, similarly to \eqref{term2a}, we get that , therefore similarly to \eqref{term2}, we obtain


By putting  and , we have , and thus 


\end{proof}


\begin{proof}[Proof of Theorem~\ref{localgcut}]
Consider the local fractional cut algorithm  as in Proposition~\ref{localgfraccut}. 
Then for each network , . 
For all ,  is a local cut algorithm, and with a uniform random , equation \eqref{fractocut} shows that we get a probability distribution of local cut algorithms producing the desired expected value.
\end{proof}


\subsection{Proof of Theorem~\ref{separation} and Corollary~\ref{smallgraph}}\label{subs:pumping}

\begin{Lemma} \label{convex}
For any nice family ,  is a convex compact subset of .
\end{Lemma}

\begin{proof}
For any two graphs  and ,

where  denotes the disjoint union of  isomorphic copies of . 
This implies that each convex combination of the -neighborhood statistics of two graphs in  can be approximated by the -neighborhood statistics of another graph in .
\end{proof}

Let us identify the natural base of  by the elements of , and let the linear extension of  be defined as the function ,

Let us define


\begin{Lemma}\label{lem:convexdist}
For each distribution  on ,

\end{Lemma}

\begin{proof}
The set  is convex and compact, therefore, it is determined by its dual:

Furthermore, for each  and , we have . This shows that if we know  for all , then we know it for all .
\end{proof}

We note without proof that the -distance of a distribution of -neighborhoods  from the convex compact set  is 



We state the generalization of Theorem~\ref{separation} as indicated in Subsection~\ref{subsec:AL}, and then prove it after a series of lemmas. 

\begin{Theorem} \label{separation2}
Assume that  holds for a nice family  of graphs, a graph , and . 
Namely, there exists a  satisfying

Then for all , there is an , a subset  and a spanned subgraph  of  such that 

\end{Theorem}

Before the proof, we first need to introduce some notions. 
If for a graph  and a function  we have 

then we say that  is \textbf{supremal} for .


For a graph , radius , weighting , and , we define the averaging network . The sets , ,  are three copies of , and for each , we denote its copies by ,  and , respectively. We identify  with . Let  . For each , let , and for each vertex , let  and , and .

\begin{Lemma} \label{aflowsize}
Given a graph , a radius , a function , and , the size of the maximum flow  in  satisfies

with equality at (*) if  is supremal for .
\end{Lemma}

\begin{proof}
Notice that for any graph ,


The upper bound in \eqref{flowsize} follows by computing the value of two cuts:  and . 

On the other hand, consider an arbitrary cut  of . 
Let  and . 
Let  and  denote the subgraph of  spanned by  and , respectively. 
Let  denote the number of edges between  and . 
For each edge between  and , its -neighborhood contains at most  number of vertices. 
Therefore there exist at most  number of vertices  for which , and at most  number of vertices  for which . 
These imply the following inequalities.


Now we prove the lower bound of \eqref{flowsize}.



Finally, we show that if  is supremal for , then the upper bound of \eqref{flowsize} is also a lower bound.




\end{proof}

For a radius , weighting ,  and , we define the following operator . Its value will be a new weighting , where  is  plus the radius used in Theorem~\ref{localg} with error bound .

Consider an arbitrary  with root . Let . Consider the flow  generated by the local flow algorithm in Theorem~\ref{localg} on  with error bound . 
Notice that


\begin{Lemma} \label{WHG}
For each graph , radius , weighting , , ,  and ,

Furthermore, if  is supremal for , then the lower bound is -tight, namely

\end{Lemma}

\begin{proof}
Let , and consider the flow  generated by the local flow algorithm in Theorem~\ref{localg} on  with error bound . For each ,  depends only on , therefore \eqref{wprimedef} shows that

Hence, we obtain




\end{proof}

We are ready to prove Theorem~\ref{separation2} and then Corollary~\ref{smallgraph}. 

\begin{proof}[Proof of Theorem~\ref{separation2}]
Let us set

and let  with radius . Then, let , and let  be the radius it uses. Let us define

Let  be the spanned subgraph of  with the lowest . We show that this satisfies the requirements.

Let  be the spanned subgraph of  with the highest . These also imply  is infimal for , and  is supremal for , namely






Identity \eqref{wsupport} shows that , therefore using Markov's inequality for ,




On the other hand, for all ,

Therefore, as  is closed under taking spanned subgraphs, for all  we have 


Therefore for all ,

Using Markov's inequality for ,

\end{proof}

\begin{proof}[Proof of Corollary~\ref{smallgraph}]
Let  be the nice family of all graphs with degrees bounded by , all of whose components have size at most . 
By the definition of , there exists a graph  such that  for all . 
Therefore, by equation~\eqref{eq:minmaxdist}, there exists a  satisfying . 
Then applying Theorem~\ref{separation2} with these , , , , and  provides us with  and . 
Let  be the characteristic function of , namely,  such that  if and only if . 
By Theorem~\ref{separation2} we have

 

Consequently,  does not satisfy the modified conditions of \eqref{ndef} for radius  and error bound . 
Thus .
\end{proof}


\section{Unimodular random graphs}

Unimodular random graphs (URGs) are probability distributions on rooted connected graphs with finite degrees satisfying the unimodularity condition. 
Informally, this condition expresses that a URG behaves like a finite graph rooted at a uniform random vertex. 
In particular, every finite connected graph with uniformly chosen root is a URG. 
We are only focusing on URGs with given maximum degree . 

For the formal definition, let  be the set of all rooted, connected countable graphs with degrees bounded by . 
In order to define the natural topology on , we endow it with a metric: two rooted graphs with centers  and  are at distance , where  is the smallest radius such that . 
This makes  a completely disconnected compact metric space. 

Let the measure  be a Borel measure defined on the induced Borel sigma-algebra . 
We define the probability measure  by . 
Select a connected rooted graph according to the measure  and then select a uniform random edge  incident with the root. 
This way we get a probability measure on rooted connected graphs (all of whose vertices have degree at most ) with a ``root edge'' incident to the root. 
If this measure is invariant under moving the root to the other endpoint of the root edge, then we say that  is involution invariant, or alternatively, that the measure is a \textbf{unimodular} random graph, or  for short. 
Further details, examples and alternative reformulations, including the Mass Transport Principle can be found in \cite{Lovaszbook}. 
Note that a finite connected graph with maximum degree  can always be viewed as a  by setting  as the uniform distribution on the vertices (inducing a distribution  on rooted graphs where the probability of picking a vertex as a root is proportionate to its degree, and in return, a uniform distribution on the root edges).


We can refine the Borel sigma algebra by decorating the vertices and edges of graphs in , and repeat the above construction. 
To define unimodular random flow networks (s), we decorate each vertex by exactly one of the letters , , , and each directed edge by a non-negative real number, the value of a cost function. 
We assume that this cost function is bounded by a given , that is  for each edge . 
As the set of decorating labels  of vertices and  of edges are compact, the induced topological space is once again compact. 
A probability measure  defines a  if 
\begin{enumerate}
\item  is a Borel probability measure on the larger Borel sigma algebra  obtained this way (where we are allowed to use expressions such as  or  when defining Borel sets), and 
\item the probability measure  induced on the rooted networks with a root edge as above is invariant under moving the root to the other endpoint of the root edge. 
\end{enumerate}
In particular, the restriction  to the original Borel sigma algebra is a unimodular random graph. 
A unimodular flow of a  is a flow that is a Borel function with respect to . 
The Bernoulli graphing is obtained by decorating the vertices (and/or edges, and in fact possibly all short paths) of graphs  by a uniform random seed  (and/or , and/or ). 
Given a  , the measure  on the above topological space can be defined by first sampling a graph from , and then assigning a uniform seed in  to all vertices independently. 
The above two refinements can be combined: we may decorate the vertices/edges/short paths of a  by uniform random seeds in . 
Once again, we obtain a compact space for the same reason as before. 
Note that a construction using these random seeds might not be Borel in the sense of the , as the network is oblivious to the seeds. 
However, taking the conditional expectation with respect to the product measure of the seeds (if possible) might lead to a construction that is legal in the network sense. 
A simplified form of this idea has already been used in the paper: the concept of a chain involved random seeds  corresponding to short paths, and when applying Lemma~\ref{spread} in the proof of Theorem~\ref{localg}, we took the expectation over such seeds. 
Fortunately, the expected value of random flows is a flow (in this case, automatically a unimodular flow), and the expected value of random fractional cuts is a fractional cut. 
The same assertion fails for cuts in general: expectation of cuts yields a fractional cut, which is one of the reasons we work with fractional cuts. 

A \textbf{factor fractional spanned subgraph} of the   (or a fractional cut of the  ) is a measurable function from  to  (equipped with the Lebesgue-measure). 
It is a \textbf{factor spanned subgraph} of the   (or a cut of the  ) if it assigns 0 or 1 to -almost all rooted graphs. 
We can think about the subgraph as those rooted graphs where the function attains the value 1. 
A \textbf{factor of i.i.d.\ () fractional spanned subgraph} of the   (or a fractional cut of the  ) is a measurable function from the Bernoulli graphing to . 
More precisely, such a measurable function induces a unimodular fractional spanned subgraph of . 
It is an \textbf{ spanned subgraph} of the   (or a cut of the  ) if the measurable function has range in  (almost everywhere). 
If we want to emphasize that we are talking about a subgraph rather than a fractional subgraph, or a cut rather than a fractional cut, we can call these objects integer subgraphs or integer cuts. 
These give rise to special unimodular spanned (fractional or integer) subgraphs of , and in particular, are themselves s: they induce an involution invariant measure  on . 
The fact that  is an involution invariant measure obtained this way from an  spanned subgraph of  is indicated by the notation .  
The notion of a factor of i.i.d.\ process is a central concept in local algorithms. It is relevant to us because the local flow algorithm presented in the proof of Theorem~\ref{localg} was constructed as the expectation of a factor of i.i.d.\ process with respect to the seeds. 
Most results in this paper hinges on that factor of i.i.d.\ process, and it is also used in the generalized results to come.  
We provide further motivation to consider  spanned (fractional) subgraphs rather than the weaker notion of unimodular random (fractional) subgraphs after the discussion on the Aldous-Lyons Conjecture. 




\subsection{Generalization of the main results to s and s}



First of all, we generalize the main theorems to unimodular random graphs and networks. 
Note that unimodular random graphs do not admit the notion of the number of vertices, and similarly, we cannot define values of flows and cuts in s. 
Due to such obstructions, we need to find equivalent reformulations of the theorems that can be generalized to s and s. 

Following standard terminology, we introduce the relative size of the values of flows and cuts in proportion to the number of vertices: see for instance the independence ratio, which is the ratio of the size of the largest independent set and the size of the vertex set. 
Alternatively, one could divide by the size of the edge set rather than the vertex set. 
The conversion rate between the two alternative ratios is the average degree, which is easily accessible from . 


Therefore, we define the flow ratio of a finite network  as , the relative flow value of a flow  as , the relative fractional cut value of a fractional cut  as , and the relative capacity as . 
Then Theorem~\ref{localg} claims the existence of a local flow algorithm for any  whose output is a flow with relative flow value  close to the flow ratio. 
Similarly, Theorem~\ref{localgcut} states that assuming a universal bound on the capacities, there is a probability measure of local cut algorithms such that the output of a random sample returns a cut with expected relative cut value  close to the flow ratio. 

All the above notions have a natural extension to s. 
Let  be an involution invariant measure on . 
We define the random variable  as follows. 
If the root  is in the set of sources , then ; otherwise . 
Observe that  for finite networks. 
Hence, we define  as  for s. 
If  is a fractional cut and  is the root edge, then the random variable  has mean  for finite networks, thus this is the plausible way to define  for s. 
Finally, the relative capacity is  where  is the capacity of the root edge. 
Note that maximum flows , minimum cuts and minimum fractional cuts exist for s by compactness: at this point however, we do not know whether their values coincide. 
Of course, the minimum cut value and the minimum fractional cut value must be equal due to the same reason that we presented in Subsection~\ref{subsec:fraccut}. 
But in principle, this value could be larger than the maximum flow value, for some s. 
An advantage of the locality of the algorithms in this paper is that they nicely extend to s, as we will see in this section. 
As a corollary, we obtain the Maximum Flow Minimum Cut Theorem for s. 



We are ready to formulate the natural generalizations of the main results to unimodular random graphs and networks. 

\begin{Theorem}\label{localgflowuni}
Assuming a universal bound  on the capacity function, for all , there is an  and a local flow algorithm  such that for any unimodular random flow network  we have

\end{Theorem}

We indicate the necessary modifications to apply to the proof of Theorem~\ref{localg}. 
First, we need to slightly modify the assertion of Lemma~\ref{approx1}. 

\begin{Lemma} \label{approx1uni}
If the set of augmenting paths of length at most  of a unimodular flow  has  measure 0, then

\end{Lemma}

The proof is essentially the same, except the summation should be replaced by expected value with respect to the probability measure . 
Lemma~\ref{lem:nonewshort} can be adjusted similarly. 

\begin{Lemma}\label{lem:nonewshortuni}
If the set of augmenting paths  with  of a flow  has  measure 0, then augmenting on a path of length  only creates a 0-measure set of new augmenting paths of length at most .
\end{Lemma}

Chains of short paths and their label are defined for s in the same way as before. 
There is a slight technical difficulty with the natural generalization of Lemma~\ref{spread} to s.

\begin{Lemma} \label{spreaduni}
For each  and  there exists a  such that for every unimodular random graph  and -almost all undirected edges  of , the probability over all labelings that there exists a chain  for which  contains  is at most .
\end{Lemma}
\begin{proof}
Note that the existence of such a chain for a given edge is determined by the -neighborhood of the edge. 
The involution invariant measure induces a probability distribution of such neighborhoods (with a distinguished root edge). 
By the Law of Total Probability, the probability described in the assertion of the lemma is a convex combination of the analogous probabilities on these finitely many finite neighborhoods. 
According to the finite variant, Lemma~\ref{spread}, for each of the neighborhoods the probability in question is at most  (by choosing the same  as in the proof of Lemma~\ref{spread}), and consequently, so is their convex combination. 
\end{proof}

The next step in the original proof was to define the algorithms  and . 
Once again, slight adjustments are needed. 
The main difference to the finite case is that it is not necessarily possible to deal with all short paths, since there are infinitely many of them in a . 
So the definition of  makes use of the labelling . 
Informally, the idea would be to systematically go through the short paths in the order of their label. 
This would not be a problem in finite networks; however, in an infinite network, the labels usually do not form a well-order. 
Hence, we could not even make sure that every short path is considered in a finite number of steps. 
As we want to define a local algorithm anyway, which can be applied in neighborhoods in parallel, it is more logical to consider a short path , and to try to determine how the flow is altered on it (starting from the empty flow, and applying the Edmonds-Karp algorithm). 
In order to compute this, we need to know how the flow values were altered on short paths intersecting  that have smaller label, as they had priority over . 
Similarly, we need to know how the flow values were altered on the short paths intersecting the ones we just considered, etc. 
Note that the branches of this downward tree of intersecting short paths are chains. 
Thus Lemma~\ref{spreaduni} tells us that the probability that the process survives at least  rounds is at most  for almost all initial . 
In particular, if we are willing to run the process without a bound on the number of steps, then it halts with probability 1 (where the probability space is the product space of the seeds). 
This yields a factor of i.i.d.\ process, which is : it augments on -almost all short paths with probability 1. 
Note that  is not a local algorithm, as we did not set a bound on the depth  above: setting such a bound is equivalent to allowing the process to work in a bounded neighborhood of , that is, locality. 
This is exactly why we define  analogously to the finite case. 
Namely, if the above process did not vanish after a certain fixed number of steps , then we give up trying. 
So we do not augment on those paths that can be obtained as the last element of a chain of length . 
Hence,  is a block factor of i.i.d.\ process. 

The proof that  is local can be copied verbatim from the finite case, see Lemma~\ref{f2local}. 
The only alteration to be made in the statement is that it holds for -almost all edges. 
Similarly, Lemma~\ref{diff} holds with the same modification for s, along with the rest of the proof of Theorem~\ref{localg}, concluding the proof of Theorem~\ref{localgflowuni}. 
We emphasize again here that taking the expectation of local flow algorithms with respect to all labelings yields a local flow algorithm, as the convex combination of flows is a flow. 

Next we generalize Proposition~\ref{localgfraccut}. 

\begin{Proposition}\label{localgfraccutuni}
Assuming a universal bound  on the capacity function, for each  there exists a local fractional cut algorithm such that for each unimodular random flow network , it produces a factor fractional cut with value .
\end{Proposition}

Note that in the proof of Proposition~\ref{localgfraccut}, we first applied the local flow algorithm with some error  and defined the residual graph. 
These local constructions lift to s directly, taking expectations with respect to  over the finitely many possible neighborhoods as before. 
Then we defined a fractional cut based on the distance of a vertex from the set of sources . 
As there are infinitely many sources in a  in general, we need to be careful here. 
In the definition, the distance is only relevant as long as it is at most  and . 
Hence, we can do it from the perspective of the vertex , scanning the  neighborhood of it, which is once again possible in a . 
If we find a source in this neighborhood, then we choose the one closest to , and compute . 
If there is no source in this neighborhood, then we set . 
The rest of the proof translates directly to s, by switching summations to expectations with respect to . 

We obtain the analog of Corollary~\ref{cor:integerflow} and Theorem~\ref{localgcut} just as in the finite setup. 

\begin{Corollary}\label{cor:integerflowURN}
Let  be a mapping that assigns an independent uniform random seed in  to the vertices of a unimodular random flow network. 
Assuming a universal bound  on the capacity function and that all capacities are integers, for all , there is an  and a random local flow algorithm  defined on the seeded neighborhoods such that 

and such that all values of the output flow are integers. 
\end{Corollary}

\begin{Theorem}\label{localgcutuni}
Assuming a universal bound  on the capacity function, for all , there is an  and a probability distribution  of local cut algorithms  that each yield a factor cut such that for any unimodular random flow network  we have

\end{Theorem}

As a corollary, we obtain the highly nontrivial generalization of the Maximum Flow Minimum Cut Theorem for unimodular random flow networks. 

\begin{Theorem}[MFMC for URNs]
We assume a universal bound  on the capacity function. 
Then the maximum flow ratio , the minimum cut ratio, and the minimum fractional cut ratio coincide for any unimodular random flow network . 
If all capacities are integers, then there is a maximum flow with all integer values. 
Except for the maximum integer flow problem, each of these optimization problems have an optimum that can be approximated up to an arbitrarily small error by the result of a factor process. 
The maximum integer flow is approximable by results of  processes. 
\end{Theorem}\label{thm:MFMCuni}
\begin{proof}
By compactness, maximum flows, minimum cuts and minimum fractional cuts exist. 
According to Proposition~\ref{localgfraccutuni} and Theorem~\ref{localgcutuni}, the three corresponding extremal values are equal. 
Similarly, by compactness,  maximum integer flows exist. 
According to Corollary~\ref{cor:integerflowURN}, provided that all capacity values are integers, the maximum integer flow ratio must coincide with the other three extremal ratios. 
\end{proof}

As stated in the introduction, Lov√°sz has proved a much more general Maximum Flow Minimum Cut Theorem in~\cite{Lovaszmeasure}, for flows and cuts defined on Markov spaces, verifying the existence of a measurable minimum cut. 
The proof uses Zorn's lemma, and hence it is non-constructive. 
In this context, a unimodular random flow network (without the edge capacities) is a reversible Markov space whose underlying standard Borel space  consists of the -decorated countable rooted graphs with maximum degree . 
The capacity measure on  disintegrates at each  into a linear combination of Dirac measures with at most  summands, corresponding to the neighbors of the rooted graph obtained by moving the root to the other endpoint of an incident edge. 
Hence, the results in \cite{Lovaszmeasure} show that in s, a measurable minimum cut, and in fact a measurable maximum flow exist with coinciding values. 
The present paper was also motivated by Lov\'asz' interest in the subject, who was Endre Cs\'oka's PhD supervisor at the time. The added value in the special case of s is a constructive proof, and a local algorithm presented that finds a near-optimal structure. 
It is unknown whether such a local algorithm, in any meaningful sense of the expression, can be provided in the general setup, or in fact anywhere beyond s with bounded degrees. 


\subsection{Connection with the Aldous-Lyons Conjecture}

Finally, we generalize Theorem~\ref{separation2} for s, and show how the most fundamental conjecture about s, due to Aldous and Lyons, can be strengthened. 
Roughly speaking, the conjecture says that the set of s is the completion of the set of finite graphs. 
For more details cf. \cite{AlLy, Lovasz}. 

Let  denote the set of unimodular random graphs  with maximum degree at most . 
Let  denote the distribution of the -neighborhoods of the root. 
Extending the definition in \eqref{Ddef}, let . 
Since every graph  with a uniform random root provides a  with , we have the trivial inclusion . 
A sequence of s  locally converges to the   if for every  the neighborhood statistics converge, that is, . 
This coincides with the notion of convergence in the topology on  defined earlier. 
Using the identification of each finite graph (assuming a given degree bound) with the  where the root is chosen uniformly at random, we can talk about sequences of finite graphs locally converging to a . 
Note that the topology induced by this convergence notion is metrizable, for instance by the \emph{sampling distance};  see \cite{Lovaszbook} for more details. 

\begin{Conjecture}[Aldous--Lyons]
Every  is the local limit of a sequence of finite graphs, or equivalently,

\end{Conjecture}

Note that any  or  can be applied to s. 
Thus a major problem in the previous subsection where we generalized the results from finite graphs to s would have indicated that the Aldous-Lyons Conjecture might be false. 

We mention that there is a conflicting conjecture in group theory. 
A finitely generated group (with any given finite generating set) is called sofic if its Cayley graph viewed as a unimodular random graph is the local limit of a sequence of finite graphs. 
It is widely believed that there exist finitely generated non-sofic groups\footnote{To be precise, the Sofic Group Conjecture says that there is a non-sofic group. However, it is well-known that a group  is sofic if and only if all finitely generated subgroups of  are sofic. Thus it is an equivalent form of the conjecture that there exists a finitely generated non-sofic group.}, which would imply that the Aldous-Lyons Conjecture is false. 


\begin{Def}\label{def:AL}
We say that the Aldous--Lyons Conjecture is \textbf{completely false} if for all , there exists an , a subset  and a   such that for all , the -neighborhood of a random vertex of  is in  with probability at most , but the -neighborhood of the root of  is in  with probability at least .
\end{Def}

\begin{Theorem}\label{thm:strAL}
If the Aldous--Lyons Conjecture is false, then it is completely false.
\end{Theorem}


The proof once again follows the finite case. We show the natural analog of Theorem~\ref{separation2}, which directly implies Theorem~\ref{thm:strAL}. 

\begin{Theorem} \label{separation2uni}
Assume that  holds for a nice family  of graphs, a unimodular random graph , and . 
Namely, there exists a  satisfying

Then for all , there is an , a subset  and a factor spanned subgraph  of  such that 

\end{Theorem}

For the proof, we need that the class of s that can be written as the local limit of a sequence of finite graphs is closed under taking factor subgraphs. 
We prove a somewhat more general statement. 
Regardless of this Aldous-Lyons conjecture, it asserts that the set of s that occur as a local limit of a finite graph sequence is closed under taking  spanned subgraphs. 

\begin{Lemma}
Let  be a  that is the local limit of a sequence of finite graphs, and let  be an  spanned subgraph of . 
Then  is the local limit of a sequence of finite graphs. 
\end{Lemma}
\begin{proof}
Given an , the  spanned subgraph  can be approximated up to an error  by a constant-radius factor of i.i.d. spanned subgraph . 
That is,  is an  spanned subgraph of  induced by a measurable function from the Bernoulli graphing to  such that the value of the measurable function only depends on the seeded -neighborhood of the root for some , and the -distance of this measurable function and the one that induces  is less than . 
This makes the total variation distance of  and  less than , and in particular, the sampling distance less than ; see formulas (19.1) and (19.4) in \cite{Lovaszbook}. 

The rule that maps 0 or 1 to a vertex depending on its -neighborhood can be applied to vertices of finite graphs. 
Let  be the sequence of finite graphs locally converging to  with . 
For each , we randomly assign independent uniform seeds from  (and also independently for all ) to the vertices of . 
Then the above block factor of i.i.d.\ rule computes a subgraph . 
By local convergence, as  the -neighborhood statistics of  tends to that of  with probability 1, making  locally converging to  with probability 1. 
(Clearly  with probability 1.)

For each  let , and let  be an index so that  and the sampling distance of  and  is less than . 
In particular, the sampling distance of  and  is less than . 
Hence, the sequence  locally converges to .  
\end{proof}

The proof of Theorem~\ref{separation2uni} follows that of Theorem~\ref{separation2}, with the main ingredient being the averaging network  defined analogously to s. 
Note that , where  is the root. 
The slight technical difficulty arising from the graphs not being finite is that it is unclear whether supremal (or infimal) s exist among the factor spanned subgraphs of . 
There is an easy fix which would have been unnecessary to include in the proof of Theorem~\ref{separation2}: we define -supremal (and -infimal) s, meaning that it has no factor spanned subgraph such that the  value of the subgraph is more than  bigger (smaller) than the  value of the given . 
Whenever we talk about cuts in the proof, it should be replaced by factor cuts. 
Similarly, in the finite case we chose  as a subgraph of  with smallest  value, and  as a subgraph with largest  value, but now we only consider factor subgraphs, instead. 
Once again, these extremal objects may not exist, so we choose factor spanned subgraphs that are close to the infimum/supremum, instead. 
These extremality conditions were applied by using the fact that in the averaging network, a carefully chosen cut can be close to optimal. 
As the cut algorithm is a mixed factor process, and a nearly optimal one can be constructed by a factor process (Theorem~\ref{thm:MFMCuni}), we lose nothing by the additional condition that only factor cuts are considered. 
The rest is a direct translation, changing summations to  and probabilities to . 

We can switch the quantifiers in Theorem~\ref{thm:strAL} in an advantageous way: if for every  there is an extreme counterexample, then there is an extreme counterexample that works for every . 

\begin{Corollary}
If the Aldous--Lyons Conjecture is false, then there is a   such that for all , there exists an  and a subset  such that for all , the -neighborhood of a random vertex of  is in  with probability at most , but the -neighborhood of the root in  is in  with probability at least .
\end{Corollary}
\begin{proof}
By Theorem~\ref{thm:strAL}, we may assume that the conjecture is completely false. 
Let . 
Then there is an , a , and a   as in Definition~\ref{def:AL}. 
We may assume that the sequence of numbers  is strictly monotone increasing. 
As the space of s is compact with respect to the total variation distance, there is a convergent subsequence of the  tending to some  . 

Given an , let  be large enough so that for any  the TV distance of  and  is less than  and also . 
We claim that  and  is an appropriate choice. 
For any , the -neighborhood of a random vertex of  is in  with probability at most , which is less than . 
On the other hand, the -neighborhood of the root of  is in  with probability at least . 
As the TV-distance of  and  is less than , we have that the -neighborhood of the root in  is in  with probability at least . 
\end{proof}

The same method can be applied to strengthen the Sofic Group Conjecture. 
Namely, if a finitely generated group is non-sofic, then it must be very far from being the local limit of finite graphs. 

\begin{Corollary}
Given any finitely generated non-sofic group, then its Cayley graph is a   such that for all , there exists an  such that for all , the -neighborhood of a random vertex of  is isomorphic to the (unique) -neighborhood of the root in  with probability at most .
\end{Corollary}
\begin{proof}
We can copy all the arguments above. 
The only thing to note is that at a point where we would switch the  to a (nearly) supremal subgraph defined by a factor process, we cannot actually change . 
Indeed, Cayley graphs are transitive, so any factor subgraph of such a graph contains either all vertices or none of them. 
This yields the following direct corollary: 
there exists an  and subset  such that for all , the -neighborhood of a random vertex of  is in  with probability at most , but the -neighborhood of the root of  is in  with probability at least . 
However, as Cayley graphs are transitive, the -neighborhood of the root is concentrated on a single -neighborhood. 
\end{proof}

\section{Acknowledgement}

The authors are indebted to L\'aszl\'o Lov\'asz for his help in making this paper, including the proposition of the main problems themselves.


\bibliographystyle{plain}
\bibliography{refs}

\end{document}
