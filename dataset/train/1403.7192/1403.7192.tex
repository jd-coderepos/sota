\documentclass[12pt,journal,oneside,onecolumn]{IEEEtran}
\pdfoutput=1
\newcounter{mytempeqncnt}
\usepackage{amsmath, amssymb,amscd, epsfig}

\usepackage{graphicx}
\usepackage{mathrsfs}
\usepackage{cite}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{color}
\usepackage{multirow}





\begin{document}
\title{Delay Analysis of Multichannel Opportunistic Spectrum Access MAC Protocols}
\author{Arash Azarfar,~\IEEEmembership{Student Member,~IEEE}, Jean-Fran\c{c}ois Frigon,~\IEEEmembership{Senior Member,~IEEE}, and Brunilde Sans\`o,~\IEEEmembership{Member,~IEEE}\thanks{The authors are from the Department of Electrical Engineering, \'{E}cole Polytechnique de Montr\'{e}al, Montr\'{e}al (Qc), Canada, H3T 1J4 (e-mail: \{arash.azarfar, j-f.frigon, brunilde.sanso\}@polymtl.ca). \newline \indent This research project was supported by NSERC under Grant STPG365205. \newline This work has been submitted to the IEEE for possible publication. Copyright may be transferred without notice, after which
this version may no longer be accessible.}
}


\maketitle
\begin{abstract}
We provide in this paper a comprehensive delay and queueing analysis for two baseline 
medium access control (MAC) protocols for  
multi-user cognitive radio (CR) networks and investigate the impact 
of different network parameters, such as packet size, Aloha-type medium access 
probability and number of channels on the system performance. 
In addition to an accurate Markov chain, which follows the queue status of all users, 
several lower complexity queueing theory approximations are provided. Accuracy and performance 
of the proposed analytical approximations are verified with extensive simulations. It is observed 
that for CR networks using an Aloha-type access to the control channel, a buffering MAC protocol, 
where in case of interruption the CR user waits for the primary user to vacate the channel before resuming the
transmission, outperforms 
a switching MAC protocol, where the CR user vacates the channel in case of appearance of 
primary users and then compete again to gain access to a new channel. The reason is that the delay
bottleneck for both protocols is the time required to successfully access the control channel,
which occurs more frequently for the switching MAC protocol. We also propose a user clustering approach, 
where users are divided into clusters with a separate control channel per 
cluster, and observe that it can significantly improve the performance by reducing the number 
of competing users per control channel. 
\end{abstract}

\section{Introduction}
\label {sec:intro}

Opportunistic spectrum access (OSA) communication models \cite{zhao07a}, implemented by cognitive radios (CR), offer both the capacity to decrease the communication infrastructure expenses by using the vacant portions of the spectrum and to improve the quality of wireless communications by permitting wireless CR nodes\footnote{\emph{Node} and \emph{user} are used interchangeably.} to switch to a better channel when the channel quality is not satisfactory. These notable features have made cognitive-radio based wireless networks a technology of choice for incoming wireless technologies.
Frequent spectrum handovers along with new requirements such as spectrum sensing and spectrum decision distinguish a cognitive radio network from its predecessors. New medium access control (MAC) protocols which take into account the inherent nature of cognitive radios are thus indispensable. For this aim, several  medium access protocols have been proposed in the literature \cite{zhao07,jia08,cordeiro07}. Different protocols may differ in details such as the existence of a common control channel, number of radios required for the nodes and sensing algorithm (please see \cite{cormio09,pawelczak09} and references therein for a detailed survey of CR MAC protocols). Since most of the proposed MAC schemes assume a dedicated control channel, and given that being equipped with multiple radios increases the hardware and complexity cost, we investigate in this paper a realistic cognitive radio network with a common control channel, distributed sensing appropriate for ad-hoc networks, and a single radio per node. 

In the literature, most of the attention on the analysis of the different medium access protocols and their variations has been focused on the throughput analysis in the presence of saturated traffic (e.g., \cite{pawelczak09,park11,zhao07,pawelczak08,jia08,cordeiro07}), while little work has been done on delay and jitter analysis. Throughput analysis provides an upper bound for the performance of the network, which can be used for evaluation and comparison purposes of different protocols. However, delay analysis and packet level performance evaluation are required to investigate how a protocol, along with its parameter settings, behaves for delay-sensitive applications, such as multimedia communications \cite{wang-l11,cisco13}.

In the few papers available on delay analysis (e.g., \cite{rashid07,S-Wang12, wang12,laourine10,kim12}), detailed system parameters are not considered or the CR network under consideration is simple, such that full insights into the impact of different parameters on the network performance have not been provided. The target has also been specific networks; e.g., sensor networks, with specific requirements \cite{bicen12}, such that the results can not be easily extended to general models. 
In \cite{azarfar12e,azarfar13f}, we proposed a general M/G/1 queueing model~\cite{kleinrock75} for a cognitive radio link where the server is subject to interruptions~\cite{takagi91}.
The channel (i.e., the server of the queue) is subject to interruptions because the CR node has to suspend its communication session for the period of spectrum handover (switching) or primary users' activity (buffering).
The proposed models in those papers  were for a single node with continuous-time operating and interruption periods. However, those models didn't address the complex problem of multi-node operation in a multi-channel environment. 

Our objective in this paper is thus to fill this MAC protocols analysis gap by providing a comprehensive delay analysis for two baseline medium access control protocols discussed in \cite{pawelczak09,park11}. Note that the models described in those papers are not detailed MAC models for practical purposes. 
The intent is rather to have models with enough details, yet general enough, to use as baseline reference models 
for families of MAC protocols and investigate the effect of different parameters on the throughput of a cognitive radio network. 
In this paper, we have the same objective for the delay analysis and thus only relax the saturated traffic 
assumption and keep the same other assumptions and modeling details to analyze the average delay. 
In the first part, a buffering MAC model~\cite{pawelczak09,park11}, in which a node stays on the channel in case of interruptions 
until the transmission of the packet is finished, is investigated. In the second part, a switching MAC model~\cite{park11}, 
where the node leaves the interrupted channel and participates in a new reservation competition every time that an interruption occurs, is investigated.



The main contribution of this work is thus providing a comprehensive analytical delay analysis for a multichannel cognitive radio network 
with both buffering and switching recovery policies where the impact of different network parameters 
(number of users, number of channels, control channel access probability, channel availability, and arrival rate) 
on the performance is considered. The results can thus be used in network optimization and design problems.  
For both MAC models, we derive an exact Markov chain model which can be solved to obtain the system time distribution and moments. Since the number of states in the Markov chains grows exponentially with the number of nodes, we also propose lower complexity approximations based on discrete-time M/G/1 queueing theory results. In both MAC models, the service time of a packet is composed of two parts: the time spent to compete with other users to reserve a channel (for the switching MAC model, the reservation period may occur multiple times during the service of a single packet), and the transmission time.  We use Markov chain models, combined with Renewal theory results, to derive approximate distributions of both parts of the packet service time. The service time moments are then used to find the approximate average system time of packets in the OSA network for both MAC protocols. We also provide numerical results to validate the analysis and provide insight on the delay performance of the MAC protocols for different network parameters.


The paper proceeds as follows.
In Section \ref{sec:system-model}, the system model is presented and related parameters are introduced. The next two sections discuss the buffering model. In Section \ref{sec:Queue-Occupancy}, an accurate Markov chain for queue occupancy is proposed from which different parameters of interest can be derived. As the queue occupancy Markov chain is not scalable, a service cycle analysis is provided in Section \ref{sec:Service-Cycle}. Section \ref{sec:switching} discusses the switching model where the same approach is followed: first an accurate Markov chain for queue occupancy is proposed and then a delay cycle analysis and related approximations are provided. Numerical and simulation results for both buffering and switching models are discussed in Section \ref{sec:simulation}. Finally Section \ref{sec:conclusion} concludes the paper with some remarks on future research direction. The notation used in this paper are listed in Table \ref{tab:notations}.

\begin{table}[]
\caption{{Notations}}
\label{tab:notations}
\centering
\begin{tabular} {c|l}
\hline
\scriptsize
{\textbf{Notation}} & {\textbf {Description}} \\
 \hline
& Number of CR nodes\\
& Total number of channels\\
& Number of data channels ()\\
& Poisson packet arrival rate\\
& Geom/G/1 service time \\
& Reservation time \\
& Transmission time (buffering) \\
& Interrupted transmission time (switching) \\
& Packet length \\
& Enlarged packet length (switching) \\
& State variable, number of competitors\\
& State variable\\
    & Probability of unavailability due to PUs\\
&Control channel availability per timeslot\\
&Packet capture probability\\
&Data channel availability \\
& Maximum No. of links equal to \\
& Probability of  being equal to \\
& Probability of success in Aloha-type competition \\
& Probability of success in state (\ref{eq:ps(k,g)}) \\
& Probability of success in state for a marked node\\
& Probability of channel access attempt in Aloha-type competition\\
& Packet length\\
& Maximum Queue Size\\
& Probability of  transmission among \\
& Probability of  successful reservation\\
& Defined in (\ref{eq:Y_a^bc})\\
& Steady-state probability of state \\
& Updated steady-state probabilities, eliminating states with \\
& Inter-arrival time of PUs (switching model)\\
\hline
\end{tabular}
\normalsize
\end{table}
\normalsize


\section{System Model}
\label {sec:system-model}
In this section we provide a summary of the two generic multichannel OSA MAC protocols for which we derive the delay analysis under unsaturated traffic in later sections. More details on those protocols, as well as their throughput performance under saturated traffic, can be found in \cite{pawelczak09,park11}.
It is assumed that there are  nodes in an ad-hoc cognitive radio network and  OSA channels where one channel is the dedicated control channel and the remaining  channels are used for data transmission. Without loss of generality and for notation simplicity, we assume that the  nodes have intended receivers that are not part of those nodes. 
A maximum of  links might thus simultaneously exist. 

As illustrated in Fig.~\ref{XTR.pdf}, operations in the OSA network is time-slotted. Primary and secondary users are fully synchronized. 
In the beginning of each timeslot, there is a short quiet period during which the whole cognitive network stops operation to sense the channels. 
Primary users (PU) activity in any channel, including the control channel, is modeled by a Bernoulli random variable: in each timeslot 
and independent of the other timeslots and channels, a channel is unavailable for CR users (occupied by primary users or due to false alarms) 
with a probability . We also use a packet capture model whereby a transmission during an available timeslot is successful, 
without considering collisions and interference, with  probability  for the data channels and probability  
for the control channel. Channel availability and packet captures are assumed to be independent.
\begin{figure*}\centering 
\includegraphics[scale=0.62]{XTR.pdf}\caption{An example of the reservation and transmission processes. In the buffering model, a node reserves channel  in three timeslots (). The transmission of a packet with the length 2 (timeslots) takes 4 timeslots to finish (). The service time for this packet is thus  timeslots. In the buffering model, after a channel unavailability in the second timeslot of the transmission on Ch1, the node participates in a new competition and reserve Ch2 after two timeslots. We thus have .}\label{XTR.pdf}\end{figure*}

A geometric (Bernoulli) arrival process is assumed for all nodes with a probability of packet arrival in a timeslot . The packet length  is given in the number of timeslots required to transmit the packet and has a geometric distribution with parameter .

A node is in the busy state when it has a reserved data channel for transmission, otherwise the node is in the idle state (with an empty or non-empty packet queue). After the sensing period, if the control channel is available, the  idle nodes with a non-empty packet queue attempt to reserve a channel using an Aloha-type competition over the control channel. That is, each of the  nodes will transmit in the timeslot a reservation request with a probability  over the control channel. The competition is successful if only one reservation request is transmitted and it is correctly received.
The probability of success in competition is given by~\cite{pawelczak09}:

where  is the probability of a successful transmission on the control channel without considering collisions. The probability of success for a marked node among  nodes is . 
It is assumed that the list of channels not being used by  CR nodes is given. So, a success in competition in this timeslot is followed by reserving the channel which is on the top of the list by the competition winner, to be used from the beginning of the next timeslot. An exception is when all channels are occupied in this timeslot. If a channel is released at the end of this timeslot, it will be assigned to the successful node in competition, otherwise the successful node in competition is unsuccessful in reserving a channel and returns for a new competition in the next timeslot. It is therefore important to distinguish the event of \emph{success in competition}, which depends solely on the number of competing users, from the event of \emph{success in reservation}, which depends also on the status of channels.
In case that a node is successful in reserving a channel, it starts transmitting one packet in the reserved channel from the beginning of the next timeslot. Other nodes can not make any interference on the reserved channel, but fading, sensing errors and PU activities may interrupt the transmission.

Two MAC protocols are considered in this paper. A  packet transmission cycle example for each protocol is illustrated in Fig.~\ref{XTR.pdf}. In the buffering MAC protocol~\cite{pawelczak09}, 
a node stays on its reserved channel, even when it becomes occupied by PUs, until the packet is entirely transmitted. 
In each timeslot, a successful transmission therefore occurs with probability . 
For the buffering MAC protocol, the (enlarged) packet service time  therefore consists of a reservation period of length  
followed by a transmission time  which consists of successful transmission, 
unsuccessful transmission and unavailable timeslots, until the entire packet is transmitted.

In the switching MAC protocol~\cite{park11}, a node that senses it channel occupied by PUs leaves the channel and returns to the idle state to participate in the competition to reserve a new channel in this timeslot. For the switching MAC protocol, the (enlarged) packet service time  therefore consists of several reservation periods and the successful transmission and unsuccessful transmission timeslots required to transmit the entire packet.

 For both MAC protocols, once the packet transmission is terminated, the node releases the channel and returns to the idle state. It will enter the competition at the next timeslot if it has another packet in its queue. A service-resume transmission model is assumed for both MAC protocols where the remaining part of the packet is transmitted after each interruption. Note that due to the packet length geometric distribution model, the delay analysis is also the same for a service-repeat model where the entire packet must be transmitted after each interruption.
 

\section{Buffering MAC Protocol: Queue Occupancy Markov Chain Analysis}
\label{sec:Queue-Occupancy}
The discrete and memoryless nature of the system model and MAC protocols described in Section~\ref{sec:system-model} 
enables us to propose a general discrete-time Markov chain (MC) which tracks all arrivals, departures and 
interruption events for all nodes. The different queue performance metrics can then be directly computed using the 
steady-state MC solution.  The state variable is given in the form  
where  is the current number of packets in the system (waiting in the queue or being transmitted) 
of node   and  is a status flag indicating whether node  has a reserved channel () or is 
idle (). For each state , we also define the variables  and , 
where  is an indication function with , , which are, respectively, the total number of busy 
nodes and the total number of idle nodes with a non-empty queue. An MC example with  is illustrated in Fig.~\ref{fig-Example-3-N1.pdf}. 
\begin{figure}\includegraphics[width=\columnwidth]{fig-Example-3-N1.pdf}\caption{An example of the proposed queue occupancy Markov chain for  and .}\label{fig-Example-3-N1.pdf}\end{figure}

Because of the geometric arrival process and since at maximum one packet can be served in one timeslot 
over each channel, the queue status changes at most by one packet in two consecutive slots. 
That is , where  is the node  queue occupancy 
at time . However, as a function of the status flag, the following refinements can be made:
\begin{enumerate}
	 \item If  then , and only an arrival event can occur, in which case , 
otherwise . Furthermore, the next status state is also , irrespectively of an arrival event occurrence.
	\item If  and , two events of reservation success and an arrival can 
occur at the same timeslot and the events are independent. We have  
depending on arrival or no arrival. Reservation success only changes the value of  to 1.
	\item If  and , two events of packet transmission termination and an arrival can occur at the same timeslot and the events are independent. We have . 
The case  occurs with an arrival and no transmission termination, and the case  
occurs with no arrival and transmission termination. Meanwhile, a node will have the same number of packets in 
the queue in the next timeslot for two events: transmission termination and no arrival, or no transmission 
termination and no arrival. A transmission termination results in changing the value of  to 0, irrespectively of 
an arrival event occurrence.
\end{enumerate}	
Furthermore, all busy nodes and idle nodes with an empty queue operate independently, 
so the joint probability of different events can easily be found by multiplication.

For two states  and ,
,  the set of impossible transitions, can then be defined as follows: 


\small

\normalsize
where  ( 
is the number of positions for which the difference between the elements of  and  is 1)
is the number of nodes which 
started transmitting in the new timeslot from state  to  and  
is the number of busy nodes in state A whose transmission is finished in state .

The transition probabilities of going from state  to a new state  can then be computed using Alg.~({\ref{alg-queue-occ}}). For , the transition probability is zero. 
In Alg.~(\ref{alg-queue-occ}),  is the set of nodes participating in competition in 
state  whose size is given by . If  is empty, the last part of the algorithm is not run.  represents the case where all channels are busy and no termination occurs. 
\begin{algorithm}[H]
\caption{\scriptsize{The algorithm to find the transition probabilities .}}
\label{alg-queue-occ}
\scriptsize
\begin{algorithmic}
\IF { \& }
\STATE 
\ENDIF
\FOR{}
\IF {}
    \STATE 
\ELSE
    \IF {}
\IF {}
    					\STATE 
					 \ELSE
    					\STATE 
    			 \ENDIF
\ELSE
    			 \STATE Put  in 
    			 \STATE 
    \ENDIF
\ENDIF
\ENDFOR
\STATE ***** Handling Competitions ***** 
\STATE Find  s.t.  
	  \IF {}
    	  \STATE 
    \ELSE
				\IF {}
							\STATE 
				\ENDIF
				
    \ENDIF



 \STATE FindProb(,)=
\end{algorithmic}
\end{algorithm}
\normalsize


This exact Markov chain model is general and can address several system model extensions, 
such as non-homogeneous nodes with different arrival rates or different packet length. 
However, as there is no buffer limit, the number of states is infinite and grows exponentially 
with the number of nodes. To be able to solve the Markov chain numerically a buffer limit  should be set
and the truncated Markov chain is analyzed instead. 
If the transition probabilities are written for a truncated version of the Markov chain with 
the buffer size , the states with  should 
be treated separately because for cases , or  and no termination, the queue 
occupancy in the next state with arrival or without any arrival (with probability equal to one) will still be .

Even for the truncated MC, the queue occupancy MC model suffers from exponential growth of the number states 
and is  thus not scalable. For example, for a buffer limit of , the number of 
states will be  (e.g., 484 states for  and ). 
In the next section, the homogeneity of the nodes is taken into account to propose an approximate but scalable combined Markov chain which will be used for a service cycle analysis.


\section{Buffering MAC Protocol: Service Cycle Analysis}
\label{sec:Service-Cycle}
 
Since a geometric arrival process is assumed, we have for any 
node a discrete-time M/G/1 queue with geometric arrivals called Geom/G/1. Continuous-time M/G/1 and Geom/G/1 become equivalent when the timeslot is short with 
respect to the arrival rate. 
Furthermore, since 
the arrival process and packet length distribution are identical for all nodes, 
the queues are homogeneous. To solve a tagged node queue, we should therefore only find 
the service time  for the buffering MAC protocol.  and  are independent, 
so the first and second moments of the service time  can easily be found from the moments of  and . 
Discrete version of the {Pollaczek–-Khinchine} formula \cite{takagi93-2} can then be used to find the queue performance metrics of interest.
The exact distribution of  and approximations for the distribution of  are derived in Section~\ref{sec:tx} and~\ref{sec:xr}, respectively. 


\subsection{Transmission Time}
\label{sec:tx}
For the buffering MAC protocol, the transmission time is started after the timeslot in which a channel has been reserved with success and lasts
until  the end of the packet transmission (see Fig. \ref{XTR.pdf}).
Since the node is using a reserved channel, there is no interference from other CR nodes and in each timeslot the probability of
a successful transmission is given by  (see Section~\ref{sec:system-model}).
For a packet with length  timeslots,  successful transmissions are required to complete
the packet transmission. For  timeslots, the last slot should necessarily be a successful transmission and
among the remaining  timeslots, exactly  of them should be successful transmissions. Therefore, conditioned on the packet length ,
the transmission time of the packet    has a negative binomial distribution 
given by:

The packet length  has a geometric distribution such that 
the unconditional distribution of  is given by:

The first and second moment of  can then be found as:


\subsection{Reservation Periods}
\label{sec:xr}
At the beginning of every timeslot, nodes can be divided into three groups: 
busy nodes with a reserved channel, idle nodes with an empty queue 
and idle nodes with a non-empty queue. The probability of reservation success at the end of the timeslot 
depends on the number of nodes in the last group, except for the case where all channels are occupied. 
Due to packet arrival and packet transmission termination events, the number of idle nodes with a non-empty
queue changes from one timeslot to the next one such that the probability of 
reservation success in a timeslot is time-varying.
We will proceed as follows to find the reservation period distribution. First, we will propose a combined Markov chain to find 
the distribution and transition probabilities 
of the number of nodes competing in the reservation procedure. We will then find the reservation period distribution by first conditioning it 
on the number of competing nodes in the first reservation timeslot for the tagged node, and then using the steady-state probabilities to
obtain the unconditioned distribution.   





\subsubsection{Combined Markov Chain}
\label{subsub:combined}
Since the sum of nodes at every timeslot is fixed to , the state variable of the proposed combined Markov chain is given by a 2-tuple  
where  is the number of busy nodes and  is the number of idle nodes with a non-empty queue. 
The number of idle nodes with an empty queue is then given by . 
We have the following facts about the system:
\begin{itemize}
	\item Every idle node with an empty queue may independently become a node with a non-empty queue in the next timeslot 
with the probability , which is the probability of one arrival during one timeslot. 
	\item Among the idle nodes with a non-empty queue, at most one node may become busy with the probability of reservation success  and
all others stay in the same group.  is the probability of getting a channel when  nodes participate in competition and  channels are already reserved. It is given by:

where  is the probability of no transmission termination among the  ongoing communication sessions.
\item Every busy node may independently finish in a timeslot its packet transmission with  probability  and then, with probability , the node 
joins the idle nodes with an empty queue.  converges to the steady-state queue occupancy of a node queue and 
is the same for all busy nodes because nodes are homogeneous and have a geometric memoryless packet length. 
\end{itemize}
The number of participants in the competition in the next slot compared to the previous slot may thus decrease at most by one, 
but may increase to any larger value up to  depending on the number of idle nodes with an empty queue with an arrival and the number of busy nodes that finish
their transmission and have a non-empty queue.
	 	
Using these facts and the results in \cite[Eq. (16)]{pawelczak09}, the transition probabilities of the combined Markov chain can be given by:


\scriptsize

\normalsize
 and  are respectively defined in \cite [Eqs. (14),(15)]{pawelczak09} 
as the probability of  transmission terminations among  ongoing communication sessions 
and the probability of  success in competition among  competitors (note that ). 

 is the probability that  new nodes join the group of idle nodes with a non-empty queue given that there are  busy nodes 
that terminate their transmission and  idle nodes with an empty queue. 
This happens if  nodes out of the  busy nodes 
that terminate their transmission have a non-empty queue at the end of the timeslot and  nodes out of the
 idle nodes with an empty queue have a packet arrival in the timeslot, where .  is thus given by:

\footnotesize

\normalsize
Assuming that  is known, the steady-state probabilities    of the combined Markov chain can be found. 
We explain in Section~\ref{sec:sol_proc} how  can be found. 


\subsubsection{Reservation Period Distribution}
\label{sec:res_per_dist}

We now derive the distribution of  for a tagged node belonging to the group of idle nodes with a non-empty queue.
Let  denote the reservation length given that the system is in the state  at the beginning of the reservation period.
The probability of a successful reservation for the marked node in the first timeslot, and thus have  is equal to . 
However, if the reservation is unsuccessful, the system transits to a new state  with the probability . 
In this state, the probability of successful reservation and thus have   is now . 
Otherwise, the system transits to a new state and the process repeats. In general, 
 can be found in a recursive manner from the probability of transition to other states  and  from other states, given that the node was not successful in reservation. 

It is important to note that for this analysis, the transition probabilities of the combined MC discussed in the previous
section can not be directly used because it is implicitly assumed that the marked node was not 
successful. We therefore need a different MC with transition probabilities denoted by  conditioned on the fact
that at each transition, the marked node was not successful, and that if the reservation
competition was a success, it was one of the other  competitors who was successful.  The transition probabilities 
are given by (\ref{eq:comb_trans_prob}) where  given in (\ref{eq:Prob-Success}) is replaced by 
.

The distribution of  is then given by:

\small

\normalsize
 can then be unconditioned to obtain  as follows:

Since when we mark a node to find , 
we implicitly assume that the node is idle with a non-empty queue,
the states in which the number of competing users is zero () 
should therefore be eliminated to obtain the steady-states probabilities for the states  as .


\subsubsection{Solution Procedure}
\label{sec:sol_proc}

To find the combined MC transition and steady-state probabilities, , the steady-state probability of 
a node's queue being empty, is required.  can be computed from the Geom/G/1 queue
relation . However,  depends on the combined MC solution.  
We therefore proposed an iterative solution where an initial value is set for . 
The combined MC chain can then be solved and  computed. A new value of  is then obtained and
used for the next iteration.
The iteration continues until the value of  converges. 
To compute the initial value of , we propose to use the lower bound case for   
where only the tagged node participates in the competition. The distribution of  is then geometric and .

Note that the number of competing nodes in one state is not independent of the other states. 
However by using the steady-state probabilities in (\ref{eq:dist_xr}) combined with the iterative solution procedure, this dependency is ignored. 
Furthermore, the different functions involve in this system are not necessarily convex. 
The combined-MC approach is therefore inherently an approximate solution.
For example, we have observed that in some cases the combined-MC solution converges to a non-zero value of  while
simulations indicated that the system is unstable. However, all studies that we have performed showed that in the region where
the system is stable, the combined-MC approximation is very accurate (see results presented in Sec.~\ref{sec:simulation}).

\subsubsection{Other Approximations}
\label{sec:xr_approx}

The proposed approach based on the combined Markov chain is scalable. 
However, the number of slots until 
reservation success is infinite and the distribution of  should be truncated
which results in an approximation. Furthermore, even when the distribution of  is truncated,
the computations are intensive. We therefore propose in this section three different approaches
to reduce the computational complexity required to calculate the moments of .


\paragraph{Reduced Markov Chain}
The number of states in the Markov chain can be reduced by assuming
that idle nodes will independently have a non-empty queue at the beginning of
a timeslot, and therefore participate in the competition, with probability .
This assumption therefore ignores the dependency between timeslots of the
status of an idle node and we don't need to track in the MC state variable
the number of idle nodes with a non-empty queue. That is, the combined MC chain presented
in Section~\ref{subsub:combined} can be replaced with the single dimension 
Markov chain proposed in \cite{pawelczak09} which uses the single state variable , the number
of busy nodes. 
In each timeslot,  nodes then participate in the competition with an
Aloha access probability given by . 
The distribution of  can then be computed as explained in Section~\ref{sec:res_per_dist}  where
 given in (\ref{eq:Prob-Success}) is replaced by ,
the summations in (\ref{eq:XRk,g}) and (\ref{eq:dist_xr}) are over a single variable, and the modified transition probabilities in (\ref{eq:XRk,g}) and
steady state probabilities in (\ref{eq:dist_xr}) are obtained from the MC in~\cite{pawelczak09}.  
The solution procedure is then the same as the one described in Section~\ref{sec:sol_proc}.
This approximate model, denoted by 'Pawelczak-MC' in the numerical results, reduces the computational complexity since the state space is smaller.

\paragraph{Approximate  Distribution}
\label{Avg}
We now propose an approximate approach which significantly reduces the complexity associated with finding
the distribution of  so that it can be used in scenarios with limited computation capacity. 
The  complexity in (\ref{eq:XRk,g}) arises from the fact that the reservation success probability is time-varying
and has memory. As an approximation, we propose to simply assume that the number of participating nodes during a reservation period is always
.  With this assumption, , the reservation time given that the number of participating nodes is  at each timeslot,
has a geometric distribution with probability 
,
where  is the probability of  being equal to  and is defined as follows:

From the combined MC chain presented in Sec.~\ref{subsub:combined}, we can compute
 (), the distribution of the number of nodes participating in the competition
excluding the cases where there is no competitors. We can then approximate the distribution of  as follows:

Given that  is geometric, it is then easy to compute the moments of .
Since  is not known, 
the same solution procedure as the one described in Section~\ref{sec:sol_proc} should be used.
This approximate model is denoted by Combined-MC-Dist in the numerical results.

\paragraph{Average  Distribution}
This third approach further simplifies the computations by calculating the reservation time with the average number of idle nodes in competition with a non-empty queue.
Let define 

where the steady-state probabilities  are obtained from the combined MC chain presented in Section~\ref{subsub:combined}.
Then  is approximated with a geometric distribution with 
probability .
Since  is not known, 
the same solution procedure as the one described in Section~\ref{sec:sol_proc} should be used.
This approximate model is denoted by Combined-MC-Avg in the numerical results.

\section{Switching MAC Protocol Delay Analysis}
\label{sec:switching}

In this section, we provide the delay analysis for the multichannel OSA switching MAC protocol. 
The same approach as for the delay analysis for the buffering MAC protocol is followed: we first 
provide a system occupancy Markov chain in Section~\ref{sec:switching_occ_mc} and then we derive an Geom/G/1 queue analysis 
in Section~\ref{sec:switching_service_cycle}. 
The only difference between the buffering and switching MAC protocols is that in the switching protocol, if a SU senses that its reserved channel is occupied
by a PU, it immediately returns to the group of idle nodes with non-empty queue and participates in the competition, while in the buffering MAC protocol
the node would remain on its reserved channel. To facilitate the analysis of the switching MAC protocol, the system occupancy MC and combined MC for service time analysis
are embedded after the sensing period. Finally, for
sake of brevity, we omit details in the analysis that are similar to the buffering MAC protocol analysis.





\subsection{Occupancy Markov Chain}
\label{sec:switching_occ_mc}

The states of the queue occupancy Markov chain are similar 
to the buffering case and are given by . 
However, the observation time where the Markov chain has been 
imbedded is immediately after the initial sensing period when 
the status of the channels has already been determined. 
We therefore have that when  the reserved channel for node 
is available in this timeslot for transmission (the transmission may however be unsuccessful due to the packet capture model).

Similar to the buffering case, for a state , we can define  as the 
total number of busy nodes who have a channel and whose channels 
are available in this timeslot and  as the total number of idle nodes with non-empty queue. 
The switching model facts are very similar to the buffering model with the difference 
that a node who transmitted on its assigned channel
in this timeslot may, if it does not finish its packet transmission,
 come back to the competition with probability  if a PU is detected on its assigned channel.
For , the Markov chain is illustrated in Fig.~\ref{fig-Example-3-N1-Switching.pdf} 
where the transitions after states  and  are not shown. 
It can be seen that compared to Fig.~\ref{fig-Example-3-N1.pdf} for the buffering policy, 
there are only two changes: a new transition may occur from state (1,1) to (1,0) 
if no arrival occurs, transmission is not finished, but the channel is missed in the next timeslot, 
and to state (2,0) with the same conditions and an arrival occurs.
\begin{figure}\includegraphics[width=\columnwidth]{fig-Example-3-N1-Switching.pdf}\caption{An example of the proposed queue occupancy Markov chain for switching policy when  and .}\label{fig-Example-3-N1-Switching.pdf}\end{figure}

Transition probabilities for this Markov chain can be found 
using Alg. \ref{alg-queue-occ-switching} with the same set of impossible states (IS). 
Similar to the buffering model, when a node  is busy (), 
its transitions are independent of other nodes. For  and , 
the node participates in competition. 
Compared to the buffering model, it can be seen that 
the main change is for the case where there is a transition between  and  
because this transition may occur in the switching model due to both a service termination 
or a PU positive sensing. Moreover, we can see that the probability 
of success is updated by  because a success in competition 
should also be followed by the availability of the reserved channel to be a reservation success.

For the case where we have , the success depends on
the nodes who had a transition from  to .
Any of them may have a transition due to missing the channel and PU arrival (kept in vector ) 
or a termination (kept in vector ). 
 keeps the total probability of both events. Then,   
is defined to be the probability that all transitions from  
to  have been due to PU arrival. In this special case, 
no reservation success is possible. If at least one node among 
them has finished its transmission, with the probability , 
then a competition success may result into a reservation success with the probability .

\begin{algorithm}
\caption{\scriptsize{The algorithm to find the transition probabilities (FindProb(,)) in the switching model. Note that  and .}
\label{alg-queue-occ-switching}}
\tiny
\begin{algorithmic}
\IF { \& }
\STATE 
\ENDIF
\FOR{}
\IF {}
    \STATE 
\ELSE
    \IF {}
\IF {}
    					\STATE 
					 \ELSE
					 			\IF {}
    								\STATE 
    						\ELSE
             			  \STATE Put  in 
             			  \STATE 
    								\STATE 
    								\STATE 
    								\STATE 
    								\STATE 
    						\ENDIF
					 					
    			 \ENDIF
\ELSE
    			 \STATE Put  in 
    			 \STATE 
    \ENDIF
\ENDIF
\ENDFOR
\FOR{}
 \STATE 
\ENDFOR
 \STATE 
\STATE FindProb(,)=
\STATE ***** Handling Competitions ***** 
\IF {}
		\STATE Find  s.t.  
	  \IF {}
    	  \STATE 
    \ELSE
				\IF {}
							\STATE 
				\ENDIF
				
    \ENDIF

\ELSE
		\STATE Find  s.t.  
	  \IF {}
    	  \STATE 
    	  \STATE 
    \ELSE
				\IF {}
							\STATE 
				\ENDIF
				
    \ENDIF
\ENDIF

\STATE FindProb(,)=
\end{algorithmic}
\end{algorithm}
\normalsize


\subsection{Service Cycle Analysis}
\label{sec:switching_service_cycle}

The nodes queue in the multichannel OSA network with the switching MAC protocol can 
also be modeled with a Geom/G/1 queue. 
As illustrated in Fig.~\ref{fig-B0S0-model.pdf}, the Geom/G/1 service time in this queue is composed of alternating renewal processes: 
uncompleted packet transmissions (a part of the packet however can be transmitted) 
and competitions for channel reservation alternate until the packet is entirely transmitted. 
Since the packet length is geometric and the occurrence of an interruption is a Bernoulli event, and both are independent, the uncompleted packet transmission time is thus memoryless and identical. The unsuccessful transmission attempts therefore form a renewal process.
The reservation periods  during the transmission 
of a packet are also identical and form the second renewal process. 
\begin{figure}\includegraphics[width=\columnwidth]{fig-B0S0-model.pdf}\caption{Unsuccessful transmission and reservation periods create alternating renewal processes.}\label{fig-B0S0-model.pdf}\end{figure}
Let  be the service time of the Geom/G/1 queueing model, which can be given by

where  is the enlarged packet length (in number of slots), 
which is geometrically distributed with 
the probability , 
and  is the number of switching during the transmission 
of the packet. To find the service time, we must find the distribution of  and the number of renewals , 
which are addressed in Section~\ref{sec:switching_X_R} and Section~\ref{sec:switching_renewal}, respectively.

\subsubsection{Reservation Period}
\label{sec:switching_X_R}

The approach to find the distribution of  for the switching MAC protocol is similar as the one followed
for the buffering model in Sec.~\ref{sec:xr}.
The state variable of the combined Markov chain is still 
given by a 2-tuple , 
however,  the observation time where the combined Markov chain is 
embedded for the switching MAC protocol is after the 
initial sensing period at the beginning of each timeslot such that the status of the channels 
for the current timeslot is known. 
 is therefore the number of reserved channels
on which there will be a transmission attempt in this timeslot and  is the number
of idle nodes 
with a nonempty queue which participate in the competition on the control channel for reservation.
The number of idle nodes with an empty queue is thus given 
by . 

To find transition probabilities, we use four 
auxiliary variables , ,  and . Note that in 
the following,   and  refer to  and  
for the current timeslot . 
Among  busy nodes,  nodes independently finish the transmission 
of their packets, each with the probability . 
We use the notation  
for the probability of this event. Any of those  nodes may  join in the next timeslot, with probability , the idle nodes with a nonempty 
queue. Otherwise, they join 
the idle nodes with an empty queue. 
The probability that  nodes out of the  finishing nodes will be among the  nodes in the next
timeslot is thus given by  .
For the remaining  nodes which do not finish their transmission,  nodes 
may leave their channels due to PU presence sensing with  
probability .
Those nodes also join the  idle nodes with a nonempty queue after the sensing period.
The remaining  nodes stay on their channels, 
so they are among the  nodes.

Considering  participants in competition, we have the 
same results for competition success as for the buffering case. One node may then be 
successful and join the  nodes with probability . The 
 term is included because the node may be successful in 
competition and reservation during this timeslot, but 
the reserved channel might be unavailable in the next timeslot. 
Therefore, without starting the transmission, the node 
has to come back to competition.  All other  nodes 
remain in the group of idle nodes with a nonempty queue, 
i.e., they are among  nodes. Finally, any of 
 idle nodes with an empty buffer may receive a 
packet and join the participants in competition in the 
next timelot. The probability to have  such nodes is 
given by . 

We can thus, for the switching MAC protocol, express the transition probabilities 
of the combined Markov chain in the form  as follows:

\begin{figure*}[!t]
\setcounter{mytempeqncnt}{\value{equation}}
\setcounter{equation}{14}
\footnotesize

\normalsize
\setcounter{equation}{\value{mytempeqncnt}}
\hrulefill
\vspace*{4pt}
\end{figure*}
where  is given in (\ref{eq:Y_a^bc}).
Given the transition probabilities for the combined Markov chain for the switching MAC protocol, the distribution of  can
be obtained as explained in Section~\ref{sec:res_per_dist}. The second and third approximations given
in Section~\ref{sec:xr_approx} to find the distribution of  can also be used (the approximation based on the
model presented in~\cite{pawelczak09} is not applicable for the switching MAC protocol).

\subsubsection{Renewal Process}
\label{sec:switching_renewal}

As illustrated in Fig.~\ref{fig-B0S0-model.pdf},
, any part of the whole service time where the node has a reserved
channel, is the inter-arrival time of the channel unavailability 
events.
Let us use the random variable 
 to denote the inter-arrival time of those events.  has 
a geometric distribution with probability .
From the 
Renewal Theory point of view~\cite{cox62},  is the 
number of renewals from 0 to  where the process which is 
renewed is .
The number of renewals can be found from Renewal Theory 
results \cite{cox62}. 

However, as we have  geometric 
distributions for both  and , we can use the following simpler 
approach.
Due to the memoryless packet length, the remaining part of the packet in any operating period is geometrically 
distributed with parameter .  The total number of renewals is 
thus the number of trials until success, which is a geometric distribution of type-II, with the 
probability of success in a period being , the probability of sending the 
whole packet in the given period. However, the number 
of reservation periods which appear in the calculation of service 
time is  because the first reservation period is not counted as a 
renewal (see Fig.~\ref{fig-B0S0-model.pdf}). We thus have:

For any two type-I geometrically distributed random 
variables  and  with parameters  and , we can show that

We thus have:


and


To find the second moment of  it should be taken into account that we have a 
random sum and the two parameters  and  are not independent. Using the 
following facts: 


and thus

the term  can be given by:
\footnotesize

\normalsize
We have used the fact that the number of renewals in the 
interval  of a type-I geometric with the parameter  is equal to .

From the moments of  and , it is then straightforward to find the moments of  and solve the Geom/G/1 queue.
Note that since  is initially unknown and is required to find the distribution of , the solution
procedure outlined in Section~\ref{sec:sol_proc} can be followed. The initial value of  is computed with the lower bound of  obtained for the case where only a
single node is competing and for which .


\section{Simulation and Numerical Results}
\label{sec:simulation}

In this section, we verify the accuracy of the proposed 
models and approximations by comparing simulation results with numerical evaluations
of the theoretical results presented in this paper. We also study the impact of several parameters on the
multi-channel OSA MAC protocols performance.
Simulations are done with Matlab where each simulation scenario is 
run for 350000 timeslots and the same scenario is repeated 10 times.
Unless indicated otherwise, we have  data channels. In Sec.~\ref{sec:res_arr_rate} to \ref{sec:res_tx_cap}, we investigate
the buffering MAC protocol while in Sec.~\ref{sec:sim-switch} we present results for the switching MAC protocol.

\subsection{Impact of Arrival Rate}
\label{sec:res_arr_rate}

Fig.~\ref{FIg21102013New} shows the average system time as a
function of the arrival rate for the buffering MAC protocol and for different system parameter values. 
It can be first observed that, as expected, the queue occupancy Markov chain 
provides accurate results compared with simulation results, called 'truncated simulation', obtained
with the same limited buffer size assumed to numerically solve the occupancy Markov chain. 
All approximations also provide acceptable results at low arrival rate while for larger values, when
the system gets close to instability, their accuracy decreases. 
For example, for  users, the combined-MC approximation is accurate within 3\% for a normal operation region
below 80\% of maximum loading. It was observed through several scenarios that, as expected, the combined Markov chain
provides the best approximation while the average based and distribution based approximations both diverge sooner 
than the two other schemes when the queue approaches the instability region.
In the following, to help the figures readability, we will only present some of the results obtained with the different approximations.
\begin{figure*}\includegraphics[width=0.41\columnwidth]{FIg21102013Dec2013.pdf}\includegraphics[width=0.41\columnwidth]{FIg22102013NewDec2013CorrectedMCN2Corrected2MC3MC.pdf} 
\includegraphics[width=0.41\columnwidth]{Fig56022014New.pdf}
\caption{Performance comparison of the proposed schemes versus the variation of the arrival rate for the buffering MAC protocol.}
\label{FIg21102013New}\vspace{1em}
\includegraphics[width=0.4\columnwidth]{Fig040506022014.pdf}\includegraphics[width=0.4\columnwidth]{Fig141516022014.pdf}\\\includegraphics[width=0.4\columnwidth]{Fig1718193738022014.pdf}\caption{Average system time for the buffering MAC protocol versus the Aloha-type probability of control channel access, for different arrival rate and packet length values.}\label{FigPVariable3LambdasOnlySim}\end{figure*}


\subsection{Impact of Medium Access Probability}

The probability of medium access on the control channel 
has a major influence on the performance of the network. 
A very small  or a very large  makes the system 
unstable because, in the former case, a packet has to 
wait several slots before the node tries to reserve a channel, 
and, in the latter case, there will be a lot of collisions such that the reservation success probability
will be very low. In Fig.~\ref{FigPVariable3LambdasOnlySim}, 
we can see that for any given scenario of the buffering MAC protocol, there is an optimal value for  which depends
on the arrival rate. 
This optimal value decreases when the total traffic load on the control channel increases due
to either an increase in the arrival rate, an increase in the number of nodes or smaller packets.
Interestingly, it can be observed that by increasing the packet length (smaller ), 
even though the total system load and the delay increase because the packets are now longer, 
the optimal probability of channel access  also increases. 
This is due to the fact that with longer packets, the nodes return less frequently to the control channel. There
is thus less competition for channel reservation and a higher probability of control channel access is optimal. 

It is also observed that the optimal control channel access probability is significantly
larger than for the saturated traffic model where the optimal value of  is very small~\cite{pawelczak09}. There is also
a large range of values of  where the performance is similar. However, this range decreases with an increase in traffic load of the system.


\subsection{Impact of Packet Length}


As observed in Fig.~\ref{FigPVariable3LambdasOnlySim}, the system time increases when
the system load increases either due to an increase of arrival rate or packet length.
In  Fig.~\ref{Figure1116171819102013}, we investigate the impact of both parameters on the buffering MAC protocol when the traffic load
 is fixed. It can be observed that as the packet length increases (and the arrival rate decreases),
the system time decreases. This is due to the fact that in the network model with an Aloha-type medium access algorithm,
the main bottleneck is the competition on the control channel to reserve a data channel. 
For a fixed traffic load, when the packet length increases, 
fewer nodes will therefore participate in the competition and the nodes with a reserved channel 
spend more time on the reserved channel and less time waiting on the control channel to get a reservation success.
\begin{figure}\includegraphics[width=\columnwidth]{Figure1116171819102013Dec2013CorrectedMCN2Onlytrunc.pdf}\caption{Performance comparison for the buffering MAC protocol for a fixed traffic load of  and .}\label{Figure1116171819102013}\end{figure}


\subsection{Impact of Transmission Capacity}
\label{sec:res_tx_cap}

We investigate in this section the impact of transmission capacity which depends on the number of available
channels and the channel availability .
In Fig.~\ref{Fig010203112013}, the number of nodes is fixed 
to  and the number of data channels is increasing 
from  to , for two different values of packet length. 
As discussed previously, when the number of nodes is high the probability of success in competition decreases and
all nodes spend a longer time for reserving a channel. Even though there 
are available channels, no node can make a reservation; 
therefore, the increase of the number of channels provides no 
gain for the network. When the packet length is small (), 
the packet transmission time is short, so a winner again joins quickly 
the competing users and the probability to have even two channels 
busy at the same time is low.  
With a longer packet length (), fewer users compete and data channels are more utilized. The
system time therefore decreases until 6 data channels are available and marginal gains are achieved
for larger values of .
\begin{figure}\includegraphics[width=\columnwidth]{Fig1213022014New.pdf}\caption{System time as a function of the number of data channels  for the buffering MAC protocol.}\label{Fig010203112013}\end{figure}

The observation that the main bottleneck 
of an Aloha-based cognitive radio MAC protocol is the channel reservation competition on 
the control channel  leads us to propose the concept of channel
and node clustering. That is, instead of having a single control channel
the CR nodes and channels can be divided into clusters where each cluster has its own 
control channel. 
The results presented in Fig.~\ref{Fig25102013NewCorrected2MC3MCNewPNewM2WithSim}
show the performance of such a clustered system.
We assumed a network with 10 nodes and 10 channels and compared the performance when there is a single control channel
and all nodes operate under a single entity of the buffering MAC protocol (i.e.,  and ) with
the case where the nodes and channels are divided into two clusters and
each cluster has its own control channel and operate under an independent 
entity of the buffering MAC protocol (i.e.,  and ). The probability of medium access, , has been 
adjusted to the value which minimizes the delay for each case.
It can be observed that even though one additional channel is now used as
a control channel in the two-cluster case, and we thus have fewer data channels, the system time 
has significantly decreased for all values of arrival rate. Furthermore, a larger arrival rate can be 
served when there are two clusters. Those results confirm our hypothesis that the delay bottleneck is due to the reservation
competition on the control channel and the
fact that, depending on the system parameters, it might be more beneficial to add control channels than to add
data transmission capacity. 
\begin{figure}\centering
\includegraphics[width=\columnwidth]{Fig25102013NewCorrected2MC3MCNewPNewM2WithSimMixed.pdf}\\
\caption{Performance comparison for the buffering MAC protocol of a network with  and the clustered network with two clusters of .}\label{Fig25102013NewCorrected2MC3MCNewPNewM2WithSim}\end{figure}


Another important issue is the trade-off between the 
number of channels and their availability, when, for instance, 
a cognitive radio network has the option of utilizing a spectrum with a large number of 
channels with a lower availability per timeslot and another spectrum with a 
smaller number of channels with a higher availability.  In Fig.~\ref{Fig0405112013}, we investigate
this tradeoff where the channel availability  decreases when  increases.  Note that 
we kept the control channel availability constant.
The interesting point to observe is that there is
an optimal point where the average delay is minimized. 
This is due to the fact that because of the control channel access bottleneck, an 
increase in the number of channels does not provide 
any significant gain for the network (see results presented in Fig.~\ref{Fig010203112013}) 
while the decrease in 
availability of the assigned channel increases the transmission time of the packet. 
Such an optimal point exists for any network as a 
function of the system parameters, 
so the analytical queueing results presented in this paper enable the network designer to select the best operating channel set.
\begin{figure}\includegraphics[width=\columnwidth]{Fig0405112013New.pdf}\caption{Impact of the variation of the number of data channels  when the channel availability, , decreases for the buffering MAC protocol. For , we have .}\label{Fig0405112013}\end{figure}







\subsection{Switching MAC Protocol}
\label{sec:sim-switch}

In this section we investigate the performance of the switching MAC protocol. 
Fig.~\ref{Fig29112013} shows the system time as a function of the arrival rate for  nodes.
It can first be observed that the analytical approximations provide a good prediction of the 
system performance.
Those results also show that there is a significant performance degradation versus
the results presented previously for the buffering MAC protocol. For similar parameters, we observe approximately  lower delay in the buffering case. 
This is due to the fact that for a packet transmission a node has to incur several reservation periods, which
are the delay bottleneck, and furthermore this creates more competition on the control channel, which further
increases the reservation delay.
\begin{figure}\includegraphics[width=\columnwidth]{Fig29112013.pdf}\caption{System time for the switching MAC protocol as a function of the arrival rate.}\label{Fig29112013}\end{figure}

In Fig.~\ref{Fig2728112013}, the performance versus 
the variation of the number of data channels and channel availability 
is illustrated. It can easily be 
seen that the performance of the switching policy 
significantly degrades especially when the packet length 
is long. This is due to the fact that the longer the packet are and the more frequent the transmission
occurs, the more often the nodes return to the control channel and wait to get a reservation.
However, we can still observe for large packets  an initial 
improvement when the number of channels increases 
from one to two.
\begin{figure}\centering
\includegraphics[width=0.6\columnwidth]{Fig27112013.pdf}\\
\includegraphics[width=0.6\columnwidth]{Fig28112013.pdf}\caption{Performance comparison versus the variation of the number of data channels  when the channel availability, , decreases for the switching MAC protocol.
For , we have .}\label{Fig2728112013}
\end{figure}

Fig.~\ref{Fig303132112013.pdf}  shows the impact of Aloha access probability on the packet system time 
for the switching MAC protocol. Those results first
validate the occupancy Markov chain model.
It is also interesting to observe that even though the switching policy 
is more sensitive to an increase in packet length due to the frequent returns to the control channel, 
there are some scenarios, as the one illustrated in the figure, in which having a lower arrival rate with longer packets provides
a better performance than having a higher arrival rate of shorter packets. 
\begin{figure}\includegraphics[width=\columnwidth]{Fig3031321120132MCnewNosim.pdf}\caption{Average system time for the switching MAC protocol versus the Aloha-type probability of control channel access. ().}\label{Fig303132112013.pdf}\end{figure}







Since the switching occurs due to PU arrivals and not fading, 
we investigate the impact of variation of  on the system time. The results for the switching and buffering MAC protocols are 
illustrated in Fig.~\ref{Fig33112013.pdf}. When , the two policies 
are naturally the same. When  increases, the performance of the buffering MAC policy
only slightly deteriorates due to a small increase in packet transmission time. However, for the switching
MAC policy, each PU interruption incurs a large penalty of channel reservation. Therefore, the performance
quickly degrades as a function of .
\begin{figure}\centering
\includegraphics[width=\columnwidth]{Fig33112013.pdf}\caption{Average system time for the switching and buffering MAC protocols as a function of PU probability of activity ().}\label{Fig33112013.pdf}\end{figure}
It is worth mentioning that we have also ignored the switching time required 
to align the radio in the switching policy \cite{park11}. Naturally, 
assuming a switching time will further degrade the 
performance of the switching policy.

Comparing the results of the buffering and switching 
policies reveals that in all  scenarios, the buffering 
MAC protocol outperforms the switching. 
This is simply due to the homogeneity of the channels and memoryless
PU presence. That is, with the switching policy if the channel is not available,
the node tries to reserve a channel. In the best case, the reservation process
will last one timeslot. However, the reserved
channel has the same probability of being available in the next timeslot as if
the node stayed on the same channel with the buffering policy.
So there is no way for a node to decrease its transmission delay
by switching to another channel.


\section{Conclusion}
\label{sec:conclusion}
In this paper, a delay and queueing analysis for a multi-node network with an 
Aloha-type medium access model was provided. Two different recovery models 
were considered: a waiting and buffering recovery policy where the CR node 
waits for the primary user to vacate the channel and continues the transmission 
on the same channel, and a switching policy where after the appearance of 
primary user, a spectrum handover occurs. It was observed that access to 
the control channel to reserve a data channel is the major bottleneck in Aloha, 
so any approach which decreases the number of competitors, 
such as having fewer but longer packets and node clustering, improves the performance. 
The probability of medium access in Aloha should also be adjusted carefully
to have the minimum delay. With the assumption of having homogenous and 
memoryless channels, a buffering policy always outperforms the switching policy. 
An important area of future work would be to improve the channel occupancy model with a 
Markov chain channel instead of the assumption of independent 
availability per timeslot. Furthermore, since the Aloha access to the control channel represents
a major contributor to the delay, alternative control channel strategies should also be investigated following 
the methodology presented in this paper.

\bibliography{new-refs,telecom}
\bibliographystyle{IEEEtran}




\end{document}
