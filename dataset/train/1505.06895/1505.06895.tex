\newif\ifproceedings\proceedingstrue
\newif\ifsinglecolumn 

\documentclass[conference]{IEEEtran}
\usepackage[hyphens]{url}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{amsfonts,amssymb}
\usepackage[ruled,algosection,noend,linesnumbered]{algorithm2e}
\usepackage{amsthm,amsmath}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{xspace}
\usepackage{xcolor}
\usepackage{framed}
\usepackage[all]{xy}
\usepackage{balance}
\SetMathAlphabet{\mathcal}{normal}{OMS}{lmsy}{m}{n}
\SetMathAlphabet{\mathcal}{bold}{OMS}{lmsy}{m}{n}
\SetSymbolFont{largesymbols}{normal}{OMX}{lmex}{m}{n}
\SetSymbolFont{largesymbols}{bold}{OMX}{lmex}{m}{n}
\overfullrule5pt

\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{subcaption}
\usepackage{pifont}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{definition}[theorem]{Definition}

\usepackage{microtype}
\renewcommand*\ttdefault{txtt}

\newenvironment{prettylist}{
\raggedright
\begin{list}{
    \footnotesize\raisebox{0.1mm}{\small\ding{118}}
}{
    \setlength\topsep{1ex}
    \setlength\leftmargin{32pt}
    \setlength\rightmargin{12pt}
    \setlength\itemsep{2pt}
    \setlength\parskip{0pt}
    \setlength\parsep{0pt}
    \setlength\itemindent{-15pt}
}
}{
\end{list}
}

\newenvironment{denseitemize}{
\begin{itemize}
    \setlength{\itemsep}{1pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{itemize}}

\newcommand\bi{\begin{itemize}}
\newcommand\ei{\end{itemize}}
\newcommand\ben{\begin{enumerate}}
\newcommand\een{\end{enumerate}}
\newcommand{\trm}[1]{\textrm{#1}}
\newcommand{\tbf}[1]{\textbf{#1}}

\hbadness = 10000

\pagestyle{plain}

\newcommand*\dash{\ifvmode\quitvmode\else\unskip\kern.16667em\fi---\hskip.16667em\relax}

\newcommand{\rscoin}{\textsf{RSCoin}\xspace}
\newcommand{\aquery}{\textsf{Query}\xspace}
\newcommand{\acommit}{\textsf{Commit}\xspace}
\newcommand{\aepoch}{\textsf{CloseEpoch}\xspace}

\newcommand{\secrscoin}{RSCOIN\xspace}
\newcommand{\subsecrscoin}{RSCoin\xspace}

\newcommand{\secp}{\lambda}
\newcommand{\usecp}{1^{\secp}}
\newcommand{\randpick}{\xleftarrow{\4.8301710030mnH(\cdot)(\sigkeygen,\sigsign,\sigverify)(\pk,\sk)\randpick\sigkeygen(\usecp)\sig\randpick\sigsign(\sk,m)0/1\gets\sigverify(\pk,m,\sig)\addr\pk\addr\pk\txspec{\{\addr_i\}_i}{n}{\{\addr_j\}_j}n\{\addr_i\}_i\{\addr_j\}_j\addr\addrid=(\tx,\txindex{\tx}{\addr},v)\txv\txindex{\tx}{\addr}\addrv\mintette_ii\mintette\owners(\addrid)\addrid\addrid=(\tx,i,v)\tx\addriv\addrid\tx\addrid\addrid\owners(S_\outputs)S_\outputs\mintette\addrid\tx\utxo\periodtxset\txset\utxo\addrid\mapsto(\addr,v)(\addrid\mapsto(\addr,v))\in\utxo\addridv\addr(\addrid\mapsto(\bot,\bot))\in\utxo\addrid\periodtxset\addrid\mapsto\tx(\addrid\mapsto\tx)\in\periodtxset\addrid\tx\utxo\periodtxset\txspec{S_\inputs}{n}{S_\outputs}j\bundle\gets\emptyset\addrid\in S_\inputsM\gets \owners(\addrid)\mintette\in M(\pk_\mintette,\sig)\gets\checknotdoublespent(\tx,\addrid,\mintette)(\pk_\mintette,\sig)=\bot\bot\bundle\gets \bundle\cup\{((\mintette,\addrid)\mapsto(\pk_\mintette,\sig))\}M\gets\owners(S_\outputs)\mintette\in M(\pk_\mintette,\sig)\gets\committx(\tx,j,\bundle,\mintette)\checktx\tx_c\addrid=(\tx,i)\mintette\checktx(\tx_c) = 0\mintette \notin \owners(\addrid)\bot(\addrid\in\utxo_\mintette)((\addrid\mapsto\tx_c)\in\periodtxset_\mintette)\utxo_\mintette\gets\utxo_\mintette\setminus\{\addrid\}\periodtxset_\mintette\gets\periodtxset_\mintette\cup\{(\addrid\mapsto\tx_c)\}(\pk_\mintette,\sigsign(\sk_\mintette,(\tx_c,\addrid)))\bot\checknotdoublespent\bot\utxo\periodtxset\utxo\periodtxset\periodtxset\bot\txspec{S_\inputs}{n}{S_\outputs}j\bundle=\{((\mintette_i,\addrid_i)
\mapsto(\pk_i,\sig_i))\}_i\mintette\checktx(\tx) = 0\mintette \notin \owners(S_\outputs)\botd\gets 1\addrid\in S_\inputs\mintette'\in \owners(\addrid)(\mintette',\addrid)\in\bundle(\pk,\sig)\gets\bundle[(\mintette', \addrid)]d'\gets d\land H(\pk)\in\periodmintette{j}\break
~~~~~~~~~~\land \sigverify(\pk,(\tx,\addrid),\sig)d\gets 0d = 0\bot\utxo_\mintette\gets \utxo_\mintette\cup S_\outputs\txset_\mintette\gets \txset_\mintette\cup \{\tx\}(\pk_\mintette,\sigsign(\sk_\mintette,\tx))\committx\utxo\txset\txset\txset\periodtxset\utxo\txseth_\seq = H(a_\seq \| h_{\seq-1})a_\seqh_{\seq-1}\mintette\sig\randpick\sigsign(\sk_\mintette,(\tx_c,\addrid,h,\seq)h\sig\randpick\sigsign(\sk_\mintette,(\tx_c,\addrid))(\pk_\mintette,\sig,h,\seq)\alphayQF(k;N;p)Np\rho = F\left(
\frac{Q-1}{2}; Q; \alpha \right)\Pr[\text{secure}] =  \rho^yMQ\lfloor{M / Q}\rfloorTQMmnmQQ2(m+1)Q0.014 per hour as of August 2015).  We assigned three mintettes to each
shard of the transaction space, so a quorum of at least two was required for
the 2PC.  A different set of 25
servers on the same data center was used for stress testing and estimating
the peak throughput in terms of transactions per second. Each of those test
machines issued 1000 transactions consisting of two inputs and two outputs.
For wide area networking latency experiments we used a residential broadband
cable service and an Ubuntu 14.02.2 LTS Linux VM running on a 64-bit Windows
7 laptop with a \SI{2.4}{GHz} i7-4700MQ processor and \si{16}{GB} RAM.

\begin{table}
\small
\centering
\begin{tabular}{lS[table-format=7.2,group-separator={,}]S[table-format=4.2,group-separator={,}]}
    \toprule
    {\bf Benchmark} & { ()} & {} \\ \midrule
    {Hash} & 1017384.86 & 41054.93 \\
    {Sign} & 17043.63 & 2316.40 \\
    {Verify} & 4651.20 & 89.84 \\ \midrule
    {Check tx} & 3585.02 & 95.17 \\
    {Query msg} & 1358.31 & 120.20 \\
    {Commit msg} & 1006.49 & 31.66 \\
    \bottomrule
\end{tabular}
\caption{Micro-benchmarks at the mintettes}
\label{tab:micro}
\end{table}

Table~\ref{tab:micro} reports the mean rate and the standard deviation of
key operations we rely on for \rscoin.\footnote{All measurements were
    performed on a single thread on a single core, using a reactor pattern
    where networking was necessary.}
\emph{Hash}, \emph{Sign} and \emph{Verify} benchmark the number of basic
cryptographic operations each mintette can perform per second (including the
overhead of our library and Python runtime).

For the other benchmarks, we consider a single transaction with one input and
two outputs (we observe that as of September 2014, 53\% of Bitcoin
transactions
had this structure, so this is a reasonable proxy for real usage).
The \emph{check tx} benchmark then measures the rate at which
a mintette can parse and perform the cryptographic checks associated with this
transaction. This involves a single signature check, and thus its difference
from the \emph{Sign} benchmark largely represents the overhead of parsing and
of binary conversion in Python. Guided by this benchmark, we chose to
represent
ECDSA public keys using uncompressed coordinates due to orders-of-magnitude
slowdowns when parsing keys in compressed form.

The \emph{query msg} and \emph{commit msg} benchmarks measure the
rate at which each mintette can process the first and second message of the
2PC respectively for this transaction.
These include full de-serialization, checks from persistent storage of the
, cryptographic checks, updates to the , signing, and
serialization of responses. These benchmarks guided our design towards not
synchronizing to persistent storage the  before each response, and
relying instead on the quorum of mintettes to ensure correctness (a design
philosophy similar to
RAMCloud~\cite{DBLP:journals/cacm/OusterhoutAEKLMMNOPRRSS11}). Persisting to
storage before
responding to each request slowed these rates by orders of magnitude.

\begin{figure}[t!]
\centering
\begin{subfigure}[b]{0.9\linewidth}
\centering
\ifsinglecolumn{
\includegraphics[width=0.45\textwidth]{WAN-latency.pdf}
}\else{
\includegraphics[width=0.8\linewidth]{WAN-latency.pdf}
}\fi
\caption{Local area network (EC2)}
\label{fig:lanlatency}
\end{subfigure}
~
\begin{subfigure}[b]{0.9\linewidth}
\centering
\ifsinglecolumn{
\includegraphics[width=0.45\textwidth]{LAN-latency.pdf}
}\else{
\includegraphics[width=0.8\linewidth]{LAN-latency.pdf}
}\fi
\caption{Wide area network (Broadband)}
\label{fig:wanlatency}
\end{subfigure}
\caption{Latency, in seconds, to perform the 2PC to validate
a payment for a transaction with freshly issued coins as inputs (run 1), and
transactions with two arbitrary previous transactions as inputs (run 2).}
\label{fig:latency}
\end{figure}

Figure~\ref{fig:latency} illustrates the latency a client would experience
when interacting with the mintettes. Figure~\ref{fig:lanlatency}
illustrates the experiments with client machines within the data center, and
point to an intrinsic delay due to networking overheads and cryptographic
checks of less than 0.5 seconds. This includes both phases of the 2PC.

Over a wide area network the latency increases (Figure~\ref{fig:wanlatency}),
but under the conditions tested, the latency
is still usually well under a second for the full 2PC and all checks.  We
note that no shortcuts were implemented: for each transaction, all three
mintettes for each input were contacted and expected to respond in the first
phase, and all three mintettes responsible for the new transaction were
contacted and have to respond in the second phase. In reality, only a majority
need to respond before concluding each phase, and this may reduce latency
further.

\begin{figure}[t!]
\centering
\ifsinglecolumn{
\includegraphics[width=0.5\textwidth]{Throughput-60.pdf}
}\else{
\includegraphics[width=0.9\linewidth]{Throughput-60.pdf}
}\fi
\caption{Throughput (90 percentile and standard error), in
transactions per second, as a function of the number of mintettes, for
transactions with two freshly issued coins as inputs (run 1) and transactions
with two arbitrary previous transactions as inputs (run 2).}
\label{fig:throughput}
\end{figure}

Figure~\ref{fig:throughput} plots the throughput of the system as we increase
the number of mintettes from 2 to 30, under the load of 25 synthetic clients,
each pushing 1000 transactions.  As expected, when fewer than three mintettes
are available the throughput is roughly flat (fewer than 400 transactions per
second), as both phases of the 2PC need to contact all mintettes.  Once more
than the minimum of three mintettes are available the load is distributed
across them: the first phase need to access at most six mintettes (three
for each of the two transaction inputs), and the second phase at most three
mintettes. This load per transaction is independent of the number of mintettes
and as a result the throughput scales linearly, as predicted in
Section~\ref{sec:envelope-numbers}.  After the initial three mintettes, each
new mintette adds approximately 66 additional transactions per second to the
capacity of the system.

The gap between the micro-benchmarks relating to the message processing for
the two phases (1358.31~ and 1006.49 
respectively) and the rate of transactions observed under end-to-end
conditions (approximately 400 ) indicates that at this
point bandwidth, networking, or the interconnection with the process are
scaling bottlenecks for single mintettes. In particular no pipelining was
implemented as part of the client (although the mintettes support it) and thus
every request initiates a fresh TCP connection, with the slowdowns and
resource
consumption on the hosts that this entails.

\section{The \secrscoin System}\label{sec:system}

With our consensus protocol in place, we now describe the structure of
\rscoin,
focusing on the interaction between the mintettes and the central bank, and on
the overall parameters and properties of the system.  We first describe the
structure and usage of \rscoin
(Sections~\ref{sec:low-blocks} and~\ref{sec:high-blocks}) and then
address considerations that arise in how to allocate fees to mintettes
(Section~\ref{sec:role-bank}); overlay \rscoin on top of an existing
cryptocurrency like Bitcoin (Section~\ref{sec:embedding}); incentivize
mintettes to follow the consensus protocol and present a collectively
consistent ledger to the central bank
(Section~\ref{sec:incentives}); and set concrete choices for various
system parameters (Section~\ref{sec:parameters}).

\subsection{Lower-level blocks}\label{sec:low-blocks}

A lower-level block produced by a mintette  within 
looks like ,
where  is a hash,  is a collection of transactions, and
 is a signature from the mintette that produced this block.  The fourth
component  specifies the cross-chain property of lower-level
blocks (recall from Section~\ref{sec:auditability} that mintettes may
reference each others' blocks) by identifying the hashes of the other previous
blocks that are being referenced.

Denote by  the bank's public key and by  the
set of mintettes authorized by the bank in the previous higher-level block

(as described in Section~\ref{sec:high-blocks}), and define
 for .
Assuming the block  is produced in , to check that 
is valid one then checks that
\ben
\item ,
\item ,
\item  for some
, and
\item .
\een

To form a lower-level block, a mintette uses the transaction set  it
has formed throughout the epoch (as described in
Section~\ref{sec:basic-consensus}) and the hashes  that it
has
received from other mintettes (as ferried through the ``bundle of evidence''
described in Section~\ref{sec:auditability})
and creates ,
,
,
and .

\subsection{Higher-level blocks}\label{sec:high-blocks}

The higher-level block that marks the end of  looks like
, where these first three
values are similar to their counterparts in lower-level blocks (i.e., a hash,
a collection of transactions, and a signature), and the set

contains pairs ; i.e., the public
keys of the mintettes authorized for  and the bank's
signatures on the keys.

To check that a block is valid, one checks that
\ben
\item ,
\item , and
\item  for
all .
\een

To form a higher-level block, the bank must collate the inputs it is given by
the mintettes, which consist of the lower-level blocks described above and the
action logs described in Section~\ref{sec:auditability}.  To create a
consistent transaction set , a vigilant bank might need to look
through all of the transaction sets it receives to detect double-spending,
remove any conflicting transactions, and identify the mintette(s) responsible
for including them.  As this would require the bank to perform work
proportional
to the number of transactions (and thus somewhat obviate the reason for
mintettes), we
also consider an optimistic approach in which the bank relies on the consensus
protocol in Section~\ref{sec:consensus} and instead simply merges the
individual transaction sets to form .  The bank then forms , , and
creates the set of
authorized mintettes using a decision process we briefly discuss below and in
Section~\ref{sec:incentives}.

\subsubsection{Coin generation and fee allocation}\label{sec:role-bank}

In addition to this basic structure, each higher-level block could also
contain within  a special coin generation transaction and an
allocation
of fees to the mintettes that earned them in the previous period.
Semantically, the coin generation could take on the same structure as in
Bitcoin; i.e., it could be a transaction ,
where  is an address owned by the bank, and fees could be
allocated using a transaction ,
where
 represents the fees owed to .
The interesting question is thus not how central banks can allocate fees to
mintettes, but how it decides which mintettes have earned these fees.  In
fact, the provided action logs allow the central bank to identify active and
live mintettes and allocate fees to them appropriately.


This mechanism (roughly) works as follows.  The central bank keeps a tally
of the mintettes that were involved in certifying the validity of input
addresses; i.e., those that replied in the first phase of the consensus
protocol.  The choice to
reward input mintettes is deliberate: in addition to providing a direct
incentive for mintettes to respond in the first phase of the protocol, it
also provides an indirect incentive for mintettes to respond in the second
phase, as only a transaction output that is marked as unspent can later be
used as an input (for which the mintette can then earn fees).  Thus,
rewarding input mintettes provides incentive to handle a transaction
throughout its lifetime.

The action logs also play a crucial role in fee allocation.  In particular,
the
``exposed inactivity'' security property from Section~\ref{sec:auditability}
prevents an inactive mintette from
becoming active at a later time and claiming that it contributed to previous
transactions, as an examination of the action logs can falsify such claims.
Additionally, if fee allocation is determined on the basis of a known function
of the action logs, anyone with access to the action logs can audit the
actions of the central bank.

Finally, we mention that although the logs are sent only to the central bank,
the expectation is that the central bank will publish these logs to allow
anyone to audit the system, as well as the bank's operation.  As we assume the
central bank is honest, this
does not present a problem, but in a stronger threat model in which less trust
were placed in the central bank, one might instead attempt to adopt a
broadcast system for distributing logs (with the caveat that this approach
introduces significantly higher latency).  In such a setting, anyone with
access to the logs could verify not only the actions of the mintettes, but
could also replay these actions to compare the ledger agreed upon by the
mintettes and the ledger published by the bank; this would allow an auditor to
ensure that the bank was not engaging in misbehavior by, e.g.,
dropping transactions.

\subsubsection{A simplified block structure}\label{sec:embedding}

The above description of higher-level blocks (and the previous description of
lower-level blocks) contains a number of additional values that do not exist
in the blocks of existing cryptocurrencies, making \rscoin somewhat
incompatible with their semantics.  To demonstrate that \rscoin can more
strongly resemble these cryptocurrencies, we briefly describe a way of
embedding these additional values into the set of transactions.

Rather than include the set , the bank could instead
store some units of currency in a master address  and include in
 a transaction ,
where  is an address specific to .
The bank could then include in  a transaction

for each mintette  authorized for .
Now, to check the validity of a particular lower-level block, one could check
that such a transaction was included in the previous higher-level block.

\subsection{Incentivizing mintettes}\label{sec:incentives}

One might naturally imagine that this structure, as currently described,
places the significant burden on the central bank of having to merge the
distinct blocks from each mintette into a consistent history.  By providing
appropriate incentives, however, we can create an environment in which
the presented ledger is in fact consistent before the bank
even sees it.  If mintettes deviate from the expected behavior then, as we
described in Section~\ref{sec:role-bank}, they can be held accountable and
punished accordingly (e.g., not chosen for future periods or not given any
fees they have earned).

Section~\ref{sec:role-bank} describes one direct incentive for mintettes to
collect transactions, which is fees.  As we described in Section~\ref{sec:role-bank},
mintettes are rewarded only for \emph{active} participation, so that an
authorized mintette needs to engage with the system in order to earn
fees.
Section~\ref{sec:embedding} describes another direct incentive, which is the
authorization of mintettes by the central bank.  For semantic purposes, the
value  used to authorize each mintette for the next period
could be arbitrarily small.  As an incentive, however, this value
could be larger to directly compensate the mintettes for their services.


Finally, we expect that the central bank could be a national or international
entity that has existing relationships with, e.g., commercial banks.  There
thus
already exist strong business incentives and regulatory frameworks for such
entities to act as honest mintettes.

\subsection{Setting system parameters}\label{sec:parameters}

As described, the system is parameterized by a number of variables, such as
the length of epochs, the length of a period, and the number of
mintettes.
The length of an epoch for an individual mintette is entirely dependent on
the rate at which it processes transactions (as described in detail in
Section~\ref{sec:auditability}).  Mintettes that process more transactions
will therefore have shorter epochs than ones that do so less frequently.
There is no limit on how short an epoch can be, and the only
upper limit is that an epoch cannot last longer than a period.

It might seem desirable for periods to be as
short as possible, as ultimately a transaction is sealed into the official
ledger only at the end of a period.  To ease the burden on the bank, however,
it is also desirable to have longer periods, so that central banks have to
intervene as infrequently as possible (and, as we describe in
Section~\ref{sec:bloat}, so that central banks can potentially perform
certain optimizations to reduce transaction bloat).  In
Section~\ref{sec:basic-consensus}, we described
methods by which mintettes could ``promise'' (in an accountable way) to users
that their transactions would be included, so that in practice
near-instantaneous settlement can be achieved even with longer periods, so
long as one trusts the mintette quorum. Bitcoin,
Nevertheless, we do not expect periods to last longer than a day.

For the purposes of having a fair and competitive settlement process, it
is desirable to have as many mintettes as possible; as we saw in
Section~\ref{sec:envelope-numbers}, this is also desirable from a performance
perspective, as the performance of the \rscoin system
(measured in the rate of transactions processed) scales linearly with the
number of mintettes.  Adding more mintettes, however, also has the effect
that they earn less in transaction fees, so these opposing concerns must be
taken into account when settling on a concrete number (to give a very rough
idea, one number that has been suggested~\cite{boe-private} is 200).

\section{Optimizations and Extensions}\label{sec:extensions}

In Sections~\ref{sec:consensus} and~\ref{sec:system}, we presented a
(relatively) minimal version of \rscoin, which allows us to achieve the basic
integrity and scalability properties that are crucial for any currency
designed to be used on a global level.  Here, we briefly sketch some
extensions that could be adopted to strengthen either of these properties,
and leave a more detailed analysis of these or other solutions as interesting
future research.

\subsection{Pruning intermediate transactions}\label{sec:bloat}

At the end of a period, the central bank publishes a higher-level block
containing the collection of transactions that have taken place in that time
interval; it is only at this point that transactions are officially recorded
in the ledger.  Because mintettes provide evidence on a shorter time scale
that a user's transaction is valid and will be included in the ledger,
however,
users might feel more comfortable moving currency multiple times
within a period than in traditional cryptocurrencies (in which one must wait
for one or several blocks to avoid possible double-spending).

It therefore might be the case that at the end of a period, the central bank
sees not just individual transactions, but
potentially multiple ``hops'' or even whole ``chains'' of transactions.  To
limit \emph{transaction bloat}, the bank could thus prune these intermediate
transactions at the end of the period, so that ultimately only the start and
end points of the transaction appear in the ledger, in a new transaction
signed by the central bank.

On its surface, this idea may seem to require a significant amount of trust in
the central bank, as it could now actively modify the transaction history.
The action logs, however, would reveal the changes that the bank had made and
allow users to audit its behavior, but nevertheless the alterations that could
be made would need be significantly restricted.

\subsection{Further incentives for honest behavior}

In addition to the existing incentives for honest behavior outlined in
Sections~\ref{sec:role-bank} and~\ref{sec:incentives}, mintettes could adopt
a sort of proof-of-stake mechanism, in which they escrow some units
of currency with the central bank and are allowed to collate only a
set of transactions whose collective value does not exceed the escrowed value.
If any issue then arises with the transactions produced by the
mintette (e.g., it has accepted double-spending transactions), the central
bank can seize the escrowed value and remove the double-spending transactions,
so the mintette ultimately pays for this misbehavior out of its own pocket
(and maybe even pays additional fines).

This mechanism as described is not fully robust (as in particular the mintette
might accept many expenditures of the same unit of currency, not just
two), but it does have an interesting effect on the length of periods.  In
particular, the length of earlier periods will necessarily
be quite small, as mintettes will not have much capital to post.  As
mintettes accumulate stores of currency, however, periods can grow longer.
This is a fairly natural process, as it also allows for a trial period in the
beginning to ensure that authorized mintettes don't misbehave, and
then for a more stable system as a set of trustworthy mintettes emerges.


\subsection{Multiple banks and foreign exchange}\label{sec:multiple-banks}

In a global setting, one might imagine that each central
bank could develop their own version of \rscoin; this would lead, however, to
a landscape much the same as today's Bitcoin and the many altcoins
it has inspired, in which multiple implementations of a largely overlapping
structure lead to an \emph{infrastructure fragmentation}: bugs are
replicated across codebases and compatibility across different altcoins is
artificially low.

An attractive approach is for different central banks to instead use the same
platform, to prevent this fragmentation and to allow users to seamlessly store
value in many different currencies.  While this allows the currencies
generated
by different central banks to achieve some notion of interoperability, we
still
expect that different blockchains will be kept separate; i.e., a particular
central bank does not\dash and should not\dash have to keep track of
all transactions that are denominated in the currency of another central bank.
(Mintettes, however, may choose to validate transactions for any number of
central banks, depending on their business interests.)

While every central bank does not necessarily
need to be aware of transactions denominated in the currency of another
central bank, this awareness may at times be desirable.  For example, if a
user would like to exchange some units of one currency into another belonging
to a central bank that is relatively known to and trusted by the first (e.g.,
exchange GBP for USD), then this should be a relatively easy process.  The
traditional approach is to simply go to a third-party service that holds units
of both currencies, and then perform one transaction to send units of the
first currency to the service, which will show up in the ledger of the
first currency, and another transaction to receive units of the second
currency, which will show up in the ledger of the second currency.  

Although this is the approach by far most commonly adopted in practice (both
in fiat currency and cryptocurrency markets), it has
a number of limitations, first and foremost of which is that it is completely
opaque: even an outside observer who is able to observe both ledgers sees two
transactions that are not linked in any obvious way.  One might naturally
wonder, then, if a more \emph{transparent} mechansim is possible, in which the
currency exchange shows up as such in the ledger.
We answer this question in the affirmative in the Appendix,
in which we demonstrate a form of \emph{fair exchange}.

Briefly, to achieve this fair exchange, we adapt a protocol to
achieve \emph{atomic cross-chain trading},\footnote{The clearest explanation
    of this for Bitcoin, by Andrew Miller, can be found
    at \url{bitcointalk.org/index.php?topic=193281.msg3315031\#msg3315031}.}
which provides a Bitcoin-compatible
way for two users to \emph{fairly} exchange units of one currency for some
appropriate units of another currency; i.e., to exchange currency in a way
that guarantees that either the exchange is successful or both users end up
with nothing (so in particular it cannot be the case that one user reclaims
currency and the other does not).  If one is less concerned about
compatibility with Bitcoin, then a slightly simpler approach such as ``pay on
reveal secret''~\cite{cross-chain-exchange} could be adopted.

To fit our setting, in which central banks may want to maintain some control
over which other currencies their currency is traded into and out of (and in
what volume), we modify the existing protocol to require a third party to sign
both transactions only if they are denominated in currencies that are viewed
as ``exchangeable'' by that party.  This serves to not only signal the third
party's blessing of the exchange, but also to bind the two transactions
together across their respective blockchains.  Our proposal of this protocol
thus enables transparent exchanges that can be approved by a third party, but
does not (and cannot) prevent exchanges from taking place without this
approval.
Importantly, however, an auditor can now\dash with access to both
blockchains\dash observe the exchange.

\section{Conclusions}

In this paper, we have presented the first cryptocurrency framework, \rscoin,
that provides the control over monetary policy that entities such as central
banks expect to retain.  By constructing a blockchain-based approach that
makes
relatively minimal alterations to the design of successful cryptocurrencies
such
as Bitcoin, we have demonstrated that this centralization can be achieved
while
still maintaining the transparency guarantees that have made
(fully) decentralized cryptocurrencies so attractive.  We have also
proposed a new consensus mechanism based on 2PC and
measured its performance, illustrating that centralization of some authority
allows
for a more scalable system to prevent double spending that completely avoids
the wasteful hashing required in proof-of-work-based systems.


\ifproceedings{
\section*{Acknowledgements}

We thank Robleh Ali, Simon Scorer, Alex Mitchell, and John Barrdear from the
Bank of England and Ben Laurie from Google for interesting discussions.  We
also thank our anonymous reviewers and our shepherd, Joseph Bonneau, for their
helpful feedback.  George Danezis is supported in part by EPSRC Grant EP/M013286/1 and H2020 Grant PANORAMIX (ref.\ 653497)
and Sarah Meiklejohn is supported in part by
EPSRC Grant EP/M029026/1.}\fi

{
\balance
\bibliographystyle{IEEEtranS}
\begin{flushleft}
\begin{thebibliography}{10}
\providecommand{\url}[1]{#1}
\csname url@samestyle\endcsname
\providecommand{\newblock}{\relax}
\providecommand{\bibinfo}[2]{#2}
\providecommand{\BIBentrySTDinterwordspacing}{\spaceskip=0pt\relax}
\providecommand{\BIBentryALTinterwordstretchfactor}{4}
\providecommand{\BIBentryALTinterwordspacing}{\spaceskip=\fontdimen2\font plus
\BIBentryALTinterwordstretchfactor\fontdimen3\font minus
  \fontdimen4\font\relax}
\providecommand{\BIBforeignlanguage}[2]{{\expandafter\ifx\csname l@#1\endcsname\relax
\typeout{** WARNING: IEEEtranS.bst: No hyphenation pattern has been}\typeout{** loaded for the language `#1'. Using the pattern for}\typeout{** the default language instead.}\else
\language=\csname l@#1\endcsname
\fi
#2}}
\providecommand{\BIBdecl}{\relax}
\BIBdecl

\bibitem{babaioff}
M.~Babaioff, S.~Dobzinski, S.~Oren, and A.~Zohar, ``On {Bitcoin} and red
  balloons,'' \emph{SIGecom Exchanges}, vol.~10, no.~3, pp. 56â€“--73, 2011.

\bibitem{boe-private}
{Bank of England}, Private communication, 2015.

\bibitem{boe-agenda}
------, ``One bank research agenda,'' 2015,
  \url{www.bankofengland.co.uk/research/Documents/onebank/discussion.pdf}.

\bibitem{DBLP:conf/sp/Ben-SassonCG0MTV14}
E.~Ben{-}Sasson, A.~Chiesa, C.~Garman, M.~Green, I.~Miers, E.~Tromer, and
  M.~Virza, ``Zerocash: Decentralized anonymous payments from bitcoin,'' in
  \emph{2014 {IEEE} Symposium on Security and Privacy, {SP} 2014, Berkeley,
CA,
  USA, May 18-21, 2014}.\hskip 1em plus 0.5em minus 0.4em\relax {IEEE}
Computer
  Society, 2014, pp. 459--474.

\bibitem{fed-on-bitcoin}
B.~Bernanke, Nov. 2013,
  \url{qz.com/148399/ben-bernanke-bitcoin-may-hold-long-term-promise/}.

\bibitem{bitcoin-sok}
J.~Bonneau, A.~Miller, J.~Clark, A.~Narayanan, J.~A. Kroll, and E.~W. Felten,
  ``Research perspectives and challenges for {Bitcoin} and cryptocurrencies,''
  in \emph{Proceedings of the IEEE Symposium on Security and Privacy}, 2015.

\bibitem{DBLP:conf/ccs/DanezisFKP13}
G.~Danezis, C.~Fournet, M.~Kohlweiss, and B.~Parno, ``Pinocchio coin: building
  zerocoin from a succinct pairing-based proof system,'' in \emph{PETShop'13,
  Proceedings of the 2013 {ACM} Workshop on Language Support for
  Privacy-Enhancing Technologies, Co-located with {CCS} 2013, November 4,
2013,
  Berlin, Germany}, M.~Franz, A.~Holzer, R.~Majumdar, B.~Parno, and H.~Veith,
  Eds.\hskip 1em plus 0.5em minus 0.4em\relax {ACM}, 2013, pp. 27--30.

\bibitem{ecb-on-bitcoin}
{European Central Bank}, ``Virtual currency schemes - a further analysis,''
  Feb. 2015,
  \url{www.ecb.europa.eu/pub/pdf/other/virtualcurrencyschemesen.pdf}.

\bibitem{selfish-mining}
I.~Eyal and E.~G. Sirer, ``Majority is not enough: {Bitcoin} mining is
  vulnerable,'' in \emph{Proceedings of Financial Cryptography 2014}, 2014.

\bibitem{EC:GarKiaLeo15}
J.~Garay, A.~Kiayias, and N.~Leonardos, ``The {Bitcoin} backbone protocol:
  Analysis and applications,'' in \emph{Proceedings of Eurocrypt 2015}, 2015.

\bibitem{is-bitcoin-decentralized}
A.~Gervais, G.~O. Karame, S.~Capkun, and V.~Capkun, ``Is {Bitcoin} a
  decentralized currency?'' \emph{IEEE Security \& Privacy}, vol.~12, pp.
  54--60, 2014.

\bibitem{DBLP:conf/eurocrypt/GrothK15}
J.~Groth and M.~Kohlweiss, ``One-out-of-many proofs: Or how to leak a secret
  and spend a coin,'' in \emph{Advances in Cryptology - {EUROCRYPT} 2015 -
34th
  Annual International Conference on the Theory and Applications of
  Cryptographic Techniques, Sofia, Bulgaria, April 26-30, 2015, Proceedings,
  Part {II}}, ser. Lecture Notes in Computer Science, E.~Oswald and
  M.~Fischlin, Eds., vol. 9057.\hskip 1em plus 0.5em minus 0.4em\relax
  Springer, 2015, pp. 253--280.

\bibitem{uk-on-banking}
{HM Treasury}, ``Digital currencies: response to the call for information,''
  Mar. 2015,
  \url{www.gov.uk/government/uploads/system/uploads/attachment_data/file/414040/digital_currencies_response_to_call_for_information_final_changes.pdf}.

\bibitem{johnson}
B.~Johnson, A.~Laszka, J.~Grossklags, M.~Vasek, and T.~Moore, ``Game-theoretic
  analysis of {DDoS} attacks against {Bitcoin} mining pools,'' in
  \emph{Workshop on Bitcoin Research}, 2014.

\bibitem{kac:bitcoin:ccs12}
G.~Karame, E.~Androulaki, and S.~Capkun, ``{Double-Spending Fast Payments in
  {Bitcoin}},'' in \emph{Proceedings of ACM CCS 2012}, 2012.

\bibitem{DBLP:conf/fc/Kasper11}
E.~K{\"{a}}sper, ``Fast elliptic curve cryptography in openssl,'' in
  \emph{Financial Cryptography and Data Security - {FC} 2011 Workshops,
{RLCPS}
  and {WECSR} 2011, Rodney Bay, St. Lucia, February 28 - March 4, 2011,
Revised
  Selected Papers}, ser. LNCS, G.~Danezis, S.~Dietrich, and K.~Sako, Eds.,
vol.
  7126.\hskip 1em plus 0.5em minus 0.4em\relax Springer, 2011, pp. 27--39.

\bibitem{kroll}
J.~A. Kroll, I.~C. Davey, and E.~W. Felten, ``The economics of {Bitcoin}
  mining, or {Bitcoin} in the presence of adversaries,'' in \emph{Proceedings
  of WEIS 2013}, 2013.

\bibitem{laszka}
A.~Laszka, B.~Johnson, and J.~Grossklags, ``When {Bitcoin} mining pools run
  dry: A game-theoretic analysis of the long-term impact of attacks between
  mining pools,'' in \emph{Workshop on Bitcoin Research}, 2015.

\bibitem{lauriecoin}
B.~Laurie, ``An efficient distributed currency,'' 2011,
  \url{www.links.org/files/distributed-currency.pdf}.

\bibitem{DBLP:journals/cacm/Laurie14}
------, ``Certificate transparency,'' \emph{Commun. {ACM}}, vol.~57, no.~10,
  pp. 40--46, 2014.

\bibitem{verifiers-dilemma}
L.~Luu, J.~Teutsch, R.~Kulkarni, and P.~Saxena, ``Demystifying incentives in
  the consensus computer,'' in \emph{Proceedings of ACM CCS 2015}, 2015, to
  appear.

\bibitem{stellar-consensus}
D.~Mazi{\`e}res, ``The {Stellar} consensus protocol: a federated model for
  {Internet}-level consensus,'' 2015,
  \url{www.stellar.org/papers/stellar-consensus-protocol.pdf}.

\bibitem{DBLP:conf/sp/MiersG0R13}
\BIBentryALTinterwordspacing
I.~Miers, C.~Garman, M.~Green, and A.~D. Rubin, ``Zerocoin: Anonymous
  distributed e-cash from bitcoin,'' in \emph{2013 {IEEE} Symposium on
Security
  and Privacy, {SP} 2013, Berkeley, CA, USA, May 19-22, 2013}.\hskip 1em plus
  0.5em minus 0.4em\relax {IEEE} Computer Society, 2013, pp. 397--411.
  [Online]. Available: \url{http://dx.doi.org/10.1109/SP.2013.34}
\BIBentrySTDinterwordspacing

\bibitem{permacoin}
A.~Miller, A.~Juels, E.~Shi, B.~Parno, and J.~Katz, ``Permacoin: Repurposing
  {Bitcoin} work for data preservation,'' in \emph{Proceedings of the IEEE
  Symposium on Security and Privacy}, 2014.

\bibitem{satoshi-bitcoin}
S.~Nakamoto, ``{Bitcoin: A Peer-to-Peer Electronic Cash System},'' 2008,
  \url{bitcoin.org/bitcoin.pdf}.

\bibitem{bitcoin-textbook}
\BIBentryALTinterwordspacing
A.~Narayanan, J.~Bonneau, E.~Felten, A.~Miller, and S.~Goldfeder,
\emph{Bitcoin
  and cryptocurrency technologies}. [Online]. Available:
  \url{piazza.com/princeton/spring2015/btctech/resources}
\BIBentrySTDinterwordspacing

\bibitem{nasdaq}
Nasdaq, ``Nasdaq launches enterprise-wide blockchain technology initiative,''
  May 2015,
  \url{www.nasdaq.com/press-release/nasdaq-launches-enterprisewide-blockchain-technology-initiative-20150511-00485}.

\bibitem{jpmorgan}
\BIBentryALTinterwordspacing
D.~O'Leary, V.~D'Agostino, S.~R. Re, J.~Burney, and A.~Hoffman, ``Method and
  system for processing {Internet} payments using the electronic funds
transfer
  network,'' Nov. 2013. [Online]. Available:
  \url{www.google.com/patents/US20130317984}
\BIBentrySTDinterwordspacing

\bibitem{DBLP:journals/cacm/OusterhoutAEKLMMNOPRRSS11}
J.~K. Ousterhout, P.~Agrawal, D.~Erickson, C.~Kozyrakis, J.~Leverich,
  D.~Mazi{\`{e}}res, S.~Mitra, A.~Narayanan, D.~Ongaro, G.~M. Parulkar,
  M.~Rosenblum, S.~M. Rumble, E.~Stratmann, and R.~Stutsman, ``The case for
  ramcloud,'' \emph{Commun. {ACM}}, vol.~54, no.~7, pp. 121--130, 2011.

\bibitem{DBLP:journals/computer/RaynalS96}
M.~Raynal and M.~Singhal, ``Logical time: Capturing causality in distributed
  systems,'' \emph{{IEEE} Computer}, vol.~29, no.~2, pp. 49--56, 1996.

\bibitem{meni:double-spending:2012}
M.~Rosenfeld, ``Analysis of hashrate-based double-spending,'' Dec. 2012,
  \url{bitcoil.co.il/Doublespend.pdf}.

\bibitem{ripple-consensus}
D.~Schwartz, N.~Youngs, and A.~Britto, ``The {Ripple} protocol consensus
  algorithm,'' 2014, \url{ripple.com/files/ripple_consensus_whitepaper.pdf}.

\bibitem{cross-chain-exchange}
T.~Young, ``Atomic cross-chain exchange,'' 2014,
  \url{upcoder.com/11/atomic-cross-chain-exchange/}.

\end{thebibliography}

\end{flushleft}
}


\appendix

\section{Fair Currency Exchange}\label{sec:fair-fx}

\begin{figure*}[t]
\begin{framed}
\centering
{\footnotesize
\xymatrix@R0.1pc@C0.1pc{
\underline{\tbf{A}} & \underline{\tbf{C}(c,\pk,\sig,m)} &
\underline{\tbf{B}}\\
x\randpick D; h\gets H(x); h_2\gets H(c_2) &
    \trm{if } \sigverify(\pk,m,\sig)=0 \trm{ return } \bot &
    h_1\gets H(c_1)\\
(\addr,\tx_1)\gets\spendtx((h,h_2),m,\currencypk{A}{c_1},\currencypk{B}{c_1},
    \currencypk{C}{c_1}) & \trm{else return } \sigsign(\currencysk{C}{c},m)
    \ar@/^3.2pc/[lddd]^----*---[flip][@]{\sig_C}
    \ar@/_5.7pc/[rddddddddd]^----*---[@]{\sig_C'}&\\
\tx_2\gets\refundtx(m,\addr,\currencypk{A}{c_1}) &&\\
\sig_A\randpick\sigsign(\currencysk{A}{c_1},\tx_2)
    \ar@/_2.5pc/[ruu]&&\\
\trm{if }\sigverify(\currencypk{C}{c_1},\tx_2,\sig_C) = 0 \trm{ return }\bot
    \ar[rr]^-{\tx_2,\sig_A,\sig_C} &&
\trm{if }\sigverify(\currencypk{C}{c_1},\tx_2,\sig_A) = 0\trm{ return } \bot\\
&&\trm{if }\sigverify(\currencypk{A}{c_1},\tx_2,\sig_C) = 0\trm{ return }
\bot\\
\trm{if  return } &&
    \ar[ll]_-{\sig_B}\sig_B\randpick\sigsign(\currencysk{B}{c_1},\tx_2)\\
\trm{add  to  blockchain} &&
(\addr,\tx_3)\gets\spendtx((h,h_1),n,\currencypk{B}{c_2},\currencypk{A}{c_2},
    \currencypk{C}{c_2})\\
&& \tx_4\gets\refundtx(n,\addr,\currencypk{B}{c_2})\\
&&\ar@/^4.8pc/[luuuuuuuu]
    \sig_B'\randpick\sigsign(\currencysk{B}{c_2},\tx_4)\\
\trm{if } \sigverify(\currencypk{C}{c_2},\tx_4,\sig_B') = 0\trm{ return }\bot
    && \ar[ll]_-{\tx_4,\sig_B',\sig_C'}
    \trm{if } \sigverify(\currencypk{C}{c_2},\tx_4,\sig_C')=0\trm{ return
}\bot\\
\trm{if } \sigverify(\currencypk{B}{c_2},\tx_4,\sig_C') = 0\trm{ return }\bot
&&\\
\sig_A'\randpick\sigsign(\currencysk{A}{c_2},\tx_4) \ar[rr]^-{\sig_A'} &&
    \trm{if  return
    }\\
&& \trm{add  to  blockchain}\\
&\vdots&\\
\trm{before : spend  using } \ar@{-->}[rr]^-{x} &&
    \trm{before : spend  using }\\
& \vdots & \\
\trm{after : refund  using } & &
    \trm{after : refund  using }
}
}
\end{framed}
\caption{A method for  and  to\dash with the approval of a third party
\dash exchange  units of currency  for  units of currency 
in a fair manner; i.e., in a way such that if either  or  stops
participating at any point in the interaction, the other party loses nothing.}
\label{fig:fx}
\end{figure*}

In Section~\ref{sec:multiple-banks}, we described a protocol for atomic
trading of different currencies and outlined some of its features, such as
allowing trade only across authorized currencies (as determined by some third
party).  Our formal protocol that achieves this fair exchange is presented
in Figure~\ref{fig:fx}.

Informally, if Alice and Bob wish to exchange  units of currency 
for  units of currency ,
with the blessing of a third party Carol, then they each create two types of
transactions: a ``spend'' transaction, in which the sender releases the units
of currency to one of two addresses, and a ``refund'' transaction, in which
the sender can reclaim the currency after a certain amount of time has passed.
The two addresses in Alice's spend transactions are a
``multi-signature'' address from which funds can be released only with the
signatures of Alice, Bob, and Carol, or Bob's address, from which he can spend
the funds only with knowledge of the pre-image of some hash .  Her
refund transaction then sends the currency back to Alice's address if
signatures are provided by all three parties, and if an
appropriate amount of time  has elapsed since the spend transaction was
accepted into the blockchain.  Similarly, Bob's spend transaction requires
Alice to present the pre-image  in order to redeem the funds, and his
refund transaction can be spent only after some time  has passed.



Alice begins by creating her spend and refund transactions, as well as picking
the value  and computing .  She then ``commits'' to the currency
 being traded with using a second hash  and sends the
refund transaction, signed by herself, to Carol.  If Carol is satisfied with
the proposed exchange, she can sign the transaction and give this signature to
Alice.  Alice now solicits a signature from Bob; once she has signatures from
both Bob and Carol, she now has a transaction that she can use to refund her
currency after time  has passed.  Thus, it is safe for her to publish the
spend transaction in the blockchain for .  Bob then follows suit by
creating his own spend and refund transactions, soliciting signatures from
Alice and Carol, and publishing his spend transaction once he has a valid
refund transaction that he can use if necessary.

Once both transactions are accepted into their respective blockchains,
Alice\dash who so far is the only one with knowledge of the pre-image \dash
can redeem the  units of currency  using Bob's spend transaction;
in doing so, she implicitly reveals .  Thus, Bob can now redeem the 
units of currency  using Alice's spend transaction and the exchange is
complete.  If Alice does not redeem Bob's spend transaction, then after time
 Bob can use his refund transaction to redeem the currency himself (so
it is important that ).

\end{document}
