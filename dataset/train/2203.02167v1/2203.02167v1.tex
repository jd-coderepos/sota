\pdfoutput=1


\documentclass[11pt]{article}

\usepackage[]{acl}

\usepackage{times}
\usepackage{latexsym}
\usepackage{booktabs}
\usepackage{bm}
\usepackage{bbm}

\usepackage[T1]{fontenc}


\usepackage[utf8]{inputenc}
\usepackage[hang,flushmargin]{footmisc}

\usepackage{microtype}
\usepackage{amsmath}
\usepackage{tabularx}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{textcomp}



\title{SimKGC: Simple Contrastive Knowledge Graph Completion with \\ Pre-trained Language Models}

\author{Liang Wang\thanks{\ \ Work done while at Yuanfudao AI Lab.} \and Wei Zhao \and Zhuoyu Wei \and Jingming Liu \\
        Microsoft Research Asia \\
        Yuanfudao AI Lab, Beijing, China \\
    {\tt wangliang@microsoft.com} \\ {\tt \{zhaowei01,weizhuoyu,liujm\}@yuanfudao.com} \\}

\begin{document}
\maketitle
\begin{abstract}
Knowledge graph completion (KGC) aims to reason over known facts
and infer the missing links.
Text-based methods such as KG-BERT ~\citep{yao2019kg}
learn entity representations from natural language descriptions,
and have the potential for inductive KGC.
However,
the performance of text-based methods still largely lag behind
graph embedding-based methods
like TransE ~\citep{bordes2013translating} and RotatE ~\citep{sun2018rotate}.
In this paper,
we identify that the key issue is efficient contrastive learning.
To improve the learning efficiency,
we introduce three types of negatives:
in-batch negatives,
pre-batch negatives,
and self-negatives which act as a simple form of hard negatives.
Combined with InfoNCE loss,
our proposed model SimKGC can substantially outperform embedding-based methods
on several benchmark datasets.
In terms of mean reciprocal rank (MRR),
we advance the state-of-the-art by +19\% on WN18RR,
+6.8\% on the Wikidata5M transductive setting,
and +22\% on the Wikidata5M inductive setting.
Thorough analyses are conducted to gain insights into each component.
Our code is available at ~\url{https://github.com/intfloat/SimKGC}.
\end{abstract}

\section{Introduction}
Large-scale knowledge graphs (KGs) are important components for knowledge-intensive applications,
such as question answering ~\citep{sun-etal-2019-pullnet},
recommender systems ~\citep{Huang2018ImprovingSR},
and intelligent conversational agents ~\citep{Dinan2019WizardOW} etc.
KGs usually consist of a set of triples (, , ),
where  is the head entity,  is the relation, and  is the tail entity.
Popular public KGs include Freebase ~\citep{bollacker2008freebase},
Wikidata ~\citep{vrandevcic2014wikidata},
YAGO ~\citep{suchanek2007yago},
ConceptNet ~\citep{speer2017conceptnet},
and WordNet ~\citep{miller1995wordnet} etc.
Despite their usefulness in practice,
they are often incomplete.
Knowledge graph completion (KGC) techniques are necessary for the automatic construction
and verification of knowledge graphs.

\begin{figure}[ht]
\begin{center}
 \includegraphics[width=0.95\linewidth]{./images/kg.pdf}
 \caption{An example of knowledge graph.
 Each entity has its name and textual descriptions.}
 \label{fig:kg}
\end{center}
\end{figure}

Existing KGC methods can be categorized into two families:
embedding-based and text-based methods.
Embedding-based methods map each entity and relation into a low-dimensional vector,
without using any side information such as entity descriptions.
This family includes TransE ~\citep{bordes2013translating}, TransH ~\citep{wang2014knowledge},
RotatE ~\citep{sun2018rotate}, and TuckER ~\citep{balazevic-etal-2019-tucker} etc.
By comparison,
text-based methods ~\citep{yao2019kg,xie2016representation,wang2021kepler}
incorporate available texts for entity representation learning,
as shown in Figure ~\ref{fig:kg}.
Intuitively,
text-based methods should outperform embedding-based counterparts
since they have access to additional input signals.
However,
results on popular benchmarks (e.g., WN18RR, FB15k-237, Wikidata5M)
tell a different story:
text-based methods still lag behind even with pre-trained language models.

We hypothesize that the key issue for such performance degradation
is the inefficiency in contrastive learning.
Embedding-based methods do not involve the expensive computation of text encoders
and thus can be extremely efficient to train with a large negative sample size.
For example,
the default configuration of RotatE ~\footnote{\url{https://github.com/DeepGraphLearning/graphvite}}
trains  epochs with a negative sample size of  on the Wikidata5M dataset.
While the text-based method KEPLER ~\citep{wang2021kepler}
can only train  epochs with a negative sample size of 
due to the high computational cost incurred by RoBERTa.

In this paper,
inspired by the recent progress on contrastive learning,
we introduce three types of negatives to improve the text-based KGC method:
in-batch negatives,
pre-batch negatives,
and self-negatives.
By adopting bi-encoder instead of cross-encoder ~\citep{yao2019kg} architecture,
the number of in-batch negatives can be increased by using a larger batch size.
Vectors from previous batches are cached and act as pre-batch negatives ~\citep{karpukhin-etal-2020-dense}.
Additionally,
mining hard negatives can be beneficial for improving contrastive learning.
We find that the head entity itself can serve as hard negatives,
which we call ``self-negatives''.
As a result,
the negative sample size can be increased to the scale of thousands.
We also propose to change the loss function from margin-based ranking loss to InfoNCE,
which can make the model focus on hard negatives.

One advantage of text-based methods is that
they enable inductive entity representation learning.
Entities that are not seen during training can still be appropriately modeled,
while embedding-based methods like TransE can only reason under the transductive setting
~\footnote{All entities in the test set also appear in the training set.}.
Inductive knowledge graph completion is important in the real world
as new entities are coming out every day.
Moreover,
text-based methods can leverage state-of-the-art pre-trained language models to learn better representations.
A line of recent work ~\citep{shin-etal-2020-autoprompt,petroni-etal-2019-language}
attempts to elicit the implicitly stored knowledge from BERT.
The task of KGC can also be regarded as a way to retrieve such knowledge.

Two entities are more likely to be related
if connected by a short path in the graph.
Empirically,
we find that text-based models heavily rely on the semantic match
and ignore such topological bias to some degree.
We propose a simple re-ranking strategy
by boosting the scores of the head entity's -hop neighbors.

We evaluate our proposed model SimKGC
by conducting experiments on three popular benchmarks:
WN18RR, FB15k-237, and Wikidata5M (both transductive and inductive settings).
According to the automatic evaluation metrics (MRR, Hits@\{1,3,10\}),
SimKGC outperforms state-of-the-art methods by a large margin
on the WN18RR (MRR ),
Wikidata5M transductive setting (MRR ),
and inductive setting (MRR ).
On the FB15k-237 dataset,
our results are also competitive.
To help better understand our proposed method,
we carry out a series of analyses
and report human evaluation results.
Hopefully,
SimKGC will facilitate the future development of better KGC systems.

\section{Related Work}

\noindent
\textbf{Knowledge Graph Completion }
involves modeling multi-relational data
to aid automatic construction of large-scale KGs.
In translation-based methods
such as TransE ~\citep{bordes2013translating} and TransH ~\citep{wang2014knowledge},
a triple (, , ) is a relation-specific translation
from the head entity  to tail entity .
Complex number embeddings are introduced by ~\citet{trouillon2016complex}
to increase the model's expressiveness.
RotatE ~\citep{sun2018rotate} models a triple as relational rotation in complex space.
~\citet{nickel2011three,balazevic-etal-2019-tucker} treat KGC as a 3-D binary tensor factorization problem
and investigate the effectiveness of several factorization techniques.
Some methods attempt to incorporate entity descriptions.
DKRL ~\citep{xie2016representation} uses a CNN to encode texts,
while KG-BERT ~\citep{yao2019kg}, StAR ~\citep{wang2021structure}, and BLP ~\citep{daza2021inductive}
both adopt pre-trained language models to compute entity embeddings.
GraIL ~\citep{Teru2020InductiveRP} and BERTRL ~\citep{Zha2021InductiveRP}
conduct inductive relation prediction by utilizing subgraph or path information.
In terms of benchmark performance ~\citep{wang2021kepler},
text-based methods still underperform methods like RotatE.
\newline

\noindent
\textbf{Pre-trained Language Models }
including BERT ~\citep{devlin-etal-2019-bert},
GPT ~\citep{radford2018improving}, and T5 ~\citep{Raffel2020ExploringTL}
have led to a learning paradigm shift in NLP.
Models are first pre-trained on large amounts of unlabeled text corpora
with language modeling objectives,
and then fine-tuned on downstream tasks.
Considering their good performance in few-shot and
even zero-shot scenarios ~\citep{Brown2020LanguageMA},
one interesting question is:
``Can pre-trained language models be
used as knowledge bases?''
~\citet{petroni-etal-2019-language} proposed to probe language models
with manually designed prompts.
A series of following work ~\citep{shin-etal-2020-autoprompt,zhong2021factual,jiang-etal-2020-know}
focus on finding better prompts
to elicit the knowledge implicitly stored in the model parameters.
Another line of work ~\citep{zhang-etal-2019-ernie,liu2020k,wang2021kepler}
injects symbolic knowledge into language model pre-training,
and shows some performance boost on several knowledge-intensive tasks.
\newline

\noindent
\textbf{Contrastive Learning }
learns useful representations by contrasting
between positives and negatives ~\citep{le2020contrastive}.
The definitions of positives and negatives are task-specific.
In self-supervised vision representation learning
~\citep{chen2020simple,he2020momentum,grill2020bootstrap},
a positive pair is two augmented views of the same image,
while a negative pair is two augmented views of different images.
Recently,
contrastive learning paradigm has witnessed great successes
in many different fields,
including multi-modal pre-training ~\citep{radford2021learning},
video-text retrieval ~\citep{Liu2021HiTHT},
and natural language understanding ~\citep{gunel2020supervised} etc.
In the NLP community,
by leveraging the supervision signals from natural language inference data ~\citep{gao2021simcse},
QA pairs ~\citep{ni2021sentence},
and parallel corpora ~\citep{Wang2021AligningCS},
these methods have surpassed non-contrastive methods ~\citep{Reimers2019SentenceBERTSE}
on semantic similarity benchmarks.
~\citet{karpukhin-etal-2020-dense,qu-etal-2021-rocketqa,xiong2020approximate}
adopt contrastive learning to improve dense passage retrieval
for open-domain question answering,
where the positive passages are the ones containing the correct answer.

\section{Methodology}

\subsection{Notations}

A knowledge graph  is a directed graph,
where the vertices are entities ,
and each edge can be represented as a triple (,,),
where , , and  correspond to
head entity, relation, and tail entity, respectively.
The link prediction task of KGC is to infer the missing triples given an incomplete .
Under the widely adopted entity ranking evaluation protocol,
tail entity prediction (, , ) requires ranking all entities given  and ,
similarly for head entity prediction (, , ).
In this paper,
for each triple (,,),
we add an inverse triple (,,),
where  is the inverse relation of .
Based on such reformulation,
we only need to deal with the tail entity prediction problem ~\citep{Malaviya2020CommonsenseKB}.

\subsection{Model Architecture} ~\label{sec:arch}

Our proposed model SimKGC adopts a bi-encoder architecture.
Two encoders are initialized with the same pre-trained language model
but do not share parameters.

Given a triple (,,),
the first encoder BERT is used to compute
the relation-aware embedding for the head entity .
We first concatenate the textual descriptions of entity 
and relation  with a special symbol [SEP] in between.
BERT is applied to get the last-layer hidden states.
Instead of directly using the hidden state of the first token,
we use mean pooling followed by L normalization
to get the relation-aware embedding ,
as mean pooling has been shown to result in
better sentence embeddings ~\citep{gao2021simcse,Reimers2019SentenceBERTSE}.
 is relation-aware
since different relations will have different inputs
and thus have different embeddings,
even though the head entity is the same.

Similarly,
the second encoder BERT is used to
compute the L-normalized embedding  for the tail entity .
The input for BERT only consists of the textual description for entity .

Since the embeddings  and  are both L normalized,
the cosine similarity 
is simply the dot product between two embeddings:


For tail entity prediction (, , ),
we compute the cosine similarity between 
and all entities in ,
and predict the one with the largest score:


\subsection{Negative Sampling}

For knowledge graph completion,
the training data only consists of positive triples.
Given a positive triple (, , ),
``negative sampling'' needs to sample one or more negative triples
to train discriminative models.
Most existing methods randomly corrupt  or 
and then filter out false negatives that appear in the training graph .
The negatives for different triples are not shared and therefore independent.
The typical number of negatives are  for embedding-based methods ~\citep{sun2018rotate},
and  for text-based methods ~\citep{wang2021structure}.
We combine three types of negatives
to improve the training efficiency
without incurring significant computational and memory overhead.
\newline

\noindent
\textbf{In-batch Negatives (IB)}
This is a widely adopted strategy in visual representation learning ~\citep{chen2020simple}
and dense passage retrieval ~\citep{karpukhin-etal-2020-dense} etc.
Entities within the same batch can be used as negatives.
Such in-batch negatives allow the efficient reuse of entity embeddings for bi-encoder models.
\newline

\noindent
\textbf{Pre-batch Negatives (PB)}
The disadvantage of in-batch negatives is that
the number of negatives is coupled with batch size.
Pre-batch negatives ~\citep{Lee2021LearningDR}
use entity embeddings from previous batches.
Since these embeddings are computed with an earlier version of model parameters,
they are not consistent with in-batch negatives.
Usually,
only  or  pre-batches are used.
Other methods like MoCo ~\citep{he2020momentum} can also provide more negatives.
We leave the investigation of MoCo as future work.
\newline

\noindent
\textbf{Self-Negatives (SN)}
Besides increasing the number of negatives,
mining hard negatives ~\citep{gao2021simcse,xiong2020approximate} is also important
for improving contrastive representation learning.
For tail entity prediction (, , ),
text-based methods
tend to assign a high score to the head entity ,
likely due to the high text overlap.
To mitigate this issue,
we propose self-negatives that use the head entity  as hard negatives.
Including self-negatives can make the model rely less
on the spurious text match.
\newline

We use , , and 
to denote the aforementioned three types of negatives.
During training,
there may exist some false negatives.
For example,
the correct entity happens to appear in another triple within the same batch.
We filter out such entities with a binary mask
~\footnote{False negatives that do not appear in the training data will not be filtered.}.
Combining them all,
the collection of negatives  is:


Assume the batch size is ,
and  pre-batches are used,
we would have ,
,
,
and  negatives in total.

\subsection{Graph-based Re-ranking}

Knowledge graphs often exhibit spatial locality.
Nearby entities are more likely to be related than entities that are far apart.
Text-based KGC methods are good at capturing semantic relatedness
but may not fully capture such inductive bias.
We propose a simple graph-based re-ranking strategy:
increase the score of candidate tail entity 
by  if  is in -hop neighbors 
of the head entity  based on the graph from training set:


\subsection{Training and Inference}
During training,
we use InfoNCE loss with additive margin ~\citep{chen2020simple,yang2019improving}:


The additive margin  encourages the model
to increase the score of the correct triple (,,).
 is the score function for a candidate triple,
here we define 
as in Equation ~\ref{eq:cos}.
The temperature  can adjust the relative importance of negatives,
smaller  makes the loss put more emphasis on hard negatives,
but also risks over-fitting label noise.
To avoid tuning  as a hyperparameter,
we re-parameterize  as a learnable parameter.

For inference,
the most time-consuming part is  BERT forward pass computation of entity embeddings.
Assume there are  test triples.
For each triple (, , ) and (, , ),
we need to compute the relation-aware head entity embedding
and use a dot product to get the ranking score for all entities.
In total,
SimKGC needs  BERT forward passes,
while cross-encoder models like KG-BERT ~\citep{yao2019kg}
needs .
Being able to scale to large datasets is important for practical usage.
For bi-encoder models,
we can pre-compute the entity embeddings
and retrieve top-k entities efficiently
with the help of fast similarity search tools like Faiss ~\citep{Johnson2021BillionScaleSS}.

\section{Experiments}

\begin{table*}[ht]
\centering
\begin{tabular}{@{}l|lllll@{}}
\toprule
dataset          & \#entity & \#relation & \#train & \#valid & \#test \\ \midrule
WN18RR           &     &        &     &      &       \\
FB15k-237        &     &      &    &   &  \\
Wikidata5M-Trans &      &     &      &    &      \\
Wikidata5M-Ind   &      &    &    &   &    \\ \bottomrule
\end{tabular}
\caption{Statistics of the datasets used in this paper.
``Wikidata5M-Trans'' and ``Wikidata5M-Ind'' refer to the transductive and inductive settings,
respectively.}
\label{tab:dataset}
\end{table*}

\subsection{Experimental Setup}

\noindent
\textbf{Datasets }
We use three datasets for evaluation:
WN18RR,
FB15k-237,
and Wikidata5M ~\citep{wang2021kepler}.
The statistics are shown in Table ~\ref{tab:dataset}.
~\citet{bordes2013translating} proposed the WN18 and FB15k datasets.
Later work ~\citep{toutanova-etal-2015-representing,dettmers2018convolutional}
showed that these two datasets suffer from test set leakage
and released WN18RR and FB15k-237 datasets by removing the inverse relations.
The WN18RR dataset consists of  synsets and  relations from WordNet ~\citep{miller1995wordnet},
and the FB15k-237 dataset consists of  entities and  relations from Freebase.
The Wikidata5M dataset is much larger in scale with  million entities and  million triples.
It provides two settings: transductive and inductive.
For the transductive setting,
all entities in the test set also appear in the training set,
while for the inductive setting,
there is no entity overlap between train and test set.
We use ``Wikidata5M-Trans'' and ``Wikidata5M-Ind'' to indicate these two settings.

For textual descriptions,
we use the data provided by KG-BERT ~\citep{yao2019kg} for WN18RR and FB15k-237 datasets.
The Wikidata5M dataset already contains descriptions for all entities and relations.
\newline

\noindent
\textbf{Evaluation Metrics }
Following previous work,
our proposed KGC model is evaluated with entity ranking task:
for each test triple ,
tail entity prediction ranks all entities to predict  given  and ,
similarly for head entity prediction.
We use four automatic evaluation metrics:
mean reciprocal rank (MRR),
and Hits@(\{,,\}) (H@ for short).
MRR is the average reciprocal rank of all test triples.
H@ calculates the proportion of correct entities ranked among the top-.
MRR and H@ are reported under the \emph{filtered setting} ~\citep{bordes2013translating},
The \emph{filtered setting} ignores the scores of all known true triples
in the training, validation, and test set.
All metrics are computed by averaging over two directions:
head entity prediction and tail entity prediction.

We also conduct a human evaluation on the Wikidata5M dataset
to provide a more accurate estimate of the model's performance.
\newline

\noindent
\textbf{Hyperparameters }
The encoders are initialized with \emph{bert-base-uncased} (English).
Using better pre-trained language models is expected to improve performance further.
Most hyperparameters except learning rate and training epochs
are shared across all datasets
to avoid dataset-specific tuning.
We conduct grid search on learning rate with ranges \{, , \}.
Entity descriptions are truncated to a maximum of  tokens.
Temperature  is initialized to ,
and the additive margin for InfoNCE loss is .
For re-ranking,
we set .
 pre-batches are used with logit weight .
We use AdamW optimizer with linear learning rate decay.
Models are trained with batch size  on  V100 GPUs.
For the WN18RR, FB15k-237, and Wikidata5M (both settings) datasets,
we train for , , and  epochs, respectively.
Please see Appendix ~\ref{app:setup} for more details.

\subsection{Main Results}

\begin{table*}[ht]
\centering
\scalebox{0.9}{\begin{tabular}{l|cccc|cccc}
\hline
\multirow{2}{*}{Method} & \multicolumn{4}{c|}{Wikidata5M-Trans} & \multicolumn{4}{c}{Wikidata5M-Ind}  \\ \cline{2-9}
                        & MRR & H@1 & H@3 & H@10 & MRR & H@1 & H@3 & H@10 \\ \hline
\multicolumn{9}{l}{\textit{embedding-based methods}}         \\ \hline
TransE ~\citep{bordes2013translating} &  25.3 & 17.0 & 31.1 & 39.2  &  - & - & - &  - \\
RotatE ~\citep{sun2018rotate} & 29.0 & 23.4 & 32.2 & 39.0 &  - & - & - & -  \\ \hline
\multicolumn{9}{l}{\textit{text-based methods}}         \\ \hline
DKRL ~\citep{xie2016representation} & 16.0 & 12.0 & 18.1 & 22.9 & 23.1 & 5.9 & 32.0 & 54.6 \\
KEPLER ~\citep{wang2021kepler} & 21.0 & 17.3 & 22.4 & 27.7 & 40.2 & 22.2 & 51.4 & 73.0 \\
BLP-ComplEx ~\citep{daza2021inductive} & - & - & - & - &  48.9 & 26.2 & 66.4 & 87.7 \\
BLP-SimplE ~\citep{daza2021inductive} & - & - & - & - &  49.3 & 28.9 & 63.9 & 86.6 \\ \hline \hline
SimKGC  & 35.3 & 30.1 & 37.4 & \textbf{44.8} & 60.3 & 39.5 & 77.8 & 92.3 \\
SimKGC & 35.4 & 30.2 & 37.3 & \textbf{44.8} & 60.2 & 39.4 & 77.7 & \textbf{92.4} \\
SimKGC & 35.6 & 31.0 & 37.3 & 43.9 & 71.3 & 60.7 & \textbf{78.7} & 91.3 \\
SimKGC & \textbf{35.8} & \textbf{31.3} & \textbf{37.6} & 44.1 & \textbf{71.4} & \textbf{60.9} & 78.5 & 91.7 \\ \hline
\end{tabular}}
\caption{Main results for the Wikidata5M dataset.
``IB'', ``PB'', and ``SN'' refer to in-batch negatives,
pre-batch negatives, and self-negatives respectively.
Embedding-based methods are inherently unable to perform inductive KGC.
According to the evaluation protocol by ~\citet{wang2021kepler},
the inductive setting only ranks  entities in the test set,
while the transductive setting ranks  million entities,
so the reported metrics for the inductive setting are much higher.
Results are statistically significant under paired student's t-test with p-value .}
\label{tab:wikidata}
\end{table*}

\begin{table*}[ht]
\centering
\scalebox{0.9}{\begin{tabular}{l|cccc|cccc}
\hline
\multirow{2}{*}{Method} & \multicolumn{4}{c|}{WN18RR}      & \multicolumn{4}{c}{FB15k-237}  \\ \cline{2-9}
                        & MRR & H@1 & H@3 & H@10 & MRR & H@1 & H@3 & H@10 \\ \hline
\multicolumn{9}{l}{\textit{embedding-based methods}}         \\ \hline
TransE ~\citep{bordes2013translating} &  24.3 & 4.3  & 44.1 & 53.2 & 27.9 & 19.8 & 37.6 & 44.1 \\
DistMult ~\citep{yang2014embedding}   &  44.4 & 41.2 & 47.0 & 50.4  &  28.1 & 19.9 & 30.1 & 44.6 \\
RotatE ~\citep{sun2018rotate}  & 47.6 & 42.8 & 49.2 & 57.1 & 33.8 & 24.1 &  37.5 & 53.3 \\
TuckER ~\citep{balazevic-etal-2019-tucker} & 47.0 & 44.3 & 48.2 & 52.6 & \textbf{35.8} & \textbf{26.6} & \textbf{39.4} & \textbf{54.4} \\ \hline
\multicolumn{9}{l}{\textit{text-based methods}}         \\ \hline
KG-BERT ~\citep{yao2019kg} & 21.6 & 4.1 &  30.2 & 52.4 &  -  &  - &  - &  42.0 \\
MTL-KGC ~\citep{kim-etal-2020-multi} & 33.1 & 20.3 & 38.3 & 59.7 & 26.7 & 17.2 & 29.8 & 45.8 \\
StAR ~\citep{wang2021structure} &  40.1 & 24.3 &  49.1 & 70.9 &  29.6 & 20.5 & 32.2 & 48.2 \\ \hline \hline
SimKGC  & \textbf{67.1} & 58.5 & \textbf{73.1} & \textbf{81.7} & 33.3 & 24.6 & 36.2  & 51.0 \\
SimKGC & 66.6 &  57.8  & 72.3 & \textbf{81.7} &  33.4 & 24.6 & \textbf{36.5} & \textbf{51.1} \\
SimKGC & 66.7 & \textbf{58.8} & 72.1 & 80.5 & 33.4 & 24.7 & 36.3 & 50.9 \\
SimKGC & 66.6 & 58.7 & 71.7 & 80.0 & \textbf{33.6} & \textbf{24.9} & 36.2 & \textbf{51.1} \\ \hline
\end{tabular}}
\caption{Main results for WN18RR and FB15k-237 datasets.
: numbers are from ~\citet{wang2021structure}.}
\label{tab:wn_and_fb}
\end{table*}

We reuse the numbers reported by ~\citet{wang2021kepler} for TransE and DKRL,
and the results for RotatE are from the official GraphVite
~\footnote{\url{https://graphvite.io/docs/latest/benchmark}} benchmark.
In Table ~\ref{tab:wikidata} and ~\ref{tab:wn_and_fb},
our proposed model SimKGC
outperforms state-of-the-art methods by a large margin
on the WN18RR,
Wikidata5M-Trans,
and Wikidata5M-Ind datasets,
but slightly lags behind on the FB15k-237 dataset (MRR ).
To the best of our knowledge,
SimKGC is the first text-based KGC method that
achieves better results than embedding-based counterparts.

We report results for various combinations of negatives.
With in-batch negatives only,
the performance of SimKGC is already quite strong
thanks to the large batch size (1024) we use.
Adding self-negatives tends to improve H@1 but hurt H@10.
We hypothesize that self-negatives make the model rely less on simple text match.
Thus they have negative impacts on metrics that emphasize recall,
such as H@10.
Combining all three types of negatives generally has the best results but not always.

Compared to other datasets,
the graph for the FB15k-237 dataset
is much denser (average degree is  per entity),
and contains fewer entities ().
To perform well,
models need to learn generalizable inference rules
instead of just modeling textual relatedness.
Embedding-based methods are likely to hold an advantage for this scenario.
It is possible to ensemble our method with embedding-based ones,
as done by ~\citet{wang2021structure}.
Since this is not the main focus of this paper,
we leave it as future work.
Also,
~\citet{cao-etal-2021-missing} points out that
many links in the FB15k-237 dataset are not predictable based on the available information.
These two reasons help explain the unsatisfactory performance of SimKGC.

Adding self-negatives is particularly helpful for the inductive setting of Wikidata5M dataset,
with MRR rising from  to .
For inductive KGC,
text-based models rely more heavily on text match than the transductive setting.
Self negatives can prevent the model from simply predicting the given head entity.

In terms of inference time,
the most expensive part is the forward pass with BERT.
For the Wikidata5M-Trans dataset,
SimKGC requires  minutes to compute  million embeddings with 2 GPUs,
while cross-encoder models such as KG-BERT ~\citep{yao2019kg}
would require an estimated time of  hours.
We are not the first work that enables fast inference,
models such as ConvE ~\citep{dettmers2018convolutional} and StAR ~\citep{wang2021structure}
also share similar advantages.
Here we just want to re-emphasize the importance of inference efficiency and scalability
when designing new models.

\section{Analysis}
We conduct a series of analyses to gain further insights
into our proposed model and the KGC task.

\subsection{What Makes SimKGC Excel?}

Compared to existing text-based methods,
SimKGC makes two major changes:
using more negatives,
and switching from margin-based ranking loss to InfoNCE loss.
To guide the future work on knowledge graph completion,
it is crucial to understand which factor contributes most
to the superior performance of SimKGC.

\begin{table}[ht]
\centering
\scalebox{0.88}{\begin{tabular}{lc|cccc}
\hline
loss & \# of neg & MRR & H@1 & H@3 & H@10 \\ \hline
InfoNCE & 255 & \textbf{64.4} & \textbf{53.8} & \textbf{71.7} & \textbf{82.8} \\
InfoNCE & 5 & 48.8 & 31.9 & 60.2 & 80.3 \\
margin & 255 & 39.5 & 28.5 & 44.4 & 61.2 \\
margin & 5 & 38.0 & 27.5 & 42.8 & 58.7 \\ \hline
margin- & 255 & 57.8 & 48.5 & 63.7 & 74.9 \\ \hline
\end{tabular}}
\caption{Analysis of loss function and the number of negatives on the WN18RR dataset.}
\label{tab:ablation_key_factor}
\end{table}

\begin{table*}[ht]
\centering
\scalebox{0.9}{\begin{tabular}{l|l}
\hline
triple   &   (Rest Plaus Historic District, is located in, \textbf{New York}) \\
evidence & \ldots a national historic district located at Marbletown in Ulster County, New York\ldots \\
SimKGC &  Marbletown  \\ \hline
triple   &   (\textbf{Timothy P. Green}, place of birth, St. Louis) \\
evidence & William Douglas Guthrie (born January 17, 1967 in St. Louis, MO) is a professional boxer\ldots \\
SimKGC &  William Douglas Guthrie \\ \hline
triple   &   (TLS termination proxy, instance of, \textbf{networked software}) \\
evidence & \ldots a proxy server that is used by an institution to handle incoming TLS connections\ldots \\
SimKGC &  http server  \\ \hline
triple   &   (1997 IBF World Championships, followed by, \textbf{1999 IBF World Championships}) \\
evidence & \begin{tabular}[c]{@{}l@{}} The 10th IBF World Championships (Badminton) were held in Glasgow, Scotland, \\ between 24 May and 1 June 1997\ldots \end{tabular} \\
SimKGC &  2000 IBF World Junior Championships  \\ \hline
\end{tabular}}
\caption{Examples of SimKGC prediction results on the test set of the Wikidata5M-Trans dataset.
The entity to predict is in bold font.
We only show a snippet of relevant texts in the row of ``evidence'' for space reason.}
\label{tab:case_analysis}
\end{table*}

In Table ~\ref{tab:ablation_key_factor},
we use SimKGC with batch size  as a baseline.
By reducing the number of negatives from  to ,
MRR drops from  to .
Changing the loss function from InfoNCE to the following margin loss makes MRR drop to :

Consistent with Equation ~\ref{eq:infonce},
 is cosine similarity score for a candidate triple,
and .

To summarize,
both InfoNCE loss and a large number of negatives are important factors,
while the loss function seems to have bigger impacts.
For InfoNCE loss,
the hard negatives naturally contribute larger gradients,
and adding more negatives can lead to more robust representations.
~\citet{Wang2021UnderstandingTB} also draws a similar conclusion:
such hardness-aware property is vital for the success of contrastive loss.

We also propose a variant ``margin-'' loss
by changing the weight in Equation ~\ref{eq:margin} from 
to ,
where 
and .
Similar to InfoNCE loss,
``margin-'' loss makes the model pay more attention to hard negatives
and leads to better performance as shown in Table ~\ref{tab:ablation_key_factor}.
It is similar to the ``self-adversarial negative sampling'' proposed by ~\citet{sun2018rotate}.
Most hyperparameters are tuned based on InfoNCE loss.
We expect the margin- loss to achieve better results with a bit more hyperparameter optimization.

\begin{figure}[ht]
\begin{center}
 \includegraphics[width=0.95\linewidth]{./images/neg_size.pdf}
 \caption{MRR on the WN18RR dataset w.r.t the number of negatives with SimKGC.
 We use a batch size of  for all experiments,
 and change the number of negatives with a binary mask over the softmax logits.}
 \label{fig:neg_size}
\end{center}
\end{figure}

In Figure ~\ref{fig:neg_size},
we quantitatively illustrate how MRR changes as more negatives are added.
There is a clear trend that
the performance steadily improves from  to .
However,
adding more negatives requires more GPU memory
and may cause optimization difficulties ~\citep{You2020LargeBO,chen2020simple}.
We do not experiment with batch size larger than .

\subsection{Ablation on Re-ranking}

\begin{table}[ht]
\centering
\begin{tabular}{c|llll}
\hline
 & MRR & H@1 & H@3 & H@10 \\ \hline
w/ re-rank &  \textbf{35.8} & \textbf{31.3} & \textbf{37.6} & \textbf{44.1} \\
w/o re-rank & 35.5 & 31.0 & 37.3 & 43.9 \\ \hline
\end{tabular}
\caption{Ablation of re-ranking on the Wikidata5M-Trans dataset.}
\label{tab:re-rank}
\end{table}

Our proposed re-ranking strategy is a simple way
to incorporate topological information in the knowledge graph.
For graphs whose connectivity patterns exhibit spatial locality,
re-ranking is likely to help.
In Table ~\ref{tab:re-rank},
we see a slight but stable increase for all metrics on the Wikidata5M-Trans dataset.
Note that this re-ranking strategy does not apply
to inductive KGC
since entities in the test set never appear in the training data.
Exploring more effective ways such as graph neural networks ~\citep{Wu2019ACS}
instead of simple re-ranking would be a future direction.

\subsection{Fine-grained Analysis}

\begin{table}[ht]
\centering
\begin{tabular}{cccc}
\hline
1-1   & 1-n \\ \hline
\begin{tabular}[c]{@{}c@{}}spouse\\ capital of \\lake inflows \\ head of government \end{tabular}
& \begin{tabular}[c]{@{}c@{}}child\\ has part \\ notable work \\ side effect \end{tabular} \\ \hline
n-1  & n-n   \\ \hline
 \begin{tabular}[c]{@{}c@{}} instance of \\ place of birth \\ given name \\ work location \end{tabular}
& \begin{tabular}[c]{@{}c@{}} cast member \\ member of \\ influenced by \\ nominated for \end{tabular} \\ \hline
\end{tabular}
\caption{Examples for different categories of relations on the Wikidata5M-Trans dataset.}
\label{tab:relation_examples}
\end{table}

\begin{table}[ht]
\centering
\begin{tabular}{l|cccc}
\hline
Dataset & 1-1 & 1-n & n-1 & n-n \\ \hline
Wikidata5M-Trans & 30.4 & 8.3 & 71.1 & 10.6 \\
Wikidata5M-Ind & 83.5 & 71.1 & 80.0 & 54.7 \\ \hline
\end{tabular}
\caption{MRR for different kinds of relations
on the Wikidata5M dataset with SimKGC.}
\label{tab:perf_by_relation}
\end{table}

We classify all relations into four categories
based on the cardinality of head and tail arguments
following the rules by ~\citet{bordes2013translating}:
one-to-one(1-1),
one-to-many(1-n),
many-to-one(n-1),
and many-to-many(n-n).
Examples are shown in Table ~\ref{tab:relation_examples}.
As shown in Table ~\ref{tab:perf_by_relation},
predicting the ``n'' side is generally more difficult,
since there are many seemingly plausible answers
that would confuse the model.
Another main reason is the incompleteness of the knowledge graph.
Some predicted triples might be correct based on human evaluation,
especially for 1-n relations in head entity prediction,
such as ``instance of'', ``place of birth'' etc.

In Table ~\ref{tab:case_analysis},
for the first example,
``Marbletown'', ``Ulster County'', and ``New York'' are both correct answers.
The second example illustrates the case for relation ``place of birth'':
a lot of people share the same place of birth,
and some triples may not exist in the knowledge graph.
This helps explain the low performance of ``1-n'' relations for the Wikidata5M-Trans dataset.
In the third example,
SimKGC predicts a closely related but incorrect entity ``http server''.

\subsection{Human Evaluation}

\begin{table}[ht]
\centering
\begin{tabular}{l|lll}
\hline
         & correct & wrong & unknown \\ \hline
(, , )  & 24\% & 54\% & 22\% \\
(, , ) & 74\% & 14\% & 12\% \\
Avg   & 49\%  & 34\% & 17\% \\ \hline
\end{tabular}
\caption{Human evaluation results on the Wikidata5M-Trans dataset.
(, , ) and (, , ) denote tail entity and head entity prediction respectively.
We randomly sample  wrong predictions according to H@1 from test set.
The ``unknown'' category indicates annotators are unable to decide
whether the prediction is correct or wrong
based on the textual information.}
\label{tab:human_eval}
\end{table}

The analyses above suggest that
automatic evaluation metrics such as MRR tend to underestimate the model's performance.
To have a more accurate estimation of the performance,
we conduct human evaluation and list the results in Table ~\ref{tab:human_eval}.
An average of  of the wrong predictions according to H@1 are correct according to human annotators.
If we take this into account,
the H@1 of our proposed model would be much higher.
How to accurately measure the performance of KGC systems
is also an interesting future research direction.

\subsection{Entity Visualization}

\begin{figure}[ht]
\begin{center}
 \includegraphics[width=0.95\linewidth]{./images/entity_vis.pdf}
 \caption{2-D visualization of the entity embeddings
 from the Wikidata5M-Trans dataset with t-SNE ~\citep{Maaten2008VisualizingDU}.}
 \label{fig:entity_vis}
\end{center}
\end{figure}

To examine our proposed model qualitatively,
we visualize the entity embeddings from  largest categories
~\footnote{We utilize the ``instance of'' relation to determine the entity category.}
with  randomly selected entities per category.
Entity embeddings are computed with BERT in Section ~\ref{sec:arch}.
In Figure ~\ref{fig:entity_vis},
different categories are well separated,
demonstrating the high quality of the learned embeddings.
One interesting phenomenon is that
the two categories ``Community'' and ``Village'' have some overlap.
This is reasonable since these two concepts are not mutually exclusive.

\section{Conclusion}
This paper proposes a simple method SimKGC
to improve text-based knowledge graph completion.
We identify that the key issue is how to perform efficient contrastive learning.
Leveraging the recent progress in the field of contrastive learning,
SimKGC adopts a bi-encoder architecture
and combines three types of negatives.
Experiments on the WN18RR, FB15k-237, and Wikidata5M datasets
show that SimKGC substantially outperforms state-of-the-art methods.

For future work,
one direction is to improve the interpretability of SimKGC.
In methods like RotatE ~\citep{sun2018rotate} and TransE ~\citep{bordes2013translating},
a triple can be modeled as rotation in complex space or relational translation,
while SimKGC does not enable such easy-to-understand interpretations.
Another direction is to explore effective ways to deal with false negatives ~\citep{Huynh2020BoostingCS}
resulting from the incompleteness of knowledge graphs.

\section{Broader Impacts}
Future work could use SimKGC as a solid baseline
to keep improving text-based knowledge graph completion systems.
Our experimental results and analyses also reveal several promising research directions.
For example,
how to incorporate global graph structure in a more principled way?
Are there other loss functions that perform better than the InfoNCE loss?
For knowledge-intensive tasks such as knowledge base question answering (KBQA),
information retrieval, and knowledge-grounded response generation, etc.,
it would be interesting to explore the new opportunities
brought by the improved knowledge graph completion systems.

\section*{Acknowledgements}
We would like to thank anonymous reviewers and area chairs for their valuable comments,
and ACL Rolling Review organizers for their efforts.

\bibliography{anthology,custom}
\bibliographystyle{acl_natbib}

\appendix

\section{Details on Hyperparameters} ~\label{app:setup}

\begin{table}[ht]
\centering
\scalebox{0.9}{\begin{tabular}{l|c}
\hline
Hyperparameter & value \\ \hline
\# of GPUs  &  4 \\ \hline
initial temperature   &   0.05 \\ \hline
gradient clip & 10  \\ \hline
warmup steps & 400  \\ \hline
batch size  & 1024 \\ \hline
max \# of tokens  & 50 \\ \hline
weight  for re-ranking  & 0.05 \\ \hline
dropout & 0.1 \\ \hline
weight decay  &  \\ \hline
InfoNCE margin  & 0.02 \\ \hline
pooling  &  mean \\ \hline
\end{tabular}}
\caption{Shared hyperparameters for our proposed SimKGC model.}
\label{tab:appendix_hyper}
\end{table}

In Table ~\ref{tab:appendix_hyper},
we show the hyperparameters that are shared across all the datasets.
For learning rate,
we use , , and 
for WN18RR, FB15k-237, and Wikidata5M datasets, respectively.
For re-ranking,
we use -hop neighbors for WN18RR and -hop neighbors for other datasets.
Each epoch takes  minutes for WN18RR,
 minutes for FB15k-237,
and  hours for Wikidata5M (both settings).
Our implementation is based on open-source project \emph{transformers}
~\footnote{\url{https://github.com/huggingface/transformers}}.

For inverse relation ,
we add a prefix word ``inverse'' to the description of .
For examples,
if  = ``instance of'',
then  = ``inverse instance of''.

Some entities in the WN18RR and FB15k-237 dataset
have very short textual descriptions.
We concatenate them with the entity names of its neighbors in the training set.
To avoid label leakage during training,
we dynamically exclude the correct entity in the input text.

\section{More Analysis Results} \label{app:analysis}

\begin{table}[ht]
\centering
\begin{tabular}{c|llll}
\hline
batch size & MRR & H@1 & H@3 & H@10 \\ \hline
256 &  33.8 & 28.7 & 35.8 & 43.1 \\
512 & 34.6 & 29.4 & 36.7 & 43.7 \\
1024 & \textbf{35.3} & \textbf{30.1} & \textbf{37.4} & \textbf{44.8} \\ \hline
\end{tabular}
\caption{Effects of batch size on the Wikidata5M-Trans dataset with SimKGC.}
\label{tab:wiki5m_trans_batch_size}
\end{table}

\begin{table}[ht]
\centering
\begin{tabular}{c|llll}
\hline
batch size & MRR & H@1 & H@3 & H@10 \\ \hline
256 &  32.4 & 23.3 & 35.4 & 50.9 \\
512 & 32.7 & 23.7 & 35.6 & \textbf{51.0} \\
1024 & \textbf{33.3} & \textbf{24.6} & \textbf{36.2} & \textbf{51.0} \\ \hline
\end{tabular}
\caption{Effects of batch size on the FB15k-237 dataset with SimKGC.}
\label{tab:fb_batch_size}
\end{table}

\begin{table}[ht]
\centering
\scalebox{0.9}{\begin{tabular}{l|cccc}
\hline
margin  & MRR & H@1 & H@3 & H@10 \\ \hline
0 & 33.4 & 24.8 & 36.0 & 50.9 \\
0.02 & \textbf{33.6} & 24.9 & \textbf{36.2} & \textbf{51.1} \\
0.05 & \textbf{33.6} & \textbf{25.0} & \textbf{36.2} & 50.9 \\ \hline
\end{tabular}}
\caption{Ablation for the additive margin  of InfoNCE loss on the FB15k-237 dataset.}
\label{tab:fb_additive_margin}
\end{table}

\begin{table*}[ht]
\centering
\scalebox{0.9}{\begin{tabular}{l|l}
\hline
\multirow{2}{*}{triple} & \multirow{2}{*}{(captive state (film), instance of, \textbf{movie})} \\
 &   \\
evidence & \begin{tabular}[c]{@{}l@{}}Captive State is a 2019 American crime science fiction thriller film directed by Rupert Wyatt \\ and co-written by Wyatt and Erica Beeney.\ldots \end{tabular} \\
SimKGC &  3-D movies \\ \hline
triple   & (Lionel Belasco, occupation, \textbf{composer}) \\
evidence & \begin{tabular}[c]{@{}l@{}} Lionel Belasco (1881 – c. 24 June 1967) was a prominent pianist, composer and bandleader, \\ best known for his calypso recordings. \end{tabular} \\
SimKGC &  bandleaders \\ \hline
triple   & (\textbf{Johan Nordhagen}, country of citizenship, Norway) \\
evidence & Waqas Ahmed (born 9 June 1991) is a Norwegian cricketer. \ldots \\
SimKGC &  Waqas Ahmed  \\ \hline
triple   & (\textbf{Carlos Peña Romulo}, position held, philippine resident commissioner) \\
evidence & \begin{tabular}[c]{@{}l@{}} Francis Burton Harrison was an American-born Filipino statesman who served in the United States \\ House of Representatives and was appointed Governor-General of the Philippines \ldots \end{tabular} \\
SimKGC &  Francis Burton Harrison \\ \hline
\end{tabular}}
\caption{More examples of SimKGC prediction results on the test set of Wikidata5M-Trans.}
\label{tab:more_cases}
\end{table*}

In Table ~\ref{tab:wiki5m_trans_batch_size} and ~\ref{tab:fb_batch_size},
we show how the batch size affects model performance
on the Wikidata5M-Trans and FB15k-237 dataset.

In Equation ~\ref{eq:infonce},
we use a variant of InfoNCE loss that has an additive margin .
In our experiments,
such a variant performs consistently better than the standard InfoNCE loss,
though the improvement is quite marginal,
as shown in Table ~\ref{tab:fb_additive_margin}.

In Table ~\ref{tab:more_cases},
we show more examples of SimKGC predictions on the Wikidata5M-Trans dataset
to help better understand our model's behavior.
Full model predictions on test datasets are available in our public code repository.

\end{document}
