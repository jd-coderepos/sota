\documentclass[a4paper]{article}
\usepackage{RR}
\usepackage{hyperref}

\usepackage{latexsym, stmaryrd, amssymb, amsbsy, amsmath} 
\usepackage{url}


\usepackage{comment}
\usepackage{ifthen}
\newboolean{extended-abstract}
\setboolean{extended-abstract}{false}
\ifthenelse{\boolean{extended-abstract}}{\excludecomment{RR}\includecomment{ABS}}{\includecomment{RR}\excludecomment{ABS}}
\newcommand{\remarque}[1]{}





\usepackage{pst-node, pst-tree}

\usepackage{float}
\floatstyle{boxed}
\newfloat{mafigure}{thp}{pipo}
\floatname{mafigure}{Figure}
\renewcommand{\textfraction}{0}
\renewcommand{\topfraction}{1}
\renewcommand{\bottomfraction}{1}
\setlength{\textfloatsep}{12pt}


\usepackage{theorem}
\theoremstyle{plain}
\theoremheaderfont{\rmfamily\bfseries}
\theorembodyfont{\itshape}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}{\bfseries}{\itshape}
\newtheorem{lemma}{Lemma}{\bfseries}{\itshape}
\newtheorem{fact}{Fact}{\rmfamily}{\itshape}
\newtheorem{corollary}{Corollary}{\bfseries}{\itshape}
\theorembodyfont{\rmfamily}
\theoremheaderfont{\itshape}
\newtheorem{example}{Example}{\itshape}{\rmfamily}
\newtheorem{remark}{Remark}{\itshape}{\rmfamily}
\newcommand{\qed}{\hfill }
\newcommand{\findef}{\hfill }
\newcommand{\finex}{\hfill }
\newenvironment{proof}{\noindent\emph{Proof.}}{} 


\newcommand{\Pos}{\mathcal{P}\mathit{os}}
\newcommand{\V}{\mathcal{V}}
\newcommand{\R}{\mathcal{R}}
\newcommand{\T}{\mathcal{T}}
\renewcommand{\H}{\mathcal{H}}
\newcommand{\M}{\mathcal{M}}
\newcommand{\Or}{\mathcal{O}}
\newcommand{\U}{\mathcal{U}}
\newcommand{\X}{\mathcal{X}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\F}{\Sigma}
\newcommand{\Q}{Q}
\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\var}{\mathit{var}}
\newcommand{\mgi}{\mathit{mgi}}
\newcommand{\mgu}{\mathit{mgu}}
\newcommand{\lhs}{\mathit{lhs}}
\newcommand{\rhs}{\mathit{rhs}}
\newcommand{\rootp}{\Lambda}
\newcommand{\ptrs}[2]{{#1}{/}{#2}}


\newcommand{\final}{\mathsf{f}}
\newcommand{\init}{\mathit{i}}
\newcommand{\accept}{\mathsf{accept}}
\newcommand{\pre}{\mathit{pre}}
\newcommand{\post}{\mathit{post}}
\renewcommand{\det}{\mathsf{d}}
\newcommand{\repl}[3]{#1 [ #2 \leftarrow #3 ]}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\dom}{\mathit{dom}}
\newcommand{\sub}{\mathit{sub}}
\newcommand{\XACU}{\textsf{XACU}}
\newcommand{\INS}{\mathsf{INS}}
\newcommand{\REN}{\mathsf{REN}}
\newcommand{\RPL}{\mathsf{RPL}}
\newcommand{\DEL}{\mathsf{DEL}}
\newcommand{\XPath}{\mathsf{XPath}}
\newcommand{\maif}{\parallel}
\newcommand{\ann}{\mathit{ann}}




\def\frew#1#2#3#4#5#6#7#8{
\setbox0=\hbox{}\setbox1=\hbox{}\ifdim \wd0>\wd1 \rlap{\rlap{\hbox to \wd0{#5}}{\hbox to\wd0{\hfil\lower #3\box1\relax\hfil}}}{\raise #4\box0}\else \rlap{\rlap{\hbox to \wd1{#5}}{\hbox to\wd1{\hfil\raise #4\box0\relax\hfil}}}{\lower #3\box1}\fi
}

\def\fstep#1#2#3#4#5{\mathchoice{\frew{#1}{#2}{1.10ex}{1.20ex}{#5}{\scriptstyle}{#3}{#4}}{\frew{#1}{#2}{0.82ex}{1.20ex}{#5}{\scriptstyle}{#3}{#4}}{\frew{#1}{#2}{0.51ex}{0.82ex}{#5}{\scriptscriptstyle}{#3}{#4}}{\frew{#1}{#2}{0.51ex}{0.69ex}{#5}{\scriptscriptstyle}{#3}{#4}}}

\newcommand{\lrstep}[2]{\mathrel{\fstep{#1}{#2}{\;\>}{\>\>\;}{\rightarrowfill}}}
\newcommand{\rlstep}[2]{\mathrel{\fstep{#1}{#2}{\;\>\>}{\;\>}{\leftarrowfill}}}
\newcommand{\eqstep}[2]{\mathrel{\fstep{#1}{#2}{\;\>}{\>\;}{\rlap{\leftarrowfill}{\rightarrowfill}}}}


\pagestyle{plain}
\sloppy









\RRdate{July 2009}

\RRNo{7007}

\RRauthor{Florent Jacquemard and Michael Rusinowitch}


\authorhead{Jacquemard and Rusinowitch}


\RRtitle{Rewrite based Verification of XML Updates}
\RRetitle{Rewrite based Verification of XML Updates}
\titlehead{Rewrite based Verification of XML Updates}


\RRresume{We consider problems of access control for update of XML document.
In the context of XML programming, types can be viewed as hedge automata, and  static 
type checking amounts to verify that a program always converts valid source documents 
into also valid output documents. 
Given a set of update operations  we are particularly interested 
by checking safety properties such as preservation of document types 
along  any sequence of updates. 
We are also interested by the related policy consistency problem, that is  
detecting whether a sequence of authorized operations can simulate a forbidden one. 
We reduce these questions to type checking problems, 
solved by computing variants of hedge automata characterizing
the set of ancestors and descendants 
of the initial document type 
for the closure of parameterized rewrite rules.}

\RRabstract{We consider problems of access control for update of XML document.
In the context of XML programming, types can be viewed as hedge automata, and  static 
type checking amounts to verify that a program always converts valid source documents 
into also valid output documents. 
Given a set of update operations  we are particularly interested 
by checking safety properties such as preservation of document types 
along  any sequence of updates. 
We are also interested by the related policy consistency problem, that is  
detecting whether a sequence of authorized operations can simulate a forbidden one. 
We reduce these questions to type checking problems, 
solved by computing variants of hedge automata characterizing
the set of ancestors and descendants 
of the initial document type 
for the closure of parameterized rewrite rules.}

\RRmotcle{XML transformations, Typing, Software Verification, Tree Automata, Term Rewriting.}

\RRkeyword{XML transformations, Typing, Software Verification, Tree Automata, Term Rewriting.}

\RRprojets{DAHU and CASSIS}

\RRdomaine{4}
\RRtheme{Knowledge and Data Representation and Management}

\RCSaclay




\begin{document}

\makeRR


\section{Introduction}
XML has developed into the {de facto} standard for the exchange and manipulation
of data on the Web~\cite{AbiteboulBunemanSuciu}. 
XML documents are textual presentations of data stored in a tree structure, 
and are commonly represented as finite labeled unranked trees. 
In general, they are constrained by 
typing restrictions such as XML schemas expressing 
structural constraints on the organisation of the markups. 
Most of the typing formalisms currently used for XML are based on
finite tree automata. 
Several formalisms exist for the specification of transformation functions for XML documents,
e.g. for converting data from one source into a format suitable to a destination, 
for the automatic update of documents or 
the deletion of confidential data, e.g. for the enforcement of an access control policy
(wrapping or anonymization).
Among these formalisms, the W3C XQuery Update Facility~\cite{xqupdate}
defines some operations for document updates.

Applying transformation functions in the context of documents
following type constraints defined by schemas raises several compatibility problems.
Static Type Checking in the context of XML document processing amounts to verify at compile time 
that every XML document which is the result of a specified query or transformation 
of a  document with a valid input type produces an output document with a valid output type. 
Static Type Checking decidability is clearly dependant of the expressive power 
of the types and transformations that are employed. 
A standard approach to  XML type checking is 
forward (resp. backward) \emph{type inference}, 
that is the computation of 
an output (resp. input) XML type from given
input (resp. output) type and a tree transformation. 
Then the type checking itself 
can be reduced to  the verification of inclusion of the computed type in the given 
output or input type.

In this paper, motivated by XML access control problems, we consider document transformations that 
are arbitrary sequences of atomic update operations, and we address the problem of their type inference.
Since update operations, beside relabeling document nodes, \remarque{"updating XML content" = relabeling?}
can create and delete entire XML fragments,
modifying document's structure, 
it is not obvious to check whether they preserve the types of documents.

We propose a redefinition in term of rewrite rules (Section~\ref{sec:XACU})  
of the update operations of \XACU~\cite{FundulakiManeth07}, 
a formal model for specifying access control on XML data 
based on the W3C XQuery Update Facility draft~\cite{xqupdate}.
For these operations, and some proposed extensions,
we derive type inference algorithms that can also be 
employed to check access control policy local consistency
(i.e. to determine whether no sequence of allowed updates 
 starting from a given document can achieve 
 an explicitly forbidden update). 
Such situations may lead to serious security breaches 
and that are  challenging to detect according to~\cite{FundulakiManeth07}.
\remarque{+ provide control of application context}
Our results are obtained through the analysis of reachability sets of 
term rewriting systems for unranked trees, 
parametrized by hedge automata, and through the computation  
of an extension of hedge automata called context-free hedge automata. 
Therefore they may give more insight on these notions that have not been investigated before. 


\medskip\noindent{\bf Related work:}
When considering general purpose transformation languages (e.g. XDuce, CDuce)
for writing transformations, typechecking is generally undecidable
and approximations must be applied.
In order to obtain exact algorithms, several approaches define conveniently
abstract formalisms for representing transformations.
Let us cite for instance TL (the transformation language)~\cite{ManethBPS05}
whose programs can be translated in macro tree transducers~\cite{MTT04},
and -pebble tree transducers~\cite{MiloSuciuVianu03},
a powerful model defined so as to cover relevant fragments
of XSLT~\cite{XSLT} and other XML transformation languages.
Some restrictions on schema languages and on
top down tree transducers (on which transformations are based)
have also been studied~\cite{MartensNeven04}
in order to obtain PTIME type checking procedures.

The  results based on tree transducers are difficult to compare to ours. 
On one hand, we consider a small class of atomic update operations
whose expressiveness cannot be compared to general purpose transformation languages,
on the other hand, the application of updates is not restricted by strategies 
like e.g. top-down  transformations in~\cite{MartensNeven04}.
One can note that the works on typechecking
generally focus on the expressiveness of transformation languages,
and are restricted to XML types modeled as regular tree languages 
(languages of tree automata) or DTDs (a strict subclass of regular tree languages).
In our work we need to consider  XML types that generalize  regular tree languages 
and are recognized by context-free hedge automata~\cite{JR-rta2008}. 

The first access control model for XML was proposed by~\cite{DamianiVPS00} 
and was extended to secure updates in \cite{Lim03}. In \cite{Gabillon05}, the authors propose a solution to secure XUpdate queries.
Static analysis has been applied to XML Access Control in ~\cite{Murata06} to determine if a query expression 
is guaranteed not to access to elements that are forbidden by the policy. 
In ~\cite{FundulakiManeth07} the authors propose the XACU language. 
They study  policy consistency and show that it is undecidable in their setting. 
On the positive side~\cite{Bravo08} consider policies defined in term of annotated non recursive XML DTDs 
and give a polynomial algorithm for checking consistency. 
\remarque{c'est sur?}

Several recent works have considered the 
application of rewriting to reason about  
access control policies. These works do not adress  XML access control. 


\paragraph{Organization of the paper:} We introduce the needed 
formal background about terms, hedge automata and rewriting systems 
in Section \ref{sec:def}. Then we present XML update as parameterized  rewriting 
rules in Section \ref{sec:update}. Finally we give application to Access Control 
Policies in Section \ref{sec:acp}.

\section{Definitions}
\label{sec:def}

\subsection{Unranked Ordered Trees}

\paragraph{Terms and Hedges.}
We consider a finite alphabet  and an infinite set of variables .
The symbols of  are generally denoted  and the variables of
 , \ldots
The set  of \emph{hedges} over  and  
is the set of finite (possibly empty) sequences of terms
where the set of \emph{terms} over  and  is 
.
The empty sequence is denoted  and 
when  is empty, the term  will be simply denoted by .
We will sometimes consider a term as a hedge of length one, 
\textit{i.e.} consider that .
A leaf of a hedge  is a leaf of one of the terms .

The sets of ground terms (terms without variables) and ground hedges
are respectively denoted  and .
The set of variables occurring in a hedge  is denoted .
A hedge  is called \emph{linear} if every variable of  occurs at most once in .

\noindent The root node of a term is denoted by .

\medskip\noindent{\bf Substitutions.}
A \emph{substitution}  is a mapping of finite domain from  into .
The application of a substitution  to terms and hedges 
(written with postfix notation)
is defined recursively by
 when ,
 when ,
  for ,
.



\medskip\noindent{\bf Contexts.}
A \emph{context} is a hedge 
with a distinguished variable  linear (with exactly one occurrence) in .
The application of a context  to a hedge  
is defined by :
it consists in inserting  into an hedge in  at the position of .
Sometimes, we write  in order to emphasis that  is a subterm (or subhedge) of .




\subsection{Hedge Automata}
We consider two typing formalisms for XML documents,
defined as two classes of unranked tree automata.
The first class is the hedge-automata~\cite{Murata00}, denoted HA.
Most popular XML typing schemas like W3C XML Schemas or Relax NG are equivalent in expressiveness to HA.
The second and perhaps lesser known class is 
the context-free hedge automata, denoted CF-HA and introduced in~\cite{OhsakiST03}. 
CF-HA are strictly more expressive than HA and
we shall see that they are of interest for
the typing of certain update operations.


\begin{definition} \label{def:ha}
A \emph{hedge automaton} (resp. \emph{context-free hedge automaton}) 
is a tuple  
where   is an finite unranked alphabet, 
 is a finite set of states disjoint from ,
 is a set of final states, 
and  is a set of transitions of the form  
where ,  and  is a regular word language 
(resp. a context-free word language). 
\end{definition}
When  is clear from the context it is omitted in the tuple specifying~. 
We define the move relation between ground hedges 
in  as follows: 
 iff there exists a context  
and a transition  such that 
, with  and 
. 
The relation   is the transitive closure of .


\paragraph{Collapsing Transitions.}
We consider the extension of HA and CF-HA with so called 
with \emph{collapsing transitions} which are special transitions of the form  
where  is a CF language and  is a state.
The move relation for the extended set of transitions
generalizes the above definition with the case

if  is a collapsing transition of  and .
Note that we do not exclude the case  in this definition,
i.e.  may contain the empty word in .
Collapsing transitions with a singleton language  containing a length one word
(i.e. transitions of the form  , where  and  are states)
correspond to \emph{-transitions} for tree automata.


\paragraph{Languages.}
The language of a HA or CF-HA  in one of its states ,
denoted by , is the set of ground hedges  
such that . 
We say sometimes that an hedge of  has type  (when  is clear from context).
A hedge is accepted by  if there exists  such that . 
The language of , denoted by   is the set of hedge accepted by . 

Note that without collapsing transitions, all the hedges of  are terms.
Indeed, by applying standard transitions of the form , 
one can only reduce length-one hedges into states.
But collapsing transitions permit to reduce a ground hedge 
of length more than one into a single state.

The -transitions of the form  do not
increase the expressiveness HA or CF-HA
(see~\cite{tata} for HA and the proof for CF-HA is similar).
But the situation is not the same in general for collapsing transitions:
collapsing transitions strictly extend HA in expressiveness,
and even collapsing transitions of the form 
where the left member  is a finite (hence regular) word language.
\begin{example}~\cite{JR-rta2008}.
The extended HA 
\{g(a^n b^n) \mathbin{|} n \geq 1 \}\F\A\A'L(\A') = L(\A) \cap \T(\F)\A = (\F, Q, Q^\final, \Delta)a \in \Fq \in Qa(L_{a, q}) \to q\Deltaa(L_1) \to qa(L_2) \to qa(L_1 \cup L_2) \to q\R\F\ell \to r\ell \in \H(\Sigma,\X) \setminus \Xr \in \H(\Sigma,\X)\ellr\R\lrstep{}{\R}\R\H(\F, \X)\Rh \lrstep{}{\R} h'u\ell \to r \in \R\sigmah = u[ \ell \sigma ]h' = u [ r\sigma ]\lrstep{}{\R}\lrstep{*}{\R}\R = \{ g(x) \to x \}g(h) \lrstep{}{\R} hh \in \H(\F, \X)h\R = \{ g(x) \to g(axb) \}g(c) \lrstep{*}{\R} g(a^n c b^n)n \geq 0\A = (\F, Q, Q^\final, \Delta)\F\A\ptrs{\R}{\A}\ell \to r\ell \in \H(\Sigma,\X)r \in \H(\Sigma \uplus Q,\X)Qr\A\lrstep{}{\ptrs{\R}{\A}}\ptrs{\R}{\A}\lrstep{}{\R[\A]}\R[\A]\ell \to r\ptrs{\R}{\A}rq \in QL(\A, q)L \subseteq \H(\Sigma,\X)\ptrs{\R}{\A}\post_{\ptrs{\R}{\A}}^*(L) = \{ h \in \H(\Sigma,\X) \mid \exists h' \in L, h' \lrstep{*}{\ptrs{\R}{\A}} h \}\pre_{\ptrs{\R}{\A}}^*(L) = \{ h \in \H(\Sigma,\X) \mid \exists h' \in L, h \lrstep{*}{\ptrs{\R}{\A}} h' \}h, h' \in \H(\F)\ptrs{\R}{\A}h \lrstep{*}{\ptrs{\R}{\A}} h'L\rightarrow RLR\tau_{in}\tau_{out}\ptrs{\R}{\A}\post^*(\tau_{in}) \subseteq \tau_{out}\tau_{in} \subseteq \pre^*(\tau_{out})\tau_{in}\tau_{out}\R / AL\post^*_\R(L)\pre^*_\R(L)\post^*_\R(L)\pre^*_\R(L)L\R\R\tau_{\mathit{in}}\R\tau_{\mathit{in}}\post^*_{\R}(\tau_{\mathit{in}})\R\pre^*_{\R}(\tau_{\mathit{out}})\tau_{\mathit{out}}\ptrs{\R}{\A}\XACU\XACU\XACU+\F\A = (\F, Q, Q^\final, \Delta)pp_1p_n\A\XACU\XACU\RENab\INS_\mathsf{first}pa\INS_\mathsf{last}\INS_\mathsf{into}a\INS_\mathsf{left}\INS_\mathsf{right}pa\DELa\RPLp\A\DEL\mathsf{patient}(x) \to ()\mathsf{patient}\INS_{\mathsf{last}}\mathsf{hospital}(x) \to \mathsf{hospital}(x\,p_{\mathsf{pa}})\mathsf{patient}\mathsf{hospital}\mathsf{treatments}\mathsf{hospital}(x) \to \mathsf{hospital}(x\,p_{\mathsf{epa}})\INS_{\mathsf{right}}\mathsf{name}(x) \to \mathsf{name}(x)\,p_{\mathsf{t}}\mathsf{treatment}\mathsf{name}\XACU+\XACU\XACU\XACU\XACU+\XACU\INS_*\REN\INS'_*\INS_*\REN\DEL_{\mathsf{s}}n\mathsf{hospital}(\ldots \mathsf{priority}(p_{\mathsf{pa}}^*)\ldots)\mathsf{priority}\DEL_{\mathsf{s}}\mathsf{priority}(x) \to x\RPL'\RPLanp_1p_n\RPL\DEL\RPLn=1n = 0\XACU\post^*\A\Sigma\ptrs{\R}{\A} \in \XACUL\post_{\ptrs{\R}{\A}}^*(L)\R\AL\A_LLa(L_{a, q}) \to qa(x) \to a(p\, x) \in \ptrs{\R}{\A}(i_{a,q}, p, i_{a,q})i_{a,q}L_{a, q}a(x) \to a(x)\, p \in \ptrs{\R}{\A}(s, q, s')'(s', p, s')\XACU\tau_{\mathit{in}}\tau_{\mathit{out}}\ptrs{\R}{\A}\post^*_{\ptrs{\R}{\A}}(\tau_{\mathit{in}}) \subseteq \tau_{\mathit{out}}\post^*_{\ptrs{\R}{\A}}(\tau_{\mathit{in}})\post^*_{\ptrs{\R}{\A}}(\tau_{\mathit{in}}) \cap \overline{\tau_{\mathit{out}}}\ptrs{\R}{\A}\tau_{\mathit{in}}\XACU+\XACU+\XACU{+} \setminus \XACU\XACU+\F = \{ a,b,c,c'\}\R\INS'_\mathsf{first}\INS'_\mathsf{last}{ c(x) \to c'(ax), c'(x) \to c(xb)}\post^*_\R\bigl(\{ c\}\bigr) \cap \H(\F) = \{ c(a^n b^n) \mid n \geq 0 \}\post^*_\R\bigl(\{ c \}\bigr)\F = \{ a,b,c\}\R\DEL_{\mathsf{s}}{ c(x) \to x}Lc(a c(a \ldots c \ldots b) b)\bigl\{ a \to q_a, b \to q_b, c\bigl(\{ (), q_a\, q\, q_b\}\bigr) \to q \bigr\}\post^*_\R(L) \cap c\bigl( \{ a, b \}^*\bigr)   = \{ c(a^n b^n) \mid n \geq 0 \}\post^*_\R(L)\A\Sigma\ptrs{\R}{\A} \in \XACU+L\post_{\ptrs{\R}{\A}}^*(L)\R\AL\A_LL\G_{a,q}A_LI'_{a,q}\ptrs{\R}{\A}a(x) \to b(x) \in \ptrs{\R}{\A}I'_{b,q} := I'_{a,q}a(x) \to b(p\, x)I'_{b,q} := p I'_{a,q}p_1 \ldots p_n \to qa(x) \to p_1 \ldots p_n \in \ptrs{\R}{\A}\XACU+\A\Sigma\ptrs{\R}{\A} \in \XACU+L\pre_{\ptrs{\R}{\A}}^*(L)\ptrs{\R}{\A} \in \XACU+\tau_{\mathit{out}}\ptrs{\R}{\A}\tau_{\mathit{in}}\XACU_\mathsf{annot}tD\RPL\A = (\F, Q, Q^\final, \Delta)\F\A\ptrs{\R}{\A}L :: \ell \to r \ellrL \subseteq \T(\Sigma)LL:: \ell \to r tt \in L\XACU_{annot}\XACU_2+a(x)a(xy)\INS_{\mathsf{into}}aa\INS_\mathsf{left}\INS_\mathsf{right}\RPL\DEL\DEL_{\mathsf{s}}\DEL_2\mathsf{hospital}(y\,\mathsf{patient}(x)\,z) \to \mathsf{hospital}(y\,z)\mathsf{patient}\mathsf{hospital}\ann(b,a)YN[q]q\ann(b,a) = YN[q]abDab\XACU_2+\XACU+\XACU+\XACU_2+\A\Sigma\ptrs{\R}{\A} \in \XACU_2+L\pre^*_{\ptrs{\R}{\A}}(L)(\ptrs{\R_a}{\A}, \ptrs{\R_f}{\A})\R_a\R_f\mathsf{hospital}\mathsf{patient}\RPL_2\mathsf{patient}(y\, \mathsf{name}(x)\,z) \to \mathsf{patient}(y\, p_\mathsf{n}\, z)\mathsf{patient}(x) \to ()\mathsf{patient}\mathsf{hospital}(x) \to \mathsf{hospital}(x\,p_{\mathsf{pa}})\mathsf{patient}D\A\F(\ptrs{\R_a}{\A}, \ptrs{\R_f}{\A})t \in \T(\F)u \in \T(\F)t \lrstep{}{\ptrs{\R_f}{\A}} ut \lrstep{*}{\ptrs{\R_a}{\A}} u\XACU+\{ u \in \T(\F) \mid t \lrstep{}{\ptrs{\R_f}{\A}} u \}\A\R_ft\post^*_{\ptrs{\R_a}{\A}}(\{ t \})\A\R_att\XACU\XACU^th\G = (\Sigma, \N, I, \Gamma)\SigmaNI \in \N\Gamma \in \N \times (\N \cup \Sigma)^*\F\A\A'L(\A') \cap \T(\F) = L(\A) \cap \T(\F)\G = (Q, N, I, \Gamma)\G_1 = (Q, N_1, I_1, \Gamma_1)Q\G\G_1LL_1L \to qa(L_1) \to pNN_1\G\G_1q \in QX_q\Gamma[q \leftarrow X_q]\GammaqX_q\AQa \in \Fp \in Q\G_{a,p}L_{a, p}a(L_{a, p}) \to p\A\A'\AL \to q\AL \to qa \in \Fp \in Q\G_{a,p}\G_{a,p}\mathclose{\downarrow}_{q}^{\G}\GLB = (\Sigma, S, i, F, \Gamma)\SigmaSiF \subseteq S\Gamma \subseteq S \times (\Sigma \cup \{ \varepsilon \}) \times S\varepsilons, s' \in Ss \lrstep{\varepsilon}{B} s's's\varepsilonBs \lrstep{a_1\ldots a_n}{} s'a_1,\ldots, a_n \in \Sigma2(n+1)s_0, s'_0, \ldots, s_{n}, s'_n \in Ss_0 = ss_n  \lrstep{\varepsilon}{B} s'0 \leq i < ns_i \lrstep{\varepsilon}{B} s'_{i}( s'_i, \sigma_{i+1}, s_{i+1}) \in \Gamma\A\Sigma\ptrs{\R}{\A} \in \XACUL\post_{\ptrs{\R}{\A}}^*(L)\R\AL\A = (\F, P, P^\final, \Theta)\A_L = (\F, Q_L, Q_L^\final, \Delta_L)L\A\A_LPQ_L\A' = (P \uplus Q_L, Q_L^\final, \Delta')\post^*_{\ptrs{\R}{\A}}(L)a \in \Fq \in Q_LL_{a, q}a(L_{a, q}) \to q \in \Delta_LB_{a, q} = \bigl(Q_L, S_{a, q}, \init_{a, q}, \{ f_{a, q} \}, \Gamma_{a, q}\bigr)L_{a, q}Q_LS_{a, q}\init_{a, q} \in S_{a, q}f_{a, q} \in S_{a, q}\Gamma_{a, q} \subseteq S_{a, q} \times Q_L \times S_{a, q}S_{a, q}SS_{a,q}a \in \Fq\in Q_L\Delta'\Gamma' \subseteq S \times (P \cup Q_L) \times S\Gamma'\Gamma_0\Gamma_{a,q}a \in \Sigmaq\in Q_L\Gamma'\ptrs{\R}{\A}a \in \Fq \in Q_LB'_{a, q}(P \cup Q_L, S, \init_{a,q}, \{ f_{a, q} \}, \Gamma')B'_{a, q}L(B'_{a, q})\RENa(x) \to b(x) \in \ptrs{\R}{\A}q \in Q_L\varepsilon(\init_{b,q}, \varepsilon, \init_{a,q})(f_{a,q}, \varepsilon, f_{b,q})\Gamma'\INS_\mathsf{first}a(x) \to a(p\, x) \in \ptrs{\R}{\A}q \in Q_L(i_{a,q}, p, i_{a,q})\Gamma'\INS_\mathsf{last}a(x) \to a(x\, p) \in \ptrs{\R}{\A}q \in Q_L(f_{a,q}, p, f_{a,q})\Gamma'\INS_\mathsf{into}a(xy) \to a(x\, p\, y) \in \ptrs{\R}{\A}q \in Q_Ls \in Si_{a,q}\Gamma'(s, p, s)\Gamma'\INS_\mathsf{left}a(x) \to p\, a(x) \in \ptrs{\R}{\A}q \in Q_Ls \in SL(B'_{a,q}) \neq \emptyset(s, q, s') \in \Gamma'(s, p, s)\Gamma'\INS_\mathsf{right}a(x) \to a(x)\, p \in \ptrs{\R}{\A}q \in Q_Ls' \in SL(B'_{a,q}) \neq \emptyset(s, q, s') \in \Gamma'(s', p, s')\Gamma'\RPLa(x) \to p \in \ptrs{\R}{\A}q \in Q_Ls, s' \in SL(B'_{a,q}) \neq \emptyset(s, q, s') \in \Gamma'(s, p, s')\Gamma'\DELa(x) \to () \in \ptrs{\R}{\A}q \in Q_Ls, s' \in SL(B'_{a,q}) \neq \emptyset(s, q, s') \in \Gamma'\varepsilon(s, \varepsilon, s')\Gamma'\Gamma'L(\A') = \post^*_{\ptrs{\R}{\A}}(L)L(\A') \subseteq \post^*_{\ptrs{\R}{\A}}(L)t \in L(\A', q)q \in Q_Lu \in L(\A_L, q)u \lrstep{*}{\R} t\M\Gamma'\Gamma_0\A'tq\Gamma_0t \in L(\A_L, q)\Gamma' \setminus \Gamma_0\RENt \in L(\A', q)q \in Q_L\varepsilon(\init_{b,q}, \varepsilon, \init_{a,q})\A't\varepsilon\Gamma'a(x) \to b(x) \in \ptrs{\R}{\A}\A'\varepsilont[b(q_1\ldots q_n)] \lrstep{}{\A'} t[q_0]b(B_{b,q_0}) \to q_0q_1\ldots q_n \in L(B_{b,q_0})\init_{b,q} \lrstep{q_1\ldots q_n}{B_{b,q_0}} f_{b,q}(\init_{b,q}, \varepsilon, \init_{a,q})(f_{a,q}, \varepsilon, f_{b,q})\varepsilon\Gamma'(\init_{b,q}, \varepsilon, \init_{a,q})\init_{a,q} \lrstep{q_1\ldots q_n}{B_{a,q_0}} f_{a,q}q_1\ldots q_n \in L(B_{a,q_0})t'= t[a(h)] \lrstep{*}{\A'} t[a(q_1\ldots q_n)] \lrstep{}{\A'} t[q_0] \lrstep{*}{\A'} qt' \in L(\A', q)\Mtu \in L(\A_L, q)u \lrstep{*}{\ptrs{\R}{\A}} t't' = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} t[b(h)] = ta(x) \to b(x)u \lrstep{*}{\ptrs{\R}{\A}} t\INS_{\mathsf{first}}t \in L(\A', q)q \in Q_L(\init_{a,q}, p, \init_{a,q})\A't\Gamma'a(x) \to a(p\,x) \in \ptrs{\R}{\A}\A't_p \in L(\A,p)t[a(p\,q_1\ldots q_n)] \lrstep{}{\A'} t[q_0]b(B_{a,q_0}) \to q_0p\,q_1\ldots q_n \in L(B_{a,q_0})\init_{a,q} \lrstep{p\,q_1\ldots q_n}{B_{a,q_0}} f_{a,q}(\init_{a,q}, p, \init_{a,q})\init_{a,q} \lrstep{q_1\ldots q_n}{B_{a,q_0}} f_{a,q}q_1\ldots q_n \in L(B_{a,q_0})t'= t[a(h)] \lrstep{*}{\A'} t[a(q_1\ldots q_n)] \lrstep{}{\A'} t[q_0] \lrstep{*}{\A'} qt' \in L(\A', q)\Mtu \in L(\A_L, q)u \lrstep{*}{\R} t't' = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} t[a(t_p h)] = ta(x) \to b(x)u \lrstep{*}{\R} t\INS_{\mathsf{last}}\INS_{\mathsf{into}}t \in L(\A', q)q \in Q_L(s, p, s)\A't\Gamma'a(xy) \to a(xpy) \in \ptrs{\R}{\A}\A't_p \in L(\A,p)(s, p, s)t[a(q_1\ldots q_n \, p\,q'_1\ldots q'_m)] \lrstep{}{\A'} t[q_0]b(B_{a,q_0}) \to q_0q_1\ldots q_n \, p\,q'_1\ldots q'_m \in L(B_{a,q_0})\init_{a,q} \lrstep{q_1\ldots q_n}{B_{a,q_0}} s
      \lrstep{p}{B_{a,q_0}} s \lrstep{q'_1\ldots q'_m}{B_{a,q_0}} f_{a,q}(s, p, s)\init_{a,q} \lrstep{q_1\ldots q_n\, q'_1\ldots q'_m}{B_{a,q_0}} f_{a,q}q_1\ldots q_n\, q'_1\ldots q'_m \in L(B_{a,q_0})t'= t[a(h\ell)] \lrstep{*}{\A'} t[a(q_1\ldots q_n\, q'_1\ldots q'_m)] 
 \lrstep{}{\A'} t[q_0] \lrstep{*}{\A'} qt' \in L(\A', q)\Mtu \in L(\A_L, q)u \lrstep{*}{\ptrs{\R}{\A}} t't' = t[a(h\ell)] \lrstep{}{\ptrs{\R}{\A}} t[a(h\, t_p\, \ell)] = ta(xy) \to b(xpy)u \lrstep{*}{\ptrs{\R}{\A}} t\INS_{\mathsf{left}}t \in L(\A', q)q \in Q_L(s, p, s)\A't\Gamma'a(x) \to p\,a(x) \in \ptrs{\R}{\A}(s,q_0,s') \in \Gamma'q_0 \in Q_LL(B_{a,q_0}) \neq \emptyset\A't_p \in L(\A,p)(s, p, s)s \lrstep{p q_0}{B_{b,q'}} s'b(s, p, s)s \lrstep{q_0}{B_{b,q'}} s't' = t[a(h)] \lrstep{*}{\A'} t[q_0] \lrstep{*}{\A'} qt' \in L(\A', q)\Mtu \in L(\A_L, q)u \lrstep{*}{\ptrs{\R}{\A}} t't' = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} t[t_p\, a(h)] = ta(x) \to p, a(x)u \lrstep{*}{\ptrs{\R}{\A}} t\INS_{\mathsf{right}}\RPLt \in L(\A', q)q \in Q_L(s, p, s')\A't\Gamma'a(x) \to p \in \ptrs{\R}{\A}(s,q_0,s') \in \Gamma'q_0 \in Q_LL(B'_{a,q_0}) \neq \emptyset\A't_p \in L(\A,p)(s, p, s')s \lrstep{p}{B_{b,q'}} s'bq' \in Q_L(s, p, s')(s, q_0, s')s \lrstep{q_0}{B_{b,q'}} s't' = t[a(h)] \lrstep{*}{\A'} t[q_0] \lrstep{*}{\A'} qt' \in L(\A', q)\Mt(s, q_0, s')\Gamma_0u \in L(\A_L, q)u \lrstep{*}{\ptrs{\R}{\A}} t't' = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} t[t_p] = ta(x) \to pu \lrstep{*}{\ptrs{\R}{\A}} t\DELt \in L(\A', q)q \in Q_L(s, \varepsilon, s')\A't\Gamma'a(x) \to () \in \ptrs{\R}{\A}(s,q_0,s') \in \Gamma'q_0 \in Q_LL(B'_{a,q_0}) \neq \emptyset\varepsilon(s, \varepsilon, s')(s,q_0,s')t \lrstep{*}{\A'} qt' \in L(\A', q)\Mt(s, q_0, s')\Gamma_0u \in L(\A_L, q)u \lrstep{*}{\ptrs{\R}{\A}} t't' = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} ta(x) \to ()u \lrstep{*}{\ptrs{\R}{\A}} t\subseteqL(\A') \supseteq \post^*_{\ptrs{\R}{\A}}(L)t \in Lt \lrstep{*}{\ptrs{\R}{\A}} uu \in L(\A')(0)u = t \in LL = L(\A_L) \subseteq L(\A')t \lrstep{+}{\ptrs{\R}{\A}} ut \in L\RENa(x) \to b(x) \in \ptrs{\R}{\A}t[a(h)] \in L(\A')q_1 \ldots q_n \in L(B'_{a, q_0})\init_{a,q_0} \lrstep{q_1 \ldots q_n}{B'_{a, q_0}} f_{a,q_0}\varepsilon(\init_{b,q_0}, \varepsilon, \init_{a,q_0})(f_{a,q_0}, \varepsilon, f_{b,q_0})\Gamma'\init_{b,q_0} \lrstep{q_1 \ldots q_n}{B'_{b, q_0}} f_{b,q_0}q_1 \ldots q_n \in L(B'_{b, q_0})t \in L(\A')\INS_\mathsf{first}a(x) \to a(p\,x) \in \ptrs{\R}{\A}p \in Pt_p \in L(\A, p)t[a(h)] \in L(\A')q_1 \ldots q_n \in L(B'_{a, q_0})\init_{a,q_0} \lrstep{q_1 \ldots q_n}{B'_{a, q_0}} f_{a,q_0}(\init_{a,q_0}, p, \init_{a,q_0})\Gamma'\init_{a,q_0} \lrstep{p}{B'_{a, q_0}} \init_{a,q_0} 
       \lrstep{q_1 \ldots q_n}{B'_{a, q_0}} f_{b,q_0}p\,q_1 \ldots q_n \in L(B'_{a, q_0})t \in L(\A')\INS_\mathsf{last}a(x) \to a(x\, p) \in \ptrs{\R}{\A}p \in P\INS_\mathsf{into}a(xy) \to a(x\,p\,y) \in \ptrs{\R}{\A}p \in Pt_p \in L(\A, p)t[a(h\ell)] \in L(\A')q_1 \ldots q_n\, q'_1 \ldots q'_m \in L(B'_{a, q_0})\init_{a,q_0} \lrstep{q_1 \ldots q_n}{B'_{a, q_0}} s 
 \lrstep{q'_1 \ldots q'_m}{B'_{a, q_0}} f_{a,q_0}s \in S(s, p, s)\Gamma'\init_{a,q_0} \lrstep{q_1 \ldots q_n}{B'_{a, q_0}} s \lrstep{p}{B'_{a, q_0}} s
 \lrstep{q'_1 \ldots q'_m}{B'_{a, q_0}} f_{a,q_0}q_1 \ldots q_n\, p\,q'_1 \ldots q'_m \in L(B'_{a, q_0})t \in L(\A')\INS_\mathsf{left}a(x) \to p\,a(x) \in \ptrs{\R}{\A}p \in Pt_p \in L(\A, p)t[a(h)] \in L(\A')L(B'_{a, q_0}) \neq \emptyset(s, q_0, s') \in \Gamma'(s, p, s)\Gamma't \in L(\A')\INS_\mathsf{right}a(x) \to a(x)\, p \in \ptrs{\R}{\A}p \in P\RPLa(x) \to p \in \ptrs{\R}{\A}p \in Pt_p \in L(\A, p)t[a(h)] \in L(\A')L(B'_{a, q_0}) \neq \emptyset(s, q_0, s') \in \Gamma'(s, p, s')\Gamma't \in L(\A')\DELa(x) \to () \in \ptrs{\R}{\A}t[a(h)] \in L(\A')L(B'_{a, q_0}) \neq \emptyset(s, q_0, s') \in \Gamma'\varepsilon(s, \varepsilon, s')\Gamma't \in L(\A')\supseteq\A\Sigma\ptrs{\R}{\A} \in \XACU+L\post_{\ptrs{\R}{\A}}^*(L)\R\AL\A = (P, P^\final, \Theta)\A_L = (Q_L, Q_L^\final, \Delta_L)LPQ_L\A' = (P \uplus Q_L, Q_L^\final, \Delta')\post^*_{\ptrs{\R}{\A}}(L)\Delta'\Delta_L \cup \Thetaa \in \Fq \in Q_LL_{a, q}a(L_{a, q}) \to q \in \Delta_L\G_{a, q} = (Q_L, N_{a, q}, I_{a, q}, \Gamma_{a, q})L_{a, q}Q_LN_{a, q}I_{a, q} \in N_{a, q}\Gamma_{a, q}N_{a, q}I'_{a, q}a \in \Fq \in Q_Laq\Delta'X_pp \in P\Delta'C'\Gamma'P \cup Q_L\Gamma' = \Gamma'_0 := \displaystyle\bigcup_{a \in \F, q \in Q} 
  \bigl(P_{a, q} \cup \{ I'_{a,q} := I_{a,q} \}\bigr) 
  \cup \{ X_p := p \mid p \in P \} \ptrs{\R}{\A}\Gamma'C'a \in \Fq \in Q_L\G'_{a, q}(P \cup Q_L, \N, I'_{a, q}, \Gamma')L'_{a, q} = L(\G'_{a, q})\Gamma'\RENa(x) \to b(x) \in  \ptrs{\R}{\A}q \in Q_LI'_{b,q} := I'_{a,q}\Gamma'\INS'_\mathsf{first}a(x) \to b(p\, x) \in  \ptrs{\R}{\A}q \in Q_LI'_{b,q} := X_p I'_{a,q}\Gamma'\INS'_\mathsf{last}a(x) \to b(x\, p) \in  \ptrs{\R}{\A}q \in Q_LI'_{b,q} := I'_{a,q} X_p\Gamma'\INS_\mathsf{into}a(xy) \to a(x\, p\, y) \in  \ptrs{\R}{\A}q \in Q_LN \in \NI'_{a, q}\Gamma'N := N X_pN := X_p N\INS_\mathsf{left}a(x) \to p\, a(x) \in  \ptrs{\R}{\A}q \in Q_LL'_{a,q} \neq \emptysetp\,q \to qC'\INS_\mathsf{right}a(x) \to a(x)\, p \in \ptrs{\R}{\A}q \in Q_LL'_{a,q} \neq \emptysetq\, p \to qC'\RPL'a(x) \to p_1 \ldots p_n \in \ptrs{\R}{\A}n \geq 0q \in Q_LL'_{a,q} \neq \emptysetp_1 \ldots p_n \to qC'\DELa(x) \to () \in \ptrs{\R}{\A}q \in Q_LL'_{a,q} \neq \emptyset() \to qC'\INS_\mathsf{first}\INS_\mathsf{last}\RPL\INS'_\mathsf{first}\INS'_\mathsf{last}\RPL'L(\A') = \post^*_{\ptrs{\R}{\A}}(L)\post^*_{\ptrs{\R}{\A}}(L)\subseteq\A'\Gamma' \setminus \Gamma_0\G'_{a, q_0}q_1\ldots q_n \in Q^*\A'C[a(q_1\ldots q_n)] \to C[q_0]t \lrstep{*}{\A'} q \ptrs{\R}{\A}\supsetequ \lrstep{*}{\ptrs{\R}{\A}} tu \in L(\A)L(\A') \subseteq \post^*_{\ptrs{\R}{\A}}(L)t \in L(\A', q)q \in Q_Lu \in L(\A_L, q)u \lrstep{*}{\ptrs{\R}{\A}} tt \lrstep{*}{\A'} q\Gamma' \setminus \Gamma_0\G'_{a, q_0}q_1\ldots q_n \in Q^*\A'u[a(q_1\ldots q_n)] \to u[q_0]t \lrstep{*}{\A'} q\vdash\Gamma'\vdash^*\Gamma' \setminus \Gamma_0 \ptrs{\R}{\A}u \lrstep{*}{\ptrs{\R}{\A}} t\Gamma' \setminus \Gamma_0t \lrstep{*}{\A_L} qt \lrstep{*}{\A'} qI'_{a, q} \vdash I_{a, q}u = tt \lrstep{*}{\A'} qt[a(q_1\ldots q_n)] \lrstep{}{\A'} t[q_0]I'_{a, q_0} \vdash^* q_1\ldots q_n\G'_{a, q_0}\Gamma' \setminus \Gamma_0 \ptrs{\R}{\A}\XACU_1\Gamma' \setminus \Gamma_0i \leq nt_i \lrstep{*}{\A'} q_it_i \in L(\A, q_i)i \leq n\RENI'_{a, q_0} \vdash I'_{b, q_0} \vdash^* q_1\ldots q_nI'_{a, q_0} := I'_{b, q_0}b(x) \to a(x) \in  \ptrs{\R}{\A}I'_{b, q_0} \vdash^* q_1\ldots q_nu \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} ss = t[ b(t_1\ldots t_n) ] \lrstep{}{\ptrs{\R}{\A}} t = t[a(t_1\ldots t_n)]b(x) \to a(x) \in  \ptrs{\R}{\A}u \lrstep{*}{\ptrs{\R}{\A}} t\INS'_\mathsf{first}I'_{b, q_0} \vdash X_p I'_{a, q_0} \vdash^* q_1\ldots q_nI'_{b, q_0} := X_p I'_{a, q_0}a(x) \to b(p x) \in  \ptrs{\R}{\A}q_1 = pI'_{a, q_0} \vdash^* q_2\ldots q_nu \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} ss = t[ a(t_2\ldots t_n) ] \lrstep{}{\ptrs{\R}{\A}} t = t[b(t_1\ldots t_n)]a(x) \to a(p x) \in  \ptrs{\R}{\A}t_1 \in L(\A, p)u \lrstep{*}{\ptrs{\R}{\A}} t\INS'_\mathsf{last}\INS_\mathsf{into}I'_{a, q_0} \vdash^* \alpha N \beta \vdash \alpha N X_p\, \beta 
 \vdash \alpha N\, p \beta  \vdash^*  q_1\ldots q_nN := N X_pa(xy) \to a(x p y) \in  \ptrs{\R}{\A}NI'_{a,q}\Gamma'k < \ell \leq n\alpha \vdash^* q_1\ldots q_kN X_p \vdash^* q_{k+1} \ldots q_{\ell}q_{\ell} = p\beta \vdash^* q_{\ell+1} \ldots q_n\ell = nu \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} ss = t[ a(t_1 \ldots t_{\ell-1}\, t_{\ell+1}\ldots t_n) ] \lrstep{}{\ptrs{\R}{\A}} 
 t = t[a(t_1\ldots t_n)]a(xy) \to a(x p y)t_n \in L(\A, p)u \lrstep{*}{\ptrs{\R}{\A}} tt \lrstep{*}{\A'} qL' \to q \in \Delta'q_1\ldots q_n \in L't \lrstep{*}{\A'} t[ q_1\ldots q_n ]t_i \in L(\A', q_i)i \leq nL' \to qC'\A_L\A \ptrs{\R}{\A}\XACU+\INS_\mathsf{left}n = 2q_1 = p \in Pq_2 = q_0p q_0 \to q_0a(x) \to p a(x) \in  \ptrs{\R}{\A}u \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} ss \lrstep{}{\ptrs{\R}{\A}} ta(x) \to p a(x)t_1 \in L(\A, p)u \lrstep{*}{\ptrs{\R}{\A}} t\INS_\mathsf{right}\RPL'i \leq nq_i = p_i \in Pp_1\ldots p_n \to q_0a(x) \to p_1 \ldots p_n \in  \ptrs{\R}{\A}L'_{a, q_0} \neq \emptyseta(h) \in L(\A', q_0)u \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} sa(x) \to p_1\ldots p_ns \lrstep{}{\ptrs{\R}{\A}} tt_i \in L(\A, p_i)i \leq nu \lrstep{*}{\ptrs{\R}{\A}} t\DELn=0() \to q_0C'a(x) \to () \in  \ptrs{\R}{\A}L'_{a, q_0} \neq \emptyseta(h) \in L(\A', q_0)u \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} ss \lrstep{}{\ptrs{\R}{\A}} ta(x) \to ()u \lrstep{*}{\ptrs{\R}{\A}} t\DEL_{\mathsf{s}}L'_{a, q_0} \to q_0\Delta'a(x) \to x \in  \ptrs{\R}{\A}L'_{a, q_0} \neq \emptysetq_1\ldots q_n \in L'_{a, q_0}u \in L(\A, q)u \lrstep{*}{\ptrs{\R}{\A}} ss \lrstep{}{\ptrs{\R}{\A}} ta(x) \to xu \lrstep{*}{\ptrs{\R}{\A}} t\subseteqL(\A') \supseteq \post^*_{\ptrs{\R}{\A}}(L)u \in Lu \lrstep{*}{\ptrs{\R}{\A}} tt \in L(\A')(0)u = t \in LL \subseteq L(\A')\Gamma'I'_{a, q} := I_{a, q}a \in \Sigmaq \in Q_Lt \in L(\A')(k+1)u \lrstep{*}{\ptrs{\R}{\A}} t\RENa(x) \to b(x) \in  \ptrs{\R}{\A}u[a(h)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}q_1 \ldots q_n\G'_{a,q_0}I'_{a,q_0}\Gamma'\Gamma'I'_{b, q_0} := I'_{a, q_0}q_1 \ldots q_n \in L'_{b, q_0}\G'_{b,q_0}I'_{b,q_0}\Gamma't \in L(\A')\INS'_\mathsf{first}a(x) \to b(p\,x) \in  \ptrs{\R}{\A}p \in Pt_p \in L(\A, p)u[a(h)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}q_1 \ldots q_n\G'_{a,q_0}I'_{a,q_0}\Gamma'\Gamma'I'_{b, q_0} := X_p I'_{a, q_0}p q_1 \ldots q_nL'_{b, q_0}t \in L(\A')\INS'_\mathsf{last}\INS_\mathsf{into}a(xy) \to a(x p y) \in  \ptrs{\R}{\A}p \in Pt_p \in L(\A, p)u[a(h \ell)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}q_1 \ldots q_n\G'_{a,q_0}I'_{a,q_0}\Gamma'\Gamma'N := N X_pN := X_p NNI'_{q, q_0}\Gamma'q_1 \ldots q_j\, p\, q_{j+1}\ldots q_n\G'_{a,q_0}I'_{a,q_0}\Gamma'jht \in L(\A')\INS_\mathsf{left}a(x) \to p a(x) \in  \ptrs{\R}{\A}p \in Pt_p \in L(\A,p)u[a(h)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}\A'p q_0 \to q_0t \in L(\A')\INS_\mathsf{right}\RPL'a(x) \to p_1\ldots p_n \in  \ptrs{\R}{\A}p_1,\ldots, p_n \in Pt_i \in L(\A,p_i)i \leq nu[a(h)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}\A'p_1\ldots p_n \to q_0t \in L(\A')\DEL_{\mathsf{s}}a(x) \to () \in  \ptrs{\R}{\A}u[a(h)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}\A'() \to q_0t \in L(\A')\DEL_{\mathsf{s}}a(x) \to x \in  \ptrs{\R}{\A}u[a(h)] \in L(\A')q_1 \ldots q_n \in L'_{a, q_0}\A'L'_{a, q_0} \to q_0t \in L(\A')\supseteq\A\Sigma\ptrs{\R}{\A} \in \XACU+L\pre_{\ptrs{\R}{\A}}^*(L)\A = (P, P^\final, \Theta)\A_L = (Q_L, Q_L^\final, \Delta_L)L\A_Ltqt \in L(\A', q)a \in \Fq \in Q_LB_{a, q} = (Q_L, S_{a, q}, i_{a, q}, \{ f_{a, q} \}, \Gamma_{a, q})L_{a, q}a(L_{a, q}) \to q \in \Delta_L\A_0, \A_1, \ldots, \A_k\pre^*_{\ptrs{\R}{\A}}(L)i \leq n\A_i = (\F, Q_L, Q_L^\final, \Delta_i)\Delta_{i}\CQ_L\CB_{a, q}a \in \Fq \in Q_LB\in \CB = (Q_L, S, i, F, \Gamma) \in \Cs, s' \in SB_{s,s'} := (Q_L, S, s, \{ s' \}, \Gamma)\CB \in \CB = (Q_L, S, i, F, \Gamma) \in \Cq \in Q_Ls, s' \in S(Q_L, S, i, F, \Gamma \cup \{ \langle s,q,s'\rangle \})(Q_L, S, i, F, \Gamma \cup \{ \langle s,\varepsilon,s'\rangle \})B+\langle s,q,s'\rangleB + \langle s,\varepsilon,s'\rangle \C\CB \in \CL(B)BB \in \Cf_B\init_B\Delta_0 = \Delta_L\Delta_ia(L_1,\ldots,L_n) \hookrightarrow_{\Delta_i} qL_1,\ldots, L_n \subseteq Q_Lq \in Q_La(L) \to q \in \Delta_iL_1\ldots L_n \subseteq L\RENa(x) \to b(x) \in \ptrs{\R}{\A}B \in \Cq \in Q_Lb(B) \hookrightarrow q\Delta_{i+1} := \Delta_i \cup \{ a(B) \to q \}\INS'_\mathsf{first}a(x) \to b(p\, x)  \in \ptrs{\R}{\A}B\in \Cq, q_p \in Q_LL(\A_i, q_p) \cap L(\A, p) \neq \emptysetb(q_p B) \hookrightarrow_{\Delta_i} q\Delta_{i+1} := \Delta_i \cup \{ a(B) \to q\}\INS'_\mathsf{last}a(x) \to b(x\, p)  \in \ptrs{\R}{\A}B\in \Cq, q_p \in Q_LL(\A_i, q_p) \cap L(\A, p) \neq \emptysetb(B\, q_p) \hookrightarrow_{\Delta_i} q\Delta_{i+1} := \Delta_i \cup \{ a(B) \to q \}\INS_\mathsf{into}a(xy) \to a(x\, p\, y) \in \ptrs{\R}{\A}B\in \Cs, s'Bq, q_p \in Q_LL(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q_p}{B} s'a(B) \hookrightarrow_{\Delta_i} q\Delta_{i+1} := \Delta_i \cup \bigl\{ a(B + \langle s, \varepsilon, s'\rangle) \to q \bigr\}\INS_\mathsf{left}a(x) \to p\, a(x) \in \ptrs{\R}{\A}b \in \FB, B' \in \Cs, s'Bq, q_p ,q' \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'L(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q_p q'}{B} s'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s, q', s'\rangle) \to q \bigr\}\INS_\mathsf{right}a(x) \to a(x)\, p \in \ptrs{\R}{\A}b \in \FB, B' \in \Cs, s'Bq, q_p ,q' \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'L(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q' q_p}{B} s'\Delta_{i+1} := \Delta_i \cup\bigl\{ b(B + \langle s, q', s'\rangle) \to q \bigr\}\RPL'a(x) \to p_1\ldots p_n \in \ptrs{\R}{\A}b \in \FB, B' \in \Cs, s'Bq, q', q_1,\ldots, q_n \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'L(\A_i, q_j) \cap L(\A, p_j) \neq \emptyset1 \leq j \leq ns \lrstep{q_1\ldots q_n}{B} s'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s, q', s'\rangle) ) \to q \bigr\}\DELa(x) \to () \in \ptrs{\R}{\A}b \in \FB, B' \in \CsBq, q' \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s,q',s\rangle) \to q \bigr\}\DEL_{\mathsf{s}}a(x) \to x \in \ptrs{\R}{\A}b \in \FB \in \Cs, s'Bq, q' \in Q_Lb(B) \to q \in \Delta_ia(B_{s,s'}) \hookrightarrow_{\Delta_i} q'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s,q',s'\rangle) \to q \bigr\}\INS_\mathsf{first}\INS_\mathsf{last}\RPL\INS'_\mathsf{first}\INS'_\mathsf{last}\RPL'\A_L\C\A'L(\A') = \pre^*_{\ptrs{\R}{\A}}(L)L(\A') \subseteq \pre^*_{\ptrs{\R}{\A}}(L)t \in L(\A', q)q \in Q_Lu \in L(\A_L, q)t \lrstep{*}{\ptrs{\R}{\A}} u\Mt \lrstep{*}{\A'} q\rho \in \Delta_ii > 0\mathit{min}( j > 0 \mid \rho \in \Delta_j)\M\Delta_0t \in L(\A_L, q)u=t\A'q_0 \in Q_Lq_1\ldots q_n \in L(B)t[a(q_1\ldots q_n)] \lrstep{}{\A'} t[q_0]b(B) \to q_0\Delta_{i+1}i \geq 0\Delta_{i+1}\RENa(B) \to q_0\Delta_{i+1}a(x) \to b(x) \in \ptrs{\R}{\A}b(B) \hookrightarrow_{\Delta_i} q_0\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} t[b(h)] = t't \lrstep{*}{\ptrs{\R}{\A}} u\INS'_{\mathsf{first}}a(B) \to q_0\Delta_{i+1}a(x) \to b(p\, x) \in \ptrs{\R}{\A}q_0, q_p \in Q_LL(\A_i, q_p) \cap L(\A, p) \neq \emptysetb(q_p B) \hookrightarrow_{\Delta_i} q_0\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h)] \lrstep{}{\ptrs{\R}{\A}} t[b(t_p\, h)] = t't \lrstep{*}{\ptrs{\R}{\A}} u\INS'_{\mathsf{last}}\INS_{\mathsf{into}}a(B') \to q_0\Delta_{i+1}a(xy) \to b(x\, p\, y) \in \ptrs{\R}{\A}B \in \Cs, s'Bq_0, q_p \in Q_LL(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q_p}{B} s'b(B) \hookrightarrow_{\Delta_i} q_0B' = B + \langle s, \varepsilon, s'\ranglet = a(h \ell)q_1\ldots q_n\, q'_1\ldots q'_m \in L(B')\init_{B'} \lrstep{q_1\ldots q_n}{B'} s \lrstep{\varepsilon}{B'} s' \lrstep{q'_1\ldots q'_m}{B'} f_{B'}\init_{B'}f_{B'}B'\init_{B} \lrstep{q_1\ldots q_n}{B} s \lrstep{q_p}{B} s' \lrstep{q'_1\ldots q'_m}{B'} f_{B}\init_{B'} = \init_{B}f_{B'} = f_{B}\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h\,\ell)] \lrstep{}{\ptrs{\R}{\A}} t[b(h\, t_p\, \ell)] = t't \lrstep{*}{\ptrs{\R}{\A}} ut\A'q_1\ldots q_n \in L(B'')q_0 \in Q_Lt[b(q_1\ldots q_n)] \lrstep{}{\A'} t[q_0]b(B'') \to q_0\Delta_{i+1}i \geq 0\INS_{\mathsf{left}}b(B'') \to q_0\Delta_{i+1}a(x) \to p\,  a(x) \in \ptrs{\R}{\A}B, B' \in \Cs, s'Bq_0, q_p, q'_0 \in Q_Lb(B) \to q_0 \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'_0L(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q_p\, q'_0}{B} s'B'' = B + \langle s, q'_0, s' \ranglet = b(h a(v) \ell)q_1\ldots q_n\, q'_1\ldots q'_m \in L(B'')\init_{B''} \lrstep{q_1\ldots q_n}{B''} s \lrstep{q'_0}{B''} s' \lrstep{q'_1\ldots q'_m}{B''} f_{B''}\init_{B''}f_{B''}B''\init_{B} \lrstep{q_1\ldots q_n}{B} s \lrstep{q_p\, q'_0}{B} s' \lrstep{q'_1\ldots q'_m}{B} f_{B}\init_{B''} = \init_{B}f_{B''} = f_{B}\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h\,a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} t[b(h\, t_p\,a(v) \ell)] = t't \lrstep{*}{\ptrs{\R}{\A}} u\INS_{\mathsf{right}}\RPL'b(B'') \to q_0\Delta_{i+1}a(x) \to p_1\ldots p_n \in \ptrs{\R}{\A}B, B' \in \Cs, s'Bq_0, q'_0, q_{p_1},\ldots, q_{p_n} \in Q_Lb(B) \to q_0 \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'_0L(\A_i, q_{p_j}) \cap L(\A, p_j) \neq \emptysetj \leq ns \lrstep{q_{p_1}\ldots q_{p_n}}{B} s'B'' = B + \langle s, q'_0, s' \ranglet = b(h a(v) \ell)q_1\ldots q_m\, q'_1\ldots q'_{m'} \in L(B'')\init_{B''} \lrstep{q_1\ldots q_m}{B''} s \lrstep{q'_0}{B''} s' \lrstep{q'_1\ldots q'_{m'}}{B''} f_{B''}\init_{B''}f_{B''}B''\init_{B} \lrstep{q_1\ldots q_m}{B} s \lrstep{q_{p_1}\ldots q_{p_n}}{B} s'
  \lrstep{q'_1\ldots q'_{m'}}{B} f_{B}\init_{B''} = \init_{B}f_{B''} = f_{B}j \leq nt_j \in L(\A_i, q_{p_j}) \cap L(\A, p_j)\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h\,a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} t[b(h\, t_1\ldots t_n\, \ell)] = t'a(x) \to p_1\ldots p_nt \lrstep{*}{\ptrs{\R}{\A}} u\DELb(B'') \to q_0\Delta_{i+1}a(x) \to () \in \ptrs{\R}{\A}B, B' \in \CsBq_0, q'_0 \in Q_Lb(B) \to q_0 \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'_0B'' = B + \langle s, q'_0, s \ranglet = b(h\, a(v) \ell)q_1\ldots q_m\, q'_1\ldots q'_{m'} \in L(B'')\init_{B''} \lrstep{q_1\ldots q_m}{B''} s \lrstep{q'_0}{B''} s \lrstep{q'_1\ldots q'_{m'}}{B''} f_{B''}\init_{B''}f_{B''}B''\init_{B} \lrstep{q_1\ldots q_m}{B} s \lrstep{q'_1\ldots q'_{m'}}{B} f_{B}\init_{B''} = \init_{B}f_{B''} = f_{B}\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h\,a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} t[b(h\, \ell)] = t't \lrstep{*}{\ptrs{\R}{\A}} u\DEL_{\mathsf{s}}b(B'') \to q_0\Delta_{i+1}a(x) \to x \in \ptrs{\R}{\A}B\in \Cs, s'Bq_0, q'_0 \in Q_Lb(B) \to q_0 \in \Delta_ia(B_{s,s'}) \hookrightarrow_{\Delta_i} q'_0B'' = B + \langle s, q'_0, s' \ranglet = b(h a(v) \ell)q_1\ldots q_m\, q'_0, q'_1\ldots q'_{m'} \in L(B'')\init_{B''} \lrstep{q_1\ldots q_m}{B''} s \lrstep{q'_0}{B''} s' \lrstep{q'_1\ldots q'_{m'}}{B''} f_{B''}\init_{B''}f_{B''}B''s \lrstep{v_1\ldots v_k}{B_{s,s'}} s'\init_{B} \lrstep{q_1\ldots q_m}{B} s \lrstep{v_1\ldots v_k}{B} s' 
           \lrstep{q'_1\ldots q'_{m'}}{B} f_{B}\init_{B''} = \init_{B}f_{B''} = f_{B}\Mu \in L(\A_L, q)t' \lrstep{*}{\ptrs{\R}{\A}} ut = t[a(h\,a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} t[b(h\, v\, \ell)] = t't \lrstep{*}{\ptrs{\R}{\A}} u\INS_\mathsf{first}\INS_\mathsf{last}\RPL\INS'_\mathsf{first}\INS'_\mathsf{last}\RPL'\subseteqL(\A') \supseteq \pre^*_{\ptrs{\R}{\A}}(L)t \in Lu \lrstep{*}{\ptrs{\R}{\A}} tu \in L(\A')(0)u = t \in LL = L(\A_L) \subseteq L(\A')u \lrstep{+}{\ptrs{\R}{\A}} t\RENu = u[a(h)] \lrstep{}{\ptrs{\R}{\A}} u[b(h)] \lrstep{*}{\ptrs{\R}{\A}} tu_1 =  u[b(h)] \in L(\A')u_1 = u[b(h)] \lrstep{*}{\A'} u[b(q_1\ldots q_n)]  \lrstep{}{\A'} u[q]  \lrstep{*}{\A'} q^\finalq, q_1,\ldots, q_n \in Q_Lq^\final \in Q^\final_La(B) \to q\A'q_1\ldots q_n \in Bu = u[a(h)] \lrstep{*}{\A'} u[a(q_1\ldots q_n)] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\INS'_{\mathsf{first}}u = u[a(h)] \lrstep{}{\ptrs{\R}{\A}} u[b(t_p\, h)] \lrstep{*}{\ptrs{\R}{\A}} tt_p \in L(\A, p)u_1 =  u[b(t_p\, h)] \in L(\A')q, q_p, q_1,\ldots, q_n \in Q_Lq^\final \in Q^\final_LL(\A', q_p) \cap L(\A, p)t_pa(B) \to q\A'q_1\ldots q_n \in Bu = u[a(h)] \lrstep{*}{\A'} u[a(q_1\ldots q_n)] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\INS'_{\mathsf{last}}\INS_{\mathsf{into}}u = u[a(h\ell)] \lrstep{}{\ptrs{\R}{\A}} u[a(h\, t_p\, \ell)] \lrstep{*}{\ptrs{\R}{\A}} tt_p \in L(\A, p)u_1 =  u[a(h\, t_p\, \ell)] \in L(\A')q, q_p, q_1,\ldots, q_m, q'_1,\ldots, q'_n \in Q_Lq^\final \in Q^\final_LL(\A', q_p) \cap L(\A, p)t_p\rhob(B) \to qq_1\ldots q_m q_p q'_1\ldots q'_nB\init_B \lrstep{q_1\ldots q_m}{B} s \lrstep{q_p}{B} s' \lrstep{q'_1\ldots q'_n}{B} f_Bs, s'Ba(B + \langle s,\varepsilon,s'\rangle) \to q\A'q_1\ldots q_m q'_1\ldots q'_nB + \langle s,\varepsilon,s'\rangleu = u[a(h\ell)] \lrstep{*}{\A'} u[a(q_1\ldots q_m q'_1\ldots q'_n)] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\INS_{\mathsf{left}}u = u[b(h\, a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} u[b(h\, t_p\, a(v) \ell)] \lrstep{*}{\ptrs{\R}{\A}} tt_p \in L(\A, p)u_1 =  u[b(h\, t_p\, a(v) \ell)] \in L(\A')q, q', q_p, q_1,\ldots, q_m, q'_1,\ldots, q'_n \in Q_Lq^\final \in Q^\final_La(v) \lrstep{*}{\A'} q'L(\A', q_p) \cap L(\A, p)t_p\rhob(B) \to qq_1\ldots q_m  q_p q' q'_1\ldots q'_nB\init_B \lrstep{q_1\ldots q_m}{B} s \lrstep{q_p q'}{} s' \lrstep{q'_1\ldots q'_n}{B} f_Bss'Bb(B + \langle s,q',s'\rangle) \to q\A'q_1\ldots q_m q' q'_1\ldots q'_nB + \langle s,q',s'\rangleu = u[b(h a(v)\ell)] \lrstep{*}{\A'} u[a(q_1\ldots q_m q' q'_1\ldots q'_n)] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\INS_{\mathsf{right}}\RPL'u = u[b(h a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} u[b(h t_1\ldots t_n \ell)] \lrstep{*}{\ptrs{\R}{\A}} tt_1,\ldots, t_nL(\A, p_1),\ldots, L(\A, p_n)u_1 =  u[b(h t_1\ldots t_n \ell)] \in L(\A')q, q_{p_1},\ldots, q_{p_n}, q_1,\ldots, q_m, q'_1,\ldots, q'_{m'} \in Q_Lq^\final \in Q^\final_Lj \leq nL(\A', q_{p_j}) \cap L(\A, p_j)t_j\rhob(B) \to qq_1\ldots q_m\,  q_{p_1}\ldots q_{p_n}\, q'_1\ldots q'_{m'} \in L(B)\init_B \lrstep{q_1\ldots q_m}{B} s \lrstep{q_{p_1}\ldots q_{p_n}}{} s' \lrstep{q'_1\ldots q'_{m'}}{B} f_Bss'Bq' \in Q_La(v) \lrstep{*}{\A'} q'b(B + \langle s,q',s'\rangle) \to q\A'q_1\ldots q_m\, q'\, q'_1\ldots q'_{m'}B + \langle s,q',s'\rangleu = u[b(h a(v)\ell)] \lrstep{*}{\A'} u[a(q_1\ldots q_m q' q'_1\ldots q'_{m'})] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\DELu = u[b(h a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} u[b(h \ell)] \lrstep{*}{\ptrs{\R}{\A}} tu_1 =  u[b(h \ell)] \in L(\A')q, q_1,\ldots, q_m, q'_1,\ldots, q'_{m'} \in Q_Lq^\final \in Q^\final_L\rhob(B) \to qq_1\ldots q_m\, q'_1\ldots q'_{m'}B\init_B \lrstep{q_1\ldots q_m}{B} s \lrstep{q'_1\ldots q'_{m'}}{B} f_BsBq' \in Q_La(v) \lrstep{*}{\A'} q'b(B + \langle s, q',s\rangle) \to q\A'q_1\ldots q_m\, q'\, q'_1\ldots q'_{m'}B + \langle s, q',s\rangleu = u[b(h\, a(v)\ell)] \lrstep{*}{\A'} u[a(q_1\ldots q_m q' q'_1\ldots q'_{m'})] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\DEL_{\mathsf{s}}u = u[b(h a(v) \ell)] \lrstep{}{\ptrs{\R}{\A}} u[b(h v \ell)] \lrstep{*}{\ptrs{\R}{\A}} tu_1 =  u[b(h v \ell)] \in L(\A')q, q_1,\ldots, q_m, q''_1,\ldots, q''_n ,q'_1,\ldots, q'_{m'} \in Q_Lq^\final \in Q^\final_L\rhob(B) \to qq_1\ldots q_m\, q''_1,\ldots, q''_n\, q'_1\ldots q'_{m'}B\init_B \lrstep{q_1\ldots q_m}{B} s \lrstep{q''_1\ldots q''_n}{B} s' 
 \lrstep{q'_1\ldots q'_{m'}}{B} f_Bs, s'B\A_Ls, s'q'a(B_{s,s'}) \hookrightarrow_{\Delta_i} q'a(v) \lrstep{*}{\A'} q'b(B + \langle s, q', s\rangle) \to q\A'q_1\ldots q_m\, q'\, q'_1\ldots q'_{m'}B + \langle s, q', s\rangleu = u[b(h a(v)\ell)] \lrstep{*}{\A'} u[a(q_1\ldots q_m q' q'_1\ldots q'_{m'})] \lrstep{}{\A'} u[q] \lrstep{*}{\A'} q^\finalu \in L(\A')\subseteq\Sigma =\{0,1,\sharp,\flat\}\Sigma' = \{0',1',\sharp',\flat'\}\sharp\flat Q \cup Q'Q =\{q_1, q_2, \ldots , q_n\}Q' =\{q_1', q_2', \ldots  , q'_n\}+\botabccde\flat\flat \ldotsdq\T_0\T_1\Sigma \cup \{ \bot, +\}\sharp\sharpt\in \T_0s\in \T(\Sigma)t[\bot \leftarrow s]t\botsL_{s,a}t \in \T(\Sigma)tsaqarbqara(q) + (b(r')+ x)a(q) + (b(\bot)+ x)L_{q,a,r,R}U[\bot \leftarrow (a(q) + (b(r')+ V)]U \in \T_1V \in \T_0qarb(r') + (a(q)+ x)b(\bot) + (a(q)+ x)L_{q,a,r,L}U[\bot \leftarrow ((b(r')+ a(q)) +V)]U\in \T_1V \in \T_0
\R = \{ L_i::\ell_i \rightarrow r_i \mid 1 \leq i \leq n \}L_iT_1, T_2t_1, t_2T_1T_2t_1 \lrstep{*}{\R} t_2L_i\biguplus_{1 \leq i \leq n} L_i\{ L_i::\ell_i \rightarrow r_i ~|~1 \leq i \leq n \}L_iL_i\cup_{\{1 \leq i \leq n \}} L_iT_1, T_2t_1, t_2T_1T_2t_1 \to^*  t_2\A\Sigma\ptrs{\R}{\A} \in \XACU_2+L\pre^*_{\ptrs{\R}{\A}}(L)\INS_\mathsf{left}\INS_\mathsf{right}\RPL'\DEL\DEL_{\mathsf{s}}b \in \F\INS_{2,\mathsf{left}}b(y\,a(x)\,z) \to b(y\,p\, a(x)\,z) \in \ptrs{\R}{\A}B, B' \in \Cs, s'Bq, q_p ,q' \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'L(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q_p q'}{B} s'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s, q', s'\rangle) \to q \bigr\}\INS_{2,\mathsf{right}}b(y\,a(x)\,z) \to b(y\, a(x)\,p\,z) \in \ptrs{\R}{\A}B, B' \in \Cs, s'Bq, q_p ,q' \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'L(\A_i, q_p) \cap L(\A, p) \neq \emptysets \lrstep{q' q_p}{B} s'\Delta_{i+1} := \Delta_i \cup\bigl\{ b(B + \langle s, q', s'\rangle) \to q \bigr\}\RPL'_2b(y\,a(x)\,z) \to b(y\,p_1\ldots p_n\,z) \in \ptrs{\R}{\A}B, B' \in \Cs, s'Bq, q', q_1,\ldots, q_n \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'L(\A_i, q_j) \cap L(\A, p_j) \neq \emptyset1 \leq j \leq ns \lrstep{q_1\ldots q_n}{B} s'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s, q', s'\rangle) ) \to q \bigr\}\DEL_2b(y\,a(x)\,z) \to b(yz) \in \ptrs{\R}{\A}B, B' \in \CsBq, q' \in Q_Lb(B) \to q \in \Delta_ia(B') \hookrightarrow_{\Delta_i} q'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s,q',s\rangle) \to q \bigr\}\DEL_{2,\mathsf{s}}b(y\,a(x)\,z) \to b(yxz) \in \ptrs{\R}{\A}B \in \Cs, s'Bq, q' \in Q_Lb(B) \to q \in \Delta_ia(B_{s,s'}) \hookrightarrow_{\Delta_i} q'\Delta_{i+1} := \Delta_i \cup \bigl\{ b(B + \langle s,q',s'\rangle) \to q \bigr\}$.\qed
\end{description}
\end{proof}
















\end{document}
