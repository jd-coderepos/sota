\documentclass[acmtocl]{robtrans}\pdfoutput=1

\usepackage{dashrule}
\usepackage{proof-dashed}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{verbatim}
\usepackage{stmaryrd}



\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}

\usepackage{tikz}
\usetikzlibrary{arrows}

\newcommand{\seq}[2]{{#1} \longrightarrow {#2} \mathstrut}
\newcommand{\foc}[2]{{#1} \vdash {#2} \mathstrut}
\newcommand{\susp}[1]{\langle{#1}\rangle}

\newcommand{\efoc}[3]{{#1}; {#2} \vdash {#3}}
\newcommand{\rfoc}[2]{{#1} \vdash [{#2}] \mathstrut}
\newcommand{\lfoc}[3]{{#1}; [{#2}] \vdash {#3} \mathstrut}
\newcommand{\ifoc}[3]{{#1}; {#2} \vdash {#3} \mathstrut}
\newcommand{\efoct}[4]{{#1}; {#2} \vdash {#3} : {#4}}
\newcommand{\rfoct}[3]{{#1} \vdash {#2} : [{#3}] \mathstrut}
\newcommand{\lfoct}[4]{{#1}; [{#3}] \vdash {#2} : {#4} \mathstrut}
\newcommand{\ifoct}[4]{{#1}; {#2} \vdash {#3} : {#4} \mathstrut}
\newcommand{\stable}[1]{{#1}\,\mathit{stable} \mathstrut}
\newcommand{\suspnormal}[1]{{#1}\,\mathit{suspnormal} \mathstrut}
\newcommand{\llangle}{\llbracket}
\newcommand{\rrangle}{\rrbracket}

\DeclareMathOperator{\with}{\&}
\DeclareMathOperator{\focmark}{\circ}

\newcommand{\dsrt}[1]{\mathsf{thunk}\,{#1}}
\newcommand{\dslt}[2]{{#1}.{#2}}      \newcommand{\usrt}[1]{\{{#1}\}}       \newcommand{\uslt}[1]{\mathsf{pm}\,{#1}}       


\newcommand{\etart}[1]{\langle{#1}\rangle} \newcommand{\etalt}[2]{\susp{#1}.{#2}}     

\newcommand{\rft}[1]{\mathsf{ret}\,{#1}} \newcommand{\lft}[2]{{#1} \circ {#2}} 



\markboth{Robert J. Simmons}{Structural focalization}

\title{Structural focalization}
\author{Robert J. Simmons}

\begin{abstract}
Focusing, introduced by Jean-Marc Andreoli in the context of classical
linear logic [Andreoli 1992], 
defines a normal form for sequent calculus derivations that 
cuts down on the number of possible derivations by eagerly applying invertible
rules and grouping sequences of non-invertible rules. 
A focused sequent calculus is defined relative to some non-focused
sequent calculus; {\it focalization} is the property that
every non-focused derivation can be transformed into
a focused derivation.

In this paper, we present a focused sequent calculus for propositional
intuitionistic logic and prove the focalization property relative to a
standard presentation of propositional intuitionistic logic. Compared
to existing approaches, the proof is quite concise, depending only on
the internal soundness and completeness of the focused
logic. In turn, both of these properties can be established
(and mechanically verified) by structural induction in the style of
Pfenning's structural cut elimination without the need for any tedious
and repetitious invertibility lemmas. The proof of cut admissibility
for the focused system, which establishes internal soundness, is not
particularly novel. The proof of identity expansion, which establishes
internal completeness, is a major contribution of this work.
\end{abstract}


\category{F.4.1}{Theory of Computation}{Mathematical Logic}[Proof theory]
            
\terms{Algorithms, Design, Theory, Verification} 
            
\keywords{intuitionstic logic, polarized logic,
cut admissibility, identity expansion, normalization, focusing,
proof terms, proof search}

\begin{document}





\maketitle




\section{Introduction}

The propositions of intuitionistic propositional logic are easily recognizable
and standard: we will consider a logic with atomic propositions, 
falsehood, disjunction, truth, conjunction, and implication.

The sequent calculus presentation for intuitionistic logic is also standard;
the system in 
Figure~\ref{fig:unfoc} is precisely the propositional fragment of 
Kleene's sequent system  as presented in \cite{pfenning00structural}.
Contexts  are, as usual, considered to be
unordered multisets of propositions , and the structural properties
of exchange, weakening, and contraction are admissible (each left
rule incorporates a contraction).

\begin{figure}
\fbox{}






\caption{Sequent calculus for intuitionistic logic.}
\label{fig:unfoc}
\end{figure}

Sequent calculi are a nice way of presenting logics, and a logic's
sequent calculus presentation is a convenient setting in which to
establish the logic's metatheory in a way that is straightforwardly
mechanizable in proof assistants (like Twelf or Agda) that are
organized around the idea of structural induction.  There are two key
metatheoretic properties that we are interested in.  The first, cut
admissibility, justifies the use of lemmas: if we know  (if we have
a derivation of the sequent ) and we know that 
follows from assuming  (if we have a derivation of the sequent
), then we can come to know  without the
additional assumption of  (we can obtain a derivation of the
sequent ). \footnote{In common practice, the words
 {\it proof} and {\it derivation} are used interchangeably.  In this
 article, we will be careful to refer to the formal objects
 constructed using sequent calculus rules (such as those in
 Figure~\ref{fig:unfoc}) as {\it derivations}.  Except when
 discussing natural deduction, the words {\it proof} and {\it
   theorem} will refer to theorems proved about these formal objects;
 these are frequently called {\it metatheorems} in the literature.} 
A
proof of the cut admissibility property establishes the {\it internal
  soundness} of a logic -- it implies that there are no closed 
derivations
of contradiction, even by circuitous reasoning using lemmas. The
identity property asserts that assuming  is always sufficient to
conclude , that is, that the sequent  is always
derivable. A proof of the identity property establishes the {\it
  internal completeness} of a logic. We call these properties
\emph{internal}, following Pfenning \shortcite{pfenning10categorical},
to emphasize that these are properties of the deductive system itself
and not a comment on the system's relationship to any external
semantics.

There is a tradition in logic, dating back to Gentzen
\shortcite{gentzen35untersuchungen}, that views the sequent calculus
as a convenient formalism for proving a logic's metatheoretic
properties while viewing natural deduction proofs as the ``true proof
objects.''\footnote{This discussion assumes a basic familiarity with
  natural deduction. We refer the interested reader to
  Girard, Taylor, and Lafont's {\it Proofs and Types}
  \cite{girard89proofs}; the aforementioned quote comes from Section
  5.4 of that work.}  One reason for this bias towards natural
deduction is that natural deduction proofs have nice normalization
properties.  A natural deduction proof is {\it normal} if if there are
no instances of an introduction rule immediately followed by an
elimination rule of the same connective; such detours give rise to
{\it local reductions} which eliminate the detour, such as this one:

The {\it normalization} property says that every 
natural deduction proof can be transformed
into a normal natural deduction proof. 

We are frequently interested in the set of normal natural deduction
proofs of a given proposition.  As an example, there is exactly one
normal natural deduction proof for . Presented as a derivation, that natural
deduction proof looks like this:

Under the standard proof term assignment for natural deduction,
this (normal) natural deduction proof corresponds to the (irreducible) 
proof term .
 
In contrast, there are many sequent calculus derivations of the same
proposition.  Here's one of them:

Reading from bottom to top, this derivation decomposes 
 on the right, then
decomposes  on the right, then decomposes
 on the right, and then (in one branch) decomposes 
on the left while (in the other branch) decomposing  on the left.
Other possibilities include decomposing  on the left 
before decomposing  on the right
and decomposing  on the left before  on the right;
there are at least six 
different derivations even if you don't count derivations
that do useless decompositions on the left. 

These different derivations are particularly problematic if our goal
is to do proof search for sequent calculus derivations, as inessential
differences between derivations correspond to unnecessary choice
points that a proof search procedure will need to backtrack over.  It
was in this context that Andreoli originally introduced the idea of
focusing. Some connectives, such as implication , are
called {\it asynchronous} because their right rules can always be
applied eagerly, without backtracking, during bottom-up proof
search. Other connectives, such as disjunction , are called
{\it synchronous} because their right rules cannot be applied
eagerly. For instance, the  rule cannot be applied eagerly
if we are looking for a derivation of . 
This 
asynchronous or synchronous character is the connective's {\it
  polarity}.\footnote{Andreoli dealt with a one-sided classical sequent
  calculus; in intuitionistic logic, it is common to call asynchronous
  connectives {\it right}-asynchronous and {\it
    left}-synchronous. Similarly, it is common to call synchronous
  connectives {\it right}-synchronous and {\it left}-asynchronous.

  Synchronicity or polarity, a property of connectives, is closely
  connected to (and sometimes conflated with) a property of rules
  called {\it invertibility}; a rule is invertible if the conclusion
  of the rule implies each of the premises. So  is
  invertible ( implies ) but  is not ( does not imply ).
  Rules that can be applied eagerly need to be invertible, so
  asynchronous connectives have invertible right rules and synchronous
  connectives have invertible left rules. Therefore, another synonym
  for asynchronous is {\it right-invertible}, and another synonym for
  synchronous is {\it left-invertible}. This terminology would be
  misleading in our case, as both the left and right rules for
  conjunction in Figure~\ref{fig:unfoc} are invertible.}

Andreoli's key observation was that proof search only needs to
consider derivations that have two alternating phases.  In {\it
  inversion} phases, we eagerly apply (invertible) right rules to
asynchronous connectives and (invertible) left rules to synchronous
ones. When this is no longer possible, we begin a {\it focusing} phase
by putting a single remaining proposition {\it in focus}, repeatedly
decomposing it (and only it) by applying right rules to synchronous
connectives and left rules to asynchronous ones. Andreoli described
this restricted form of proof search as a regular proof search
procedure in a restricted sequent calculus; such sequent calculi, and
derivations in them, are called {\it focused} as opposed to {\it
  unfocused} \cite{andreoli92logic}.

In order to adopt such a proof search strategy, it is important to
know that the strategy is both sound (i.e., the proof search strategy
will only say ``the sequent has a derivation'' if that is the case)
and complete (i.e., the proof search strategy is capable of finding a
derivation if one exists). Soundness proofs for focusing are usually easy:
focused derivations are essentially a syntactic refinement of the
unfocused derivations.  Completeness, the nontrivial direction,
involves turning unfocused derivations into focused ones. This process
is {\it focalization}.\footnote{The usage of {\it focus}, {\it
    focusing}, {\it focussing}, and {\it focalization} is not standard
  in the literature. We use the words {\it
    focus} and {\it focusing} to describe a logic (e.g. the focused
  sequent calculus) and aspects of that logic (e.g. focused
  derivations, propositions in focus, left- or right-focused sequents,
  and focusing phases).  {\it Focalization}, derived from the French
  {\it focalisation}, is reserved exclusively for the act of producing
  a focused derivation given an unfocused derivation; the focalization
  {\it property} establishes that focalization is always possible.} Thus, an effective procedure for
focalization is a constructive witness to the completeness of
focusing.

The techniques described in this article are general and can be
straightforwardly transferred to other modal and substructural logics,
as explored in the author's dissertation
\cite{simmons12substructural}. Our approach has three key
components, which we will now discuss in turn.

\paragraph*{Focalization via cut and identity}
Existing focalization proofs almost all fall prey to the need to prove
multiple tedious invertibility lemmas describing the interaction of
each rule with every other rule; this results in proofs that are
unrealistic to write out, difficult to check, and exhausting to
contemplate mechanizing. The way forward was first suggested by
Chaudhuri \shortcite{chaudhuri06focused}. In his dissertation, he
established the focalization property for linear logic as the
consequence of the focused logic's internal soundness (the cut
admissibility property) and completeness (the identity property).
Stating and proving the identity property for a focused sequent
calculus has remained a challenge, however. A primary contribution of
this work is {\it identity expansion}, a generalization of the
identity property that is amenable to mechanized proof by structural
induction on propositions. This identity property is, in turn, part of
our larger development, a proof of the focalization property that
entirely avoids the tedious invertibility lemmas that plague existing
approaches.  (We review existing techniques used to prove the
focalization property in Section~\ref{sec:previous}.)

\paragraph*{Refining the focused calculus}
The focused logic presented in this article is essentially equivalent
to the presentation of LJF given by Liang and Miller
\shortcite{liang09focusing}, a point we will return to in
Section~\ref{sec:logic-scalc}. A reader familiar with LJF will note
three non-cosmetic differences.  The first two, our use of a {\it
  polarized} variant of intuitionistic logic and our novel treatment
of atomic and suspended propositions, will be discussed further in
Section~\ref{sec:logic}.  A third change is that LJF does not force
any particular ordering for the application of rules during a
inversion phase. A seemingly inevitable consequence of this choice is
that the proof of focalization must establish the equivalence of all
permutations of these invertible rules; this is one of the
aforementioned tedious invertibility lemmas that plague proofs of the
focalization property. Our focused logic, like many others (including
Andreoli's original system) fixes a particular inversion order.

We introduce a new calculus rather than reusing an existing one in
order to present a focused logic and focalization proof that is
computationally clean and straightforward to both mechanize and
apply to other logics.  Our desire to
mechanize proofs of the focalization property also informed our
decision to use propositional intuitionistic logic.
All proofs in this
article are mechanized in both Twelf \cite{pfenning99system} and Agda
\cite{norell08towards}, though we will only mention the Twelf
development.
The concrete
basis for our claim of computational cleanliness is that our
mechanizations are complete artifacts capturing the constructive
content of the proofs we present, 
and the size of this artifact scales linearly
relative to the number of connectives; the approaches we call
``tedious'' tend to scale quadratically.

\paragraph*{Proof terms}
Since Andreoli's original work, focused sequent calculus derivations
have been shown to be isomorphic to normal natural deduction proofs
for restricted fragments of logic \cite{cervesato03linear} and
variations on the usual focusing discipline \cite{howe01proof}.  Such
results challenge the position that natural deduction proofs are
somehow more fundamental than sequent calculus derivations and also
indicate that focalization is a fundamental property of logic. In
Section~\ref{sec:proofterms}, we present a proof term language for
polarized intuitionistic logic that directly captures the branching
and binding structure of focused derivations. The result is a term
language generalizing the {\it spine form} of Cervesato and Pfenning
\shortcite{cervesato03linear}.

Understanding focalization at the level of proof terms is not strictly
necessary; the theorems we prove are perfectly sensible as statements
about sequent calculi.  We choose to present cut admissibility and
identity expansion at the level of proof terms in part because it
emphasizes the constructive content of those theorems. The
constructive content of cut admissibility is a substitution function
on proof terms generalizing the {\it hereditary substitution} of
Watkins et al.~\shortcite{watkins02concurrent} in a spine form
setting, and the constructive content of our identity expansion proof
is a novel -expansion property on proof terms.

\begin{figure}
\begin{center}
\begin{tikzpicture}
\draw (6,20.5) node{``Soundness''};
\draw (10,20.5) node{``Completeness''};

\draw[dotted] (2,20) -- (12,20);
\draw (3,18.2) node{Focused,};
\draw (3,17.8) node{polarized};
\draw[dotted] (2,16) -- (12,16);
\draw (3,15) node{};
\draw[dotted] (2,14) -- (12,14);
\draw (3,13.2) node{Unfocused,};
\draw (3,12.8) node{unpolarized};

\draw (6,19.45) node{\bf Cut admissibility};
\draw (6,18.95) node{\it Theorem~\ref{thm:cut},};
\draw (6,18.55) node{\it Section~\ref{sec:cut}}; 

\draw (10,19.45) node{\bf Identity expansion};
\draw (10,18.95) node{\it Theorem~\ref{thm:identity},};
\draw (10,18.55) node{\it Section~\ref{sec:expansion}}; 

\draw (10,17.45) node{\bf Unfocused};
\draw (10,17.05) node{\bf admissibility lemmas};
\draw (10,16.55) node{\it Section~\ref{sec:unfocusedadmissibility}}; 

\draw (6,15.45) node{\bf De-focalization};
\draw (6,14.95) node{\it Theorem~\ref{thm:soundness},};
\draw (6,14.55) node{\it Section~\ref{sec:soundness}}; 

\draw (10,15.45) node{\bf Focalization};
\draw (10,14.95) node{\it Theorem~\ref{thm:completeness},};
\draw (10,14.55) node{\it Section~\ref{sec:focalizationproof}}; 

\draw (6,13.45) node{\bf Cut admissibility};
\draw (6,12.95) node{\it Corollary~\ref{cor:cut},};
\draw (6,12.55) node{\it Section~\ref{ref:corollaries}}; 

\draw (10,13.45) node{\bf Identity};
\draw (10,12.95) node{\it Corollary~\ref{cor:identity},};
\draw (10,12.55) node{\it Section~\ref{ref:corollaries}}; 

\draw [->] (4.6,19.3) .. controls (4,17) and (3.5,14) .. (4.4,13.6);
\draw [->] (11.6,19.3) .. controls (12.7,17) and (13,14) .. (10.8,13.6);

\draw [->] (4.6,19.3) .. controls (4,17) and (6.7,17) .. (8,17);
\draw [->] (11.6,19.3) .. controls (12.65,17) and (12,17.05) .. (11.95,17.05);

\draw [->] (10,16.3) -- (10,15.7);
\draw [->] (10,14.3) -- (10,13.7);
\draw [->] (6,14.3) -- (6,13.7);
\draw [->] (10,14.3) -- (6.3,13.72);
\draw [->] (6,14.3) -- (9.7,13.72);
\end{tikzpicture}
\end{center}
\caption{Theorems and their dependencies.}
\label{fig:outline}
\end{figure}

\subsection{Outline}

This article is dealing with three ``soundness'' properties and three
``completeness'' properties, so it is important to carefully 
explain what we're doing and when; the following discussion is represented
graphically in Figure~\ref{fig:outline}.

We present a new proof of the completeness {\it of focusing} (the
focalization property, Theorem~\ref{thm:completeness}) for
intuitionistic logic; the proof of the focalization property follows
from the {\it internal} soundness and completeness of the focused
sequent calculus (cut admissibility, Theorem~\ref{thm:cut}, and
identity expansion, Theorem~\ref{thm:identity}).  We will start, in
Section~\ref{sec:logic}, by motivating a polarized presentation of
logic that syntactically differentiates the synchronous and
asynchronous propositions. We then present a focused sequent calculus
for polarized propositional intuitionistic logic and formally state
the soundness and completeness of focusing. We also prove the
soundness of focusing (the de-focalization property,
Theorem~\ref{thm:soundness}) in this section, but it's pretty boring
and independent of the proofs of cut admissibility, identity
expansion, and the completeness of focusing.

Internal soundness for the focused sequent calculus is established by
the cut admissibility theorem in Section~\ref{sec:cut}, and internal
completeness for the focused sequent calculus is established in
Section~\ref{sec:expansion} using a generalization of the identity
expansion theorem first developed in \cite{simmons11weak}. In
Section~\ref{sec:focalization} we prove the focalization property by
showing {\it unfocused admissibility}, a group of lemmas establishing
that the focused sequent calculus can act like an unfocused sequent
calculus.  Finally, rather than proving the internal soundness and
completeness (cut and identity) for the unfocused system directly, we
show that these properties can be established as corollaries of the
first four theorems.  In Section~\ref{sec:previous} we conclude with
an overview of existing proofs of the focalization property.


We will henceforth avoid using 
the words {\it soundness} and {\it completeness} as much as possible. 
Instead, we will refer
to the cut admissibility and identity theorems 
for the focused and unfocused sequent calculi by name, and will refer
to the soundness and completeness of focusing as de-focalization 
and focalization, respectively.

\section{Polarized logic}
\label{sec:logic}

There is a significant line of work on polarity in logic dating back
to Andreoli \shortcite{andreoli92logic} and Girard
\shortcite{girard93unity}. That line of work holds that 
the asynchronous and
synchronous propositions are syntactic refinements of the set of
propositions. We can determine the synchronous or asynchronous
character of a proposition by inspecting its outermost
connective.\footnote{Linear logic naturally has two polarities. Other
  systems, like Girard's LU and Liang and Miller's LKU, use more than
  these two polarities
  \cite{girard93unity,liang11focused}. Furthermore, in LU the polarity
  of a proposition is determined by more than just the outermost
  connective.}

In a 1991 note published to the LINEAR list \cite{girard91sex}, Girard
introduced the idea of syntactically differentiating the {\it
  positive} propositions (those Andreoli called synchronous) from the
{\it negative} propositions (those Andreoli called asynchronous) while
mediating between the two with {\it shifts}: the upshift
 includes positive propositions in the negative ones,
and the downshift  includes negative propositions in
the positive ones. This {\it polarization}\footnote{For the purposes
  of this article we are making somewhat artificial distinction
  between {\it polarity}, Andreoli's classification of propositions as
  asynchronous and synchronous, and {\it polarization}, the
  segregation of these two classes as positive or negative
  propositions by using shifts. This distinction is not a standard
  one: ``synchronous'' and ``positive'' are elsewhere used
  interchangeably, ``polarity'' is used to describe what we call
  ``polarization,'' and so on.} of logic was developed further by
Girard in Ludics \cite{girard01locus} and treated extensively in
Laurent and Zeilberger's Ph.D. theses
\cite{laurent02etude,zeilberger09logical}.
These are the propositions, positive and negative, for polarized
intuitionistic logic:


Linear logic is able to unambiguously assign all connectives
to one category or the other, but in intuitionistic logic, truth
 and conjunction 
can be understood as having either a positive character (corresponding to
 and  in linear logic) or a negative character
(corresponding to  and  in linear logic). 
We take the maximally general approach and allow both versions of 
truth and conjunction, which are decorated to emphasize their polarity.

\begin{figure}

\caption{Erasure of polarized propositions.}
\label{fig:erasure}
\end{figure}

The shifts introduced by Girard were modalities that might change the
provability of a proposition. We adopt the later stance of Zeilberger
\shortcite{zeilberger09logical}, McLaughlin and Pfenning
\shortcite{mclaughlin09efficient}, and others: shifts influence the
structure of derivations, but not the provability of
propositions. Therefore, we expect there to be a focused derivation of
 or  if and only if there is an unfocused derivation of
 or , where  is the {\it
  erasure} function given in Figure~\ref{fig:erasure}.  The polarity
of an atomic proposition can be arbitrary as long as it is consistent,
as if each individual atomic proposition  is really intrinsically
positive or negative, but the calculus in Figure~\ref{fig:unfoc}
didn't notice.


Shifts and polarization are computationally interesting phenomena. Our
view of polarization lines up with the {\it call-by-push-value} system
independently developed by Levy: positive propositions correspond to
{\it value types} and negative propositions correspond to {\it
  computation types} \cite{levy04call}.  Shifts are also useful in
theorem proving. By employing different {\it polarization strategies},
the name for partial inverses of erasure, the Imogen theorem prover can
simulate fully-focused LJF proof search, proof search in an unfocused
logic like Kleene's , and proof search in many other
partially-focused systems in between \cite{mclaughlin09efficient}.
Furthermore, forward-chaining versus backward-chaining logic
programming can be seen as arising from particular polarization
strategies in uniform proof search \cite{chaudhuri10logical}. However,
in this article polarization is primarily a technical device. Shifts
makes it clearer that certain proofs are structurally inductive over
propositions, especially identity expansion
(Theorem~\ref{thm:identity}).  Additionally, the focus-interrupting
nature of the shift is a critical part of our unfocused admissibility
lemmas.\footnote{Something like a shift is necessary for Liang and
  Miller's focalization proofs as well. Because their logic has
  polarity but no shifts, they construct {\it delays}  and  to force
  asynchronous or synchronous connectives to behave (respectively)
  like synchronous or asynchronous ones \cite{liang09focusing}. This
  gets in the way of defining logical fragments by adding or removing
  connectives, as the presence of the connective  is
  fundamental to their completeness proof.}


\subsection{Sequent calculus}\label{sec:logic-scalc}

We will develop our focused sequent calculus in two stages; in the
first stage we do not consider atomic propositions. We can present
sequents for our polarized logic in two equivalent ways. In the {\it
  one-sequent} view, we say that all sequents have the form
. The components of a sequent are defined by the
following (currently incomplete) grammar:

This first view requires us to further restrict the form of sequents
for two reasons. First, we only want to focus on one proposition at a
time, so only one right focus  or left focus  should be
present in a sequent.  Second, focus and inversion phases should not
overlap, so it must be the case that  when  and
that  when . Given this
restriction, the first view of sequents is equivalent to a {\it
  three-sequent} view in which there are three different sequent
forms:
\begin{itemize}
\item Right focus: , where  and is
  therefore omitted,
\item Inversion: , where , and
\item Left focus: , where  is {\it stable}
  (more about this shortly).
\end{itemize}

\begin{figure}
\fbox{ -- {\it right focus}} 




\medskip
\fbox{ -- {\it inversion, }}







\medskip
\fbox{ -- {\it left focus,  must be stable}}



\medskip
\fbox{}
\vspace{-12pt}

\caption{Focused sequent calculus for polarized intuitionistic logic
  (sans suspended propositions).}
\label{fig:foc}
\end{figure}


The sequent calculus for polarized intuitionistic logic in
Figure~\ref{fig:foc} is presented in terms of this three-sequent view.
The {\it right focus} sequent  describes a state
in which non-invertible right rules are being applied to positive
propositions, the {\it left focus} sequent 
describes a state in which non-invertible left rules are being applied
to negative propositions, and the {\it inversion} sequent
 describes everything else. While we treat
the hypothetical context  informally as a multiset, the {\it
  inversion context}  is {\it not} a multiset. Instead, it
should be thought of as an ordered sequence of positive propositions:
the empty sequence is written as ``'' and ``'' is an
associative append operator.  Whenever the inversion context  is
non-empty, the {\it only} applicable rule is the one that decomposes
the left-most positive connective in .

The picture in Figure~\ref{fig:foc} is quite uniform: every rule
except for  and  breaks down a single
connective, while the shift rules regulate the focus and inversion
phases.  Read from bottom up, they put an end to the process of
breaking down a proposition under focus (,
) and to the process of breaking down a proposition with
inversion (, ). All other rules maintain
focus or inversion on the subformulas of a proposition.

The conclusions of  and  are inversion
sequents with empty inversion contexts and succedents  that are
stable, meaning that there is no possibility of applying an invertible
rule.  These {\it stable sequents} (sometimes called {\it neutral})
have an important place in focused sequent calculi.  In the
introduction, we claimed that there was an essential equivalence
between LJF and our focused presentation, but this is only true if we
ignore the internal structure of focus and inversion phases and work
with {\it synthetic rules}, the derivation fragments comprised of one
or more inversion phases stacked on top of a single focused phase. In
the synthetic view of focusing, we abstract away from the internal
structure of focusing phases to emphasize the stable sequents that lie
between them \cite{andreoli01focussing}. LJF and our presentation of
polarized intuitionistic logic have different internal structure, but
we claim that the systems give rise to the same synthetic
rules.\footnote{Our presentation does not have the first-order
  quantifiers present in LJF, and LJF lacks a negative unit ,
  but quantifiers can be added to our system easily, and the same is
  true for  in LJF.} Aside from our use of shifts, we depart
from Liang and Miller in ways that are technically relevant but that
are invisible at the level of synthetic connectives.

The stability requirement for  in left focus sequents
 can equivalently be stated as a extra premise
 for the rule , which is done in the
accompanying Twelf development. (Our placement of the premise on  shows a bit of bias towards bottom-up proof construction.)

\subsection{Suspended propositions}\label{sec:susp}

The pleasant picture of focusing given above must become more
complicated when we
consider atomic propositions. Atomic propositions are best understood
as stand-ins for arbitrary propositions, and so our polarized logic
has both positive atomic propositions (stand-ins for arbitrary
positive propositions) and negative atomic propositions (stand-ins for
arbitrary negative propositions).


When we are performing inversion and we reach an atomic proposition,
we do not have enough information to break down that proposition any
further, but we have not reached a shift. We have to do something
different. What we do is {\it suspend} that atomic proposition, either
in the hypothetical context or in the succedent. We represent a
suspended atomic proposition as  or . If we
wanted to closely follow existing focused sequent calculi, we would
introduce two more rules for proving atomic propositions in focus
using a suspended atomic proposition. The resulting extension of
Figure~\ref{fig:foc} would look something like this:


This treatment is not incorrect and is obviously analogous to the  rule from the unfocused system in
Figure~\ref{fig:unfoc}. Nevertheless, we contend that this is a design
error and a large part of why it has historically been difficult to
prove the identity theorem for focused systems. We generalize the
rules above
by allowing the hypothetical context to contain arbitrary
suspended positive propositions (not just atomic positive
propositions) and allowing the succedent to contain arbitrary
suspended negative propositions (not just atomic negative
propositions).

\begin{figure}


\caption{Focused sequent calculus, extended with suspended propositions}
\label{fig:foc-atom}
\end{figure}


This generalization allows us to finally give the complete grammar of 
hypothetical contexts and succedents: 

The rules for atomic propositions, extending Figure~\ref{fig:foc}, are
given in Figure~\ref{fig:foc-atom}. The  and  rules
are the same as the ones we discussed above, reflecting the fact that
the inversion process {\it must} suspend itself at an atomic
proposition and {\it should not} suspend itself any earlier.  The
 and  rules directly describe an identity
or hypothesis principle, but only for suspended propositions.


These more general  and  rules allow us to define two
substitution principles, which are critical for the proof of identity
expansion in Section~\ref{sec:expansion}. The derivation of a
right-focused sequent  can discharge  in the
hypothetical context, and the derivation of a left-focused sequent
 can discharge  in the succedent. Written as
admissible rules, these two {\it focal substitution} principles are as
follows:

It is straightforward to establish the positive focal substitution
principle by induction over the derivation of , and it is likewise straightforward to establish
the negative substitution principle by induction over the derivation
of . When the last rule in the
derivation we're inducting over is  or , we
return the derivation we're not inducting over, and in every other
case we apply the induction hypothesis directly.\footnote{In the case
  of the rules  and , we also apply an
  admissible weakening principle to the derivation we're not inducting
  over.}

The admissible rules  and  are {\it
  uniform} substitution principles. This means that, in the
accompanying Twelf development, it is possible to get them both for
free from the LF function space, the same way we get weakening 
and contraction of the
hypothetical context for free and generally take it for granted. This
is natural in the case of positive focal substitution: we interpret
the suspended atomic proposition  as a uniform assumption
that  is provable in right focus. It is more counterintuitive to
get negative focal substitution for free in LF; we refer the reader to
the accompanying Twelf development for details. 

The logic extended with these more general  and  rules conservatively extends the logic with the more
traditional rules we initially proposed. Reading rules from bottom to
top, the rules  and  are the only ones that introduce
suspended propositions. Therefore, given the derivation of a sequent
where every suspended proposition is atomic, we know that every
instance of  and  in that derivation acts on an
atomic proposition. We call sequents where every suspended proposition
is atomic {\it suspension-normal} sequents. Certain operations, in
particular erasure and cut admissibility, are only defined on
suspension-normal sequents and derivations of these sequents.


\subsection{Erasure and focalization}

\begin{figure}

\caption{Erasure of contexts and succedents.  and
   are defined in Figure~\ref{fig:erasure}.}
\label{fig:erasure-ctx}
\end{figure}

We presented the erasure of propositions in Figure~\ref{fig:erasure},
and Figure~\ref{fig:erasure-ctx} describes the erasure of a polarized
contexts and sequents. Note that erasure is only defined on
hypothetical contexts  and succedents  that are
suspension-normal.
 
Erasure is a pretty boring operation, important mainly because it
allows us to state soundness and completeness of focusing. We want to
understand completeness in terms of stable, suspension-normal
sequents, so the correctness of focusing states that, if 
and  are stable and suspension-normal,  if
and only if . The
backward (completeness) direction is focalization and the forward
(soundness) direction is de-focalization.

Many different polarized propositions will typically erase to the same
unpolarized proposition.  The proposition used in the example from the
introduction, , is the erasure of each of the following:

Note that the first proposition implies a 
negative polarity for all atomic propositions and the last two propositions
imply a positive polarity. 

The first and second propositions
each have {\it exactly one} focused 
derivation, just as the unpolarized propositions
had exactly one normal natural deduction proof. The unique derivation of 
(\ref{eqn:neg}) is structurally similar to the unfocused derivation from the
introduction:


The unique derivation of (\ref{eqn:pos}) decomposes the proposition
in a completely different order:

These examples illustrate how polarity and focusing can dramatically
reduce the bureaucratic nondeterminism present in the unfocused
sequent calculus. To be clear, however, we have {\it chosen} to reduce
that bureaucratic nondeterminism: the derivations of proposition
(\ref{eqn:seq}) are isomorphic to the unfocused derivations of the
original, unpolarized proposition.

Our statement of the focalization property applies to {\it all}
polarization strategies.  Having obtained this strong focalization
property, if we are given an unfocused derivation of any unpolarized
sequent (such as ), we can use any polarization strategy at our
disposal to turn the unpolarized sequent into a polarized sequent
(such as ) and then use
focalization to transform the unfocused derivation into a focused
derivation. Our proof that unfocused cut and identity follow from
focused cut and identity does require that we know about {\it some}
polarization strategy, but that will be the extent to which the
present technical development relies on the matter.

With the exception of Zeilberger \shortcite{zeilberger08unity}, proofs
of the focalization property tend not to operate on the basis of
erasure. Erasure-based polarization only emerges clearly as an option
in a logic with shifts; Andreoli's focused classical linear logic
\shortcite{andreoli92logic}, Chaudhuri's focused intuitionistic linear
logic \shortcite{chaudhuri06focused}, and Liang and Miller's LJF
\shortcite{liang09focusing} all approach focalization for a logic
where there are no shifts and where polarity is derived from a
proposition's topmost connective.  From our polarized perspective,
these approaches can all be seen as defining a particular polarization
strategy  that transforms unpolarized
sequents into polarized ones. It is then possible to state and prove a
strictly weaker focalization property: that 
is derivable if and only if  is derivable.


\subsection{Proof terms}\label{sec:proofterms}

\begin{figure}
\fbox{ -- {\it values} }




\medskip
\fbox{ -- {\it terms , }}







\medskip
\fbox{ -- {\it spines ,  must be stable}}



\medskip
\fbox{}
\vspace{-12pt}

\caption{Proof terms for the focused sequent calculus.}
\label{fig:proofterms}
\end{figure}

While it is convenient and traditional to define a logic in terms of
rules, we follow Herbelin \shortcite{herbelin95lambda} in noting that it is 
sometimes 
easier to manipulate derivations using an appropriately-designed proof term
presentation of the logic. 
Our proof term language is primarily a
generalization of the {\it spine form} introduced by Cervesato and
Pfenning \shortcite{cervesato03linear}.\footnote{We also draw
  inspiration from the syntax of CLF \cite{watkins02concurrent},
  call-by-push-value \cite{levy04call}, and Modernized Algol
  \cite{harper12practical} for our syntax.}  Spine form is a proof
term assignment for the so-called uniform proofs, the focused fragment
of a logic that only includes the negative (or asynchronous)
propositions. In spine form, {\it terms} and {\it spines} correspond
to derivations of inversion sequents and left-focused sequents,
respectively; we also consider {\it values} corresponding to
derivations of right-focused sequents.

The separation of our syntax into three categories corresponds to the
three-sequent view of our calculus. We will also refer to proof terms
generically as {\it expressions}  when we want to invoke the
one-sequent view of our system.

Only two terms bind new variables. The term ,
corresponding to the rule , binds a positive variable  (a
variable corresponding to a suspended proposition). The term
, corresponding to the rule , binds a new
negative variable  (a variable corresponding to a negative
proposition).  We will freely span the Curry-Howard correspondence (or
``propositions as types''), calling a value that corresponds to a
derivation of the right-focused sequent  a value
focused on  and calling a spine that corresponds to a derivation
of the left-focused sequent  or
 a spine of type  or 
(respectively) focused on . Terms that correspond to stable
sequents  and
 are (respectively) terms of type
 or .  Terms corresponding to derivations of more general
inversion sequents like  and
 are (respectively) terms of type 
introducing  and terms introducing  and . We
reserve the word {\it type} for stable succedents to emphasize that
these are the important elements in the synthetic view of focusing.

It is possible to re-present the entire sequent calculus from
Figures~\ref{fig:foc}~and~\ref{fig:foc-atom} annotating sequents with
values, terms, and spines; the result is
Figure~\ref{fig:proofterms}. This ``Curry-style'' view, which sees
types as {\it extrinsic} to the proof terms, is helpful as a
reference, but it does not otherwise serve our purposes. Instead, we
will proceed with a ``Church-style'' view of types as {\it
  intrinsic}. This necessitates thinking of proof terms as carrying
some extra annotations; Pfenning writes these as superscripts
\cite{pfenning08church}, but which we will follow Girard in leaving
them implicit \cite{girard89proofs}.  In particular, positive
variables  must be annotated with positive propositions,
negative variables  must be annotated with negative propositions,
and , , , and  must be
annotated with the branch of the disjunction or conjunction that was
not taken.  This suffices to ensure that proof terms are in 1-to-1
correspondence with sequent calculus derivations modulo the structural
properties of exchange and weakening.\footnote{Our desire present cut
  admissibility and identity expansion using proof terms is one reason
  we use so many syntactic markers in our proof terms. These markers
  (, , and , etc.)~may be omitted in a
  Curry-style presentation.}

We will make a habit of presenting proof terms for admissible rules as
well. The admissible focal substitution principles labeled 
and  above are respectively associated with the
functions  and  that act on proof terms:



\begin{figure}
\begin{tabbing}
\qquad \=
Proof term: \= 
\\
\>SML: \> \verb'fn x1 => fn x2 => (#1 x1, #1 x2)'
\\
\>Type: \> 
\\
\end{tabbing}

\begin{tabbing}
\qquad \=
Proof term: \= 
\\
\>SML: \> \verb'fn (z1, z2) => fn (z3, z4) => (z1, z3)'
\\
\>Type: \> 
\\
\end{tabbing}

\begin{tabbing}
\qquad \=
Proof term: \= \=
      \\
\>\>\>
\\
\>SML: \> \verb'fn f => fn g => fn z => (fn Inl z1 => f z1 z'
\\   \>\> \verb'                          | Inr z2 => g (z2, z))'
\\
\>Type: \> 
\\
\end{tabbing}

\begin{tabbing}
\qquad \=
Proof term: \= \=\\
\>\>\>
\\
\>SML: \> \verb'fn z => fn f => fn g => (case (f z) of'
\\   \>\> \verb'                            Inl z1 => (case g z1 of z3 => z3)'
\\   \>\> \verb'                          | Inr z2 => z2)'
\\
\>Type: \> 
\end{tabbing}
\caption{Some proof terms and their rough translation into Standard ML.}
\label{fig:sml-ex}
\end{figure}

\paragraph*{Patterns}
Our proof term calculus departs in one important way from most
presentations of focused proof terms. In other work, the trend is to
introduce the variables needed for an inversion phase all at once in a
syntactic entity called a {\it pattern}; one significant example is
Krishnaswami's presentation of ML-style pattern matching and pattern
compilation in the context of a focused sequent calculus
\cite{krishnaswami09focusing}. We do not use patterns because doing so
would not be faithful to the LF encoding of Figure~\ref{fig:foc} used
in the accompanying Twelf development; patterns cause the inductive
structure of proof terms and sequents to deviate, even if they remain
in 1-to-1 correspondence. 

While a full discussion of patterns is
beyond the scope of this article, we also want to suggest that our
choice is the natural one from the perspective of the sequent
calculus. Patterns are certainly relevant in the study of logic and
programming languages, but they seem more in line with natural
deduction presentations of logic or with higher-order focused
presentations, which can be seen as a synthesis of natural deduction
and sequent calculus presentations
\cite{zeilberger09logical,brock10focused}.

\paragraph*{Examples}
Using Standard ML's syntax as an imperfect proxy for a
natural-deduction system with pattern matching, we give, in
Figure~\ref{fig:sml-ex}, some proof terms and our suggestion as to the
corresponding natural deduction term. Note that if  is a term
introducing  then the proof term corresponding to
 is , though in this
case the familiar construct is comprised of two smaller constructs,
the proof term corresponding to  and the proof term
corresponding to . The spine form  comes
from Levy's CBPV, stands for {\it pattern match}, and corresponds to
\verb'case' in Standard ML.



\subsection{De-focalization}\label{sec:soundness}

We conclude this section by presenting the de-focalization property,
that  implies
, which we can prove independently
of any of the standard metatheoretic results for either system.
In order to generalize the induction hypothesis, we define
a new sequent form , where  is an ordered sequence 
that mimics the inversion context . The meaning of this 
sequent is defined
by two rules which force the ordered  context to introduce its contents
into the hypothetical context  in a left-to-right order:


With this definition, we can state the appropriate generalization of
the induction hypothesis; our desired de-focalization property is a
corollary.

\begin{theorem}[De-focalization]\label{thm:soundness}
If , then 
   
\end{theorem}
We can also state Theorem~\ref{thm:soundness} using the three-sequent
view of our logic. This statement of the theorem has three parts:
\begin{enumerate}
\item If ,
      then ,
\item If ,
      then , and
\item If , 
      then .
\end{enumerate}

\begin{proof}
By induction and case analysis on the given derivation;
 denotes that  is a
derivation of . Twenty-one of the twenty-four cases
are blindingly straightforward, such as this one:

\begin{description}
\item[Case]


\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
 \` by the i.h.~(part 1) on 
\\
\>
 \> :: 
 \` by inversion on 
\\
\>
 \> :: 
 \` by the i.h.~(part 1) on 
\\
\>
 \> :: 
 \` by inversion on 
\\
\>
 \> :: 
 \` by rule  on  and 
\\
\>
 \> :: 
 \` 
\\
\>
 \> :: 
 \` by rule  on .
\end{tabbing}
\end{description}

\noindent
For three cases corresponding to the rules , , and
, a secondary induction is needed to show the
admissibility, in the unfocused sequent calculus, of left rules that
have a context .

\begin{description}
\item[Case]

\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
 \` by i.h.~(part 2) on 
\\
\>
 \> :: 
 \` 
\\
\>
 \> :: 
 \` by inversion on  \\
\>
 \> :: 
 \` by inversion on  \\
\>
 \> :: 
 \` by lemma on 
\\
\>
 \> :: 
 \` 
\\
\>
 \> :: 
 \` by rule  on 
\\
\>
 \> :: 
 \` 
\end{tabbing}
\end{description}
The necessary lemma is that ,
implies .
We proceed by induction on  and by case analysis on the
structure of the given derivation.
\begin{description}
\item[Subcase] 
\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
 \` by exchange on \\
\>
 \> :: 
 \` by i.h.~on \\
\>
 \> :: 
 \` by exchange on \\
\>
 \> :: 
 \` by rule  on 
\end{tabbing}
\item[Subcase] 
\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
 \` by weakening on \\
\>
 \> :: 
 \` by rule  on \\
\>
 \> :: 
 \` by rule  on \\
\>
 \> :: 
 \` by rule  on 
\end{tabbing}
\end{description}
The 22 other cases of the main theorem and the 2 other lemmas are
similar.  This theorem is named {\tt sound} in the accompanying Twelf
development.
\end{proof}

The lemma for  and the two similar lemmas for  and
 are as close as we will get to the tedious invertibility
lemmas encountered by other proofs of the focalization property.
Because of the way we have structured our system, each lemma only
requires induction and case analysis over the definition of
, which is defined by two rules, 
and . Therefore, our proof remains linear in the number of
connectives and rules, rather than quadratic as in other approaches.

\section{Cut admissibility}
\label{sec:cut}

The statement of cut admissibility in an unpolarized logic is that
 and  imply . In
polarized logic, we have positive and negative propositions, so the
cut admissibility theorem must, at minimum, have two parts: a negative
cut, that  and  imply , and a positive cut,
that  and  imply
. The actual proof of cut admissibility will
require further generalization, but these statements are corollaries.
As in the statement of de-focalization, we state cut admissibility
using the one-sequent view of sequents in order to cut down on the
number of individual statements that we need to consider (4 parts
instead of the 7 we would need otherwise).

\begin{theorem}[Cut admissibility]
If  and  are suspension-normal, then\label{thm:cut}

\begin{enumerate}
\item If  and , then
      ,
\item If , , 
      and , then
      ,
\item If  and , then 
      , and
\item If , ,
      and ,
      then .
\end{enumerate}
\end{theorem}

\noindent
Beyond the additional cases needed to deal with shifts, the proof of
focused cut admissibility mirrors structural cut admissibility proofs
for unfocused sequent calculi.  In fact, the organization strategy
imposed by this four-part statement of cut admissibility makes
explicit the informal organization strategy of principal, 
left commutative, and right commutative cuts that Pfenning used to
present the many cases of structural cut admissibility proofs
\cite{pfenning00structural}.  

Before discussing the proof of Theorem~\ref{thm:cut}, we will show how
we write the four parts of cut admissibility at the level of proof
terms. By Curry-Howard, cut admissibility corresponds to a reduction
operation on proof terms that was named {\it hereditary substitution}
by Watkins et al.~\shortcite{watkins02concurrent}.

{\it Principal cuts} (parts 1 and 2) are cases where the {\it
  principal formula} (that is,  or ) is the proposition
being decomposed in the last rule of both given derivations. In a
focused sequent calculus, this naturally happens when the principal
formula is in focus in one sequent and in inversion in the other. We
will refer to the operation of principal cuts on proof terms as {\it
  principal substitution}:




{\it Right commutative cuts} (part 3) deal with all cases where the
second given derivation decomposes a proposition other than the
principal formula. The action on proof terms is {\it rightist
  substitution}:


{\it Left commutative cuts} (part 4) deal with all cases where the
first given derivation ends in a left rule. The action on proof terms
is a {\it leftist substitution}: 


\begin{proof}
The proof of cut admissibility is by lexicographic induction. In each
invocation of the induction hypothesis, either
\begin{itemize}
\item the principal formula  or  
gets smaller, or else it stays the same 
and
\item the ``part size'' (as in parts 1-4) decreases, or else both the
  principal formula and part size stay the same and either
\begin{itemize}
\item we are in part 3 and the second given derivation gets smaller,
  or
\item we are in part 4 and the first given derivation gets smaller.
\end{itemize}
\end{itemize}
This is actually a refinement of the standard structural induction
metric presented by Pfenning \shortcite{pfenning00structural}, which
is itself a structural-induction-flavored reinterpretation of the
metric used by Gentzen \shortcite{gentzen35untersuchungen} that forms
the basis of most cut elimination proofs. The
extra lexicographic ordering on ``part size'' is nonstandard, but is
needed here to justify the appeals to principal substitution
from rightist and leftist substitution.  When we look at the
computational content of cut admissibility, we can see that rightist
substitutions only break apart the second given derivation and that
leftist substitutions only break apart the first derivation, and that
these substitutions do not call one another directly. Unlike the usual
induction argument for cut admissibility, there is no commitment made
to the first derivation staying the same or getting smaller
while we are performing rightist substitution; the same is true for
the second derivation in leftist substitution. While it is beyond the
scope of this article, this alternate induction metric is helpful
when formalizing structural focalization in Agda.

Due to the conciseness (certainly) and clarity (optimistically) of
such a presentation, we present the cases of this proof using only
proof terms. This critically relies on the fact that we
understand all of our values, terms, and spines to be intrinsically
typed (and therefore in 1-to-1 correspondence with focused sequent
calculus derivations).

\subsubsection*{Principal substitution} 
This is where the action is; it's where both terms are decomposed
simultaneously in concert as the type gets smaller. Rightist and
leftist substitutions, in comparison, are just looking around for
places where principal substitution can happen.

\bigskip
\fbox{} (part 1)
\begin{quote}
\\
\\
\\
\\
\\


\medskip
In the case where , we invoke focal substitution 
to do variable-for-variable substitution. This can also be seen as 
a use of contraction.
\end{quote}

\medskip
\fbox{} (part 2)
\begin{quote}
\\
\\
\\
\\

\end{quote}

\subsubsection*{Rightist substitution} 
This is closest to the traditional form of substitution that we're
used to from natural deduction: we churn through the second term to
find all the places where , the variable we're substituting 
for, occurs (if, indeed, any exist). When we find an occurrence of
this distinguished variable, which can only happen when the expression
that we're substituting into is a term that has decided to focus on
, we call to negative principal substitutions (part 2).  In
traditional substitution we'd just plop  down at the places where
 occurred, but to do that in this setting would introduce a cut!

\bigskip
\fbox{} (part 3, )
\begin{quote}
\\
\\
\\
\\
\\

\end{quote}

\medskip
\fbox{} (part 3, )
\begin{quote}
\\
\\

   \qquad (if )\\
\\
\\
\\
\\
\\
\\
\\
\\
\\
\\


\medskip
In the cases for  (proof term ) and 
(proof term ), the bound variables
 and  can always be 
-converted to be different from both  and any variables free in .
\end{quote}

\medskip
\fbox{} (part 3, )

\begin{quote}
\\ 
\\
\\
\\

\end{quote}

\subsubsection*{Leftist substitution} 
This is so named because it, rather unusually, breaks apart the first
(and not the second) derivation. This is natural from the perspective
of cut elimination: the second term  has an inversion it must do on
the left, so just like we searched in rightist substitution for any
(potential) use of the  rule on  in the second term, we
search in leftist substitution for uses of  to derive
 in the first term.

\bigskip
\fbox{} (part 4, )
\begin{quote}
\\
\\
\\
\\
\\
\\
\\

\end{quote}

\medskip
\fbox{} (part 4, )
\begin{quote}
\\
\\
\\

\end{quote}

\noindent
This completes the proof. The four parts of this theorem are named
{\tt cut+}, {\tt cut-}, {\tt rsubst}, and {\tt lsubst} (respectively)
in the accompanying Twelf development.
\end{proof}



\section{Identity expansion}
\label{sec:expansion}

A significant novelty of our presentation relative to existing work is
our presentation of the identity expansion theorem; it is adapted from
the identity expansion theorem given for {\it weak focusing}
\cite{simmons11weak}, a less-restricted focusing calculus that does
not require invertible rules to be applied eagerly. The familiar
identity property for an unfocused sequent calculus states that, for
all propositions , there is a derivation . Identity in an unfocused sequent calculus can generally be
established by structural induction on the proposition .


As with cut admissibility, there are two analogous identity properties
for the focused sequent calculus. First, for all positive propositions
 there is a derivation of . Second, for
all negative propositions  there is a derivation . As an exercise, you should convince yourself that
this property cannot be established directly by structural induction
on  or . It doesn't work, in other words, to generalize the
 rule from the unfocused sequent calculus
(Figure~\ref{fig:unfoc}) to get an identity principle for the focused
sequent calculus. Instead, it is the suggestively named  and
 rules that generalize to admissible identity expansion
principles:

When we introduced the  and  rules, we said they
reflected the idea that inversion should not suspend itself until
reaching an atomic proposition. The existence of these admissible
rules relaxes this requirement: we can optionally suspend inversion
before the pattern matching process is exhausted. The non-atomic
suspended propositions that appear when we suspend early appear to
have a connection to the {\it complex values} in call-by-push-value
\cite{levy04call}.

The premises of both of these rules are definitely not
suspension-normal. Unlike cut admissibility, identity expansion is not
at all restricted to suspension-normal sequents: non-atomic suspended
propositions and focal substitution play an important role. 

We associate positive identity expansion with the proof term 
and negative identity expansion with the proof term , 
allowing us to annotate the admissible rules above:

Given identity expansion, the positive identity principle that
 holds for all  is provable using
positive identity expansion.

 The negative identity principle that 
 holds for all  is similarly a corollary of negative identity
 expansion.


\begin{theorem}[Identity expansion]\label{thm:identity}~
\begin{enumerate}
\item For all , if , 
then . 
\item For all , if ,
then . 
\end{enumerate}
\end{theorem}

\begin{proof}
The proof is by induction and case analysis on the structure of the
proposition  or .  

We will present one case of part 1 and
one case of part 2 line-by-line, and then present all of the cases
using the language of proof terms.


\begin{description}
\item[Case (part 1)] 
\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
  \` given \\
\>
 \> :: 
  \` by weakening on \\
\>
 \> :: 
  \` by rule \\
\>
 \> :: 
  \` by rule \\
\>
 \> :: 
  \` by rule  on  and \\
\>
 \> :: 
  \` by focal substitution on  and \\
\>
 \> :: 
  \` by i.h.~(part 1) on  and \\
\>
 \> :: 
  \` by i.h.~(part 1) on  and \\
\>

  \` by rule  on 
\end{tabbing}

\item[Case (part 2)] 
\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
  \` given \\
\>
 \> :: 
  \` by weakening on \\
\>
 \> :: 
  \` by rule \\
\>
 \> :: 
  \` by rule \\
\>
 \> :: 
  \` by rule  on  and \\
\>
 \> :: 
  \` by focal substitution on  and \\
\>
 \> :: 
  \` by i.h.~(part 2) on  and \\
\>
 \> :: 
  \` by i.h.~(part 1) on  and \\
\>

  \` by rule  on 
\end{tabbing}
\end{description}
This suffices to show the line-by-line structure of the identity
expansion theorem; other cases follow the same pattern. We will now
give all the cases on the level of proof terms:

\bigskip
\fbox{} (part 1) 
\begin{quote}
\\
\\
\\
\\
\\

\end{quote}

\medskip
\clearpage\fbox{} (part 2) 
\begin{quote}
\\
\\
\\
\\

\end{quote}


\noindent
This completes the proof; the two parts of this theorem are named
{\tt expand+} and {\tt expand-} (respectively) 
in the accompanying Twelf development.
\end{proof}

\section{Focalization}
\label{sec:focalization}

Theorem~\ref{thm:completeness} in this section establishes the
focalization property: it is possible to turn the 
unfocused derivation of an unpolarized sequent into a focused derivation
for any polarized sequent that erases to the unpolarized one. This
proof naturally factors into two parts. The first part is a series of
{\it unfocused admissibility} lemmas, a family of admissible rules
which serve to show that focused sequent calculus derivations can
mimic unfocused derivations.  The second part is a straightforward
inductive proof that, if  is stable,
 implies
. Recall that , from
Figure~\ref{fig:erasure-ctx}, is the erasure of polarization for
contexts and succedents.


\subsection{Unfocused admissibility}\label{sec:unfocusedadmissibility}

We think of unfocused admissibility as building an
abstraction layer on top of focused, polarized logic.  The proof of
focalization then interacts with focused derivations entirely through
the abstraction layer of unfocused admissibility. 

It is possible to motivate unfocused admissibility independently of
focalization.  Consider the unfocused right rules for
conjunction compared to the focused right rules for (positive)
conjunction.

The rules look similar, but their usage is quite different. To prove
 we must prove  (possibly doing some work on the left first)
and, in the other branch, we must prove  (possibly doing some work on the
left first). To prove , we must 
decompose  in one branch and  in the other; there is no possibility
of doing work on the left first. The admissible rule in polarized
logic that actually matches the structure of the unfocused rule 
looks like this:\footnote{The admissible rules associated with 
the lemmas in this section will all be
annotated with a  for {\it unfocused} (e.g. ).}

The stable premises  and  ensure that, in both
subderivations, it will be possible to do work on the left before
decomposing  or . 

The unfocused admissibility lemmas could be established the slow,
painful, and boring way, by one or more inductions over focused
derivations per lemma.
This more traditional approach is
both technically and philosophically unsatisfying, however. The approach is
technically unsatisfying because these theorems are long and annoying,
and it is philosophically unsatisfying because cut admissibility and
identity expansion are already supposed to capture global properties
of the logic. We will instead establish unfocused admissibility
directly from cut admissibility and identity expansion without the
need for any additional induction; each unfocused
admissibility proof is short, though dense. In Figure~\ref{fig:adm} we
present the proof of  as a derivation built using
admissible rules.

\begin{figure}

\caption{Unfocused admissibility rule  as a derivation,
  where .}
\label{fig:adm}
\end{figure}




The unfocused admissibility lemmas will be presented in terms of the
admissible rules they justify, but their proofs will be presented
entirely at the level of proof terms. In most cases, we will omit the
propositions that annotate instances of cut admissibility.  We must be
careful about the interaction of cut admissibility and identity
expansion. The premises of  and  are
not suspension-normal because they contain non-atomic suspended
propositions, and cut admissibility is only defined on
suspension-normal sequents. All the unfocused admissibility lemmas in
this section require that the given sequents are stable and
suspension-normal, but we omit this repetitive precondition when we
write the admissible rules.\footnote{For lemmas that do not use cut
  admissibility, stability and suspension-normality are usually
  unnecessary preconditions. The mechanized proof states these less
  restrictive preconditions where they apply.}

\newcommand{\deshift}{\mbox{}}

In certain cases we do more work than necessary, such as in the left
rule for , which could alternatively be phrased as
a use of weakening. This is done to match the structure of unfocused
admissibility in substructural logics \cite{simmons12substructural}.


\subsubsection{Initial rules} 

A positive atomic proposition can appear in the hypothetical context
either as a shifted positive proposition  or as a
suspended positive proposition , and likewise for
negative atomic propositions on the right. As a result, we need four
initial rules to correspond to the single unfocused rule .
(We could cut these four rules down to two if we restricted erasure
and focalization to suspension-free sequents instead of
suspension-normal sequents.)  Each of these unfocused admissibility
lemmas are actually directly derivable.

















\subsubsection{Disjunction}

















\smallskip
\quad 
where 

\quad
is a closed term of type 
 
introducing 

\subsubsection{Positive conjunction}














\smallskip
\quad 
where 

\quad
    is a term of type  introducing  with 
     of type  free.

\quad(This was the case given above as a derivation with admissible rules.)





\smallskip
\quad 
where 

\quad
is a closed term of type 

introducing .

\subsubsection{Implication}





\smallskip
\quad
where 

\quad
is a term introducing  
with  of type 
 free.





\smallskip
\quad
where 

\quad is a term of type  introducing  with
 of type  free.




\paragraph{Negative conjunction}









\smallskip
\quad
where 

\quad
is a term introducing  
with  of type 
 free.










\subsubsection{Shift removal} 

In order for the unfocused admissibility lemmas to form a complete
abstraction boundary between the focused sequent calculus and the
focalization theorem, we must account for the fact that many polarized
propositions erase to the same proposition. For example, if
 and , then

and so on. To deal with deeply-shifted propositions in the
completeness theorem, we will invoke a shift removal lemma. It is
different from the other unfocused admissibility lemmas in that it
mentions erasure and we prove it by induction over the structure of
propositions.

\begin{lemma}[Shift removal (positive)]

If , there exists a , 
  not of the form , such that
 and, for any , 
implies .
\end{lemma}

\begin{lemma}[Shift removal (negative)] 

If , there exists a , 
  not of the form , such that
 and, for any  and ,
 implies 
\end{lemma}

\begin{proof}
Both lemmas are by induction on the structure of the proposition 
or . If the outermost structure of the proposition is two
adjacent shifts, we invoke the induction hypothesis and apply either
 or
:









\bigskip
\noindent
In all cases where the outermost structure of the proposition is {\em
  not} made up of two adjacent shifts, we succeed immediately using
the given derivation.  These lemmas are called {\tt rshifty} and {\tt
  lshifty} in the accompanying Twelf development.
\end{proof}




\subsection{Proof of focalization}
\label{sec:focalizationproof}

Since we have not defined proof terms corresponding to 
unfocused sequent calculus derivations, in
the proof of the focalization we will return to the more
traditional style of proof presentation.

\begin{theorem}[Focalization]\label{thm:completeness}
If  is stable and  and  are suspension-normal, then
 implies .
\end{theorem}

\noindent
The second condition, that  and  are suspension-normal, is
not something we strictly need to state, as  and
 are only defined on suspension-normal contexts and
succedents.

\begin{proof}
By induction on the structure of the given derivation . Aside from the rule , each rule in
Figure~\ref{fig:unfoc} decomposes one proposition  on the left or
the right. By the definition of erasure in
Figure~\ref{fig:erasure-ctx}, if  is being decomposed on the right
then  for some . We proceed by 
case analysis on the structure of the polarized proposition .
By
the shift removal lemma, it suffices to consider the case where this
formula is not double-shifted. We will show a few representative
cases.

\begin{description}
\item[Case] , \quad

\begin{tabbing}
\qquad \=  \= \kill
\>
 
  \` by unfocused admissibility lemma 
\end{tabbing}

\item[Case] , \quad

\begin{tabbing}
\qquad \=  \= \kill
\>
 
  \` by unfocused admissibility lemma 
\end{tabbing}

\item[Case] , \quad

\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
  \` by i.h.~on \\
\>
 \> :: 
  \` by i.h.~on \\
\>
 
  \` by unfocused admissibility lemma  
     on  and 
\end{tabbing}

\item[Case] , \quad

\begin{tabbing}
\qquad \=  \= \kill
\>
 \> :: 
  \` by i.h.~on \\
\>
 \> :: 
  \` by i.h.~on \\
\>
 
  \` by unfocused admissibility lemma  
     on  and 
\end{tabbing}
\end{description}
There are three other cases
corresponding to , , and .
All proceed in a similar fashion. 

Similarly, if  is being decomposed
on the left, then  for some , and we proceed
using the shift removal lemma and case analysis on the structure
of .

\begin{description}
\item[Case] , \quad


\begin{tabbing}
\qquad \=  \= \kill
\>
 \> ::
 
  \` by i.h.~on \\
\>
 \> ::
 
  \` by weakening on \\
\>
 \> ::
 \\
  \` by unfocused admissibility lemma  on \\
\>
 \` by contraction on 
\end{tabbing}

\item[Case] , \quad


\begin{tabbing}
\qquad \=  \= \kill
\>
 \> ::
 
  \` by i.h.~on \\
\>  \> ::
\\
  \` by unfocused admissibility lemma  on  \\
\> 
  \` by contraction on 
\end{tabbing}

\end{description}
There are five other non-initial cases: two corresponding to
 that mirror the cases for , and three
corresponding to , ,
and . All proceed in a similar fashion. 

If our unfocused derivation ends with the  rule, we must
observe that, according to the definition of erasure, there are four
distinct sequents that all erase to .  An atomic
proposition can be the erasure of a positive or negative atomic
proposition, and in suspension-normal sequents atomic
propositions may be suspended or not.  (If  is a positive atomic
proposition, then it can appear on the left as either  or
as .)
In each of the four cases, the theorem proceeds directly from shift
removal and the appropriate unfocused admissibility lemma.

This
theorem is named {\tt complete} in the accompanying Twelf development.
\end{proof}

\subsection{Corollaries of focalization}\label{ref:corollaries}

Consider this section a short victory lap. We have established cut
admissibility and identity for the focused sequent calculus, as well
as the focalization and de-focalization properties, without reference
to any properties of the unfocused sequent calculus other than
weakening and exchange. Given these four theorems, the standard
metatheoretic results of the unfocused sequent calculus can be
established as straightforward corollaries. (If our goal was simply to
prove cut admissibility and identity for the unfocused sequent
calculus, then proving focused cut admissibility, identity expansion,
de-focalization, and focalization would admittedly not be the easiest
way to do so!)

The only new thing we need is an arbitrary polarization strategy
 that translates unpolarized propositions to negatively
polarized propositions. It is straightforward to then define
, the obvious lifting of this function to
contexts.

\begin{corollary}\label{cor:cut}
If  and , then .
\end{corollary}

\begin{proof}
Since  is defined to be a partial inverse of erasure,
the first given derivation is equally a derivation of
, and
the second given derivation is equally a derivation of
. 

By focalization (Theorem~\ref{thm:completeness}), we have the focused
derivations  and
, and
by applying  to the second of these derivations we get
.
Then, by cut admissibility (Theorem~\ref{thm:cut}, part 4), we obtain
a derivation of , which by
de-focalization (Theorem~\ref{thm:soundness}) gives us a derivation of
, 
which is the same thing as a derivation of .
\end{proof}

\clearpage
\begin{corollary}\label{cor:identity}
For all , .
\end{corollary}

\begin{proof}
By the identity principle, which as discussed is a corollary of
identity expansion (Theorem~\ref{thm:identity}), we can obtain a
derivation of . By
de-focalization (Theorem~\ref{thm:soundness}), this gives us a
derivation of , which is the same thing
as a derivation of .
\end{proof}

These corollaries ({\tt unfocused-cut} and {\tt unfocused-identity} 
in the accompanying Twelf development) 
are interesting primarily insofar as they establish the 
total dominance that the focused sequent calculus enjoys over 
the unfocused sequent calculus. We have performed precisely
one induction over unpolarized propositions
(implicitly, in the definition of 
) and one induction over unfocused derivations (in the proof of
focalization, Theorem~\ref{thm:completeness}). 
The cut admissibility and identity
expansion lemmas for the focused sequent calculus are strong enough for the
unfocused sequent calculus to inherit its metatheory from the force
of the theorems in the focused setting.

\section{Conclusion}
\label{sec:previous}

We have presented two sequent calculi for different variants of
propositional intuitionistic logic, an unfocused sequent calculus for
unpolarized intuitionistic logic and a focused sequent calculus for
polarized intuitionistic logic.  We then proved a strong theorem about
their equivalence at the level of derivability. The equivalence result
follows from mechanized, structurally inductive proofs establishing
internal soundness and completeness for the focused logic. That
equivalence result implies the internal soundness and completeness of
the unfocused logic. Our systematic approach avoids
tedious invertibility lemmas and allows for a proof, on paper or 
in a mechanized setting, that scales linearly in the number of
connectives and rules.

We will close with a brief survey of existing techniques used to prove
the focalization property, with an emphasis on intuitionistic logic.

\subsection{Comparison to existing focalization proofs}

The most prevalent technique by far has been to do things the long
way.  Andreoli's original presentation of a focused sequent calculus
required a large and tedious series of invertibility lemmas; Andreoli
described these lemmas as ``long but not difficult''
\cite{andreoli92logic}.  Howe's dissertation presents a similar
brute-force approach to the focalization property in the context of
intuitionistic logics, including intuitionistic linear logic
\cite{howe98proof}.  In an unpublished note, Laurent described a
refactored version of the focalization property for classical linear
logic. Laurent staged the proof differently from Andreoli, introducing
several intermediate refinements with some, but not all, of the
restrictions of full focusing.  Laurent's proof is conceptually
clearer than Andreoli's, but it still requires tedious invertibility
lemmas in order to establish the identity property
\cite{laurent04proof}.

The ``grand tour'' strategy of Liang and Miller stands somewhat alone
as an attempt to piggyback on established focusing results, rather
than proving new ones.  Unfocused derivations are translated into
classical linear logic derivations, which are then focused. It is then
only necessary to show that focused derivations can be translated back
out from the focused classical linear logic derivations
\cite{liang09focusing}.  We believe most of instances of this strategy
can be understood, in the context of our system, as specific
polarization strategies, which (as partial inverses of erasure) are
handled generically by our erasure-based proof of focalization.
 





The idea that focalization should arise as a consequence of the 
cut admissibility
and identity properties for a focused logic
originates from Chaudhuri's dissertation
\cite{chaudhuri06focused}. Compared to this work, Chaudhuri's reliance on 
the identity property is less direct, and his proof of identity was 
non-structural, relying on a global decomposition of contexts and
propositions. Chaudhuri's technique was generalized by 
Liang and Miller \shortcite{liang11focused} to any systems meeting 
a general set of criteria; 
these criteria encompass classical and linear logics. In comparison,
the techniques in this paper have not
yet been applied to classical logics,
but have been shown to extend straightforwardly to substructural 
and modal logics \cite{simmons12substructural}.

A line of work by Reed proved focalization by adding extra structure
to the logic being focused. Reed's ``token passing translation''
obtains the necessary structure through the use of linearity and a
distinguished linear atomic proposition \cite{reed08focalizing}. His
work with Pfenning, which was aimed at giving a resource semantics for
substructural logics, obtains the necessary structure through the use
of first-order terms quotiented by an equivalence relation
\cite{reed10focus}. These proofs avoid invertibility lemmas, but their
technique is less direct than ours and may not be as amenable to
formalization in existing logical frameworks.

A wildly different approach to focalization can be found in the
context of Zeilberger's {\it higher-order focusing}
\cite{zeilberger08focusing}. This pattern-based presentation of logic
entirely removes any mention of individual logical connectives from
the core logic; negative and positive propositions are handled in a
completely generic way, in line with synthetic presentations of
focusing. This approach prevents tedious repetition by
default; there aren't enough rules left to tediously induct upon!
Polarization strategy-based focalization for higher-order focusing has
been formalized in the Agda proof assistant, and there do not appear
to be any technical obstacles to mechanizing the erasure-based
approach discussed by Zeilberger \shortcite{zeilberger08unity}.
Higher-order focused proofs represent a significant departure from the
style of presentation in this paper; in particular, higher-order proof
terms are infinitary, which means the Agda mechanization cannot be
ported straightforwardly in Twelf. It is unclear what impact
Zeilberger's strategy of de-functionalizing focused derivations (which
makes them representable in Twelf and, more generally, by
non-infinitary derivations) has on focalization
\cite{zeilberger09defunctionalizing}.

The broad outlines of this paper were first developed in conjunction
with our study of ordered linear logic as a forward chaining logic
programming language \cite{pfenning09substructural}. For the purposes
of that paper, unfocused admissibility in a {\it weakly focused}
sequent calculus -- which did not force invertible rules to be applied
eagerly -- was established the historic (long and tedious) way. A
Twelf proof for weakly focused intuitionistic logic developed at the
same time was the genesis of the structural identity expansion proof
presented here \cite{simmons09weak}.  Eventually, this Twelf proof was
adapted back to ordered linear logic in a technical report that also
introduced the idea of suspended propositions
\cite{simmons11weak}. Unfortunately, to prove full focalization it was
still necessary to prove tedious invertibility lemmas
\cite{simmons11logical}, meaning that the weak focusing technique
gives no advantages beyond those provided by Laurent's refactoring. We
believe this article supersedes our work on weak focusing
entirely. 



Our novel presentation of identity expansion seems to be necessary to
deal with positive propositions. In logics without any interesting
positive structure, simpler techniques have been successfully applied
to prove analogues of the focalization property. The first result in
this line was Miller et al.'s work on {\it uniform proofs} which, like
Andreoli's seminal work, was motivated by logic programming
\cite{miller91uniform}.  We don't intend to fully survey techniques
applicable to settings with only negative connectives, but we will
mention two such systems.  The first system is Jagadeesan et al.'s
, a mixed-paradigm logic programming language with {\it
  atoms} and {\it constraints} that, in retrospect, 
are recognizable as instances of 
negative and positive atoms.
Their focalization proof roughly
resembles the one used by Miller et
al.~\cite{jagadeesan05testing}. The second system is the framework in
which Reed and Pfenning developed their constructive resource
semantics. This system is notable for our purposes because its
focalization proof almost exactly follows our development
\cite{reed10focus}. It was not known at the time how to extend their
proof to a language with non-trivial positive propositions.

\subsection*{Acknowledgments}

Carlo Angiuli, Taus Brock-Nannestad, Illiano Cervesato, 
Kaustuv Chaudhuri, Karl Crary,
Rowan Davies,
Robert Harper, Dan Licata, Chris Martens, Adam Megacz, Dale Miller,
Frank Pfenning, Jason Reed, Fabien Renaud, Bernardo Toninho, 
Sean McLaughlin, Noam Zeilberger, and
two anonymous reviewers offered helpful pointers to existing work
and/or feedback on various drafts of this work.  Frank Pfenning's
insights, particularly his Twelf formulation of identity expansion for
a weakly focused logic (which preceded the formal on-paper formulation
by several years), were particularly invaluable.

Support for this research was provided by the Funda\c{c}\~ao para a
Ci\^encia e a Tecnologia (Portuguese Foundation for Science and
Technology) through the Carnegie Mellon Portugal Program under Grant
NGN-44 and by an X10 Innovation Award from IBM.

\bibliographystyle{acmtrans}
\bibliography{ref}

\end{document}
