\documentclass[a4paper]{article}
\usepackage{a4wide}
\usepackage{graphicx,xcolor}
\graphicspath{{./images/}}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{empheq}
\usepackage{amsthm}
\usepackage{amssymb, latexsym, mathrsfs}
\usepackage{amsmath}
\usepackage{dsfont}
\usepackage{enumerate}
\usepackage{algorithm}
\usepackage{color}
\usepackage{transparent}
\usepackage{url}
\usepackage[affil-it]{authblk}
\usepackage{booktabs}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}

\usepackage[american,cuteinductors,smartlabels]{circuitikz}
\usepackage{tikz}
\usepackage{schemabloc}
\usetikzlibrary{shapes,arrows}

\newcommand*{\QEDA}{\hfill\ensuremath{\blacksquare}}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{ass}{Assumption}
\newtheorem{prbl}{Problem}
\newtheorem{cor}{Corollary}
\newtheorem{rmk}{Remark}
\newtheorem{prp}{Proposition}
\newtheorem{lem}{Lemma}
\newtheorem{definition}{Definition}

\newcommand\overmat[2]{\makebox[0pt][l]{}#2}
\newcommand\bovermat[2]{\makebox[0pt][l]{}#2}
\newcommand\partialphantom{\vphantom{\frac{\partial e_{P,M}}{\partial w_{1,1}}}}
\newcommand{\qedwhite}{\hfill \ensuremath{\Box}}




\newcommand{\Aset}{\mathbb{A}}
\newcommand{\Bset}{\mathbb{B}}
\newcommand{\Cset}{\mathbb{C}}
\newcommand{\Dset}{\mathbb{D}}
\newcommand{\Eset}{\mathbb{E}}
\newcommand{\Fset}{\mathbb{F}}
\newcommand{\Gset}{\mathbb{G}}
\newcommand{\Hset}{\mathbb{H}}
\newcommand{\Iset}{\mathbb{I}}
\newcommand{\Jset}{\mathbb{J}}
\newcommand{\Kset}{\mathbb{K}}
\newcommand{\Lset}{\mathbb{L}}
\newcommand{\Mset}{\mathbb{M}}
\newcommand{\Nset}{\mathbb{N}}
\newcommand{\Oset}{\mathbb{O}}
\newcommand{\Pset}{\mathbb{P}}
\newcommand{\Qset}{\mathbb{Q}}
\newcommand{\Rset}{\mathbb{R}}
\newcommand{\Sset}{\mathbb{S}}
\newcommand{\Tset}{\mathbb{T}}
\newcommand{\Uset}{\mathbb{U}}
\newcommand{\Vset}{\mathbb{V}}
\newcommand{\Wset}{\mathbb{W}}
\newcommand{\Xset}{\mathbb{X}}
\newcommand{\Yset}{\mathbb{Y}}
\newcommand{\Zset}{\mathbb{Z}}




\newcommand{\hAset}{\mathbb{\hat{A}}}
\newcommand{\hBset}{\mathbb{\hat{B}}}
\newcommand{\hCset}{\mathbb{\hat{C}}}
\newcommand{\hDset}{\mathbb{\hat{D}}}
\newcommand{\hEset}{\mathbb{\hat{E}}}
\newcommand{\hFset}{\mathbb{\hat{F}}}
\newcommand{\hGset}{\mathbb{\hat{G}}}
\newcommand{\hHset}{\mathbb{\hat{H}}}
\newcommand{\hIset}{\mathbb{\hat{I}}}
\newcommand{\hJset}{\mathbb{\hat{J}}}
\newcommand{\hKset}{\mathbb{\hat{K}}}
\newcommand{\hLset}{\mathbb{\hat{L}}}
\newcommand{\hMset}{\mathbb{\hat{M}}}
\newcommand{\hNset}{\mathbb{\hat{N}}}
\newcommand{\hOset}{\mathbb{\hat{O}}}
\newcommand{\hPset}{\mathbb{\hat{P}}}
\newcommand{\hQset}{\mathbb{\hat{Q}}}
\newcommand{\hRset}{\mathbb{\hat{R}}}
\newcommand{\hSset}{\mathbb{\hat{S}}}
\newcommand{\hTset}{\mathbb{\hat{T}}}
\newcommand{\hUset}{\mathbb{\hat{U}}}
\newcommand{\hVset}{\mathbb{\hat{V}}}
\newcommand{\hWset}{\mathbb{\hat{W}}}
\newcommand{\hXset}{\mathbb{\hat{X}}}
\newcommand{\hYset}{\mathbb{\hat{Y}}}
\newcommand{\hZset}{\mathbb{\hat{Z}}}





\newcommand{\hhAset}{\mathbb{\hat{\hat{A}}}}
\newcommand{\hhBset}{\mathbb{\hat{\hat{B}}}}
\newcommand{\hhCset}{\mathbb{\hat{\hat{C}}}}
\newcommand{\hhDset}{\mathbb{\hat{\hat{D}}}}
\newcommand{\hhEset}{\mathbb{\hat{\hat{E}}}}
\newcommand{\hhFset}{\mathbb{\hat{\hat{F}}}}
\newcommand{\hhGset}{\mathbb{\hat{\hat{G}}}}
\newcommand{\hhHset}{\mathbb{\hat{\hat{H}}}}
\newcommand{\hhIset}{\mathbb{\hat{\hat{I}}}}
\newcommand{\hhJset}{\mathbb{\hat{\hat{J}}}}
\newcommand{\hhKset}{\mathbb{\hat{\hat{K}}}}
\newcommand{\hhLset}{\mathbb{\hat{\hat{L}}}}
\newcommand{\hhMset}{\mathbb{\hat{\hat{M}}}}
\newcommand{\hhNset}{\mathbb{\hat{\hat{N}}}}
\newcommand{\hhOset}{\mathbb{\hat{\hat{O}}}}
\newcommand{\hhPset}{\mathbb{\hat{\hat{P}}}}
\newcommand{\hhQset}{\mathbb{\hat{\hat{Q}}}}
\newcommand{\hhRset}{\mathbb{\hat{\hat{R}}}}
\newcommand{\hhSset}{\mathbb{\hat{\hat{S}}}}
\newcommand{\hhTset}{\mathbb{\hat{\hat{T}}}}
\newcommand{\hhUset}{\mathbb{\hat{\hat{U}}}}
\newcommand{\hhVset}{\mathbb{\hat{\hat{V}}}}
\newcommand{\hhWset}{\mathbb{\hat{\hat{W}}}}
\newcommand{\hhXset}{\mathbb{\hat{\hat{X}}}}
\newcommand{\hhYset}{\mathbb{\hat{\hat{Y}}}}
\newcommand{\hhZset}{\mathbb{\hat{\hat{Z}}}}




\newcommand{\bAset}{\mathbb{\bar{A}}}
\newcommand{\bBset}{\mathbb{\bar{B}}}
\newcommand{\bCset}{\mathbb{\bar{C}}}
\newcommand{\bDset}{\mathbb{\bar{D}}}
\newcommand{\bEset}{\mathbb{\bar{E}}}
\newcommand{\bFset}{\mathbb{\bar{F}}}
\newcommand{\bGset}{\mathbb{\bar{G}}}
\newcommand{\bHset}{\mathbb{\bar{H}}}
\newcommand{\bIset}{\mathbb{\bar{I}}}
\newcommand{\bJset}{\mathbb{\bar{J}}}
\newcommand{\bKset}{\mathbb{\bar{K}}}
\newcommand{\bLset}{\mathbb{\bar{L}}}
\newcommand{\bMset}{\mathbb{\bar{M}}}
\newcommand{\bNset}{\mathbb{\bar{N}}}
\newcommand{\bOset}{\mathbb{\bar{O}}}
\newcommand{\bPset}{\mathbb{\bar{P}}}
\newcommand{\bQset}{\mathbb{\bar{Q}}}
\newcommand{\bRset}{\mathbb{\bar{R}}}
\newcommand{\bSset}{\mathbb{\bar{S}}}
\newcommand{\bTset}{\mathbb{\bar{T}}}
\newcommand{\bUset}{\mathbb{\bar{U}}}
\newcommand{\bVset}{\mathbb{\bar{V}}}
\newcommand{\bWset}{\mathbb{\bar{W}}}
\newcommand{\bXset}{\mathbb{\bar{X}}}
\newcommand{\bYset}{\mathbb{\bar{Y}}}
\newcommand{\bZset}{\mathbb{\bar{Z}}}





\newcommand{\tAset}{\mathbb{\tilde{A}}}
\newcommand{\tBset}{\mathbb{\tilde{B}}}
\newcommand{\tCset}{\mathbb{\tilde{C}}}
\newcommand{\tDset}{\mathbb{\tilde{D}}}
\newcommand{\tEset}{\mathbb{\tilde{E}}}
\newcommand{\tFset}{\mathbb{\tilde{F}}}
\newcommand{\tGset}{\mathbb{\tilde{G}}}
\newcommand{\tHset}{\mathbb{\tilde{H}}}
\newcommand{\tIset}{\mathbb{\tilde{I}}}
\newcommand{\tJset}{\mathbb{\tilde{J}}}
\newcommand{\tKset}{\mathbb{\tilde{K}}}
\newcommand{\tLset}{\mathbb{\tilde{L}}}
\newcommand{\tMset}{\mathbb{\tilde{M}}}
\newcommand{\tNset}{\mathbb{\tilde{N}}}
\newcommand{\tOset}{\mathbb{\tilde{O}}}
\newcommand{\tPset}{\mathbb{\tilde{P}}}
\newcommand{\tQset}{\mathbb{\tilde{Q}}}
\newcommand{\tRset}{\mathbb{\tilde{R}}}
\newcommand{\tSset}{\mathbb{\tilde{S}}}
\newcommand{\tTset}{\mathbb{\tilde{T}}}
\newcommand{\tUset}{\mathbb{\tilde{U}}}
\newcommand{\tVset}{\mathbb{\tilde{V}}}
\newcommand{\tWset}{\mathbb{\tilde{W}}}
\newcommand{\tXset}{\mathbb{\tilde{X}}}
\newcommand{\tYset}{\mathbb{\tilde{Y}}}
\newcommand{\tZset}{\mathbb{\tilde{Z}}}





\newcommand{\ha}{{\hat{a}}}
\newcommand{\hb}{{\hat{b}}}
\newcommand{\hc}{{\hat{c}}}
\newcommand{\hd}{{\hat{d}}}
\newcommand{\he}{{\hat{e}}}
\newcommand{\hf}{{\hat{f}}}
\newcommand{\hg}{{\hat{g}}}
\newcommand{\hh}{{\hat{h}}}
\newcommand{\hi}{{\hat{i}}}
\newcommand{\hj}{{\hat{j}}}
\newcommand{\hk}{{\hat{k}}}
\newcommand{\hl}{{\hat{l}}}
\newcommand{\hm}{{\hat{m}}}
\newcommand{\hn}{{\hat{n}}}
\newcommand{\ho}{{\hat{o}}}
\newcommand{\hp}{{\hat{p}}}
\newcommand{\hq}{{\hat{q}}}
\newcommand{\hr}{{\hat{r}}}
\newcommand{\hs}{{\hat{s}}}
\newcommand{\hatt}{{\hat{t}}}
\newcommand{\hu}{{\hat{u}}}
\newcommand{\hv}{{\hat{v}}}
\newcommand{\hw}{{\hat{w}}}
\newcommand{\hx}{{\hat{x}}}
\newcommand{\hy}{{\hat{y}}}
\newcommand{\hz}{{\hat{z}}}



\newcommand{\hA}{{\hat{A}}}
\newcommand{\hB}{{\hat{B}}}
\newcommand{\hC}{{\hat{C}}}
\newcommand{\hD}{{\hat{D}}}
\newcommand{\hE}{{\hat{E}}}
\newcommand{\hF}{{\hat{F}}}
\newcommand{\hG}{{\hat{G}}}
\newcommand{\hH}{{\hat{H}}}
\newcommand{\hI}{{\hat{I}}}
\newcommand{\hJ}{{\hat{J}}}
\newcommand{\hK}{{\hat{K}}}
\newcommand{\hL}{{\hat{L}}}
\newcommand{\hM}{{\hat{M}}}
\newcommand{\hN}{{\hat{N}}}
\newcommand{\hO}{{\hat{O}}}
\newcommand{\hP}{{\hat{P}}}
\newcommand{\hQ}{{\hat{Q}}}
\newcommand{\hR}{{\hat{R}}}
\newcommand{\hS}{{\hat{S}}}
\newcommand{\hT}{{\hat{T}}}
\newcommand{\hU}{{\hat{U}}}
\newcommand{\hV}{{\hat{V}}}
\newcommand{\hW}{{\hat{W}}}
\newcommand{\hX}{{\hat{X}}}
\newcommand{\hY}{{\hat{Y}}}
\newcommand{\hZ}{{\hat{Z}}}




\newcommand{\hXi}{{\hat{\Xi}}}
\newcommand{\heta}{{\hat{\eta}}}




\newcommand{\hha}{{\hat{\hat{a}}}}
\newcommand{\hhb}{{\hat{\hat{b}}}}
\newcommand{\hhc}{{\hat{\hat{c}}}}
\newcommand{\hhd}{{\hat{\hat{d}}}}
\newcommand{\hhe}{{\hat{\hat{e}}}}
\newcommand{\hhf}{{\hat{\hat{f}}}}
\newcommand{\hhg}{{\hat{\hat{g}}}}
\newcommand{\hhh}{{\hat{\hat{h}}}}
\newcommand{\hhi}{{\hat{\hat{i}}}}
\newcommand{\hhj}{{\hat{\hat{j}}}}
\newcommand{\hhk}{{\hat{\hat{k}}}}
\newcommand{\hhl}{{\hat{\hat{l}}}}
\newcommand{\hhm}{{\hat{\hat{m}}}}
\newcommand{\hhn}{{\hat{\hat{n}}}}
\newcommand{\hho}{{\hat{\hat{o}}}}
\newcommand{\hhp}{{\hat{\hat{p}}}}
\newcommand{\hhq}{{\hat{\hat{q}}}}
\newcommand{\hhr}{{\hat{\hat{r}}}}
\newcommand{\hhs}{{\hat{\hat{s}}}}
\newcommand{\hhatt}{{\hat{\hat{t}}}}
\newcommand{\hhu}{{\hat{\hat{u}}}}
\newcommand{\hhv}{{\hat{\hat{v}}}}
\newcommand{\hhw}{{\hat{\hat{w}}}}
\newcommand{\hhx}{{\hat{\hat{x}}}}
\newcommand{\hhy}{{\hat{\hat{y}}}}
\newcommand{\hhz}{{\hat{\hat{z}}}}




\newcommand{\ba}{{\bar{a}}}
\newcommand{\bb}{{\bar{b}}}
\newcommand{\bc}{{\bar{c}}}
\newcommand{\bd}{{\bar{d}}}
\newcommand{\be}{{\bar{e}}}
\newcommand{\barf}{{\bar{f}}}
\newcommand{\bg}{{\bar{g}}}
\newcommand{\bh}{{\bar{h}}}
\newcommand{\bi}{{\bar{i}}}
\newcommand{\bj}{{\bar{j}}}
\newcommand{\bk}{{\bar{k}}}
\newcommand{\bl}{{\bar{l}}}
\newcommand{\bm}{{\bar{m}}}
\newcommand{\bn}{{\bar{n}}}
\newcommand{\bo}{{\bar{o}}}
\newcommand{\bp}{{\bar{p}}}
\newcommand{\bq}{{\bar{q}}}
\newcommand{\br}{{\bar{r}}}
\newcommand{\bs}{{\bar{s}}}
\newcommand{\bt}{{\bar{t}}}
\newcommand{\bu}{{\bar{u}}}
\newcommand{\bv}{{\bar{v}}}
\newcommand{\bw}{{\bar{w}}}
\newcommand{\bx}{{\bar{x}}}
\newcommand{\by}{{\bar{y}}}
\newcommand{\bz}{{\bar{z}}}




\newcommand{\bA}{{\bar{A}}}
\newcommand{\bB}{{\bar{B}}}
\newcommand{\bC}{{\bar{C}}}
\newcommand{\bD}{{\bar{D}}}
\newcommand{\bE}{{\bar{E}}}
\newcommand{\bF}{{\bar{F}}}
\newcommand{\bG}{{\bar{G}}}
\newcommand{\bH}{{\bar{H}}}
\newcommand{\bI}{{\bar{I}}}
\newcommand{\bJ}{{\bar{J}}}
\newcommand{\bK}{{\bar{K}}}
\newcommand{\bL}{{\bar{L}}}
\newcommand{\bM}{{\bar{M}}}
\newcommand{\bN}{{\bar{N}}}
\newcommand{\bO}{{\bar{O}}}
\newcommand{\bP}{{\bar{P}}}
\newcommand{\bQ}{{\bar{Q}}}
\newcommand{\bR}{{\bar{R}}}
\newcommand{\bS}{{\bar{S}}}
\newcommand{\bT}{{\bar{T}}}
\newcommand{\bU}{{\bar{U}}}
\newcommand{\bV}{{\bar{V}}}
\newcommand{\bW}{{\bar{W}}}
\newcommand{\bX}{{\bar{X}}}
\newcommand{\bY}{{\bar{Y}}}
\newcommand{\bZ}{{\bar{Z}}}




\newcommand{\bba}{{\bar{\bar{a}}}}
\newcommand{\bbb}{{\bar{\bar{b}}}}
\newcommand{\bbc}{{\bar{\bar{c}}}}
\newcommand{\bbd}{{\bar{\bar{d}}}}
\newcommand{\bbe}{{\bar{\bar{e}}}}
\newcommand{\bbarf}{{\bar{\bar{f}}}}
\newcommand{\bbg}{{\bar{\bar{g}}}}
\newcommand{\bbh}{{\bar{\bar{h}}}}
\newcommand{\bbi}{{\bar{\bar{i}}}}
\newcommand{\bbj}{{\bar{\bar{j}}}}
\newcommand{\bbk}{{\bar{\bar{k}}}}
\newcommand{\bbl}{{\bar{\bar{l}}}}
\newcommand{\bbm}{{\bar{\bar{m}}}}
\newcommand{\bbn}{{\bar{\bar{n}}}}
\newcommand{\bbo}{{\bar{\bar{o}}}}
\newcommand{\bbp}{{\bar{\bar{p}}}}
\newcommand{\bbq}{{\bar{\bar{q}}}}
\newcommand{\bbr}{{\bar{\bar{r}}}}
\newcommand{\bbs}{{\bar{\bar{s}}}}
\newcommand{\bbt}{{\bar{\bar{t}}}}
\newcommand{\bbu}{{\bar{\bar{u}}}}
\newcommand{\bbv}{{\bar{\bar{v}}}}
\newcommand{\bbw}{{\bar{\bar{w}}}}
\newcommand{\bbx}{{\bar{\bar{x}}}}
\newcommand{\bby}{{\bar{\bar{y}}}}
\newcommand{\bbz}{{\bar{\bar{z}}}}




\newcommand{\ta}{{\tilde{a}}}
\newcommand{\tb}{{\tilde{b}}}
\newcommand{\tc}{{\tilde{c}}}
\newcommand{\td}{{\tilde{d}}}
\newcommand{\te}{{\tilde{e}}}
\newcommand{\tf}{{\tilde{f}}}
\newcommand{\tg}{{\tilde{g}}}
\newcommand{\tildeh}{{\tilde{h}}}
\newcommand{\ti}{{\tilde{i}}}
\newcommand{\tj}{{\tilde{j}}}
\newcommand{\tk}{{\tilde{k}}}
\newcommand{\tl}{{\tilde{l}}}
\newcommand{\tm}{{\tilde{m}}}
\newcommand{\tn}{{\tilde{n}}}
\newcommand{\tildeo}{{\tilde{o}}}
\newcommand{\tp}{{\tilde{p}}}
\newcommand{\tq}{{\tilde{q}}}
\newcommand{\tr}{{\tilde{r}}}
\newcommand{\ts}{{\tilde{s}}}
\newcommand{\tildet}{{\tilde{t}}}
\newcommand{\tu}{{\tilde{u}}}
\newcommand{\tv}{{\tilde{v}}}
\newcommand{\tw}{{\tilde{w}}}
\newcommand{\tx}{{\tilde{x}}}
\newcommand{\ty}{{\tilde{y}}}
\newcommand{\tz}{{\tilde{z}}}





\newcommand{\tA}{{\tilde{A}}}
\newcommand{\tB}{{\tilde{B}}}
\newcommand{\tC}{{\tilde{C}}}
\newcommand{\tD}{{\tilde{D}}}
\newcommand{\tE}{{\tilde{E}}}
\newcommand{\tF}{{\tilde{F}}}
\newcommand{\tG}{{\tilde{G}}}
\newcommand{\tH}{{\tilde{H}}}
\newcommand{\tI}{{\tilde{I}}}
\newcommand{\tJ}{{\tilde{J}}}
\newcommand{\tK}{{\tilde{K}}}
\newcommand{\tL}{{\tilde{L}}}
\newcommand{\tM}{{\tilde{M}}}
\newcommand{\tN}{{\tilde{N}}}
\newcommand{\tO}{{\tilde{O}}}
\newcommand{\tP}{{\tilde{P}}}
\newcommand{\tQ}{{\tilde{Q}}}
\newcommand{\tR}{{\tilde{R}}}
\newcommand{\tS}{{\tilde{S}}}
\newcommand{\tT}{{\tilde{T}}}
\newcommand{\tU}{{\tilde{U}}}
\newcommand{\tV}{{\tilde{V}}}
\newcommand{\tW}{{\tilde{W}}}
\newcommand{\tX}{{\tilde{X}}}
\newcommand{\tY}{{\tilde{Y}}}
\newcommand{\tZ}{{\tilde{Z}}}





\newcommand{\AAA}{{\mathcal{A}}}
\newcommand{\BB}{{\mathcal{B}}}
\newcommand{\CC}{{\mathcal{C}}}
\newcommand{\DD}{{\mathcal{D}}}
\newcommand{\EE}{{\mathcal{E}}}
\newcommand{\FF}{{\mathcal{F}}}
\newcommand{\GG}{{\mathcal{G}}}
\newcommand{\HH}{{\mathcal{H}}}
\newcommand{\II}{{\mathcal{I}}}
\newcommand{\JJ}{{\mathcal{J}}}
\newcommand{\KK}{{\mathcal{K}}}
\newcommand{\LL}{{\mathcal{L}}}
\newcommand{\MM}{{\mathcal{M}}}
\newcommand{\NN}{{\mathcal{N}}}
\newcommand{\OO}{{\mathcal{O}}}
\newcommand{\PP}{{\mathcal{P}}}
\newcommand{\QQ}{{\mathcal{Q}}}
\newcommand{\RR}{{\mathcal{R}}}
\newcommand{\SSS}{{\mathcal{S}}}
\newcommand{\T}{{\mathcal{T}}}
\newcommand{\UU}{{\mathcal{U}}}
\newcommand{\VV}{{\mathcal{V}}}
\newcommand{\WW}{{\mathcal{W}}}
\newcommand{\XX}{{\mathcal{X}}}
\newcommand{\YY}{{\mathcal{Y}}}
\newcommand{\ZZ}{{\mathcal{Z}}}





\newcommand{\hAAA}{\hat{{\mathcal{A}}}}
\newcommand{\hBB}{\hat{{\mathcal{B}}}}
\newcommand{\hCC}{\hat{{\mathcal{C}}}}
\newcommand{\hDD}{\hat{{\mathcal{D}}}}
\newcommand{\hEE}{\hat{{\mathcal{E}}}}
\newcommand{\hFF}{\hat{{\mathcal{F}}}}
\newcommand{\hGG}{\hat{{\mathcal{G}}}}
\newcommand{\hHH}{\hat{{\mathcal{H}}}}
\newcommand{\hII}{\hat{{\mathcal{I}}}}
\newcommand{\hJJ}{\hat{{\mathcal{J}}}}
\newcommand{\hKK}{\hat{{\mathcal{K}}}}
\newcommand{\hLL}{\hat{{\mathcal{L}}}}
\newcommand{\hMM}{\hat{{\mathcal{M}}}}
\newcommand{\hNN}{\hat{{\mathcal{N}}}}
\newcommand{\hOO}{\hat{{\mathcal{O}}}}
\newcommand{\hPP}{\hat{{\mathcal{P}}}}
\newcommand{\hQQ}{\hat{{\mathcal{Q}}}}
\newcommand{\hRR}{\hat{{\mathcal{R}}}}
\newcommand{\hSSS}{\hat{{\mathcal{S}}}}
\newcommand{\hTT}{\hat{{\mathcal{T}}}}
\newcommand{\hUU}{\hat{{\mathcal{U}}}}
\newcommand{\hVV}{\hat{{\mathcal{V}}}}
\newcommand{\hWW}{\hat{{\mathcal{W}}}}
\newcommand{\hXX}{\hat{{\mathcal{X}}}}
\newcommand{\hYY}{\hat{{\mathcal{Y}}}}
\newcommand{\hZZ}{\hat{{\mathcal{Z}}}}




\newcommand{\eA}{{\emph{A}}}
\newcommand{\eB}{{\emph{B}}}
\newcommand{\eC}{{\emph{C}}}
\newcommand{\eD}{{\emph{D}}}
\newcommand{\eE}{{\emph{E}}}
\newcommand{\eF}{{\emph{F}}}
\newcommand{\eG}{{\emph{G}}}
\newcommand{\eH}{{\emph{H}}}
\newcommand{\eI}{{\emph{I}}}
\newcommand{\eJ}{{\emph{J}}}
\newcommand{\eK}{{\emph{K}}}
\newcommand{\eL}{{\emph{L}}}
\newcommand{\eM}{{\emph{M}}}
\newcommand{\eN}{{\emph{N}}}
\newcommand{\eO}{{\emph{O}}}
\newcommand{\eP}{{\emph{P}}}
\newcommand{\eQ}{{\emph{Q}}}
\newcommand{\eR}{{\emph{R}}}
\newcommand{\eS}{{\emph{S}}}
\newcommand{\eT}{{\emph{T}}}
\newcommand{\eU}{{\emph{U}}}
\newcommand{\eV}{{\emph{V}}}
\newcommand{\eW}{{\emph{W}}}
\newcommand{\eX}{{\emph{X}}}
\newcommand{\eY}{{\emph{Y}}}
\newcommand{\eZ}{{\emph{Z}}}




\newcommand{\bhx}{{\bar{\hat x}}}
\newcommand{\hdigamma}{{\hat\digamma}}




\newcommand{\diag}{{\mbox{diag}}}                  \newcommand{\dist}[2]{\mbox{dist}({#1},{#2})}      \newcommand{\abs}[1]{{|{#1}|}}                     \newcommand{\norme}[2]{||{#1}||_{#2}}            \newcommand{\ball}[1]{{B_{#1}}}                    \newcommand{\eye}[1]{\mathds{I}_{#1}}              \newcommand{\Metz}{\mathds{M}}                     \newcommand{\rank}{\mbox{rank}}                    \newcommand{\convh}{\mbox{convh}}                  




\newcommand{\imply}{\Rightarrow}                   \newcommand{\IFF}{\Leftrightarrow}                 



\newcommand{\mbf}[1]{\mathbf{#1}}                  \newcommand{\mbfgk}[1]{\boldsymbol{#1}}                  \newcommand{\One}{\textbf{1}}
\newcommand{\Zero}{\textbf{0}}




\newcommand{\subss}[2]{{#1}_{[#2]}}

\newcommand{\ep}{e^+}                              \newcommand{\xp}{x^+}                              \newcommand{\zp}{z^+}                              

\newcommand{\txp}{{\tilde{x}}^+}                   

\newcommand{\hxp}{{\hat{x}}^+}                     \newcommand{\hzp}{{\hat{z}}^+}                     

\newcommand{\hhxp}{{\hat{\hat{x}}}^+}              

\newcommand{\bkappa}{{\bar\kappa}}                 \newcommand{\dx}{{\dot x}}




\newcommand{\matr}[1]{
\begin{bmatrix}
    #1
\end{bmatrix}
}




\newcommand{\GFT}[1]{\textcolor{red}{#1}} \newcommand{\SR}[1]{\textcolor{blue}{#1}} \newcommand{\SF}[1]{\textcolor{green}{#1}} \newcommand{\MT}[1]{\textcolor{magenta}{#1}} 









 
\begin{document}
	\title{\LARGE \bf A consensus-based secondary control layer for stable current sharing and voltage balancing in DC microgrids}
\author[1]{Michele Tucci\thanks{Electronic address:
         \texttt{michele.tucci02@universitadipavia.it}}}
        \author[2]{Lexuan Meng\thanks{Electronic address: \texttt{menglexuan@gmail.com}; Corresponding author}} 
\author[2]{Josep M. Guerrero\thanks{Electronic address: \texttt{joz@et.aau.dk}} }
\author[3]{Giancarlo Ferrari-Trecate\thanks{Electronic address: \texttt{giancarlo.ferraritrecate@epfl.ch}} }
 \affil[1]{Dipartimento di Ingegneria Industriale e
       dell'Informazione\\Universit\`a degli Studi di Pavia, Italy}
     \affil[2]{Institute of Energy Technology, Aalborg University, Denmark}
	\affil[3]{Automatic Control Laboratory, \'Ecole Polytechnique F\'ed\'erale de Lausanne (EPFL), Switzerland}
     \date{\textbf{Technical Report}\\ March, 2016}

     \maketitle

  \begin{abstract}
  	In this paper, we propose a secondary consensus-based control
  	layer for current sharing and voltage balancing in DC microGrids
  	(mGs). To this purpose, we assume that Distributed Generation Units (DGUs) are equipped with decentralized primary controllers guaranteeing voltage stability. This goal can be achieved using, for instance, Plug-and-Play (PnP) regulators.
  	We analyze the behavior of the
  	closed-loop mG by approximating local primary control loops with
  	either unitary gains or first-order transfer functions. Besides
  	proving exponential stability, current sharing, and voltage balancing, we describe how to design secondary controllers in
  	a PnP fashion when DGUs are added or
  	removed. Theoretical results are complemented by simulations, using a 7-DGUs mG implemented in Simulink/PLECS, and experiments on a 3-DGUs mG.
  	
  \end{abstract}
  
\newpage


\section{Introduction}
\label{sec:intro}
Power generation and distribution are rapidly changing due to the
increasing diffusion of renewable energy sources, advances in energy
storage, and active participation of consumers to the energy market
\cite{ipakchi2009grid, hu2016greener,justo2013ac}. This shift of paradigm has motivated the
development of migroGrids (mGs), commonly recognized as small-scale
power systems integrating Distributed Generation Units (DGUs), storage
devices and loads. 
Since AC power generation is the standard for commercial, residential,
and industrial utilization, several studies focused on the control of AC mGs
\cite{guerrero2013advanced,riverso2014plug,bolognani2013distributed, 7097655, 7500071}. However,
nowadays, DC energy systems are gaining interest
\cite{dragicevic2015dc,elsayed2015dc} because of the
increasing number of DC loads, the availability of efficient
converters, and the need of interfacing DC energy sources and
batteries with minimal power losses \cite{justo2013ac,elsayed2015dc, fairley2012dc}. As reviewed in \cite{elsayed2015dc}, DC mGs are
becoming more and more popular in several application domains, such as
avionics, automotive, marine and residential systems \cite{elsayed2015dc}. 

The basic
problems in control of DC mGs are  voltage stabilization
\cite{dragicevic2015dc,tucci2015decentralized,zhao2015distributed,de2016power,cezar2015stability,hamzeh2016power, zonetti2014globally} and
current sharing (or, equivalently, load sharing), the latter meaning
that DGUs must compensate constant load currents proportionally to given parameters (for example, the converter ratings) and independently of the mG topology and line
impedances. Current sharing is crucial for preserving the safety
of the system, as unregulated currents may overload generators and eventually lead to failures or system
blackout \cite{han2016review}. An
additional desirable goal is voltage balancing, i.e. to keep the average output
voltage of DGUs close to a prescribed level. 
Indeed, load devices are designed to be supplied by a nominal
reference voltage: it is therefore
important to ensure that the voltages at the load buses are spread around this value.

These objectives can be realized using hierarchical control structures. 
In particular, current sharing is often realized by coupling secondary-layer consensus algorithms with primary voltage controllers. Secondary regulators, however, can have a detrimental effect and closed-loop stability of the mG must be carefully analyzed. In order to guarantee stability, several existing approaches focus on specific mG topologies or provide centralized control design algorithms, i.e. the synthesis of a local controller for a DGU requires knowledge about all other DGUs and lines. For instance,  in \cite{behjati2014modular,moayedi2015team} only mG with a bus topology are considered and local control design is performed in a centralized fashion. The synthesis procedures proposed in \cite{6816073,8026170} suffer from similar limitations. Indeed, in these works, the computation of local controllers guaranteeing collective stability relies on the knowledge of a global closed-loop transfer function matrix, and the largest eigenvalue of the Laplacian matrix associated with the communication network.
	Consensus-based secondary controllers for mG with general topologies have been presented in \cite{shafiee2014distributed_b}; also in this case, however, stability and the closed-loop mG equipped with primary and secondary control layers is studied through centralized analysis (i.e. the root locus), or via simulations \cite{dragicevic2015dc}. Similar drawbacks affect the approach in \cite{meng2015modeling}, whereas, in \cite{Setiawan2017}, current sharing is achieved by means of a centralized controller which receives informations from all the DGUs in the mG.
All the synthesis algorithms mentioned above become prohibitive for large mGs. Moreover, they are unsuitable for mGs with flexible structure because, to preserve voltage stability, the plugging-in
or -out of DGUs might require to update all local controllers in
the mG. This motivated the development of \emph{scalable} design procedures
for local controllers as in \cite{tucci2015decentralized, tucci2016improved,zhao2015distributed}.
In \cite{tucci2015decentralized} and \cite{tucci2016improved}, the aim is to stabilize the  voltage only via primary decentralized controllers. These regulators, termed Plug-and-Play (PnP) have the following features: (\textit{i}) the existence of a local controller for a DGU can be tested on local hardware, and control design is cast into an optimization problem, (\textit{ii}) each optimization problem exploits information about the DGU only \cite{tucci2016improved} or, at most, the power lines connected to it \cite{tucci2015decentralized}, and (\textit{iii}) when a DGU is plugged-in, no other DGUs \cite{tucci2016improved}, or at most neighboring DGUs \cite{tucci2015decentralized}, must update their local controllers.

\paragraph{Paper contributions.}
In this paper, we present a secondary regulation scheme for achieving stable current sharing and voltage
	balancing in DC mGs. We assume that the proposed higher-level scheme is build on top of a primary stabilizing voltage control layer; moreover, similarly to
	\cite{zhao2015distributed}, at the secondary level we exploit consensus filters requiring DGUs to communicate in real-time over a connected network. 
	There is, however, a key difference between our approach and the one presented in \cite{zhao2015distributed}. In the latter work, the authors assume DGUs to be controllable \textit{current} sources; on the contrary, we consider primary-controlled DGUs behaving as \textit{voltage} generators. In this setting, by properly choosing the reference values for the output voltages of each DGU, one can always regulate the currents that flow through the power lines, even when load conditions change. In this way, unwanted circulating currents (which may open the safety breakers in order to prevent damages on the devices) can be avoided. Instead, if all the DGUs in the mG are ideal current sources, the primary regulation scheme alone cannot guarantee such control on the flowing currents \cite{zhao2015distributed}. 
	
	At the modeling level, we propose two abstractions for the DGUs controlled with primary voltage regulators: unit gain and first-order transfer function approximation. The first one is used only for tutorial purposes and for developing basic mathematical tools that will allow us to extend the key results to the second (more realistic) approximation of the primary loops.
	
	Another contribution of this paper is the study of the eigenstructure of the product of three matrices (), where (\textit{i})  and  are the graph Laplacians associated with the electrical
	and the communication graphs, respectively, and (\textit{ii})  is a diagonal positive definite matrix defining the desired ratios between balanced currents. While several studies focused on the properties of the product of stochastic
	matrices (see e.g. \cite{jadbabaie2003coordination}), which are
	central in discrete-time consensus, to our knowledge weighted products of
	Laplacians received much less attention. In particular, we show that, under two different conditions,  preserves some key features of Laplacian matrices. In this case, the asymptotic achievement of current sharing and voltage balancing in a globally exponentially stable fashion is proved.
	
	Finally, we provide an experimental validation of our approach using a lab-size DC mG. The results show the robustness of the proposed controllers to non-idealities that are unavoidably present in a real mG.

\paragraph{Paper organization.}	
The paper is organized as
follows. Section \ref{sec:PnP_primary} summarizes the electrical model
of DGUs and PnP controllers. The secondary control layer is developed
and analyzed in Sections \ref{sec:consensus} and
\ref{sec:modeling_and_analysis}. In particular, Section \ref{sec:pnp_sec_ctrl} shows that, similarly to the regulators in \cite{tucci2015decentralized} and \cite{tucci2016improved}, secondary controllers can be designed in a PnP fashion. Section \ref{sec:simulations} demonstrates current
sharing and voltage balancing through simulations in Simulink/PLECS
\cite{allmeling2013plecs}, where non-idealities of real converters
and lines have been taken into account. Finally, in Section \ref{sec:experiments} we present experimental tests performed on a real DC mG.

A preliminary version of the paper will be presented at the 20th IFAC World Congress. Different from the conference version, the present paper includes (\textit{i}) the proofs of Propositions 2-5 and Theorem 1, (\textit{ii}) the more realistic case where primary control loops are approximated with first-order transfer functions, and (\textit{iii}) experimental results and more detailed simulations.

\paragraph{Notation and basic definitions.} 
The cardinality of the finite set  will be denoted with . A
weighted directed graph (\emph{digraph})  is
defined by the set of nodes , the set of edges
 and the diagonal
matrix  with , where  is the weight associated with the edge . The set of neighbors of node  is . A digraph  is \textit{weakly connected} if its undirected
version is connected \cite{lns-v.85}.  is the incidence matrix of 
\cite{grone1990laplacian}. The Laplacian matrix of  is , and it is independent of the orientation of edges. 

The average of a vector  is . We denote with  the subspace composed by all vectors with zero average \cite{bensoussan2005difference,1643380} i.e. . The space orthogonal to  is . It holds  and dim. Moreover, the decomposition  is direct, i.e. each vector  can always be written in a unique way as

Consider the matrix . With
 we indicate the linear map 
(i.e. the restriction of the map
 to the subspace ). For a
subspace , we denote with
 the projection of  on
. The subspace  is said to be
\textit{-invariant} if . Moreover, with , , we denote the eigenvalues of .

Let  be a matrix with real eigenvalues. The \textit{inertia} of  is the triple , where  is the number of positive eigenvalues of ,   is the number of negative eigenvalues of , and   is the number of zero eigenvalues of , all counted with their algebraic multiplicity \cite{hong1991jordan}. We use  for indicating that the real symmetric matrix  is positive-definite.

Laplacian matrices have the key properties summarized in the next
Proposition \cite{agaev2005spectra,godsil2001algebraic,bensoussan2005difference}.
\begin{prp}
	\label{pr:laplacian_prop}
	For a weakly connected graph  with weights ,  has the following properties:
	\begin{enumerate}[(i)]
		\item \label{lapl_1}it has non positive off-diagonal elements;
		\item \label{lapl_2} ;
		\item \label{lapl_3}  and ;
		\item \label{lapl_4}  is invertible.
	\end{enumerate}
\end{prp}
\begin{proof}
	Points (\ref{lapl_1})-(\ref{lapl_3}) are shown, e.g. in \cite{agaev2005spectra, godsil2001algebraic}. Point (\ref{lapl_4}) has been shown in \cite{bensoussan2005difference} with the framework of partial difference equations. Next, we provide a proof based on linear algebra only. We start noticing that the linear map  invertible if it is surjective and injective \cite{lang1987linear}. First, we show the surjectivity of  on . By construction, rank because  Moreover, since  is symmetric, each column of  has zero sum and hence is a vector in . Since  is the column span, then . Since dim, one obtains . This proves that the map  is surjective. \\
	Next, we prove that  is also injective. By definition, this holds if
	
	Now,  implies that . It means that , therefore  such that . However, since ,  is verified only for ; this leads to .  
\end{proof}

\section{Plug-and-play primary voltage control}
\label{sec:PnP_primary}

\subsection{DGU electrical model}
\label{sec:mG_model}
As in \cite{tucci2015decentralized}, we consider a DC mG composed of
 DGUs, whose electrical scheme is shown
in Figure \ref{fig:ctrl_part}. In each DGU, the generic renewable
resource is modeled as a battery and a Buck converter is
used to supply a local load connected to the Point of Common Coupling
(PCC) through an  filter. 
Furthermore, we assume
that loads  are unknown and treated as current disturbances
\cite{tucci2015decentralized,tucci2016improved}. The controlled variable is the voltage at
each PCC, whereas the control input is the command to the Buck (indicated with ). From Figure \ref{fig:ctrl_part}, by applying Kirchhoff's
voltage and current laws and exploiting Quasi Stationary Line (QSL)
approximation of power lines \cite{tucci2015decentralized,tucci2016improved}, we obtain
the following model of DGU \footnote{For the detailed model
	derivation, we defer the reader to \cite{tucci2015decentralized}.}


where  are the inputs,  the states (i.e. the measured voltage at the -th PCC and -th output current, respectively),  is the voltage at the PCC of each neighboring DGU , the constants  identify the electrical parameter of the -th Buck filter, and  is the conductance of the power line connecting DGUs  and  (see Figure \ref{fig:ctrl_part}).

\subsection{Plug-and-play regulators}
\label{sec:pnp_design}
In this Section, we briefly summarize the PnP scalable approach in
\cite{tucci2015decentralized,tucci2016improved} for designing primary decentralized controllers guaranteeing
voltage stability in DC mGs. This will allow us to justify the approximations of primary control loops used in Section \ref{sec:modeling_and_analysis}. Moreover, we will describe local updates that must be performed when DGUs are added or removed. These operations will be mirrored by those described in Section \ref{sec:pnp_sec_ctrl} for updating local secondary controllers, hence showing that both the primary and secondary control layer can be designed in a modular and scalable fashion. 

The local regulator of DGU 
exploits measurements of  and  to compute the command
 of the -th Buck converter and make  track a
reference signal  (see the scheme in Figure
\ref{fig:ctrl_part}). Each controller is composed of a vector
gain  and an integral action is present for offset-free voltage
tracking. The decentralized computation of these vector gains is the
core of PnP controller synthesis: (\textit{i}) the design of  requires
knowledge of the dynamics of DGU  only \cite{tucci2016improved} or, at most, the parameters of power lines connecting it to its neighbors \cite{tucci2015decentralized}, (\textit{ii})  is automatically
obtained by solving a Linear Matrix Inequality (LMI) problem.

For modeling the \textit{electrical} interactions between multiple DGUs, we represent the mG
with a digraph  (see the example in Figure \ref{fig:5areasplug}), where (\textit{i}) each node is a DGU with
local PnP controller and local current load, (\textit{ii}) edges  are
power lines whose orientation define a reference direction for
positive currents, (\textit{iii}) weights are line conductances\footnote{Line inductances  are neglected as we assume QSL approximations \cite{tucci2015decentralized, tucci2016improved}, which are reasonable in low-voltage mGs.} , and
(\textit{iv}) we set  and . 

Next, we describe how to handle plugging -in/-out of DGUs while preserving
the stability of the mG. Whenever a DGU (say DGU ) wants to join
the network (e.g. DGU 6 in Figure \ref{fig:5areasplug}), it sends a
plug-in request to its future neighbors, i.e. DGUs 
(e.g. DGUs 1 and 5 in Figure \ref{fig:5areasplug}). Then, DGU  \cite{tucci2016improved} or each DGU in
the set  \cite{tucci2015decentralized} solves an LMI problem ((24) in
\cite{tucci2016improved} and (25) in \cite{tucci2015decentralized}) that, if feasible, gives a vector gain
 guaranteeing voltage stability in the whole mG after the
addition of DGU . Otherwise, if one of the LMIs is infeasible, the
plug-in of DGU  is denied and no update of matrices ,
 is performed. 

The unplugging of a DGU (say DGU ) follows a similar procedure. It is always allowed without redesigning any local controller \cite{tucci2016improved} or it requires to successfully update, at most, controllers of DGUs ,  before allowing the disconnection of the DGU \cite{tucci2015decentralized}. 

\begin{figure}[!htb]
	\centering
	\ctikzset{bipoles/length=.55cm}
	\tikzstyle{every node}=[font=\sffamily]
	\begin{circuitikz}[scale=0.7]
		\draw (1,1)  to [battery, o-o](1,4)
		to [short](1.5,4)
		to [short](1.5,4.5)
		to [short](3.5,4.5)
		to [short](3.5,0.5)
		to [short](1.5,0.5)
		to [short](1.5,4)
		to [short](1.5,1)
		to [short](1,1);
		\node at (2.5,2.5){ \textbf{Buck }};
		\draw[-latex] (4,1.25) -- (4,3.75)node[midway,right]{};
		\draw (3.5,4) to [short](4,4)
		to [short](4.5,4)
		to [R=] (6,4)
		to [L=] (7.5,4)
		to [short, i=, -] (8.5,4)
		to [short](9,4) 
		to [C, l=, -] (9,1)
		to [short](4,1)
		to [short](3.5,1);
		\draw (12.3,4)  to [R=] (14.5,4)
		to [L=] (16,4)
		to [short, -o] (16.5,4) node[anchor=north,above]{};
		\draw (8.5,4) to (11,4) 
		to [ I ] (11 ,1)
		to [short] (9,1)
		to [short, -o] (16.5,1); 
		\draw (11,4) to [short](11.5,4);
		\draw (11,4) node[anchor=north, above]{}  to [short, i_=](11,2.9);
		\node at (11,4.6)[anchor=north, above]{} ;
		\draw (11,4) to [short,i<=] (13,4) -- (13,4); 
\draw[black, dashed] (.5,.25) -- (12.45,.25) -- (12.45,5.5) -- (.5,5.5)node[sloped, midway, above]{{ \textbf{DGU }}}  -- (.5,.25);
		\draw[black, dashed] (12.7,.25) -- (16,.25) -- (16,5.5) -- (12.7,5.5)node[sloped, midway, above]{{ \textbf{Power line }}}  -- (12.7,.25);
		\draw[red,o-] (10.9,4.15) -- (11.7,3) to (11.7,-1.5);
		\draw[red,latex-](8,-1.5)-- (9,-1.5) --  (10,-0.5)-- (11.7,-0.5);
\draw[blue,o-latex] (8.5,4.15) to (8.5,1.75) -- (8.5,-1) to (8,-1);
\draw (10,-2) node(a) [black, draw,fill=white!20] {};
\draw[-latex] (a.west) to (8,-2);
		\draw (11.7,-2) node(b)[ circle, draw=black, minimum size=12pt, fill=lightgray!20]{};
\draw[red, -latex] (11.7,1.75)  -- (b.north) node[pos=0.9, left]{\textcolor{black}{\normalsize{-}}};
\draw[latex-] (a.east) -- (b.west);
		\draw[-latex] (12.8,-2)  -- (b.east) node[pos=0.7,above]{{+}} node[pos=0.25,right]{};
\draw[fill=lightgray] (8,-2.25) -- (8,-0.75) -- (6.5,-1.5) -- (8,-2.25);
		\node at (7.5,-1.5) {};
\draw[-latex] (6.5,-1.5) -- (5.5,-1.5) -- (5.5,1.5) -- (5.5,2.5) -- (5,2.5);				   
	\end{circuitikz}
\caption{Electrical scheme of DGU  and local PnP voltage controller.}
	\label{fig:ctrl_part}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[scale=0.25]{5areas_new.pdf}
	\caption{Graph representation of an mG composed of 5 DGUs (in black)
		and plug-in of DGU 6 (in red). Blue nodes identify DGUs whose electrical scheme is shown in Figure \ref{fig:ctrl_part}, i.e. with local loads connected to the corresponding PCCs.}
	\label{fig:5areasplug}
\end{figure}

\begin{rmk}
	\label{rmk:integral}
	Local PnP controllers can be enhanced with pre-filters so as to shape
	in a desired way the transfer function  between voltages
	 and  represented in Figure
	\ref{fig:ctrl_part}. The closed-loop transfer function 
	has 3 poles and in the sequel it will be approximated by a unit gain
	or a first-order system. The first approximation will be used mainly
	for tutorial reasons. The second one is very mild at low and medium
	frequencies, as can be noticed from the Bode plots of
	 in
	\cite{tucci2015decentralized}. Moreover, the presence of an
	integrator in Figure \ref{fig:ctrl_part} allows the
	voltage  at the PCC to
	track constant references without offset when the
	disturbances (i.e. load currents ) are constant.
\end{rmk}

\section{Secondary control based on consensus algorithms}
\label{sec:consensus}
\subsection{Control objectives}
Primary stabilizing  controllers, such as the PnP regulators described in Section \ref{sec:pnp_design}, have the goal of turning DGUs into controlled voltage generators, i.e. to approximate, as well as possible, the identity . As such, they do not ensure current sharing and voltage balancing, defined in the sequel.
\begin{definition}
	\label{defn:cs}
	For constant load currents , \textit{current sharing} is achieved if, at steady state, the overall load current is
	proportionally shared among DGUs, i.e. if
	
	where  are constant scaling factors.
\end{definition}

We recall that current sharing is desirable in order to avoid
situations in which some DGUs are not able to supply local
loads, thus requiring power from other DGUs. A very common goal is to make DGUs share the total load
current proportionally to their generation capacity. This can be obtained by measuring the output currents
in per-unit (p.u.), i.e. setting each scaling factor  in \eqref{eq:cs_defn} equal to the corresponding DGU rated current (see Section \ref{sec:simulations} for an example).
On the other hand, if the scaling factors are all identical, the current sharing condition becomes

where  is the vector of the local load currents.

\begin{ass}
	\label{ass:vref}
	Voltage references are identical for all DGUs, i.e. , .
\end{ass}
\begin{definition}
	\label{defn:vb}
	Under Assumption \ref{ass:vref}, \textit{voltage balancing} is achieved if 
	
	where vector  collects the PCC voltages.
\end{definition}

In order to guarantee current sharing and voltage balancing, we use a consensus-based secondary
control layer, as described next. 
\subsection{Consensus dynamics}
Consensus filters are commonly employed for achieving
global information sharing or coordination through distributed
computations \cite{olfati2004consensus,lns-v.85}. In our case, as
shown in Figure \ref{fig:ctrl_complete}, we adopt the following
consensus scheme for adjusting the references of each primary voltage regulator

where  if DGUs  and  are connected by a communication
link (, otherwise), and the coefficient  is
common to all DGUs. The use of consensus protocols has been thoroughly
studied for networks of agents with simple dynamics, e.g. simple
integrators \cite{olfati2004consensus,lns-v.85}, with the goal of
proving convergence of individual states to a common value. In our
case, however, \eqref{eq:basic_consensus} is interfaced with the mG dynamics and convergence
of currents  to the same value does not trivially follow from
standard consensus theory. This property will be rigorously analyzed in Section
\ref{sec:modeling_and_analysis}. 

In the sequel, we assume bidirectional communication, i.e. . The corresponding \textit{communication} digraph is
 where
 and . 

Considerations on the topologies of  and  guaranteeing stable current sharing and voltage balancing are detailed in Section \ref{sec:properties_Q}. In all cases, however, the following standing assumption must hold.
\begin{ass}
	\label{ass:conneced}
The graph  is weakly
		connected. The graph  is undirected and connected.
\end{ass}
From a system point of view, the collective dynamics of the group of DGUs
following \eqref{eq:basic_consensus} can be expressed as

where , , ,  and . Note that  is the Laplacian matrix of  with  replaced by .

\section{Modeling and analysis of the complete system}
\label{sec:modeling_and_analysis}
The hierarchical control scheme of a DGU equipped with primary and
secondary regulators is shown in Figure \ref{fig:ctrl_complete}. For
studying the behavior of the closed-loop mG, we first approximate DGUs under the effect of primary controllers by unit
gains (Section \ref{sec:simpl_model}) and prove that current sharing is achieved in a stable way. We also provide conditions for voltage balancing. Results derived in this simple setting will be 
instrumental for studying the more complex scheme where primary
control loops are abstracted into first-order transfer functions
(Section \ref{sec:fo_approx}).  

\begin{figure}
	\centering
	\includegraphics[scale=0.4]{Complete_hierachical_automatica_rev2.pdf}
	\caption{Complete hierarchical control scheme of DGU . Subsystems  and  are the neighbors of DGU  according to the communication graph.}
	\label{fig:ctrl_complete}
\end{figure}
\subsection{Unit-gain approximation of primary control loops}
\label{sec:simpl_model}
By approximating primary
loops with ideal unit gains, we have the relations ,
. \\
Figures \ref{fig:hierarc}-\ref{fig:ith_ideal} show the resulting control scheme, used for deriving the dynamics of the overall mG as a function of the inputs  and
. Starting from
the left-hand side of Figure \ref{fig:hierarc}, we have, in order, \eqref{eq:ss_simpl_1} and 

Then, from basic circuit theory, we derive the relation between the vector of voltages  and the vector of line currents  as
  
where  and  are the weight and the incidence matrix of , respectively. Next, we get
 
and, merging equations \eqref{eq:ss_simpl_1}-\eqref{eq:ss_simpl_4}, we finally obtain
 
where  is the
Laplacian matrix of the electrical network and . 
\subsection{Properties of the matrix }
\label{sec:properties_Q}
The matrix  in \eqref{eq:ss_simpl_dyn} captures the interaction of electric couplings and communication. From \eqref{eq:ss_simpl_dyn}, it governs the voltage dynamics and hence the achievement of current sharing and voltage balancing.
Notice that  is obtained  pre- and post- multiplying a diagonal matrix by a Laplacian ( and , respectively). It follows that  is not a Laplacian matrix itself because it might fail to be symmetric and have
positive off-diagonal entries, even if weights of  and 
are positive. Nevertheless, in the sequel we provide two distinct conditions under which  preserves some key features of Laplacian matrices. Before proceeding, we introduce the following preliminary result.
\begin{figure}[!htb]
	\centering
	\begin{subfigure}[!htb]{0.8\textwidth}
		\centering
		\includegraphics[scale=0.7,width = \columnwidth]{consensus_inner_ideal_and_1st_order_loops_rev}
		\caption{Hierarchical control scheme.}
		\label{fig:hierarc}
	\end{subfigure}
	\begin{subfigure}[!htb]{0.35\columnwidth}
		\centering
		\includegraphics[scale=0.35, width = \columnwidth]{ideal_loops_automatica_cut}
		\caption{-th ideal primary loop.}
		\label{fig:ith_ideal}
	\end{subfigure}
	\begin{subfigure}[!htb]{0.45\columnwidth}
		\centering
		\includegraphics[scale=0.4, width = \columnwidth]{1st_order_loops_automatica_cut}
		\caption{First-order approximation of the -th primary loop.}
		\label{ith_first_order}
	\end{subfigure}
	\caption{Hierarchical control scheme and
		Primary Loop (PL) approximations.}
	\label{fig:hierarc_scheme}
\end{figure}
\begin{prp}
	\label{prp:projection}
	It holds .
\end{prp}
\begin{proof}
	From Proposition \ref{pr:laplacian_prop}-(\ref{lapl_4}), we know that  is invertible, hence surjective. Then,
	
	We now study the projection map . Since  is invertible, we have that . Therefore, one has
	
	The next step is to show that 
	
	so that, from \eqref{eq:rank_nullity_projection},  is surjective. Let  and set , where  and . Hence,  and, if , then . In other words,  verifies
	
	One has
	
	where the last identity follows from the fact that  has zero average. But, since  is a norm,  implies . This shows \eqref{eq:ker_projection}.
\end{proof}

	At this point, we can introduce two assumptions which allow us to characterize the eigenstructure of matrix ; then, we discuss their impact on the choice of the communication graph topology as well as on the value of coefficients  in \eqref{eq:basic_consensus}.
	\begin{ass}
		\label{ass:D_identity}
		The diagonal matrix containing the scaling factors for the output currents coincides with the identity, i.e. .  
	\end{ass}
	\begin{ass}
		\label{ass:same_topology}
It holds ,  and the product  commutes (i.e. ).
	\end{ass}
	\begin{rmk}
		Under Assumption \ref{ass:D_identity}, the desired goal is that all converters in the mG produce the same current (measured in Ampere and not in p.u.), i.e. that \eqref{eqn:equal_sharing} holds. This can be desirable, for instance, when all the converters in the network have the same generation capacity. We notice that Assumption \ref{ass:D_identity} does not enforce constraints on the graphs  and , which must fulfill Assumption \ref{ass:conneced} only. In particular, the topology of  can be chosen based on considerations on the network technology and for optimizing the performance of the secondary control layer, independently of the electrical interactions.
	\end{rmk}
	\begin{rmk}
		\label{rmk:same_topology}
		Assumption \ref{ass:same_topology} is suited to the case of converters with different ratings. However, it requires matrix  to be symmetric. An interesting case where this condition is verified is given by 
		
		where  is a global parameter, common to all the DGUs\footnote{From \eqref{eq:prop_laplacians}, , which commutes since  and  are symmetric and  is a scalar.}. Relation \eqref{eq:prop_laplacians} holds if the following conditions are simultaneously guaranteed:
		\begin{enumerate}[(a)]
			\item  and  have the same topology;
			\item \label{rmk:cond_b}coefficients in \eqref{eq:basic_consensus} are chosen as  if DGUs  and  are connected by a communication link.
		\end{enumerate} 
		Condition \eqref{rmk:cond_b} has an impact on the design of local Laplacian control laws \eqref{eq:basic_consensus}. Notably, each agent (say DGU ) needs to know the global parameter  and the value of the conductances  connecting it to its electrical neighbors  belonging to set  (which, in this particular case, coincides with ).
	\end{rmk}
	\begin{rmk}
		Assumptions \ref{ass:D_identity} or \ref{ass:same_topology} are instrumental in guaranteeing asymptotic stability of the hierarchical control architecture in Figure \ref{fig:ctrl_complete}. Indeed, as will be shown in the following Proposition, the above conditions imply that the eigenvalues of  are nonnegative.
		Note that, if neither Assumption \ref{ass:D_identity} nor \ref{ass:same_topology} are verified,  can have negative eigenvalues (see the example in Appendix \ref{app:eig_Q}).
	\end{rmk}

\begin{prp}
	\label{prop_2}
	The matrix  has the following properties:
	\begin{enumerate}[(i)]
		\item \label{prop:zero_row_sum} ;
		\item \label{prop:range} ;
		\item \label{prop:Q_invertible} the linear transformation  is invertible;
		\item \label{prop:diag_and_psd} under Assumption \ref{ass:D_identity} or \ref{ass:same_topology},  is diagonalizable and has real nonnegative eigenvalues.
		\item \label{prop:zero_eig} under Assumption \ref{ass:D_identity} or \ref{ass:same_topology}, the zero eigenvalue of  has algebraic multiplicity equal to one.
	\end{enumerate}
\end{prp}
\begin{proof}
	We start by proving point (\ref{prop:range}). Since, from Proposition \ref{pr:laplacian_prop}-(\ref{lapl_3}), , one has . Furthermore, from Proposition \ref{prp:projection}, . Proposition \ref{pr:laplacian_prop}-(\ref{lapl_4}) applied to the Laplacian  shows that , which is (\ref{prop:range}).
	
	For proving point (\ref{prop:zero_row_sum}), we recall that  and then . From (\ref{prop:range}) we have that . The equation  implies that . Since , we have .
	
	In order to prove point (\ref{prop:Q_invertible}), we  show that  is both surjective and injective \cite[p.~50]{lang1987linear}. The surjectivity of  on  has been shown above when proving point (\ref{prop:range}). For proving the injectivity, we need to check if it holds
	
	Now,  implies that . It means that , therefore  such that . However, since ,  is verified only for ; this leads to . 
	
	As regards statement (\ref{prop:diag_and_psd}), we first consider the case in which Assumption \ref{ass:D_identity} holds. Since , we have that . Hence,  is the product of two matrices, both positive semidefinite in the real sense. Moreover, since  and  are symmetric, they are positive semidefinite also in the complex sense
		\cite{pease1965methods}. The proof concludes by applying Corollary 2.3 in \cite{hong1991jordan}, which states that the product of two complex positive
		semidefinite matrices is diagonalizable and has nonnegative real
		eigenvalues. 
	
We now prove statement \eqref{prop:diag_and_psd} when Assumption \ref{ass:same_topology} holds. Since  is diagonal with positive elements, the matrix  verifying  exists and is invertible. Then,  can be written as follows
		
		Matrices  and  in \eqref{eq:rewrite_Q} are positive semidefinite in the real sense and symmetric; hence, they are positive semidefinite also in the complex sense. Therefore, also in this case, we can use Corollary 2.3 in \cite{hong1991jordan} to state that   is has nonnegative real eigenvalues. Now, since  in \eqref{eq:rewrite_Q} is symmetric, matrix  is congruent to . Thus, since under Assumption \ref{ass:same_topology}  is symmetric\footnote{Indeed, .}, by Sylvester's law of inertia \cite{horn2012matrix}, the inertia of  and  coincide, i.e.
		 
		This concludes the proof of statement \eqref{prop:diag_and_psd} under Assumption \ref{ass:same_topology}.
		
		Finally, point \eqref{prop:zero_eig} follows from points \eqref{prop:zero_row_sum} and \eqref{prop:diag_and_psd}. Indeed, since  is diagonalizable, the algebraic and geometric multiplicity of null eigenvalues coincide. From point (\ref{prop:zero_row_sum}), since , we conclude that the zero eigenvalue of  is unique.
\end{proof}

\subsubsection{Analysis of equilibria}
\label{sec:eq_an_1}
In order to evaluate the steady-state behavior of the electrical
signals appearing in Figure \ref{fig:hierarc}-\ref{fig:ith_ideal},
we study the equilibria of system \eqref{eq:ss_simpl_dyn}. Hence, for given constant inputs , we characterize the solutions  of equation

through the following Proposition.
\begin{prp}
	\label{prop:equilibrium}
	For equation \eqref{eq:eq_simpl},
	\begin{enumerate}[(i)]
		\item \label{st_2} there is only one solution ;
		\item \label{st_3} all solutions  can be written as
		
	\end{enumerate}
\end{prp}
\begin{proof}
	Proposition \ref{prop_2}-(\ref{prop:range}) shows that
	\eqref{eq:eq_simpl} has solutions only if . From
	Propositions \ref{pr:laplacian_prop}-(\ref{lapl_3}) and
	\ref{prop_2}-(\ref{prop:range}) this is always true. Statement (\ref{st_2}) directly follows from Proposition \ref{prop_2}-(\ref{prop:Q_invertible}).\\
	For the proof of statement (\ref{st_3}), we split  as in \eqref{eq:decomposition}, i.e. . From \eqref{eq:eq_simpl} and Proposition
	\ref{prop_2}-(\ref{prop:zero_row_sum}), one has that, irrespectively
	of , . Moreover, from the first part of the proof, it holds .
\end{proof}
Next, we relate properties of
the equilibria of \eqref{eq:ss_simpl_dyn} to current sharing and voltage balancing.
\begin{prp}
	\label{prop:volt_bal}
	Consider system \eqref{eq:ss_simpl_dyn} with constant inputs
	. Then, current sharing is achieved at steady state. Moreover, if  (i.e. if Assumption \ref{ass:vref} holds) and 
	in \eqref{eq:infinite_equilibria} is equal to zero, then the
	equilibrium  verifies the voltage balancing condition \eqref{eq:vb_defn}.
\end{prp}
\begin{proof}
	At the equilibrium, since  (see Proposition \ref{pr:laplacian_prop}-\eqref{lapl_3}), from \eqref{eq:ss_simpl_1} we have that 
	
	which is \eqref{eq:cs_defn}. 
	Let now  be an equilibrium for system \eqref{eq:ss_simpl_dyn}. Replacing \eqref{eq:infinite_equilibria} in \eqref{eq:ss_simpl_2} and averaging the resulting vector, we get
	 which is \eqref{eq:vb_defn}.
\end{proof}
\subsubsection{Stability analysis}
\label{sec:st_an_1}
The similarities established in Proposition \ref{prop_2} between the spectral properties of graph Laplacians and the matrix  will allow us to study the stability properties of \eqref{eq:ss_simpl_dyn} using methods similar to the ones adopted for analysis of classical consensus dynamics. Results in this section follow the approach in \cite{1643380}, where stability of consensus is analyzed through the use of invariant subspaces. An advantage of this rationale is that it carries over almost invariably to the case of more complex models of primary loops (Section \ref{sec:fo_approx}).

In the sequel, we prove exponentially stable convergence of
 in \eqref{eq:ss_simpl_dyn} to an equilibrium
ensuring both current sharing and voltage balancing for constant
 and . We first show that projections  and  have non-interacting dynamics (or, equivalently, that subspaces  and  are invariant for \eqref{eq:ss_simpl_dyn}).
\begin{prp}
	\label{pr:invariant}
	If  is given by system  in
	\eqref{eq:ss_simpl_dyn} for , then , where  and  fulfill
	 and
	
\end{prp}
\begin{proof}
	We write vectors ,  and
	 according to the decomposition
	\eqref{eq:decomposition}, i.e. using
	``\hspace{1mm}\hspace{1mm}" and
	``\hspace{1mm}\hspace{1mm}" for
	denoting their  and  components, respectively. As described in \cite{1643380}, we analyze the dynamics of
	 by averaging both sides of
	\eqref{eq:ss_simpl_dyn} and , respectively. From points (\ref{prop:zero_row_sum})-(\ref{prop:range}) of Proposition
	\ref{prop_2}, we have
	 and . Since  (see Proposition \ref{pr:laplacian_prop}-(\ref{lapl_3})), we also have , hence obtaining . Recalling that , we obtain \eqref{eq:subsysDGUi}.
	
	Next, we analyze . We have
	
	and . From Proposition \ref{prop_2}-(\ref{prop:zero_row_sum}),  and then we have \eqref{eq:simpl_initial_state_H1}.  
\end{proof}
\begin{rmk}
	\label{rmk:splitting}
	The splitting of  into systems  and
	 implies that, if  has zero
	average, then  has the same property,
	 and irrespectively of inputs
	. This behavior can be realized by
	suitable initialization of the integrators appearing in Figure \ref{fig:hierarc}.
\end{rmk}
According to system , the value of  remains constant over time and equal to . Hence, in order to characterize the stability of equilibria \eqref{eq:infinite_equilibria}, it is sufficient to study the dynamics \eqref{eq:simpl_initial_state_H1}. In an equivalent way, one can consider system \eqref{eq:ss_simpl_dyn} and the following definition of stability on a subspace.
\begin{definition}
	Let  be a subspace of . The origin of ,  is Globally Exponentially Stable (GES) on  if  : . The parameter  is termed \textit{rate of convergence}.
\end{definition}

Note that  is a linear system and, for stability analysis, we can neglect inputs, hence obtaining 

\begin{theorem}
	\label{thm:GES_H1}
	Under Assumption \ref{ass:D_identity} or \ref{ass:same_topology}, the origin of \eqref{eq:no_inputs} is GES on . Moreover, the rate of convergence is the smallest strictly positive eigenvalue of .
\end{theorem}
\begin{proof}
	The proof of Theorem \ref{thm:GES_H1} is presented in Appendix \ref{appendix_1}.
\end{proof}
The above results reveal that, given an initial
condition  for system \eqref{eq:ss_simpl_dyn}
and constant inputs  and
, the state 
converges to the equilibrium \eqref{eq:infinite_equilibria} with .\\
Summarizing the main results of this Section, we have that the consensus scheme described by \eqref{eq:basic_consensus}, Assumption \ref{ass:vref} and 

guarantee the asymptotic achievement of current sharing and voltage balancing in a GES fashion. 


\subsection{First-order approximation of primary control loops}
\label{sec:fo_approx}
Figure \ref{fig:hierarc} and Figure \ref{ith_first_order} show the overall
closed-loop scheme of an mG equipped with (\textit{i}) consensus current loops
and (\textit{ii}) primary control loops modeled as first-order transfer
functions. Different from the case analyzed in Section
\ref{sec:simpl_model}, each local dynamics is now described by means
of two states which are the state of the consensus current loop
() and the state of the controlled DGU ( in Figure
\ref{ith_first_order}). We highlight that relations
\eqref{eq:ss_simpl_1} and \eqref{eq:ss_simpl_2} still hold, while the additional state equation is

where vectors
 and  belong to , and the diagonal matrix , , collects on its diagonal the approximate bandwidth of each controlled DGU.
In view of Remark \ref{rmk:integral}, assuming equal approximate bandwidths for all the controlled DGUs is a mild constraint.\\
As in Section \ref{sec:simpl_model}, in order to find the dynamics of the closed-loop scheme, we write relations among mG variables. From Figure \ref{fig:hierarc}, we notice that \eqref{eq:ss_simpl_1} holds, and

Always from Figure \ref{fig:hierarc}, we have that, for line and output currents, equations \eqref{eq:ss_simpl_3} and \eqref{eq:ss_simpl_4} are still valid. By merging relations \eqref{eq:ss_simpl_1}, \eqref{eq:v_circ}, \eqref{eq:state2_1st_order}, \eqref{eq:ss_simpl_3} and \eqref{eq:ss_simpl_4}, we can write the dynamics of the overall mG as
[left = \empheqlbrace]{align}
	\label{eq:1st_order_dyn_A}\mathbf{\dot{\Delta V}}  &= -\mathbb{Q} \mathbf{V} - \mathbb{L} D\mathbf{I_{L}}\\
	\label{eq:1st_order_dyn_B}\mathbf{\dot V} &= \Omega\mathbf{\Delta V}-\Omega \mathbf{V} + \Omega \mathbf{V_{ref}},
	
or, equivalently, in compact form,

with  and .

\subsubsection{Analysis of equilibria}
The equilibria of
system \eqref{eq:1st_order_dyn} for constant
inputs , are obtained by
computing the solutions
 to the system 
[left =  \empheqlbrace]{align}
	\label{eq:1st_order_eq_A}
	\mathbb{Q} \mathbf{V}^* &= - \mathbb{L}D \mathbf{I_{L}^*}\\
	\label{eq:1st_order_eq_B}
	\mathbf{0}_N &= \Omega\mathbf{\Delta V^*}-\Omega \mathbf{V^*} + \Omega \mathbf{V_{ref}^*}.
	
Since matrix  is invertible, equation \eqref{eq:1st_order_eq_B} becomes

By substituting \eqref{eq:eq_1st_order_1} in \eqref{eq:1st_order_eq_A}, we get

that is exactly \eqref{eq:eq_simpl}. We can then exploit Proposition \ref{prop:equilibrium} for concluding that there are infinitely many solutions  in the form \eqref{eq:infinite_equilibria}.
Replacing \eqref{eq:infinite_equilibria} in \eqref{eq:eq_1st_order_1}, we can write equilibria of system \eqref{eq:1st_order_dyn} as

Relations between the equilibria and current sharing/voltage balancing are given in the next Proposition.
\begin{prp}
	\label{prop:volt_bal_2}
	Consider system \eqref{eq:1st_order_dyn} with constant inputs
	 and . At the equilibrium,
	current sharing is achieved. Moreover, if  (i.e. if Assumption \ref{ass:vref} holds) and
	 in \eqref{eq:equilibria_1st_order_1} is equal to zero, then
	the equilibrium  verifies the voltage balancing.
\end{prp}
\begin{proof}
	Since equation \eqref{eq:ss_simpl_1} holds, one has that, at the
	equilibrium, relation \eqref{eq:I_curr_sharing} is verified. Then, the
	proof is  identical to the one of Proposition \ref{prop:volt_bal}.
\end{proof}
Next, similarly to the simplified case described in Section \ref{sec:st_an_1}, we evaluate the stability properties of the closed-loop system \eqref{eq:1st_order_dyn} so as to show the convergence of state  to an equilibrium which guarantees current sharing and voltage balancing.
\subsubsection{Stability analysis}
\begin{prp}
	\label{prop:7}
	If  verifies \eqref{eq:1st_order_dyn}, then  where  and  fulfill
	[left =  {\widetilde\Sigma}_{\perp}^1:\empheqlbrace]{align}
		\label{eq:sysdist_perp_A}\mathbf{\dot{\overline{\Delta V}}} &= \mathbf{0}_N\\
		\label{eq:sysdist_perp_B} \mathbf{\dot{\overline{V}}} &= \Omega\mathbf{\overline {\Delta V}}-\Omega \mathbf{\overline{V}} + \Omega\mathbf{\overline{V_{ref}}}                          
		
	and
	[left = {\widetilde\Sigma}^1:\empheqlbrace]{align}
		\label{eq:subsys_H1_A}\mathbf{\dot{\widehat{\Delta V}}} &= -\mathbb{Q}\mathbf{\widehat V} -\mathbb{L}D\mathbf{{I_L}}\\
		\label{eq:subsys_H1_B}\mathbf{\dot {\widehat V}} &= \Omega\mathbf{\widehat {\Delta V}}-\Omega \mathbf{\widehat V} + \Omega \mathbf{\widehat{V_{ref}}},
		
	respectively.
\end{prp}
\begin{proof}
	The dynamics of  and  can be derived proceeding as in the proof of Proposition \ref{pr:invariant}. 
	In a similar way, by averaging both sides of
	\eqref{eq:1st_order_dyn_B}, one derives the (independent) dynamics of  and . 
\end{proof}
The above decomposition allows us to evaluate the evolution of state  on  by separately analyzing dynamics \eqref{eq:subsys_perp} and \eqref{eq:subsys_H1}, i.e. studying the behavior of projections  and , with  and . \\
First we focus on . Without loss of
generality, for stability analysis we can neglect the input vector  in \eqref{eq:sysdist_perp_B}, thus having:
[left =  \empheqlbrace]{align}
	\label{eq:sysdist_perp_A_free}\mathbf{\dot{\overline{\Delta V}}} &= \mathbf{0}_{N}\\
	\label{eq:sysdist_perp_B_free} \mathbf{\dot{\overline{V}}} &= \Omega\mathbf{\overline {\Delta V}}-\Omega \mathbf{\overline{V}}     .                    
	
By construction, \eqref{eq:sysdist_perp_B_free} collects the decoupled equations

where, according to \eqref{eq:sysdist_perp_A}, each term  in can be treated as an exogenous input (thus not affecting stability properties). It follows that dynamics \eqref{eq:single_Vtilde} is asymptotically stable, since . In summary, system \eqref{eq:subsys_perp} tells us that the average  will remain constant in time (and equal to ), while  will converge to the origin. For studying stability properties of system , we consider \eqref{eq:1st_order_dyn} without inputs, i.e. 

and analyze stability on . We have the following result.
\begin{theorem}
	\label{thm:stability_1st_order}
	Under Assumption \ref{ass:D_identity} or \ref{ass:same_topology}, the origin of \eqref{eq:subsys_H1_free} is GES on . Furthermore, matrix  has a simple zero eigenvalue and the rate of convergence is the maximum among real parts of all other eigenvalues.
\end{theorem}
\begin{proof}
	The proof is given in Appendix \ref{appendix_2}.
\end{proof}
By means of Theorem \ref{thm:stability_1st_order}, we have that, given
an initial condition  for system
\eqref{eq:1st_order_dyn}, the state 
will converge to the equilibrium in \eqref{eq:equilibria_1st_order_1},
with .

The results above show that, for system \eqref{eq:1st_order_dyn}, current sharing is achieved in a GES fashion. In a similar way,  asymptotic voltage
balancing is ensured if Assumption
\ref{ass:vref} and \eqref{eq:cs_vb} are fulfilled.

\subsection{PnP design of secondary control}
\label{sec:pnp_sec_ctrl}
We now describe the procedure for designing secondary controllers in a PnP fashion. We will show that, as for the PnP design of primary regulators, when a DGU is added or removed, the secondary control layer can be updated only locally for preserving current sharing and voltage balancing.

\paragraph{Plug-in operation.} Under Assumption \ref{ass:D_identity}, when a DGU (say DGU ) sends a plug-in request at a time , it choses a
set  of communication neighbors (which must not necessarily coincide with ) and fixes parameters , , in order to design the local consensus filter
\eqref{eq:basic_consensus}. At the same time, each DGU , , updates its consensus filter by setting  in \eqref{eq:basic_consensus}. If, instead, , one can fulfill Assumption \ref{ass:same_topology} by allowing the entering DGU to receive the value of conductances  from neighboring DGUs  and by setting   (see Remark \ref{rmk:same_topology}). By doing so, DGU  can choose parameters , and each DGU  sets , thus updating its consensus filter \eqref{eq:basic_consensus}.

Overall, Theorems \ref{thm:GES_H1} and
\ref{thm:stability_1st_order} ensure that the disagreement dynamics of
the mG states is GES.
Let Assumption \ref{ass:vref}
hold for all the interconnected DGUs in the mG before  and let
us denote the common reference voltage by . If DGU  sets
 and if we choose  (thus having , where  is the
vector  prior the plugging-in of DGU ), both current sharing and
voltage balancing are preserved in the asymptotic r\'{e}gime (see Propositions
\ref{prop:volt_bal} and \ref{prop:volt_bal_2}). 

\paragraph{Unplugging operation.} Under Assumption \ref{ass:D_identity} or \ref{ass:same_topology}, when a DGU (say DGU ) is
unplugged at time , provided that the new graphs  and  fulfill Assumption \ref{ass:conneced}, the key condition that must
be guaranteed is that the vector 
(i.e.  without element ) verifies
. If , this can be achieved by re-setting  for all , and keeping  for all . Indeed, this yields




\section{Validation of secondary controllers}
\subsection{Simulation results}
\label{sec:simulations}
In this Section, we demonstrate the capability of the proposed control
scheme to guarantee current sharing and voltage balancing when DGUs are plugged in/out and load changes occur. Simulations have been performed in Simulink/PLECS \cite{allmeling2013plecs}.
We consider an mG composed of 7 DGUs, interconnected as in Figure
	\ref{fig:sim_stages}, with non-identical electrical parameters and power lines. Notice the presence of loops in the electrical network, that complicates voltage regulation. Primary PnP voltage regulators are designed according to the method in \cite{tucci2015decentralized}, whereas, for the secondary control layer, we choose  in \eqref{eq:ss_simpl_1} equal to 1. DGUs have rated currents  A, ,  A and  A. Since, in this scenario, we aim to achieve the current sharing condition \eqref{eq:cs_defn}, we set , , thus having, in \eqref{eq:ss_simpl_1}, . Then, in order to guarantee the asymptotic stability of the hierarchical control scheme, we fulfill Assumption \ref{ass:same_topology} by (\textit{i}) letting  have the same topology of , and (\textit{ii}) picking , if DGUs  and  are connected by a communication link (see Remark \ref{rmk:same_topology}). Furthermore, the voltage reference in Assumption \ref{ass:vref} is  V, and the electrical parameters are given in Appendix \ref{sec:AppElectrPar}.
 
In the following, we describe Figure
\ref{fig:sim_complete_1}, which illustrates the evolution of the main
electrical quantities (i.e. measured DGU output currents in Amperes, DGU output currents in p.u., PCC voltages and
average PCCs voltage) during the consecutive simulation
stages shown in Figure~\ref{fig:sim_stages}.

\paragraph{Stage 1:}
At time , all the DGUs are isolated and only
the primary PnP voltage regulators, designed as in \cite{tucci2015decentralized}, are active. Therefore, as shown in
Figure \ref{fig:sim_complete_1}, (\textit{i}) each DGU supplies its local load while keeping the
corresponding PCC voltage at 48 V, and (\textit{ii}) the DGU output currents in p.u.
are different. We further highlight that primary controllers have been designed assuming that all the switches in Figure \ref{fig:sim_stages} connecting DGUs 1-6 are closed. From \cite{tucci2015decentralized}, however, they also stabilize the mG when all switches are open.

\paragraph{Stage 2:}
Subsystems 1-6 are
	connected together at time  s and, as described before, no update of primary controllers is needed. As shown in the plot of  in Figure \ref{fig:sim_complete_1}, voltage stability and fast transients after the plug-in operations are ensured by PnP primary regulators. The secondary control layer is still disabled at this stage.

\paragraph{Stage 3:}
At time  s, we activate the secondary control layer for DGUs 1-6, thus
ensuring asymptotic current sharing among them (see the plot of the currents in p.u.). This is achieved by automatically
adjusting the voltages at PCC (as shown in the plot of ).Moreover, the top plot of Figure \ref{fig:sim_complete_1} reveals that, as expected, DGUs 4 and 5 share half of the current of DGUs 1-3, while the output current of DGUs 6 is one third of the currents of DGUs 1-3. We further highlight that, by setting , , as described in Section \ref{sec:pnp_sec_ctrl}, condition
	\eqref{eq:cs_vb} is fulfilled and asymptotic voltage balancing is guaranteed (see the plot of the average PCCs voltage, indicated with ).
	
\paragraph{Stage 4:} For evaluating the PnP capabilities of our control scheme, at  s, DGU 7 sends a plug-in request to DGUs
4 and 5. Previous primary controllers of DGUs 4 and 5
still fulfill the plug-in conditions in \cite{tucci2015decentralized}: they are therefore maintained and the plug-in of DGU 7 is performed. In the light of Assumption \ref{rmk:same_topology}, at  also the secondary controller of DGU 7 is activated, thus enabling the DGU to 
	contribute to current sharing. This can be noticed in Figure
\ref{fig:sim_complete_1}, as all PCC voltages change in order
to let all the output currents in p.u. converge to a common
value. We also notice that the measured output currents (top plot of Figure \ref{fig:sim_complete_1}) are still shared accordingly (i.e. ). Furthermore, choosing  (as described in
Section \ref{sec:pnp_sec_ctrl}), we maintain the average PCCs voltage at 48 V (see , stage 4). 

\paragraph{Stage 5:} At  s, we halve the load of DGU 1,
thus increasing the corresponding load current  and causing a
peak in the corresponding output current. However, after few seconds,
all the DGUs share again the total load current, while the averaged PCC voltage converges to the reference value. 

\paragraph{Stage 6:}  Finally, we assess the performance of the proposed hierarchical scheme when the sudden disconnection of a DGU occurs. To this aim, at time  s, we disconnect DGU 3. Figure \ref{fig:sim_complete_1} (stage 6) shows that voltage stability, current sharing and voltage balancing are preserved in the mG composed of DGU 1-2 and 4-7.


\begin{figure}
	\centering
	\includegraphics[scale=.3]{simulation_stages.pdf}
	\caption{Simulation stages: numbered nodes represent DGUs, while black lines denote power lines. The secondary control layer is activated for the DGUs contained in the red area. Open switches in stages 1, 2, 3 and 6 denote disconnected DGUs. The arrow in stage 5 represents a step up in the load current of DGU 1.}
	\label{fig:sim_stages}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[scale=0.4]{sim_signals_k}
	\caption{Simulation results: evolution of measured output currents, output currents in p.u., 
		voltages at PCCs and average PCCs voltage. Lines in the
		plots are associated with different DGUs and they are color-coded as in Figure \ref{fig:sim_stages}. Simulation stages are those shown in Figure \ref{fig:sim_stages}.}
	\label{fig:sim_complete_1}
\end{figure}
\subsection{Experimental results}
\label{sec:experiments}
Performance brought about by the presented hierarchical scheme been also validated via experimental tests based on the mG platform in the top panel of Figure \ref{fig:experimental_setup}, which consists of three \textit{Danfoss} inverters, a dSPACE1103 control board and LEM sensors. In order to properly emulate DC/DC converters (i.e. Buck converters), only the first phase of each inverter has been used. Buck converters operate in parallel to emulate DGUs while different local load conditions have been obtained by connecting each PCC to a resistive load. All the converters are supplied by DC source generators.

For this scenario, primary PnP voltage controllers are designed using the approach in \cite{tucci2016improved}, and Assumption \ref{ass:D_identity} holds. Hence, since , , i.e. we aim to achieve the asymptotic current sharing condition \eqref{eqn:equal_sharing}. Moreover, we set  in \eqref{eq:ss_simpl_1} equal to 0.5, while coefficients  in \eqref{eq:basic_consensus} are equal to 1 if DGUs  and  are connected by a communication link, 0 otherwise. We also recall that, under Assumption \ref{ass:D_identity}, the stability of the mG equipped with our hierarchical scheme is preserved even if the topologies of  and  differ. Notably, we consider the mG in Figure \ref{fig:experimental_setup}, where  and  are highlighted in blue and red, respectively, and the edges of  are  lines.
	
The controllers have been implemented in Simulink and compiled to the dSPACE system in order to command the Buck switches at a frequency of 10 kHz.

The evolution of the main electrical quantities is shown in Figure \ref{fig:experiments}. At time  s, all the DGUs are isolated and do not communicate. At times  s,  s and  s, we connect DGU 1 to 2, 2 to 3 and 1 to 3, respectively, thus obtaining a loop in the electrical topology. As described in \cite{tucci2016improved}, no update of primary PnP controllers is required when units are connected. As shown in the plot of the PCC voltages in Figure \ref{fig:experiments}, PnP primary voltage regulators ensure smooth transitions and stability. Since for  the secondary layer is not active, the output currents are not equally shared and the PCC voltages coincide with the reference (notably, Assumption \ref{ass:vref} holds, with  V). Next, at time  s, we set ,  and enable the secondary control layer. As expected, the three output currents converge to the same value (see  in Figure \ref{fig:experiments}). Furthermore, the fulfillment of condition \eqref{eq:cs_vb} guarantees asymptotic voltage balancing (see  in Figure \ref{fig:experiments}). Finally, at time  s we decrease the load of DGU 3, causing an increment in the corresponding load current. As a consequence, the value of  increases as well. Also in this case, the total load current is equally shared among DGUs while  does not deviate from 48 V.

As for the voltage discrepancies induced by secondary controllers, they are within 5 of the nominal voltage  V. This fulfills, for instance, the standards for DC mGs used as uninterruptible power supply systems for telecommunication applications \cite{schulz2007etsi}.

\begin{figure}
	\centering
	\includegraphics[scale=0.65]{Exp_Setup_Lucas_new}
	\caption{Experimental validation: mG setup (top) and topologies of the electrical and communication graphs (bottom).}
	\label{fig:experimental_setup}
\end{figure}
\begin{figure}
	\centering
	\hspace{-4mm}
	\includegraphics[scale=0.4]{experiments_stages_automatica_cut}
	\caption{Experimental results for the mG in Figure \ref{fig:experimental_setup}. In the time interval from  s to  s, DGUs are connected together and primary PnP voltage regulators are enabled. From time  s onwards, also the secondary control layer is active. At time  s, the local load of DGU 3 is halved.}
	\label{fig:experiments}
\end{figure}

\section{Conclusions}
In this paper, a secondary consensus-based control layer for
current sharing and voltage balancing in DC mGs has been
presented. Under the assumption that DGUs are equipped with decentralized primary controllers that guarantee voltage stability, we proved stability of the hierarchical control scheme. Moreover, we presented a method for designing secondary
controllers in a PnP fashion for handling plugging -in/-out of DGUs. 

Future developments will study the impact of non-idealities (such as transmission delays, data quantization and packet drops) on the performance of closed-loop mGs. The analysis of networked control systems has received considerable attention in the recent past \cite{Hespanha2007} and our goal will be to reappraise methods and tools developed within this area in the context of microgrids. Another fundamental challenge that must be addressed when higher-level networked schemes are included in the mG control architecture is security against cyberattacks \cite{Pasqualetti2013}.




     \clearpage

     \appendix
    \section{Proof of Theorem \ref{thm:GES_H1}}
\label{appendix_1}
We introduce a preliminary Lemma, partly taken from Theorem 19 in \cite{callier2012linear}.
\begin{lem}
	\label{lem:stability}
	For , let  and  be -invariant subspaces of  such that dim, dim and . Then:
	\begin{enumerate}[I)]
		\item \label{thm:stability_1} there is a matrix  such that  has the block-diagonal structure 
		
		with  and .
		In particular, if  and  are basis for  and , respectively, the transformation matrix  has the block structure
		
		Therefore, if , then , with . Similarly, if , then , with .
		\item\label{thm:stability_2} The origin of  is GES on  if and only if the origin of   is GES. Moreover, parameters  verifying , also guarantee .
	\end{enumerate}
\end{lem}
\begin{proof}
	For the proof of point \ref{thm:stability_1}, we defer the reader to the proof of Theorem 19 in \cite{callier2012linear}.
	
	The proof of point \ref{thm:stability_2} directly follows from the block-diagonal structure of matrix  in \eqref{eq:repres_matrix}. Indeed,
	
	i.e.  is the matrix representation of the map . In other words, studying the stability of  on  is equivalent to study the stability of . 
	Moreover, by construction, . Then,
	
	Since , inequality \eqref{eq:theroem_part2_1} becomes
	
\end{proof}
\paragraph{Proof of Theorem \ref{thm:GES_H1}.}
\label{app:GES_H1}
Points (\ref{prop:zero_row_sum}) and (\ref{prop:range}) of Proposition \ref{prop_2} show that subspaces  and  are -invariant. Moreover, . It follows that Lemma \ref{lem:stability} can be applied with  and . In particular, by means of point \ref{thm:stability_1}, we know that there exists a transformation matrix  such that the linear map  can be represented as in \eqref{eq:repres_matrix}. Denoting with  and  the basis for  and , respectively, from \eqref{eq:matrix_T}, we have

Matrix  is given by 

where . Moreover, scalar  since, by construction, it represents the map  (see Proposition \ref{prop_2}-(\ref{prop:zero_row_sum})). We notice that the representations of  and  with respect to the basis  are   and , respectively.
Now we prove that the origin of

is GES. Since  and  are similar matrices, they have the same
eigenvalues. Therefore, by exploiting points (\ref{prop:diag_and_psd}) and (\ref{prop:zero_eig}) of Proposition
\ref{prop_2}, one has that all the eigenvalues of 
are strictly positive. This proves that \eqref{eq:origin_ideal} is GES
and, as shown in \cite{callier2012linear}, the convergence rate is , where  is the minimal eigenvalue of .
The remainder of the proof follows directly from point \ref{thm:stability_2} of Lemma \ref{lem:stability}. \qed     \newpage
    \section{Proof of Theorem \ref{thm:stability_1st_order}}
\label{appendix_2}
We first present two Propositions which provide preliminary results that will be used to prove Theorem \ref{thm:stability_1st_order}.
\begin{prp}
	\label{prop:h1_h1}
	Subspaces  and  are -invariant.
\end{prp}
\begin{proof}
	We first show that, for any vector , it holds . Indeed,
	
	and, from Proposition \ref{prop_2}-(\ref{prop:Q_invertible}), the rightmost vector belongs to .\\
	Similarly, for any vector , we have that
	
	and then .
\end{proof}
\begin{prp}
	\label{prop:eig_Qcall}
	Matrix  has two eigenvalues equal to zero and , respectively. All other eigenvalues have strictly negative real part.
\end{prp}
\begin{proof}
	By definition, vector  is an eigenvector of , if there exists  such that 
	
	From \eqref{eq:def_eig}, one gets:
	
		\label{eq:def_eig_1A}
		-\mathbb{Q}\mathbf{{V}}&= \lambda_i\mathbf{{\Delta V}}\\
		\label{eq:def_eig_1B}
		\omega_c (\mathbf{{\Delta V}}-\mathbf{{V}}) &= \lambda_i {\mathbf{V}}.
	By isolating  in \eqref{eq:def_eig_1B} and substituting it in \eqref{eq:def_eig_1A}, we obtain
	
	where  are, by construction, eigenvalues of . From points (\ref{prop:diag_and_psd}) and (\ref{prop:zero_eig}) of Proposition \ref{prop_2}, we have 
	
		\label{eq:def_eig_hat_lambda_1}
		\hat\lambda_N &= 0\\
		\label{eq:def_eig_hat_lambda_2}
		\hat\lambda_i &=-\gamma_i,\hspace{2mm}\gamma_i>0\hspace{7mm}i = 1,\dots,N-1.
	From \eqref{eq:def_eig_hat_lambda_1} and \eqref{eq:lambda_hat}, one has
	
	and hence  has a single eigenvalue equal to zero and an eigenvalue equal to .
	By substituting in \eqref{eq:def_eig_hat_lambda_2} the expression of  in \eqref{eq:lambda_hat}, one gets:
	
	Since all the coefficients of the polynomial in \eqref{eq:eig_hur} are strictly positive, we can conclude that matrix  has  eigenvalues with Re.
\end{proof}
\paragraph{Proof of Theorem \ref{thm:stability_1st_order}.}
Similarly to the proof of Theorem \ref{thm:GES_H1}, we can exploit Lemma \ref{lem:stability} with  and . In fact, we know that (\textit{i}) subspaces  and  are -invariant (see Proposition \ref{prop:h1_h1}) and (\textit{ii}) . Hence, there exists a transformation matrix  such that the linear map  has an equivalent block-diagonal representation of the form \eqref{eq:repres_matrix}, i.e. \vspace{3mm}

with  and .
By construction, matrices  and  in \eqref{eq:ex_B}
represent the maps  and , respectively. In particular, in the light on the consideration made for system
\eqref{eq:subsys_perp}, we have that the eigenvalues of  are
zero and . Moreover, by construction, the eigenvalues of
 are the  eigenvalues of  with strictly negative
real part (see Proposition \ref{prop:eig_Qcall}). \qed     \newpage
    \section{On the eigenvalues of }
\label{app:eig_Q}
In this appendix, we provide an example which shows that, by pre- and  post- multiplying a generic positive definite diagonal matrix by two positive semidefinite Laplacians (associated with graphs having different topologies), one can obtain a matrix with some negative eigenvalues. 

Let us consider the graphs depicted in Figures \ref{fig:G_1} and \ref{fig:G_2}. 
\begin{figure}[H]
	\centering
	\ctikzset{bipoles/length=1.2cm}
	\tikzstyle{every node}=[font=\normalsize]
	\begin{circuitikz}[american currents, scale=0.8]
\draw (0,0) node(a) [circle, draw=blue, fill=blue!20] {};
		\draw (-2,-2) node(b)  [circle, draw=blue, fill=blue!20] {};
		\draw (-2,-4) node(c)  [circle, draw=blue, fill=blue!20] {};
		\draw (4,-2) node(d)  [circle, draw=blue, fill=blue!20] {};
		\draw (2,-4) node(e)  [circle, draw=blue, fill=blue!20] {};
		\draw (2,-6) node(f)  [circle, draw=blue, fill=blue!20] {};
		\draw (4,-6) node(g)  [circle, draw=blue, fill=blue!20] {};
		\draw (4,-9) node(h)  [circle, draw=blue, fill=blue!20] {};
		\draw (6,-9) node(i)  [circle, draw=blue, fill=blue!20] {};
\draw[red] (a.south east) to [short, i>=, color=red] (e.north);
		\draw[red] (b.east) to [short, i>=, color=red] (e.west);
		\draw[red] (c.south east) to [short, i>=, color=red] (f.west);
		\draw[red] (d.south east) to [short, i>=, color=red] (i.north);
		\draw[red] (f.east) to [short, i>=, color=red] (g.west);
		\draw[red] (f.south east) to [short, i>=, color=red] (h.north west);
		\draw[red] (f.north) to [short, i<=, color=red] (e.south);
		\draw[red] (g.south) to [short, i<=, color=red] (h.north);
		\draw[red] (g.south east) to [short, i>=, color=red] (i.north west);
\end{circuitikz}
	\caption{Topology of .}
	\label{fig:G_1}
\end{figure}
\begin{figure}[H]
	\centering
	\ctikzset{bipoles/length=1.2cm}
	\tikzstyle{every node}=[font=\normalsize]
	
	\begin{circuitikz}[american currents, scale=0.8]
\draw (0,0) node(a) [circle, draw=blue, fill=blue!20] {};
		\draw (-2,-2) node(b)  [circle, draw=blue, fill=blue!20] {};
		\draw (-2,-4) node(c)  [circle, draw=blue, fill=blue!20] {};
		\draw (4,-2) node(d)  [circle, draw=blue, fill=blue!20] {};
		\draw (2,-4) node(e)  [circle, draw=blue, fill=blue!20] {};
		\draw (2,-6) node(f)  [circle, draw=blue, fill=blue!20] {};
		\draw (4,-6) node(g)  [circle, draw=blue, fill=blue!20] {};
		\draw (4,-9) node(h)  [circle, draw=blue, fill=blue!20] {};
		\draw (6,-9) node(i)  [circle, draw=blue, fill=blue!20] {};
		
\draw[black] (a.south west) to [short, i>=, color=black] (b.north east);
		\draw[black] (b.south) to [short, i>=, color=black] (c.north);
		\draw[black] (c.east) to [short, i>=, color=black] (d.west);
		\draw[black] (c.south east) to [short, i>=, color=black] (h.west);
		\draw[black] (d.south west) to [short, i_<=, color=black] (e.north east);
		\draw[black] (d.south) to [short, i>=, color=black] (f.north east);
		\draw[black] (f.east) to [short, i>=, color=black] (g.west);
		\draw[black] (f.north) to [short, i>=, color=black] (e.south);
		\draw[black] (g.south) to [short, i>=, color=black] (h.north);
		\draw[black] (h.east) to [short, i<=, color=black] (i.west);
\end{circuitikz}
	\caption{Topology of .}
	\label{fig:G_2}
\end{figure}
According to the assigned edge directions, the incidence matrices associated with  and  have the form

and

respectively. As regards the (positive) weights of the edges of  and , they are collected in the following diagonal matrices

and
\small

\normalsize
At this point, we have all the ingredients for computing the Laplacians of  and  (called  and , respectively) as

and

Next, we pick the positive definite diagonal matrix 

and pre- and post- multiply it by  and , respectively, thus obtaining

Now, if we compute the eigenvalues of , we get 

that proves the desired result. This example led us to introduce Assumptions \ref{ass:D_identity} and \ref{ass:same_topology}, which define conditions under which the eigenvalues of  are always real and nonnegative. 	\newpage
     \section{Electrical parameters }
 \label{sec:AppElectrPar}
 In this appendix, we provide the electrical parameters of the simulation scenario described in Section \ref{sec:simulations}.
 


 \begin{table}[h]
 	\centering
 	\begin{tabular}{*{4}{c}}
 		\toprule
 		\multicolumn{4}{c}{\textbf{Converter parameters}} \\
 		\midrule
 		DGU &   &  (mH) &  (mF)\\
 		\midrule
 		 & 0.2  & 1.8 & 2.2 \\
 		& 0.3 & 2 & 1.9 \\
 		& 0.1 & 2.2 & 1.7 \\
 		& 0.5 & 3 & 2.5 \\
 		& 0.4 & 1.2 & 2 \\
 		& 0.6 & 2.5 & 3 \\
 		& 0.3 & 2 & 2.1 \\
 		\midrule
 		\multicolumn{4}{c}{\textbf{Power line parameters}}\\
 		\toprule
 		\multicolumn{2}{c}{Connected DGUs } & Resistance   & Inductance
 		H \\
 		\midrule
 		\multicolumn{2}{c}{} & 0.05 & 2.1 \\
 		\multicolumn{2}{c}{} & 0.07 & 1.8 \\
 		\multicolumn{2}{c}{} & 0.06 & 1 \\
 		\multicolumn{2}{c}{} & 0.04 & 2.3 \\
 		\multicolumn{2}{c}{} & 0.08 & 1.8 \\
 		\multicolumn{2}{c}{} & 0.1 & 2.5 \\
 		\multicolumn{2}{c}{} & 0.08 & 3 \\
 		\multicolumn{2}{c}{} & 0.09 & 2.3 \\
 		\multicolumn{2}{c}{} & 0.05 & 2.4 \\
 		\bottomrule
 	\end{tabular}
 	\caption{Electrical parameters.}	
 	\label{tbl:Ch5_el_parameters}
 \end{table}
 


 
 
    
     \clearpage


   \bibliographystyle{IEEEtran}
     \bibliography{PnP_consensus}

\end{document}