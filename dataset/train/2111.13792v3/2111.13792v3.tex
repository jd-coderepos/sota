

\documentclass[10pt,twocolumn,letterpaper]{article}

\usepackage{cvpr}              

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{booktabs}
\usepackage{adjustbox}
\usepackage[accsupp]{axessibility}  

\usepackage[outercaption]{sidecap}

\usepackage[pagebackref,breaklinks,colorlinks]{hyperref}


\usepackage[capitalize]{cleveref}
\crefname{section}{Sec.}{Secs.}
\Crefname{section}{Section}{Sections}
\Crefname{table}{Table}{Tables}
\crefname{table}{Tab.}{Tabs.}

\usepackage{floatrow}

\def\cvprPaperID{9380} \def\confName{CVPR}
\def\confYear{2022}


\newcommand{\shortname}{\textsc{Lafite}}
\newcommand{\shortnamen}{}
\newcommand{\shortnameg}{}
\newcommand{\longname}{\textbf{LA}nguage-\textbf{F}ree~tra\textbf{I}ning~for~\textbf{T}ext-to-image~g\textbf{E}neration}


\newcommand{\lafetilogo}{\includegraphics[width=10px]{figures/Lafite.png}}



\usepackage{amsmath,amsfonts,bm}

\newcommand{\figleft}{{\em (Left)}}
\newcommand{\figcenter}{{\em (Center)}}
\newcommand{\figright}{{\em (Right)}}
\newcommand{\figtop}{{\em (Top)}}
\newcommand{\figbottom}{{\em (Bottom)}}
\newcommand{\captiona}{{\em (a)}}
\newcommand{\captionb}{{\em (b)}}
\newcommand{\captionc}{{\em (c)}}
\newcommand{\captiond}{{\em (d)}}

\newcommand{\newterm}[1]{{\bf #1}}


\def\figref#1{figure~\ref{#1}}
\def\Figref#1{Figure~\ref{#1}}
\def\twofigref#1#2{figures \ref{#1} and \ref{#2}}
\def\quadfigref#1#2#3#4{figures \ref{#1}, \ref{#2}, \ref{#3} and \ref{#4}}
\def\secref#1{section~\ref{#1}}
\def\Secref#1{Section~\ref{#1}}
\def\twosecrefs#1#2{sections \ref{#1} and \ref{#2}}
\def\secrefs#1#2#3{sections \ref{#1}, \ref{#2} and \ref{#3}}
\def\eqref#1{equation~\ref{#1}}
\def\Eqref#1{Equation~\ref{#1}}
\def\plaineqref#1{\ref{#1}}
\def\chapref#1{chapter~\ref{#1}}
\def\Chapref#1{Chapter~\ref{#1}}
\def\rangechapref#1#2{chapters\ref{#1}--\ref{#2}}
\def\algref#1{algorithm~\ref{#1}}
\def\Algref#1{Algorithm~\ref{#1}}
\def\twoalgref#1#2{algorithms \ref{#1} and \ref{#2}}
\def\Twoalgref#1#2{Algorithms \ref{#1} and \ref{#2}}
\def\partref#1{part~\ref{#1}}
\def\Partref#1{Part~\ref{#1}}
\def\twopartref#1#2{parts \ref{#1} and \ref{#2}}

\def\ceil#1{\lceil #1 \rceil}
\def\floor#1{\lfloor #1 \rfloor}
\def\1{\bm{1}}
\newcommand{\train}{\mathcal{D}}
\newcommand{\valid}{\mathcal{D_{\mathrm{valid}}}}
\newcommand{\test}{\mathcal{D_{\mathrm{test}}}}

\def\eps{{\epsilon}}


\def\reta{{\textnormal{}}}
\def\ra{{\textnormal{a}}}
\def\rb{{\textnormal{b}}}
\def\rc{{\textnormal{c}}}
\def\rd{{\textnormal{d}}}
\def\re{{\textnormal{e}}}
\def\rf{{\textnormal{f}}}
\def\rg{{\textnormal{g}}}
\def\rh{{\textnormal{h}}}
\def\ri{{\textnormal{i}}}
\def\rj{{\textnormal{j}}}
\def\rk{{\textnormal{k}}}
\def\rl{{\textnormal{l}}}
\def\rn{{\textnormal{n}}}
\def\ro{{\textnormal{o}}}
\def\rp{{\textnormal{p}}}
\def\rq{{\textnormal{q}}}
\def\rr{{\textnormal{r}}}
\def\rs{{\textnormal{s}}}
\def\rt{{\textnormal{t}}}
\def\ru{{\textnormal{u}}}
\def\rv{{\textnormal{v}}}
\def\rw{{\textnormal{w}}}
\def\rx{{\textnormal{x}}}
\def\ry{{\textnormal{y}}}
\def\rz{{\textnormal{z}}}

\def\rvepsilon{{\mathbf{\epsilon}}}
\def\rvtheta{{\mathbf{\theta}}}
\def\rva{{\mathbf{a}}}
\def\rvb{{\mathbf{b}}}
\def\rvc{{\mathbf{c}}}
\def\rvd{{\mathbf{d}}}
\def\rve{{\mathbf{e}}}
\def\rvf{{\mathbf{f}}}
\def\rvg{{\mathbf{g}}}
\def\rvh{{\mathbf{h}}}
\def\rvu{{\mathbf{i}}}
\def\rvj{{\mathbf{j}}}
\def\rvk{{\mathbf{k}}}
\def\rvl{{\mathbf{l}}}
\def\rvm{{\mathbf{m}}}
\def\rvn{{\mathbf{n}}}
\def\rvo{{\mathbf{o}}}
\def\rvp{{\mathbf{p}}}
\def\rvq{{\mathbf{q}}}
\def\rvr{{\mathbf{r}}}
\def\rvs{{\mathbf{s}}}
\def\rvt{{\mathbf{t}}}
\def\rvu{{\mathbf{u}}}
\def\rvv{{\mathbf{v}}}
\def\rvw{{\mathbf{w}}}
\def\rvx{{\mathbf{x}}}
\def\rvy{{\mathbf{y}}}
\def\rvz{{\mathbf{z}}}

\def\erva{{\textnormal{a}}}
\def\ervb{{\textnormal{b}}}
\def\ervc{{\textnormal{c}}}
\def\ervd{{\textnormal{d}}}
\def\erve{{\textnormal{e}}}
\def\ervf{{\textnormal{f}}}
\def\ervg{{\textnormal{g}}}
\def\ervh{{\textnormal{h}}}
\def\ervi{{\textnormal{i}}}
\def\ervj{{\textnormal{j}}}
\def\ervk{{\textnormal{k}}}
\def\ervl{{\textnormal{l}}}
\def\ervm{{\textnormal{m}}}
\def\ervn{{\textnormal{n}}}
\def\ervo{{\textnormal{o}}}
\def\ervp{{\textnormal{p}}}
\def\ervq{{\textnormal{q}}}
\def\ervr{{\textnormal{r}}}
\def\ervs{{\textnormal{s}}}
\def\ervt{{\textnormal{t}}}
\def\ervu{{\textnormal{u}}}
\def\ervv{{\textnormal{v}}}
\def\ervw{{\textnormal{w}}}
\def\ervx{{\textnormal{x}}}
\def\ervy{{\textnormal{y}}}
\def\ervz{{\textnormal{z}}}

\def\rmA{{\mathbf{A}}}
\def\rmB{{\mathbf{B}}}
\def\rmC{{\mathbf{C}}}
\def\rmD{{\mathbf{D}}}
\def\rmE{{\mathbf{E}}}
\def\rmF{{\mathbf{F}}}
\def\rmG{{\mathbf{G}}}
\def\rmH{{\mathbf{H}}}
\def\rmI{{\mathbf{I}}}
\def\rmJ{{\mathbf{J}}}
\def\rmK{{\mathbf{K}}}
\def\rmL{{\mathbf{L}}}
\def\rmM{{\mathbf{M}}}
\def\rmN{{\mathbf{N}}}
\def\rmO{{\mathbf{O}}}
\def\rmP{{\mathbf{P}}}
\def\rmQ{{\mathbf{Q}}}
\def\rmR{{\mathbf{R}}}
\def\rmS{{\mathbf{S}}}
\def\rmT{{\mathbf{T}}}
\def\rmU{{\mathbf{U}}}
\def\rmV{{\mathbf{V}}}
\def\rmW{{\mathbf{W}}}
\def\rmX{{\mathbf{X}}}
\def\rmY{{\mathbf{Y}}}
\def\rmZ{{\mathbf{Z}}}

\def\ermA{{\textnormal{A}}}
\def\ermB{{\textnormal{B}}}
\def\ermC{{\textnormal{C}}}
\def\ermD{{\textnormal{D}}}
\def\ermE{{\textnormal{E}}}
\def\ermF{{\textnormal{F}}}
\def\ermG{{\textnormal{G}}}
\def\ermH{{\textnormal{H}}}
\def\ermI{{\textnormal{I}}}
\def\ermJ{{\textnormal{J}}}
\def\ermK{{\textnormal{K}}}
\def\ermL{{\textnormal{L}}}
\def\ermM{{\textnormal{M}}}
\def\ermN{{\textnormal{N}}}
\def\ermO{{\textnormal{O}}}
\def\ermP{{\textnormal{P}}}
\def\ermQ{{\textnormal{Q}}}
\def\ermR{{\textnormal{R}}}
\def\ermS{{\textnormal{S}}}
\def\ermT{{\textnormal{T}}}
\def\ermU{{\textnormal{U}}}
\def\ermV{{\textnormal{V}}}
\def\ermW{{\textnormal{W}}}
\def\ermX{{\textnormal{X}}}
\def\ermY{{\textnormal{Y}}}
\def\ermZ{{\textnormal{Z}}}

\def\vzero{{\bm{0}}}
\def\vone{{\bm{1}}}
\def\vmu{{\bm{\mu}}}
\def\vtheta{{\bm{\theta}}}
\def\va{{\bm{a}}}
\def\vb{{\bm{b}}}
\def\vc{{\bm{c}}}
\def\vd{{\bm{d}}}
\def\ve{{\bm{e}}}
\def\vf{{\bm{f}}}
\def\vg{{\bm{g}}}
\def\vh{{\bm{h}}}
\def\vi{{\bm{i}}}
\def\vj{{\bm{j}}}
\def\vk{{\bm{k}}}
\def\vl{{\bm{l}}}
\def\vm{{\bm{m}}}
\def\vn{{\bm{n}}}
\def\vo{{\bm{o}}}
\def\vp{{\bm{p}}}
\def\vq{{\bm{q}}}
\def\vr{{\bm{r}}}
\def\vs{{\bm{s}}}
\def\vt{{\bm{t}}}
\def\vu{{\bm{u}}}
\def\vv{{\bm{v}}}
\def\vw{{\bm{w}}}
\def\vx{{\bm{x}}}
\def\vy{{\bm{y}}}
\def\vz{{\bm{z}}}

\def\evalpha{{\alpha}}
\def\evbeta{{\beta}}
\def\evepsilon{{\epsilon}}
\def\evlambda{{\lambda}}
\def\evomega{{\omega}}
\def\evmu{{\mu}}
\def\evpsi{{\psi}}
\def\evsigma{{\sigma}}
\def\evtheta{{\theta}}
\def\eva{{a}}
\def\evb{{b}}
\def\evc{{c}}
\def\evd{{d}}
\def\eve{{e}}
\def\evf{{f}}
\def\evg{{g}}
\def\evh{{h}}
\def\evi{{i}}
\def\evj{{j}}
\def\evk{{k}}
\def\evl{{l}}
\def\evm{{m}}
\def\evn{{n}}
\def\evo{{o}}
\def\evp{{p}}
\def\evq{{q}}
\def\evr{{r}}
\def\evs{{s}}
\def\evt{{t}}
\def\evu{{u}}
\def\evv{{v}}
\def\evw{{w}}
\def\evx{{x}}
\def\evy{{y}}
\def\evz{{z}}

\def\mA{{\bm{A}}}
\def\mB{{\bm{B}}}
\def\mC{{\bm{C}}}
\def\mD{{\bm{D}}}
\def\mE{{\bm{E}}}
\def\mF{{\bm{F}}}
\def\mG{{\bm{G}}}
\def\mH{{\bm{H}}}
\def\mI{{\bm{I}}}
\def\mJ{{\bm{J}}}
\def\mK{{\bm{K}}}
\def\mL{{\bm{L}}}
\def\mM{{\bm{M}}}
\def\mN{{\bm{N}}}
\def\mO{{\bm{O}}}
\def\mP{{\bm{P}}}
\def\mQ{{\bm{Q}}}
\def\mR{{\bm{R}}}
\def\mS{{\bm{S}}}
\def\mT{{\bm{T}}}
\def\mU{{\bm{U}}}
\def\mV{{\bm{V}}}
\def\mW{{\bm{W}}}
\def\mX{{\bm{X}}}
\def\mY{{\bm{Y}}}
\def\mZ{{\bm{Z}}}
\def\mBeta{{\bm{\beta}}}
\def\mPhi{{\bm{\Phi}}}
\def\mLambda{{\bm{\Lambda}}}
\def\mSigma{{\bm{\Sigma}}}

\DeclareMathAlphabet{\mathsfit}{\encodingdefault}{\sfdefault}{m}{sl}
\SetMathAlphabet{\mathsfit}{bold}{\encodingdefault}{\sfdefault}{bx}{n}
\newcommand{\tens}[1]{\bm{\mathsfit{#1}}}
\def\tA{{\tens{A}}}
\def\tB{{\tens{B}}}
\def\tC{{\tens{C}}}
\def\tD{{\tens{D}}}
\def\tE{{\tens{E}}}
\def\tF{{\tens{F}}}
\def\tG{{\tens{G}}}
\def\tH{{\tens{H}}}
\def\tI{{\tens{I}}}
\def\tJ{{\tens{J}}}
\def\tK{{\tens{K}}}
\def\tL{{\tens{L}}}
\def\tM{{\tens{M}}}
\def\tN{{\tens{N}}}
\def\tO{{\tens{O}}}
\def\tP{{\tens{P}}}
\def\tQ{{\tens{Q}}}
\def\tR{{\tens{R}}}
\def\tS{{\tens{S}}}
\def\tT{{\tens{T}}}
\def\tU{{\tens{U}}}
\def\tV{{\tens{V}}}
\def\tW{{\tens{W}}}
\def\tX{{\tens{X}}}
\def\tY{{\tens{Y}}}
\def\tZ{{\tens{Z}}}


\def\gA{{\mathcal{A}}}
\def\gB{{\mathcal{B}}}
\def\gC{{\mathcal{C}}}
\def\gD{{\mathcal{D}}}
\def\gE{{\mathcal{E}}}
\def\gF{{\mathcal{F}}}
\def\gG{{\mathcal{G}}}
\def\gH{{\mathcal{H}}}
\def\gI{{\mathcal{I}}}
\def\gJ{{\mathcal{J}}}
\def\gK{{\mathcal{K}}}
\def\gL{{\mathcal{L}}}
\def\gM{{\mathcal{M}}}
\def\gN{{\mathcal{N}}}
\def\gO{{\mathcal{O}}}
\def\gP{{\mathcal{P}}}
\def\gQ{{\mathcal{Q}}}
\def\gR{{\mathcal{R}}}
\def\gS{{\mathcal{S}}}
\def\gT{{\mathcal{T}}}
\def\gU{{\mathcal{U}}}
\def\gV{{\mathcal{V}}}
\def\gW{{\mathcal{W}}}
\def\gX{{\mathcal{X}}}
\def\gY{{\mathcal{Y}}}
\def\gZ{{\mathcal{Z}}}

\def\sA{{\mathbb{A}}}
\def\sB{{\mathbb{B}}}
\def\sC{{\mathbb{C}}}
\def\sD{{\mathbb{D}}}
\def\sF{{\mathbb{F}}}
\def\sG{{\mathbb{G}}}
\def\sH{{\mathbb{H}}}
\def\sI{{\mathbb{I}}}
\def\sJ{{\mathbb{J}}}
\def\sK{{\mathbb{K}}}
\def\sL{{\mathbb{L}}}
\def\sM{{\mathbb{M}}}
\def\sN{{\mathbb{N}}}
\def\sO{{\mathbb{O}}}
\def\sP{{\mathbb{P}}}
\def\sQ{{\mathbb{Q}}}
\def\sR{{\mathbb{R}}}
\def\sS{{\mathbb{S}}}
\def\sT{{\mathbb{T}}}
\def\sU{{\mathbb{U}}}
\def\sV{{\mathbb{V}}}
\def\sW{{\mathbb{W}}}
\def\sX{{\mathbb{X}}}
\def\sY{{\mathbb{Y}}}
\def\sZ{{\mathbb{Z}}}

\def\emLambda{{\Lambda}}
\def\emA{{A}}
\def\emB{{B}}
\def\emC{{C}}
\def\emD{{D}}
\def\emE{{E}}
\def\emF{{F}}
\def\emG{{G}}
\def\emH{{H}}
\def\emI{{I}}
\def\emJ{{J}}
\def\emK{{K}}
\def\emL{{L}}
\def\emM{{M}}
\def\emN{{N}}
\def\emO{{O}}
\def\emP{{P}}
\def\emQ{{Q}}
\def\emR{{R}}
\def\emS{{S}}
\def\emT{{T}}
\def\emU{{U}}
\def\emV{{V}}
\def\emW{{W}}
\def\emX{{X}}
\def\emY{{Y}}
\def\emZ{{Z}}
\def\emSigma{{\Sigma}}

\newcommand{\etens}[1]{\mathsfit{#1}}
\def\etLambda{{\etens{\Lambda}}}
\def\etA{{\etens{A}}}
\def\etB{{\etens{B}}}
\def\etC{{\etens{C}}}
\def\etD{{\etens{D}}}
\def\etE{{\etens{E}}}
\def\etF{{\etens{F}}}
\def\etG{{\etens{G}}}
\def\etH{{\etens{H}}}
\def\etI{{\etens{I}}}
\def\etJ{{\etens{J}}}
\def\etK{{\etens{K}}}
\def\etL{{\etens{L}}}
\def\etM{{\etens{M}}}
\def\etN{{\etens{N}}}
\def\etO{{\etens{O}}}
\def\etP{{\etens{P}}}
\def\etQ{{\etens{Q}}}
\def\etR{{\etens{R}}}
\def\etS{{\etens{S}}}
\def\etT{{\etens{T}}}
\def\etU{{\etens{U}}}
\def\etV{{\etens{V}}}
\def\etW{{\etens{W}}}
\def\etX{{\etens{X}}}
\def\etY{{\etens{Y}}}
\def\etZ{{\etens{Z}}}


\newcommand{\ea}[0]{\emph{et al. }}


\newcommand{\pdata}{p_{\rm{data}}}
\newcommand{\ptrain}{\hat{p}_{\rm{data}}}
\newcommand{\Ptrain}{\hat{P}_{\rm{data}}}
\newcommand{\pmodel}{p_{\rm{model}}}
\newcommand{\Pmodel}{P_{\rm{model}}}
\newcommand{\ptildemodel}{\tilde{p}_{\rm{model}}}
\newcommand{\pencode}{p_{\rm{encoder}}}
\newcommand{\pdecode}{p_{\rm{decoder}}}
\newcommand{\precons}{p_{\rm{reconstruct}}}

\newcommand{\laplace}{\mathrm{Laplace}} 

\newcommand{\E}{\mathbb{E}}
\newcommand{\Ls}{\mathcal{L}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\emp}{\tilde{p}}
\newcommand{\lr}{\alpha}
\newcommand{\reg}{\lambda}
\newcommand{\rect}{\mathrm{rectifier}}
\newcommand{\softmax}{\mathrm{softmax}}
\newcommand{\sigmoid}{\sigma}
\newcommand{\softplus}{\zeta}
\newcommand{\KL}{D_{\mathrm{KL}}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\standarderror}{\mathrm{SE}}
\newcommand{\Cov}{\mathrm{Cov}}
\newcommand{\normlzero}{L^0}
\newcommand{\normlone}{L^1}
\newcommand{\normltwo}{L^2}
\newcommand{\normlp}{L^p}
\newcommand{\normmax}{L^\infty}

\newcommand{\parents}{Pa} 

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\DeclareMathOperator{\sign}{sign}
\DeclareMathOperator{\Tr}{Tr}
\let\ab\allowbreak

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=0.6pt] (char) {#1};}}
             \newcommand{\chunyl}[1]{{\color{magenta}{(Chunyl: #1)}}}
\newcommand{\yf}[1]{{\color{red}{(Yufan: #1)}}}
\newcommand{\cy}[1]{{\color{red}{(CY: #1)}}}
\newcommand{\roy}[1]{{\color{blue}{(Roy: #1)}}}
\newcommand{\chris}[1]{{\color{green}{(Chris: #1)}}}
\usepackage{adjustbox}
\usepackage{booktabs}
\usepackage{hyperref}
\usepackage{url}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{wrapfig}
\usepackage{multirow}
\usepackage{xcolor}
\usepackage{amsthm}
\ifx\proof\undefined
\newenvironment{proof}{\par\noindent{\bf Proof\ }}{\hfill\BlackBox\\label{eq:adaptive_gaussian}
    \rvh^\prime = \tilde{\rvh} / \Vert \tilde{\rvh} \Vert_2, ~~~ \tilde{\rvh} = f_{\text{img}}(\rvx) + \xi \mathbf{\epsilon} \Vert  f_{\text{img}}(\rvx) \Vert _2  /\Vert \mathbf{\epsilon}\Vert_2,
\label{eq:txt_fts_nn}
    \rvh^\prime & = \tilde{\rvh} / \Vert \tilde{\rvh} \Vert_2, \text{where}  \\ \tilde{\rvh} & = f_{\text{img}}(\rvx) + r_{1}(f_{\text{img}}(\rvx)) + \mathbf{\epsilon} \odot \exp(r_2(f_{\text{img}}(\rvx))),~ \nonumber
\label{eq:generator}
    \rvx^\prime = G( \rvh^\prime, \rvz) 
\label{eq:logit}
    D(\rvx, \rvh^\prime) = 
     \underbrace{f_{\text{d}}(\rvx)}_{\text{real or fake}} + 
    \underbrace{\langle \rvh^\prime, f_{\text{s}}(\rvx) \rangle}_{\text{semantic alignment}}~,
\label{eq:base_loss}
    \mathcal{L}_{\text{G}} &= - \sum_{i=1}^n \log \sigma(D(\rvx^\prime_i, \rvh_i^\prime)) ,  \\ 
    \mathcal{L}_{\text{D}} &= - \sum_{i=1}^n  \log \sigma(D(\rvx_i, \rvh_i^\prime)) - \sum_{i=1}^n  \log(1- \sigma(D(\rvx^\prime_i, \rvh_i^\prime))) \nonumber
\label{eq:d_contrastive_loss}
\mathcal{L}_{\text{ConD}} = - \tau \sum_{i=1}^n \log \dfrac{\exp( \mathrm{Sim}(f_{\text{s}}(\rvx _i), \rvh_i^\prime)/\tau)}{\sum_{j=1}^n \exp( \mathrm{Sim}(f_{\text{s}}(\rvx _j), \rvh_i^\prime)/\tau)}, 
\label{eq:clip_contrastive_loss}
\hspace{-0.3cm}\mathcal{L}_{\text{ConG}} = - \tau \sum_{i=1}^n \log \dfrac{\exp(\mathrm{Sim}(f_{\text{img}}(\rvx^\prime _i), \rvh_i^\prime)/\tau)}{\sum_{j=1}^n \exp(\mathrm{Sim}(f_{\text{img}}(\rvx^\prime _j), \rvh_i^\prime)/\tau)}.

\mathcal{L}_{\text{D}}^\prime & = \mathcal{L}_{\text{D}}  + \gamma \mathcal{L}_{\text{ConD}} \label{eq:final_loss_d} \\
\mathcal{L}_{\text{G}}^\prime &  = \mathcal{L}_{\text{G}} +  \gamma \mathcal{L}_{\text{ConD}} + \lambda \mathcal{L}_{\text{ConG}}   \label{eq:final_loss_g}

   &\text{Prob}(\text{Sim}(f_{\text{img}}(\rvx_i), \rvh^\prime_i) \geq c) \\= & 1 - \int_{-1}^{(c-1)/\xi+c} \dfrac{\Gamma(d/2+1/2)}{\sqrt{\pi} \Gamma(d/2)} (1-x^2)^{d/2-1} \text{d}x 

    & \text{Sim}(f_{\text{img}}(\rvx), \rvh^\prime) \\
    = & \dfrac{\langle f_{\text{img}}(\rvx), \rvh^\prime \rangle }{\Vert  f_{\text{img}}(\rvx)\Vert_2 \Vert \rvh^\prime \Vert_2}\\
    = & \dfrac{\langle f_{\text{img}}(\rvx), f_{\text{img}}(\rvx) + \xi \epsilon \Vert f_{\text{img}}(\rvx) \Vert_2 / \Vert \epsilon \Vert_2 \rangle }{\Vert  f_{\text{img}}(\rvx)\Vert_2 \Big\Vert f_{\text{img}}(\rvx) + \xi \epsilon \Vert f_{\text{img}}(\rvx) \Vert_2 / \Vert \epsilon \Vert_2 \Big \Vert_2} \\
    = & \dfrac{\Vert f_{\text{img}}(\rvx)\Vert^2 + \xi \epsilon^\intercal f_{\text{img}}(\rvx)  \Vert f_{\text{img}}(\rvx) \Vert_2 / \Vert \epsilon \Vert_2 }{\Vert  f_{\text{img}}(\rvx)\Vert_2 \Big\Vert f_{\text{img}}(\rvx) + \xi \epsilon \Vert f_{\text{img}}(\rvx) \Vert_2 / \Vert \epsilon \Vert_2 \Big\Vert_2}

    & \text{Sim}(f_{\text{img}}(\rvx), \rvh^\prime) \\
    = & \dfrac{\Vert f_{\text{img}}(\rvx)\Vert^2 + \xi \epsilon^\intercal f_{\text{img}}(\rvx)  \Vert f_{\text{img}}(\rvx) \Vert_2 / \Vert \epsilon \Vert_2 }{\Vert  f_{\text{img}}(\rvx)\Vert_2 \Big\Vert f_{\text{img}}(\rvx) + \xi \epsilon \Vert f_{\text{img}}(\rvx) \Vert_2 / \Vert \epsilon \Vert_2 \Big\Vert_2}\\
    = & \dfrac{1 + \xi a^\intercal b }{\Vert a  + \xi b \Vert _2}\\
    \geq & \dfrac{1 + \xi a^\intercal b }{\Vert a \Vert_2 + \xi \Vert b \Vert_2 }\\
     = & \dfrac{1 + \xi a^\intercal b}{1 + \xi}

    & \text{Prob}(\text{Sim}(f_{\text{img}}(\rvx_i), \rvh^\prime_i) \geq c) \\
    \geq & \text{Prob}(\dfrac{1 + \xi a^\intercal b}{1 + \xi} \geq c) \\
     = & \text{Prob}(1 + \xi a^\intercal b \geq c + c \xi) \\
      = & \text{Prob}(a^\intercal b \geq (c - 1 +  c \xi)/\xi) 

     \text{Prob}(a^\intercal b \leq z) = \int_{-1}^z  \dfrac{\Gamma(d/2 + 1/2)}{\sqrt{\pi} \Gamma(d/2)}(1-x^2)^{d/2 - 1} \text{d}x

    & \text{Prob}(\text{Sim}(f_{\text{img}}(\rvx_i), \rvh^\prime_i) \geq c) \\
    \geq & \text{Prob}(a^\intercal b \geq (c - 1 +  c \xi)/\xi) \\
     = & 1 - \int_{-1}^{(c-1)/\xi+c} \dfrac{\Gamma(d/2+1/2)}{\sqrt{\pi} \Gamma(d/2)} (1-x^2)^{d/2-1} \text{d}x, 

which completes the proof.
\end{proof}


\subsection{Experiment Details}

\paragraph{Datasets} The statistics of datasets are summarized in Table \ref{tab:datasets}.

\begin{algorithm}[ht!]
    \caption{Image feature extraction process}\label{algo:algorithm_image_feature}
    \begin{algorithmic}[1]
        \STATE {\bfseries Input: An image dataset , image resolution , pre-trained , hyper-parameters } 
        \STATE {\color{blue} //  Image feature generation}
        \FOR{ {\bfseries to} }
        \IF{use data augmentation}{
            \STATE Initialize ;
            \FOR{ {\bfseries to} k}
                \STATE , where  denotes randomly cropping image to be ,  is an integer randomly sampled from the range ;
            \ENDFOR
            \STATE ;}
        \ELSE
            \STATE Initialize ;
        \ENDIF
        \ENDFOR
    \end{algorithmic}
\end{algorithm}
\begin{table}[t!]
\scalebox{0.96}{
    \begin{tabular}{lccc}
        \toprule
          Dataset& \#train & \#validation & caption/image\\
         \midrule
         MS-COCO & 82k &40k & 5 \\
         CUB & 9k &3k & 10 \\
         LN-COCO & 134k & 8k & 1 \\
         MM CelebA-HQ & 24k & 6k & 10 \\
         \bottomrule
    \end{tabular}
    }
    \centering
    \caption{Statistics of datasets. The last column indicates ratio of captions vs images. 
}    
    \label{tab:datasets}
\end{table}

\paragraph{Image feature extraction} In practice, we use random cropping as data augmentation when we extract the image features, which is presented in Algorithm \ref{algo:algorithm_image_feature}. The pseudo text features will be generated by perturb the average feature of augmented samples. In our implementation, we set  to extract image features used in generating , while we set  in contrastive loss \eqref{eq:clip_contrastive_loss}. 




\paragraph{Hyper-parameter} The hyper-parameters are selected based on the performance on MS-COCO dataset. Specifically,  is selected from ,  are selected from . 

\paragraph{Exponential sharpening} In practice, we found that applying an extra exponential sharpening in contrastive loss makes it easier to reproduce the experiment results, i.e. we add an extra exponential operation right before the softmax function in \eqref{eq:d_contrastive_loss} and \eqref{eq:clip_contrastive_loss}. Our implementation can be found at \url{https://github.com/drboog/Lafite}.



\subsection{More Results}

We provide the implementation details of image generation with multi-modal conditions, an ablation study on discriminator, and more generated examples under language-free setting. 

\paragraph{Generation with multi-modal conditions}
To generate an image conditioned on both a reference image and text description, we first extract the text feature  from the given text, and pseudo text feature  from the image. Then  will be feed into the pre-trained generator, leading to two conditional style codes  and . We construct a new conditional style code, whose elements are randomly selected from the corresponding elements in either  or . The new conditional style code will be fed into the generator to generate the desired image.

Note that generation conditioned on image is not reconstruction. Thus when only a reference image is provided, the generated image may have differences with the given image. However, they will share some visible characteristics that are semantic meaningful as illustrated in our examples.


\paragraph{Ablation study on discriminator}
We test the impact of each term of \ref{eq:logit} under language-free setting. The results are provided in Table \ref{tab:logit_ablation}, from which we can see that both terms are important, while the "real or fake" term seems to be more important.
\begin{table}[t!]
    \centering
    \begin{tabular}{cccccc}
    \toprule
    {\color{red}RoF} & {\color{red}SA} & FID  & IS  & SOA-C  & SOA-I \\
    \midrule
     \checkmark & &  &  &  & \\
         & \checkmark &  &  &  & \\ 
         \checkmark & \checkmark &  &  &  & \\
         \bottomrule
    \end{tabular}
    \caption{Ablation study on discriminator logits in language-free setting. {\color{red}RoF} denotes ``real or fake'' term, {\color{red}SA} denotes ``semantic alignment'' term.}
    \label{tab:logit_ablation}
\end{table}


\paragraph{Generated examples}
Some text-to-image generation results on CUB, MS-COCO, MM CelebA-HQ, LN-COCO are provided in the following figures.



\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.7\linewidth]{figures/generated_imgs/ms-coco_generated.png}
    \caption{Generating examples on MS-COCO dataset.}
    \label{fig:ms-coco_generated}
\end{figure*}


\begin{figure*}[h!]
    \centering
    \includegraphics[width=0.7\linewidth]{figures/generated_imgs/birds_generated.png}
    \caption{Generating examples on CUB dataset.}
    \label{fig:birds_generated}
\end{figure*}



\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.7\linewidth]{figures/generated_imgs/celeba_generated.png}
    \caption{Generating examples on MM CelebA-HQ dataset.}
    \label{fig:celeba_generated}
\end{figure*}

\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.7\linewidth]{figures/generated_imgs/ln-coco_generated.png}
    \caption{Generating examples on LN-COCO dataset.}
    \label{fig:ln-coco_generated}
\end{figure*}


\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.6\linewidth]{figures/generated_imgs/coco_mixed.png}
    \caption{Generating images with multi-modal conditions (conditioned on both image and text) on MS-COCO dataset.}
    \label{fig:ms-coco_mixed}
\end{figure*}

\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.6\linewidth]{figures/generated_imgs/birds_mixed.png}
    \caption{Generating images with multi-modal conditions (conditioned on both image and text) on CUB dataset.}
    \label{fig:birds_mixed}
\end{figure*}


\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.6\linewidth]{figures/generated_imgs/celeba_mixed.png}
    \caption{Generating images  with multi-modal conditions (conditioned on both image and text) on MM CelebA-HQ dataset.}
    \label{fig:celeba_mixed}
\end{figure*}

\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.6\linewidth]{figures/generated_imgs/ln-coco_mixed.png}
    \caption{Generating images with multi-modal conditions (conditioned on both image and text) on LN-COCO dataset.}
    \label{fig:ln-coco_mixed}
\end{figure*}

\end{document}
