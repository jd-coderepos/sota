\documentclass{sig-alternate-2013}

\def\istechreport{1}

\ifdefined\istechreport
\pdfoutput=1
\fi

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\ifdefined\istechreport
\usepackage{url}
\else
\usepackage{hyperref}
\fi

\usepackage{listings}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{amsmath}
\usepackage{array}
\usepackage{pbox}
\usepackage{todonotes}
\usepackage{xparse}
\usepackage{letltxmacro}

\LetLtxMacro{\todonote}{\todo}
\renewcommand{\todo}[2][]
{\todonote[caption={#2}, size=\footnotesize, #1]
{\renewcommand{\baselinestretch}{0.5}\selectfont#2\par}}

\lstset{basicstyle=\scriptsize\ttfamily,captionpos=b,escapeinside={@}{@}}

\setlist{itemsep=.01cm}

\hyphenation{authData authPolicy authValue policyDigest policySession
pcrUpdateCounter stand-alone TPMIdent}

\sloppy

\clubpenalty=10000
\widowpenalty = 10000

\renewcommand{\UrlFont}{\scriptsize}

\renewcommand{\footnotesize}{\scriptsize}

\newfont{\mycrnotice}{ptmr8t at 7pt}
\newfont{\myconfname}{ptmri8t at 7pt}
\let\crnotice\mycrnotice \let\confname\myconfname 
\ifdefined\istechreport
\toappear{This work is based on an earlier work: Citizen Electronic Identities
using TPM 2.0, to appear in the Proceedings of the 4th international workshop
on Trustworthy embedded devices, \myconfname{TrustED'14}, {\mycrnotice November
3, 2014, Scottsdale, Arizona, USA, http://dx.doi.org/10.1145/2666141.2666146}}
\else
\permission{Permission to make digital or hard copies of all or part of this
work for personal or classroom use is granted without fee provided that copies
are not made or distributed for profit or commercial advantage and that copies
bear this notice and the full citation on the first page. Copyrights for
components of this work owned by others than the author(s) must be honored.
Abstracting with credit is permitted. To copy otherwise, or republish, to post
on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.}
\conferenceinfo{TrustED'14,}{November 3, 2014, Scottsdale, Arizona, USA.\\
{\mycrnotice{Copyright is held by the owner/author(s). Publication rights
licensed to ACM.}}}
\copyrightetc{\the\acmcopyr}
\crdata{ACM 978-1-4503-3149-4/14/11 ...\PCR_{new} = \mathbf{H}(PCR_{old} || digest)PCR_{new}PCR_{old}\mathbf{H}()digestObjectObject \rightarrow authValueObject \rightarrow authPolicypolicySessionObjectpolicySession \rightarrow commandCodepolicySession \rightarrow pcrUpdateCounterpolicySession \rightarrow policyDigestpolicyDigest_{new} = \mathbf{H}(policyDigest_{old}\;||\;commandCode\;||\;commandArgs)policyDigest_{new}policyDigest_{old}\mathbf{H}()commandCodecommandArgs\begin{aligned}
    \mathbf{if}&\;condition\;\mathbf{then} \\
    &\;\;policyDigest_{new} = \mathbf{H}(0\;||\;commandCode\;||\;commandArgs)
  \end{aligned}\begin{aligned}
      \mathbf{if}&\;NValue\;\mathbf{op}\;operand\;\mathbf{then} \\
      &\;\;policyDigest_{new} = \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyNV\;||
      \;args\;||\;NVName)
    \end{aligned}TPM\_CC\_PolicyNVargsNVValueNVNamepolicyDigest_{new} =
  \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyCommandCode\;||
  \;code)codepolicyDigest_{new} =
  \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyPCR\;||
  \;PCRs\;||\;digest)PCRsdigest\begin{aligned}
    \mathbf{if}&\;policySession \rightarrow
    policyDigest\;\mathbf{in}\;digest_{1} \ldots digest_{n}\;\mathbf{then} \\
    &\;\;policyDigest_{new} =
    \mathbf{H}(0\;||\;TPM\_CC\_PolicyOR\;||\;digests)
  \end{aligned}digest_{1} \ldots digest_{n}digestsdigest_{1}\;||\;\ldots\;||\;digest_{n}n=8\mathbf{H}(digest_{1}||\ldots||digest_{n})digest' \notin \{digest_{1} \ldots digest_{n}\}\mathbf{H}digest_{x}||\ldots||digest'||\ldots||digest_{z}\mathbf{H}(digest_{1}||\ldots||digest_{n}) =
  \mathbf{H}(digest_{x}||\ldots||digest'||\ldots||digest_{z})\begin{aligned}
    \mathbf{if}&(\mathbf{V}(keyHandle_{A}, signature, policySession \rightarrow policyDigest)\;\\
    &\;\;policyDigest_{new} = \mathbf{H}(0\;||\;TPM\_CC\_PolicyAuthorize\;||\;keyName_{A})\\
    &\;\;policyDigest_{new+1} =\mathbf{H}(policyDigest_{new}\;||\;policyRef)
  \end{aligned}A\mathbf{V}()AkeyHandle_{A}AsignaturekeyName_{A}ApolicyRef[digest\;\leftarrow]\;command(<in\;parameters>[,\;<out\;parameters>])d_{0}\leftarrow          d_{x}\leftarrowkeyHandle_{eID}sessionType_{policy}d_{x}\leftarrowsessionHandle_{eID}d_{1}\leftarrow          sessionHandle_{eID}pcrSelectiond_{x}\leftarrow\ldotsd_{x}\leftarrowpubKey_{A}keyHandle_{A}d_{x}\leftarrowd_{x}\leftarrowkeyHandle_{A}sig_{a}ticket_{\{a,A\}}d_{2}\leftarrow           d_{x}\leftarrowsessionHandle_{eID}signature_{a}policyRef_{a}d_{x}\leftarrowkeyName_{A}ticket_{\{a,A\}}d'_{0}\leftarrow          d_{x}\leftarrowobjectHandle_{ctr}sessionType_{policy}sessionhandle_{ctr}d'_{1}\leftarrow          d_{x}\leftarrowsessionhandle_{ctr}ctrnd_{x}\leftarrowd_{3}\leftarrow           sessionHandle_{eID}ctrneqd_{x}\leftarrowd''_{0}\leftarrow          d_{x}\leftarrowkeyHandle_{ctr'}sessionType_{policy}sessionHandle_{ctr'}d''_{1}\leftarrow         d_{x}\leftarrowsessionhandle_{ctr}ctrd_{x}\leftarrowd_{\underset{(n,n+1)}{}}\leftarrowsessionHandle_{eID}ctrn+1eqd_{4}\leftarrow           sessionHandle_{eID}d_{(0,1)}d_{(1,2)}d_{(2,3)}d_{x}\leftarrowd_{x}\leftarrowd_{x}\leftarrowkeyHandle_{A}signature_{b}ticket_{\{b,A\}}d_{5}\leftarrow           d_{x}\leftarrowsessionHandle_{eID}signature_{b}policyRef_{b}d_{x}\leftarrowkeyName_{A}ticket_{\{b,A\}}n+1d'''_{0}\leftarrow        d_{x}\leftarrowobjectHandle_{PIN}sessionType_{policy}d_{x}\leftarrowsessionHandle_{PIN}d'''_{1}\leftarrow        d_{x}\leftarrowsessionHandle_{PIN}authValue_{PIN}d_{x}\leftarrowd_{6}\leftarrow           d_{x}\leftarrowsessionHandle_{eID}objectHandle_{PIN}d_{x}\leftarrowsessionHandle_{PIN}d_{x}\leftarrowd_{x}\leftarrowkeyHandle_{A}signature_{c}ticket_{\{c,A\}}d_{7}\leftarrow           d_{x}\leftarrowsessionHandle_{eID}signature_{c}policyRef_{c}d_{x}\leftarrowkeyName_{A}ticket_{\{c,A\}}d_{8}\leftarrow           d_{x}\leftarrow\begin{aligned}
    \mathbf{if}&(\mathbf{V}(keyHandle_{A}, signature, policySession \rightarrow policyDigest)\;\\
    &\;\;policyDigest_{new} = \mathbf{H}(0\;||\;TPM\_CC\_PolicyAuthorize\;||\;keyName_{A})\\
    &\;\;policyDigest_{new+1} =\mathbf{H}(policyDigest_{new}\;||\;policyRef)
  \end{aligned}TPM\_CC\_PolicyAuthorizeA\mathbf{V}()AkeyHandle_{A}AsignaturekeyName_{A}ApolicyRef\rightarrowpolicyDigest_{new} =
  \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyAuthValue)\rightarrowpolicyDigest_{new} =
  \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyCommandCode\;||\;code)TPM\_CC\_PolicyCommandCodecode\begin{aligned}
      \mathbf{if}&\;NValue\;\mathbf{op}\;operand\;\mathbf{then} \\
      &\;\;policyDigest_{new} = \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyNV\;||
      \;args\;||\;NVName)
    \end{aligned}TPM\_CC\_PolicyNVargsNVValueNVName\begin{aligned}
    \mathbf{if}&\;policySession \rightarrow
    policyDigest\;\mathbf{in}\;digest_{1} \ldots digest_{n}\;\mathbf{then} \\
    &\;\;policyDigest_{new} =
    \mathbf{H}(0\;||\;TPM\_CC\_PolicyOR\;||\;digests)
  \end{aligned}TPM\_CC\_PolicyORdigest_{1} \ldots digest_{n}digestsdigest_{1}\;||\;\ldots\;||\;digest_{n}\rightarrowpolicyDigest_{new} =
  \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyAuthValue)policyDigest_{new} =
  \mathbf{H}(policyDigest_{old}\;||\;TPM\_CC\_PolicyPCR\;||
  \;PCRs\;||\;digest)TPM\_CC\_PolicyPCRpcrsdigest\rightarrow$ \texttt{pcrUpdateCounter} each
time a PCR is updated. When \texttt{TPM2\_PolicyPCR()} is invoked, and the
immediate PCR value check succeeds, the current value of the PCR update counter
is stored in the current session context. On subsequent \texttt{TPM2\_PolicyPCR}
invocations, and when the policy session is used for authorization, the value of
the PCR update counter is compared against the stored counter; the authorization
will fail unless the counter values match.



 \fi

\end{document}
