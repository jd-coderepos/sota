\documentclass{article}









\usepackage[final]{neurips_2020}

\usepackage[utf8]{inputenc} \usepackage[T1]{fontenc}    \usepackage{hyperref}       \usepackage{url}            \usepackage{booktabs}       \usepackage{amsfonts}       \usepackage{nicefrac}       \usepackage{microtype}      \usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{amsmath,amssymb} 
\usepackage{cuted}
\usepackage{bbm}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{multirow}
\usepackage{soul}
\usepackage{arydshln}
\usepackage[numbers]{natbib}

\setlength{\tabcolsep}{-4pt}
\renewcommand{\arraystretch}{1}

\newcommand\blfootnote[1]{\begingroup
  \renewcommand\thefootnote{}\footnote{#1}\addtocounter{footnote}{-1}\endgroup
}


\title{Multi-Task Temporal Shift Attention Networks for On-Device Contactless Vitals Measurement}



\author{Xin Liu\textsuperscript{1},
  Josh Fromm\textsuperscript{3},
  Shwetak Patel\textsuperscript{1},
  Daniel McDuff\textsuperscript{2}\\
  Paul G. Allen School of Computer Science \& Engineering, University of Washington, Seattle, USA\textsuperscript{1}\\
  Microsoft Research AI, Redmond, USA\textsuperscript{2} \\
  OctoML, Seattle, USA\textsuperscript{3}
 \\
 \{xliu0, shwetak\}@cs.washington.edu, jwfromm@octoml.ai, damcduff@microsoft.com
 }


\begin{document}

\maketitle

\begin{abstract}

Telehealth and remote health monitoring have become increasingly important during the SARS-CoV-2 pandemic and it is widely expected that this will have a lasting impact on healthcare practices. These tools can help reduce the risk of exposing patients and medical staff to infection, make healthcare services more accessible, and allow providers to see more patients. However, objective measurement of vital signs is challenging without direct contact with a patient. We present a video-based and on-device optical cardiopulmonary vital sign measurement approach. It leverages a novel multi-task temporal shift convolutional attention network (MTTS-CAN) and enables real-time cardiovascular and respiratory measurements on mobile platforms. We evaluate our system on an Advanced RISC Machine (ARM) CPU and achieve state-of-the-art accuracy while running at over 150 frames per second which enables real-time applications. Systematic experimentation on large benchmark datasets reveals that our approach leads to substantial (20\%-50\%) reductions in error and generalizes well across datasets.
\end{abstract}
\section{Introduction}
\blfootnote{Github Link: \url{https://github.com/xin71/MTTS-CAN}}
The SARS-CoV-2 (COVID-19) pandemic is transforming the face of healthcare around the world \citep{song2020role,smith2020telehealth}. One example of this is the sharp increase (by more than 10x) in the number of medical appointments held via telehealth platforms because of the increased pressures on healthcare systems, the desire to protect healthcare workers and restrictions on travel \citep{smith2020telehealth}. Telehealth includes the use of telecommunication tools, such as phone calls and messaging, and online health portals that allow patients to communicate with their providers. The Center for Disease Control and Prevention is recommending the ``use of telehealth strategies when feasible to provide high-quality patient care and reduce the risk of COVID-19 transmission in healthcare settings''\footnote{https://www.cdc.gov/coronavirus/2019-ncov/hcp/ways-operate-effectively.html}.
Performing primary care visits from a patient's home reduces the risk of exposing people to infections, increases the efficiency of visits and facilitates care for people in remote locations or who are unable to travel. These are longstanding arguments for telehealth and will still be valid after the end of the current pandemic. Healthcare systems are likely to maintain a high number of telehealth appointments in the future \citep{pollock2020embracing}. 

However, despite the longstanding promise of telehealth, it is difficult to provide a similar level of care on a video call as during an in-person visit. The physician \textit{can} diagnose a patient based on visual observations and self-reported symptoms; however, in most cases they \textit{cannot} objectively assess the patient's physiological state. This means that physicians have to make decisions (e.g., recommending a trip to the emergency department) without important data. In the case of COVID-19, there are severe cardiopulmonary (heart and lung related) symptoms that are difficult to evaluate remotely. The symptoms seen in patients have drawn links to acute respiratory distress syndrome \citep{xu2020pathological}, myocardial injury, and chronic damage to the cardiovascular system. Experts suggest that particular attention should be given to cardiovascular protection during treatment \citep{zheng2020covid}. The development of more accurate and efficient non-contact cardiopulmonary measurement technology would give remote physicians access to the data to make more informed decisions. Beyond telehealth, the same technology could impact passive health monitoring, improving the standard of care for infants in neonatal intensive care units  \citep{villarroel2019non}.

Cameras can be used to measure physiological signals, including heart and respiration rates, and blood oxygenation levels \citep{poh2010non,guazzi2015non,chen2018deepphys}, based on facial videos \citep{takano2007heart,verkruysse2008remote}. Non-contact cardiopulmonary measurement involves capturing subtle changes in light reflected from the body caused by physiological processes. Imaging methods can be used to measure volumetric changes of blood in the surface of the skin cause changes in light absorption ($\uparrow$ volume of hemoglobin = $\uparrow$ light absorption). This in turns affects the amount of visible light reflected from the skin, which is the source of the photoplethysmogram (PPG). The mechanical force of blood pumping around the body also causes subtle motions and these are the source of the ballistocardiogram (BCG). These color and motion changes in the video help us extract the pulse signal and heart rate frequency. The PPG and BCG signals provide complementary information to one another and also contain information about breathing due to respiratory sinus arrhythmia \citep{poh2010advancements}. Respiratory signals can also be recovered from motion-based analyses of the head and torso as the subjects breathes in and out \citep{tarassenko2014non}.

Computer vision for remote cardiopulmonary measurement is a growing field; however, there is room for improvement in the existing methods. First, accuracy of measurements is critical to avoid false alarms or misdiagnoses. The US Federal Drug Administration (FDA) mandates that testing of a new device for cardiac monitoring should show ``substantial equivalence'' in accuracy with a legal predicate device (e.g., a contact sensor)\footnote{https://www.fda.gov/regulatory-information/search-fda-guidance-documents/cardiac-monitor-guidance-including-cardiotachometer-and-rate-alarm-guidance-industry\#6\_1}. This standard has not been obtained in non-contact approaches. Second, designing models that run on-device helps reduce the need for high-bandwidth Internet connections making telehealth more practical and accessible. Moreover, camera-based cardiopulmonary measurement is a highly privacy sensitive application. These data are personally identifiable, combining videos of a patient's face with sensitive physiological signals. Therefore, streaming and uploading data to the cloud to perform analysis is not ideal. Finally, the ability to run at a high frame rates enables opportunistic sensing (e.g., obtaining measurements each time you look at your phone) and helps capture waveform dynamics that could be used to detect arterial fibrillation \cite{chan2016diagnostic}, hypertension \cite{hosanee2020cuffless}, and heart rate variability \cite{mcduff2014remote} where high-frame rates (at least 100Hz) are a requirement to yield precise measurements. 

We propose a novel multi-task temporal shift convolutional attention network (MTTS-CAN) to address the challenges of privacy, portability, and precision in contactless cardiopulmonary measurement. Our end-to-end MTTS-CAN leverages temporal shift modules to perform efficient temporal modeling and remove various sources of noise without any additional computational overhead. An attention module improves signal source separation, and a multi-task mechanism shares the intermediate representations between pulse and respiration to jointly estimate both simultaneously. By combining these three techniques, our proposed network can run on an ARM CPU and achieve the state-of-the-art accuracy and inference speed. 

To summarize, the contributions of this paper are to 1) present an accurate and efficient approach to perform on-device real-time spatial-temporal modeling of vitals signal, 2) evaluate our system and show \textbf{state-of-the-art performance} on two large public datasets, 3) provide an implementation of core tensor operations required for MTTS-CAN using a modern deep learning compiler and an on-device latency evaluation across different architectures showing MTTS-CAN can run at more than \textbf{150 frame} per second. Our code, models, and video figures are provided in the supplementary materials.

\section{Related Work}

\textbf{Camera-based Physiological Measurement:}
Early work established that the blood volume pulse can be extracted by analysing skin pixel intensity changes over time \citep{takano2007heart,verkruysse2008remote}. These methods are grounded by optical models (e.g., the Lambert-Beer law (LBL) and Shafer's dichromatic reflection model (DRM)) that provide a framework for modeling how light interacts with the skin. However, traditional signal processing techniques are quite sensitive to noise from other sources in video data, including head motions and illumination changes \citep{poh2010non,poh2010advancements}. To help address these issues, some approaches incorporate prior knowledge about the physical properties of the patient's skin \citep{de2013robust,wang2016algorithmic}. Although effective, these handcrafted signal processing pipelines make it difficult to capture the complexity of the spatial and temporal dynamics of physiological signals in video. Neural network based approaches have been successfully applied using the BVP or respiration as the target signal \citep{chen2018deepphys,vspetlik2018visual,yu2019remote,song2020heart}, but these methods still struggle with effectively combining spatial and temporal information while maintaining a low computational budget. More recently, researchers have investigated on-device remote camera-based heart rate variability measurement using facial videos from smartphone cameras \citep{huynh2019vitamon}. However, their proposed architecture requires approximately 200ms per frame inference, which is insufficient for real-time performance, and was not evaluated on public datasets. 

\textbf{Efficient Temporal Models:}
Yu et al. \citep{yu2019remote} have shown that applying 3D convolutional neural networks (CNNs) significantly improves performance and achieves better accuracy compared to using a combination of 2D CNNs and recurrent neural networks. The benefit of 3D CNNs implies that incorporating temporal data in all layers of the model is necessary for high accuracy. However, direct temporal modeling with 3D CNNs requires dramatically more compute and parameters than 2D based models. In addition to reducing computational cost, there are several reasons that it is highly desirable to be able to have efficient non-contact physiological measurement models that run on-device. Temporal Shift Modules \citep{lin2019tsm} provide a clever mechanism that can be used to replace 3D CNNs without reducing accuracy and requiring only the computational budget of a 2D CNN. This is achieved by shifting the tensor along the temporal dimension, facilitating information exchange across multiple frames. TSM has been evaluated on the tasks of video recognition and video object detection and achieved superior performance in both latency and accuracy. Xiao et al. \citep{xiao2019reasoning} used pretrained TSM-based residual networks as a backbone followed by two attention modules for reasoning about human-object interactions. The differences between this aforementioned work and ours is they applied attention modules as the head followed by pretrained TSM-based residual feature maps while our work applies two attention modules to the intermediate feature maps generated from regular 2D CNNs with TSM. 


\textbf{Machine Learning and COVID-19:}
Researchers have explored the use of machine learning from various perspectives to help combat COVID-19 \citep{latif2020leveraging}. Recent studies have shown that applying convolutional neural networks to CT scans can help extract meaningful radiological features for COVID-19 diagnosis and facilitate automatic pulmonary CT screening as well as cough monitoring \citep{wang2020deep, butt2020deep,al2020flusense, imran2020ai4covid}. Researchers have also looked at the correlation between resting heart rate generated from wearable sensors and COVID-19 related symptoms and behaviors at population scale \citep{khan2020coronavirus}. 



\section{Method}

\begin{figure*}[t!]
  \includegraphics[width=\textwidth]{Figures/main_arch2.pdf}
  \caption{We perform a systematic comparison of several convolutional attention network (CAN) architectural designs. Starting from previous work that presented a 2D-CAN \citep{chen2018deepmag}, we introduce a fully 3D-CAN, a 2D-3D Hybrid CAN in which the appearance branch takes a single frame, and our proposed temporal shift CAN. Each of these models can be applied in a single or multi-task manner.}
  \label{fig:architecture}
  \vspace{-0.3cm}
\end{figure*}

\subsection{Optical Model}
For our optical basis we start with Shafer's Dichromatic Reflection Model (DRM), as in prior work \citep{wang2016algorithmic,chen2018deepphys}. Specifically, we aim to capture both spatial and temporal changes and the relationship between multiple physiological processes. Let us start with the RGB values captured by the cameras as given by:
\begin{equation} \label{eq:1}
	\pmb{C}_k(t)=I(t) \cdot (\pmb{v}_s(t)+\pmb{v}_d(t))+\pmb{v}_n(t)
\end{equation}
where $I(t)$ is the luminance intensity level, modulated by the specular reflection $\pmb{v}_s(t)$ and the diffuse reflection $\pmb{v}_d(t)$. The quantization noise of the camera sensor is captured by $\pmb{v}_n(t)$. Following \cite{wang2016algorithmic} we can decompose $I(t)$, $\pmb{v}_s(t)$ and $\pmb{v}_d(t)$ into stationary and time-dependent parts:
\begin{equation} \label{eq:2}
	\pmb{v}_d(t) = \pmb{u}_d \cdot d_0 + \pmb{u}_p \cdot p(t)  
\end{equation}
where $\pmb{u}_d$ is the unit color vector of the skin-tissue; $d_0$ is the stationary reflection strength; $\pmb{u}_p$ is the relative pulsatile strengths caused by hemoglobin and melanin absorption; $p(t)$ represents the physiological changes.
\begin{equation} \label{eq:3}
	\pmb{v}_s(t) = \pmb{u}_s \cdot (s_0+\Phi(m(t),p(t))) 
\end{equation}
where $\pmb{u}_s$ denotes the unit color vector of the light source spectrum; $s_0$ and $\Phi(m(t),p(t))$ denote the stationary and varying parts of specular reflections; $m(t)$ denotes all the non-physiological variations such as flickering of the light source, head rotation, and facial expressions.  
\begin{equation} \label{eq:4}
	I(t) = I_0 \cdot (1+\Psi(m(t),p(t))) 
\end{equation}
where $I_0$ is the stationary part of the luminance intensity, and $I_0\cdot\Psi(m(t),p(t))$ is the intensity variation observed by the camera. As in \citep{chen2018deepphys} we can disregard products of time-varying components as they are relatively small:
\begin{multline} \label{eq:7}
	\pmb{C}_k(t)\approx \pmb{u}_c \cdot I_0 \cdot c_0+\pmb{u}_c \cdot I_0 \cdot c_0 \cdot \Psi(m(t),p(t)) + \\
	\pmb{u}_s \cdot I_0 \cdot \Phi(m(t),p(t))+\pmb{u}_p \cdot I_0 \cdot p(t)+\pmb{v}_n(t)
\end{multline}
However, unlike in previous work which modeled pulse and respiration signals as independent \citep{chen2018deepmag}, we leverage the fact that \textit{p(t)} actually captures a complex combination of both pulse and respiration information. Specifically, both the specular and diffuse reflections are influenced by related physiological processes. Respiratory sinus arrhythmias (RSA) are rhythmical fluctuations in heart periods at the respiration frequency \citep{berntson1993respiratory}. Furthermore, the respiration and pulse signals both cause outward motions of the body in the form of chest and head motions. We can say that the physiological process \textit{p(t)} is a complex combination of both the blood volume pulse, \textit{b(t)}, and the respiration wave, \textit{r(t)}. Thus, $p(t) = \Theta(b(t),r(t))$ and the following equation gives a more accurate representation of the underlying process:
\begin{multline} \label{eq:8}
	\pmb{C}_k(t)\approx \pmb{u}_c \cdot I_0 \cdot c_0+\pmb{u}_c \cdot I_0 \cdot c_0 \cdot \Psi(m(t),\Theta(b(t),r(t))) + \\
	\pmb{u}_s \cdot I_0 \cdot \Phi(m(t),\Theta(b(t),r(t)))+\pmb{u}_p \cdot I_0 \cdot p(t)+\pmb{v}_n(t)
\end{multline}

Since \textit{b(t)} and \textit{r(t)} are so closely intertwined, a temporal multi-task learning approach would seem optimal for this problem and at very least could leverage redundancies between the two signals. 


\begin{figure*}[t!]
  \includegraphics[width=\textwidth]{Figures/TS-CAN.pdf}
  \caption{We present a multi-task temporal shift convolutional attention network for camera-based physiological measurement. }
  \label{fig:TS-CAN}
\end{figure*}

\label{sec: optical_model}
\subsection{Architecture}
\textbf{Efficient Spatial-Temporal Modeling:}
To achieve state-of-the-art performance in on-device optical cardiopulmonary measurement, an architecture should have the ability to: 1) efficiently learn spatial features that map raw RGB values to latent representations corresponding to the pulse and respiratory signals as well as temporal features that offset various sources of noise (e.g., head motion, ambient illumination changes, etc.), 2) learn the relationships between associated physiological processes, 3) work in real-time to support various telehealth deployments. Our solution is a novel temporal shift convolutional attention architecture (Fig. \ref{fig:architecture}D) which we systematically compare to its variants (Fig. \ref{fig:architecture}A-C) to illustrate its benefits.

Because of the strong performance shown in prior work \citep{chen2018deepphys}, our architecture leverages a two-branch structure with a spatial attention module (Fig. \ref{fig:architecture}A). One branch is used for motion modeling, and the other branch for extracting meaningful spatial (i.e., facial) features. However, it fails to capture temporal dependencies beyond consecutive frames and thus is still vulnerable to many sources of noise. Perhaps the simplest way to introduce a strong temporal dependency is a \textit{3D-CAN} that leverages 3D convolutions to model temporal relationships (Fig. \ref{fig:architecture}B) which is similar to the model used in \cite{yu2019remote} but adds an attention module. However, since 3D convolutions incur quadratic computational cost compared to 2D convolutions, it is not feasible to achieve real-time on-device performance using a primarily 3D architecture. Therefore, we present a \textit{Hybrid-CAN} architecture that is more computationally efficient than a purely 3D model. \textit{Hybrid-CAN} combines a 2D-CAN and a 3D-CAN to maintain temporal modeling while leveraging more efficient 2D convolutions where possible. Since spatial position changes between adjacent frames are subtle, using 3D convolutions in the appearance branch is unnecessary. As Fig. \ref{fig:architecture}C illustrates, the input of the appearance branch is a single frame generated by averaging N (window size) adjacent frames. Although Hybrid-CAN reduces computational cost significantly, the computational overhead from 3D convolutions in the motion branch is still not tolerable if we want to achieve real-time inference on low-end mobile platforms (i.e., ideally at least 60 FPS).  

Therefore, we introduce \textit{TS-CAN} to remove the 3D convolution operations from the architecture entirely while preserving spatial-temporal modeling. TS-CAN has two major additional components: the temporal shift module (TSM) \citep{lin2019tsm} and the attention module. TSM performs tensor shifting before the tensor is fed into the convolutional layers as visualized in Fig.\ref{fig:TS-CAN}. More specifically, TSM splits the input tensor into three chunks across the channel dimension. Then, it shifts the first chunk to the left by one place (advancing time by one frame) and shifts the second chunk to the right by one place (delaying time by one frame). Both shifting operations are along the temporal axis, and the third chunk remains unchanged. It is worth noting that tensor shifting does not add any additional parameters to the network, but does enable information exchange among neighbouring frames. We used TSM in the motion branch to mimic the effects of 3D convolution, while the appearance branch in the TS-CAN is the same as Hybrid-CAN and only takes a single averaged frame. By doing so, the model not only significantly reduces computational time by only calculating the attention mask once, but also captures most of the pixels that contain skin and reduces camera quantization error. 

\textbf{Attention on Temporal Shift:} 
Given there are already many different sources of noise described in the previous section, naively shifting an input tensor in time will introduce extra temporal information to our representation. It is then important that we pay attention to the pixels with physiological signals or risk amplifying noise. Therefore, we propose inserting an attention module in TSM to minimize the negative effects introduced by tensor shifting as well as to enable the network to focus on the target signals.
The spatial and temporal distribution of physiological signals are not uniform on human skin. Soft-attention masks can assign higher weights to certain shifted pixels with stronger signals in intermediate representations from the convolutional operations. More concretely, our attention modules are the bridges between the appearance branch and the motion branch (See Fig. \ref{fig:TS-CAN}). Softmax attention masks are generated via 1 $\times$ 1 convolutions before pooling layers. The attention mask is calculated as in Equation \ref{eq:attention} where $k$ is the index of a layer,  $\omega^k$  is the  1 $\times$ 1 convolution and followed by a sigmoid activate function $\sigma(\cdot)$. $l_1$ normalization was applied to soften the extreme values in the mask to make sure the network avoided pixel anomalies. Finally, we perform an element-wise product to the corresponding representation $\mathbb{X}^k$ from the motion branch. 
\begin{equation} \label{eq:attention}
    \mathbb{X}^k \odot \frac{H_k W_k \cdot \sigma(\omega^k\mathbb{X}_{\alpha}^k + b^k)}
    {2\parallel\sigma(\omega^k\mathbb{X}_{\alpha}^k + b^k)\parallel_1}
\end{equation}


\textbf{Multi-Task TS-CAN:}
We now have an efficient on-device architecture to predict physiological signals in real-time. However, we still have two independent networks, one for estimating the blood volume pulse and another for the respiration signals. Thus, the computational cost is doubled while preventing the possibility for information sharing across these related physiological processes.
As we know that pulse and respiration are linked, we propose a multi-task variant of our network (see Fig. \ref{fig:TS-CAN}). This shrinks the computational budget by approximately 50\% and the tasks of estimating BVP and respiration can share an intermediate representation. The loss function of this multi-task TS-CAN (MTTS-CAN) is described in Eqn. \ref{eq:loss} where b(t) is the gold-standard BVP waveform and r(t) is gold-standard respiration waveform. b(t)' and r(t)' are the respective predictions from the model. 
\begin{equation} \label{eq:loss}
    L = \frac{1}{T}\sum_{t=1}^{T} |b(t) - b(t)'| + \alpha\frac{1}{T}\sum_{t=1}^{T} |r(t) - r(t)'|
\end{equation}

\section{Experiments}
\vspace{-1mm}
We compare our methods to four approaches for pulse measurement: POS\citep{wang2016algorithmic}, CHROM\citep{de2013robust}, ICA\citep{poh2010advancements}, 2D-CAN\citep{chen2018deepphys} and two for respiration measurement: 2D-CAN and ARM \citep{tarassenko2014non}. Other than DeepPhys \cite{chen2018deepphys}, we are not aware of other methods that work for both pulse and respiration measurement. We run our experiments using the following datasets: 

\textbf{AFRL} \citep{estepp2014recovering}: 300 videos of 25 participants (17 males) recorded at 658x492 resolution and 120 fps (down-sampled to 30 fps for our experiments). Fingertip reflectance photoplethysmograms(PPG) were used to record ground-truth signals for training our network and electrocardiograms(ECG) were recorded for evaluating performance (this is the medical gold-standard). Each participant was recorded six times with increasing head motion in each task. The participants were asked to sit still for the first two tasks and perform three motion tasks rotating their head about the vertical axis with an angular velocity of 10 degrees/second, 20 degrees/second, 30 degrees/second, respectively. In the last task, participants were asked to orient their head randomly once every second to one of nine predefined locations. The six recording were repeated twice in front of two backgrounds.

\textbf{MMSE-HR} \citep{zhang2016multimodal}: 102 videos of 40 participants were recorded at 1040x1392 resolution and 25 fps during spontaneous emotion elicitation experiments. The gold standard contact signal was measured via a Biopac2 MP150 system\footnote{\url{https://www.biopac.com/}} which provided pulse rate at 1000 fps and was updated after each heart beat. These videos feature smaller but more spontaneous motions than those in the AFRL dataset including facial expressions. Respiration measurements were not provided.

\textbf{Experiment Details:} At a high-level all our proposed networks share a similar two-branch architecture. Each branch has four convolutional layers. There is an averaging pooling layer and dropout layer placed after the second and fourth convolutional layers as shown in Fig. \ref{fig:TS-CAN}. Different architectures in Fig. \ref{fig:architecture} require different convolutional operations (e.g., 3D-CAN requires 3D CNNs). To preprocess the input of the appearance branch, we downsample each frame $c(t)$ to 36$\times$36, which balances maintaining spatial resolution quality and suppressing camera noise \citep{wang2014exploiting}. For the motion branch, we calculate normalized frames using every two adjacent frames as $(c(t+1) - c(t)) / (c(t) + c(t+1))$. The normalized frames are less vulnerable to changes in brightness and skin appearance compared to the raw frames $c(t)$ and reduce the chance of over-fitting to certain datasets. 

Our system is implemented in TensorFlow~\citep{abadi2016tensorflow}. We trained our proposed MTTS-CAN architectures using the Adadelta optimizer \citep{zeiler2012adadelta} with a learning rate of 1.0, batch size of 32, kernel size of 3$\times$3, pooling size of 2$\times$2, and dropout rates of 0.25 and 0.5. The final model was chosen after the training converged (12 epochs on the respiration task and 24 epochs on the pulse task). We implemented 2D-CAN, 3D-CAN and Hybrid-CAN as baselines to compare against our proposed architectures. For the 3D and Hybrid models the training schema is similar to TS-CAN, but we use a kernel size of 3$\times$3$\times$3 and a pooling size of 2$\times$2$\times$2. We used a window size of 10 frames in all temporal models to provide a fair comparison for our proposed architectures. We picked $\alpha=0.5$ for the multi-tasking loss function in the MTTS-CAN to force estimations of pulse and respiration treated equally (pulse and respiration signals were both normalized in amplitude).  
To calculate the performance metrics, we post-processed the outputs of all methods in the same way using a 2nd-order Butterworth filter (cut-off frequencies of 0.75 and 2.5 Hz for HR and 0.08 and 0.5 Hz for BR). For the AFRL data, we divided the dataset into 30-second windows with no overlap. For the MMSE-HR dataset we used a window size equal to the number of frames in each video. We then computed four standard metrics for each window: mean absolute error (MAE), root mean squared error (RMSE) and correlation ($\rho$) in heart/breathing rate estimations and the corresponding BVP/respiration signal-to-noise ratio (SNR) \citep{de2013robust}. Details of the calculation for these metrics, training code, architecture and the trained models are available in the supplementary material. 

\textbf{On-Device Evaluation:} Our proposed architectures were deployed on an open-source embedded system called Firefly-RK3399\footnote{\url{http://en.t-firefly.com/product/rk3399.html}} for latency evaluation. This embedded system has two large Cortex-A72 cores and four small Cortex-A53 cores. Although RK3399 also has a mobile Mali GPU, we focus our evaluation on CPU such that our proposed end-to-end architecture can be generalized to any ARM based mobile platform and IoT device. In this work, we extend a deep learning compiler stack - TVM \citep{chen2018tvm} to support the core temporal shift operation required for TS-CAN. TVM takes a high-level description of a function and generates highly optimized low-level code for a targeted device. More specifically, our TVM-based on-device system first converts a TensorFlow graph to a Relay graph \citep{roesch2018relay} and complies the code to Firefly-RK3399 using LLVM. We take advantage of TVM’s scheduling primitives to generate efficient low-level LLVM code that accelerates expensive operations such as 2D and 3D convolutions.

\section{Results and Discussion}
\begin{table*}[t]
	\footnotesize
	\caption{Pulse and respiration measurement on the AFRL and MMSE-HR datasets.}
	\label{tab:AFRL_MMSE}
	\centering
	\setlength\tabcolsep{3pt} \begin{tabular}{r|cccc|cccc|cccc|cc}
	\toprule
		& \multicolumn{8}{c}{\textbf{Heart Rate}} & \multicolumn{4}{c}{\textbf{Respiration Rate}} \\
		& \multicolumn{4}{c}{\textbf{AFRL (All Tasks) }} &  \multicolumn{4}{c}{\textbf{MMSE-HR}}  & \multicolumn{4}{c}{\textbf{AFRL (All Tasks) }} & \textbf{Time}  \\
        \textbf{Method} & MAE & RMSE & $\rho$ & SNR & MAE & RMSE & $\rho$ & SNR & MAE & RMSE & $\rho$ & SNR & (ms) & \\ \hline \hline
        MTTS-CAN & 1.45 &  3.72 & 0.94 & 8.64 & 3.00 & 5.66 & 0.92 & 2.37 & 2.30 & 4.52 & 0.40 & 18.7 & 6 \\
        MT-Hyb.-CAN & 1.15 & 2.69 & 0.97 & 10.2 & 3.43 & 6.98 & 0.88 & 4.70 & 2.17 & 4.24 & 0.45 & 19.1 & 13 \\ 
        TS-CAN & 1.32 &  3.25 & 0.95 & 8.86 & 3.41 & 7.82 & 0.84  & 2.92  & 2.25 & 4.47 & 0.41 & 18.9 & 12 \\
        Hyb.-CAN & 1.12 & 2.60 & 0.97 & 10.6 & 2.55 & 4.16 & 0.96 & 5.47  & 2.06 & 4.17 & 0.46 & 19.8 & 26 \\
        3D-CAN & 1.18 & 2.83 & 0.97 & 10.5 & 2.78 & 5.08 & 0.94 & 4.73 & 2.31 & 4.42 & 0.44 & 19.3 & 48  \\ \hdashline
        2D-CAN \citep{chen2018deepphys} & 2.32 & 5.82 & 0.85 & 6.23 & 4.72 & 8.68 &  0.82 & 2.06  & 2.86 & 5.16 & 0.34 & 16.3 & 20  \\
        POS \citep{wang2016algorithmic} & 2.48 & 5.07 & 0.89 & 2.32 & 3.90 & 9.61 & 0.78 & 2.33 & \multicolumn{4}{c|}{|} & - \\
        CHROM \citep{de2013robust} & 6.42 & 12.4  & 0.60  & -4.83 & 3.74 & 8.11 & 0.82 & 1.90 & \multicolumn{4}{c|}{Not Applicable} & -\\
        ICA \citep{poh2010advancements} & 4.36 & 7.84 & 0.77 & 3.64 & 5.44 & 12.00 & 0.66 & 3.03 &  \multicolumn{4}{c|}{|} & - \\ 
        ARM \citep{tarassenko2014non} & \multicolumn{8}{c}{\multirow{1}{*}{Not Applicable}}  & 3.68 & 5.52 & 0.29 & -6.22 & - \\
        \bottomrule 
   \end{tabular}
   \\
   \tiny
   MAE = Mean Absolute Error, RMSE = Root Mean Squared Error, $\rho$ = Pearson Correlation, SNR = BVP Signal-to-Noise Ratio.
   \vspace{-0.4cm}
\end{table*}



\begin{table*}[t]
	\caption{Pulse and respiration measurement MAE on the AFRL by motion task.}
	\label{tab:tasks}
	\centering
	\small
	\setlength\tabcolsep{3pt} \begin{tabular}{rc|cccccc|cccccc}
	\toprule
		&& \multicolumn{6}{c}{\textbf{Heart Rate}} &  \multicolumn{6}{c}{\textbf{Respiration Rate}}  \\
        \textbf{Method} && T1 & T2  & T3 & T4 & T5 & T6 &  T1 & T2  & T3 & T4 & T5 & T6 \\ \hline \hline
        MTTS-CAN && 1.08 & 1.23 & 0.94 & 1.27 & 1.07 & 3.12 & 0.68 & 0.98 & 2.12 & 3.81 & 3.31 & 2.89 \\
        MT-Hybrid-CAN && 1.04 & 1.24 & 0.95 & 1.23 & 0.88 & 1.53 & 0.77 & 0.89 & 2.23 & 3.28 & 3.03 & 2.80 \\
        TS-CAN && 1.07 & 1.25 & 0.96 & 1.24 & 1.01 & 2.36 & 0.69 & 1.14 & 2.27 & 3.70 & 3.18 & 2.53 \\
        Hybrid-CAN && 1.04 & 1.21 & 0.94 & 1.22 & 0.89 & 1.39 & 0.77 & 1.03 & 1.83 & 3.19 & 2.96 & 2.60 \\
        3D-CAN && 1.06 & 1.19 & 0.92 & 1.23 & 0.89 & 1.77 & 0.96 & 0.98 & 2.58 & 3.80 & 2.87 & 2.65 \\ \hdashline

        2D-CAN \citep{chen2018deepphys} && 1.08 & 1.21 & 1.02 & 1.43 & 2.15 & 7.05 & 1.25 & 1.11 & 3.35 & 4.63 & 3.77 & 3.08 \\
        POS \citep{wang2016algorithmic} && 1.50 & 1.53 & 1.50 & 1.84 & 2.05 & 6.11 & \multicolumn{6}{c}{|} \\
        CHROM \citep{de2013robust} && 4.53 & 4.59 & 4.35 & 4.84 & 6.89 & 10.3 & \multicolumn{6}{c}{Not Applicable}  \\
        ICA \citep{poh2010advancements} && 1.17 & 1.70 & 1.70 & 4.00 & 5.22 & 11.8 & \multicolumn{6}{c}{|} \\
        ARM \citep{tarassenko2014non} &&& \multicolumn{4}{c}{\multirow{1}{*}{Not Applicable}} && 2.51 & 2.53 & 3.19 & 4.85 & 4.22 & 4.78 \\ \bottomrule 
   \end{tabular}
    \vspace{-0.3cm}
\end{table*}



\textbf{Comparison with the State-of-the-Art:}
For the AFRL dataset all 25 participants were randomly divided into five folds of five participants each (same folds as in \cite{chen2018deepphys}). The learning models were trained and tested via five-fold cross-validation using data from all tasks. The evaluation metrics are averaged over five folds and shown in Table \ref{tab:AFRL_MMSE}. All of our proposed models outperform the 2D-CAN and other baselines. Hybrid-CAN and 3D-CAN achieve similar accuracy, reducing MAE by 50\% on pulse and 20\% on respiration measurement. The hybrid model has lower computational cost and is therefore preferable. TS-CAN also surpasses the 2D-CAN by more than 43\% on pulse and 20\% on respiration measurement. We also evaluated a multi-tasking version of TS-CAN and Hybrid-CAN, and call them MTTS-CAN and MT-Hybrid-CAN respectively. We observe that there is no accuracy benefit from the multi-tasking model variants relative to the single task versions because the network must use almost all the same parameters for both tasks. However, the MT models require half the computation and half as many parameters compared to running pulse and respiration models separately which is a considerable benefit.
\begin{wrapfigure}{L}{0.5\textwidth}
\centering
\includegraphics[width=0.5\textwidth]{Figures/window_size_latency_att.pdf}
\caption{(A) On-Device latency evaluation across six models; (B) An visualization of TSM on a normalized frame from motion branch.}
\label{fig:window_size_latency}
\end{wrapfigure}

\textbf{Cross-Dataset Generalization:}
To test whether our model can generalize to videos with a different resolution, background, and lighting, we trained our proposed models on the AFRL dataset and tested on the MMSE-HR dataset. Our proposed TS-CAN, Hybrid-CAN and 3D-CAN reduce errors by 25-50\% compared to 2D-CAN (see Table \ref{tab:AFRL_MMSE}). Furthermore, MTTS-CAN and MT-Hybrid-CAN both perform strongly, showing that it is possible to share the representations between pulse and respiration.

\textbf{Computation Cost and Latency:} 
Fig. \ref{fig:window_size_latency}A and the last column of Table \ref{tab:AFRL_MMSE} show that MTTS-CAN and TS-CAN are the fastest architectures of those evaluated, taking 6 ms and 12 ms per frame for inference respectively. It is worth noting that TS-CAN is 40\% faster than the 2D-CAN because the unique design of the appearance branch that only executes once and provides the generated attention mask to all the frames in the motion branch.
MT-Hybrid-CAN and Hybrid-CAN also achieve 13ms and 26ms inference times respectively, this is approximately double that of our TS-based methods due to the cost of 3D convolutions relative to 2D convolutions. The 2D-CAN not only has a higher latency compared to TS-CAN, but the accuracy is significantly lower. It is not surprising that the 3D-CAN achieved the worst inference speed because it has costly 3D convolutions in both branches. Latency is important because we want our models to run at as high a frame rate as possible, 30 fps is the bare minimum required to accurately measure heart rate variability and subtle waveform dynamics and 100 fps would be preferable. Therefore, faster inference increases the precision at which we can measure inter-beat and systolic-diastolic intervals \citep{mcduff2014remote} and could help with non-invasive
blood pressure measurement \citep{hosanee2020cuffless} and detecting arterial fibrillation (AFib) \citep{chan2016diagnostic}.

\textbf{Temporal Modeling:} 
Capturing such waveform dynamics requires good temporal modeling, therefore we compared several designs to help improve this. Our proposed MTTS-CAN, TS-CAN, MT-Hybrid-CAN, Hybrid-CAN and 3D-CAN all outperform the 2D-CAN and other baseline methods. This is consistent with prior work that found a 3D-CNN without attention outperformed a 2D-CNN (without attention)~\citep{yu2019remote}. We would anticipate that the focus on modeling the temporal aspects of the physiological waveform would lead to greater resilience to noise. We perform a systematic evaluation on videos with varying velocities of angular (rotational) head motion. The results are shown in Table~\ref{tab:tasks}. As expected, all the proposed temporal models perform particularly strongly on tasks with greater velocity head motion; reducing the error on the most challenging task (6) by over 75\%. Moreover, as Fig. \ref{fig:window_size_latency}B illustrates, although tensor shifting provides important temporal information, it also introduces extra noise. The results in Table \ref{tab:AFRL_MMSE} indicate that our attention module is effective at separating the signal from the added noise.

\textbf{Multi-task Learning:}
Comparing our MT models with the non-MT models, we observe that the MT models do not reduce the error in pulse and respiration rate estimates. But they do significantly improve the efficiency of inference as shown in Fig. \ref{fig:window_size_latency}A which is critical in resource constrained mobile platforms. Moreover, in order to estimate heart beat and respiration rate from a video, there is a number of mandatory pre-processing and post-processing steps to be included in the pipeline such as down-sampling images, computing averaged frames, calculating the number of peaks etc. Since MTTS-CAN only takes 6ms for inference on each fraem, even with the pre-processing overhead real-time inference is still eminently feasible. Also, memory is a valuable resource on edge devices, and MTTS-CAN only requires half of the memory to store the parameters compared to TS-CAN. We believe MTTS-CAN can be deployed and especially useful in resource constrained settings. 

\textbf{Applications of MTTS-CAN:}
The low latency and high accuracy of our system opens the door for many other applications. For example, it could be used to improve the measurement of heart rate variability which is a measure of the variation in the time between each heartbeat. Tracking the subtle changes between consecutive heart beats requires low latency like that provided by MTTS-CAN. Contactless and on-device HRV tracking could enable numerous novel applications in mental health and personalized health. Besides health applications, MTTS-CAN is also potentially be applied to various computer vision tasks that require on-device computation such as activity recognition and video understanding. 



\section{Broader Impact}

Non-contact camera-based vital sign monitoring has great potential as a tool for telehealth. Our proposed system can promote global health equity and make healthcare more accessible for those in rural areas or those who find it difficult to travel to clinics and hospitals in-person (perhaps because of age, mobility issues or care responsibilities). These needs are likely to be particularly acute in low-resource settings. Non-contact sensing has other potential benefits for measuring the vitals of infants who ideally would not have contact sensors attached to their delicate skin. Furthermore, due to the exceptionally fast inference speed, the computational budget required for our proposed system is minimal. Therefore, people who cannot afford high-end computing devices still will be able to access the technology. While low-cost, ubiquitous sensing democratizes physiological measurement, it presents other challenges. If measurement can be performed from only a video, what happens if we detect a health condition in an individual when analyzing a video for other purposes. When and how should that information be disclosed? If the system fails in a context where a person is in a remote location, it may lead them to panic. 

It is also important to consider how such technology could be used by ``bad actors'' or applied with negligence and without sufficient forethought for the implications. Non-contact sensing could be used to measure personal physiological information without the knowledge of the subject. Law enforcement might be tempted to apply this in an attempt to detect individuals who appear ``nervous'' via signals such as an elevated heart rate or irregular breathing, or an employer may surreptitiously screen prospective employees for health conditions without their knowledge during an interview. These applications would set a very dangerous precedent and would be illegal in many cases. Just as is the case with traditional contact sensors, it must be made transparent when these methods are being used and subjects should be required to consent before physiological data is measured or recorded. There should be no penalty for individuals who decline to be measured.  Ubiquitous sensing offers the ability to measure signals in more contexts, but that does not mean that this should necessarily be acceptable. Just because cameras may be able to measure these signals in a new context, or with less effort, it does not mean they should be subject to any less regulation than existing sensors, in fact quite the contrary.

In the United States, the Health Insurance Portability and Accountability Act (HIPAA) and the HIPAA Privacy Rule sets a standard for protecting sensitive patient data and there should be no exception with regard to camera-based sensing. In the case of videos there should be particular care in how videos are transferred, given that significant health data can be contained with the channel. That was one of the motivations for designing our methods to run on-device, as it can minimize the risks involved in data transfer.  

\section{Conclusions}

Telehealth and the SARS-CoV-2 pandemic have acutely highlighted the specific need for accurate and computationally efficient cardiovascular and pulmonary sensing. We have presented a novel multi-task temporal shift convolutional attention network (MTTS-CAN) that improves on the state-of-the-art in both of these dimensions. 


\section{Acknowledgements}
We would like to thank the financial support from Bill \& Melinda Gates Foundation and University of Washington Endowment Funds. 


\small
\bibliographystyle{unsrt}
\bibliography{ref.bib}

\newpage
\section{Example Waveforms}

Please see our video figure in the supplementary material for video examples of results for pulse and respiration results. Below we should examples of pulse (Fig.~\ref{fig:pulsewaveforms}) and respiration (Fig.~\ref{fig:respwaveforms}) waveforms for the MT-2DCAN, MT-Hybrid-CAN and MTTS-CAN models compared to the gold-standard contact sensor measurements.  Videos are shown in the video figure included with the supplementary material.

\begin{figure*}[h]
  \includegraphics[width=\textwidth]{SuppFigures/P11T12_Pulse.pdf}
  \caption{Examples of pulse wave predictions from MT-2DCAN, MT-Hybrid-CAN and MTTS-CAN.  Notice how the agreement with the gold-standard measurements (blue) is highest for MT-Hybrid-CAN and MTTS-CAN.}
  \label{fig:pulsewaveforms}
\end{figure*}
\begin{figure*}[h]
  \includegraphics[width=\textwidth]{SuppFigures/P16T10_Resp.pdf}
  \caption{Examples of respiration wave predictions from MT-2DCAN, MT-Hybrid-CAN and MTTS-CAN.  Notice how the agreement with the gold-standard measurements (blue) is highest for MTTS-CAN.}
  \label{fig:respwaveforms}
\end{figure*}


\section{Architecture Details}

\begin{itemize}
    \item Please see Fig. \ref{fig:MTTS-CAN} for details of TS-CAN and MTTS-CAN. 
    \item Please see Fig. \ref{fig:Hybrid-CAN} for details of Hybrid-CAN and MT-Hybrid-CAN.
    \item Please see Fig. \ref{fig:3D-CAN} for details of 3D-CAN and MT-3D-CAN.
 \end{itemize}





\section{Pre-processing}

All the input images are first downsampled to the resolution of $36\times36$. We then calcucated the normalized frames between two consecutive frames using 
$(c(t+1)-c(t)) / (c(t+1) + c(t))$ to reduce the dependency on the absolute frame brightness and skin appearance. By doing so, we have a normalized image and a raw image for every single frame in the video. Both of raw and normalized frame were mean subtracted and then scaled to unit standard deviation over each video.

\section{Post-processing}

To calculate the performance metrics, we post-processed the outputs of all methods in the same way using a 2nd-order Butterworth filter (cut-off frequencies of 0.75 and 2.5 Hz for HR and 0.08 and 0.5 Hz for BR). For the AFRL data, we divided the dataset into 30-second windows with no overlap. For the MMSE-HR dataset we used a window size equal to the number of frames in each video. We then computed four standard metrics for each window: mean absolute error (MAE), root mean squared error (RMSE) and correlation ($\rho$) in heart/breathing rate estimations and the corresponding BVP/respiration signal-to-noise ratio (SNR). 

The performance metrics are calculated as follows:

\textbf{Mean Absolute Error (MAE)} 
For calculate the MAE between our model estimates and the gold-standard heart rate calculated from the contact sensor measurements in window within each dataset. As follows:

\textbf{Heart Rate:}
\begin{equation}
MAE = \frac{1}{T}\sum_{i=1}^{T} |HR_{i} - HR'_{i}|
\end{equation}

\textbf{Respiration Rate:}
\begin{equation}
MAE = \frac{1}{T}\sum_{i=1}^{T} |RR_{i} - RR'_{i}|
\end{equation}


\textbf{Root Mean Squared Error (RMSE)} 
For calculate the RMSE between our model estimates and the gold-standard heart rate calculated from the contact sensor measurements in window within each dataset. As follows:

\textbf{Heart Rate:}
\begin{equation}
RMSE = \sqrt{\frac{i=1}{T}\sum_{1}^{T} (HR_{i} - HR'_{i})^{2}}
\end{equation}

\textbf{Respiration Rate:}
\begin{equation}
RMSE = \sqrt{\frac{i=1}{T}\sum_{1}^{T} (RR_{i} - RR'_{i})^{2}}
\end{equation}

Where HR and RR are the gold-standard heart rate and respiration rates and HR' RR' are the estimated heart rate and respiration rates, respectively, from the video. The gold-standard HR frequency was determined from the manually corrected ECG peaks in the AFRL dataset and the HR estimates provided with the dataset for the MMSE-HR dataset.

We also compute the Pearson correlation between the estimated heart rates and respiration rates and the gold-standard heart rates from the contact sensor measurements.

\textbf{Pulse and Respiration Signal-to-Noise Ratios (SNR):} 

We calculate blood volume pulse and respiration signal-to-noise ratios (SNR) according to the method proposed by De Haan et al.~\citep{de2013robust}. This captures the signal quality of the recovered pulse and respiration estimates. Again, the gold-standard HR/RR frequency was determined from the manually corrected gold-standard measurements in the AFRL and MMSE-HR datasets, respectively.

\textbf{BVP SNR:}
\begin{equation}
SNR = 10\mathrm{log}_{10}\left(\frac{\sum^{240}_{f=30}((U_t(f)\hat{S}(f))^2}{\sum^{240}_{f=30}(1 - U_t(f))\hat{S}(f))^2)}\right)
\end{equation}
where $\hat{S}$ is the power spectrum of the BVP signal (S), $\textit{f}$ is the frequency (in BPM), HR is the heart rate computed from the gold-standard device  and $\textit{U$_{t}$(f)}$ is a binary template that is one for the heart rate region from HR-6 BPM to HR+6BPM and its first harmonic region from 2*HR-12BPM to 2*HR+12BPM, and 0 elsewhere. 

\textbf{Respiration SNR:}
\begin{equation}
SNR = 10\mathrm{log}_{10}\left(\frac{\sum^{30}_{f=5}((U_t(f)\hat{S}(f))^2}{\sum^{30}_{f=5}(1 - U_t(f))\hat{S}(f))^2)}\right)
\end{equation}
where $\hat{S}$ is the power spectrum of the respiration signal (S), $\textit{f}$ is the frequency (in breaths/min), RR is the respiration rate computed from the gold-standard device and $\textit{U$_{t}$(f)}$ is a binary template that is one for the heart rate region from RR-6 breaths/min to RR+6breaths/min and its first harmonic region from 2*RR-12breaths/min to 2*RR+12breaths/min, and 0 elsewhere.   


\section{Baseline Methods}
We compared the performance of our proposed approach to state-of-the-art supervised method using a convolutional attention network (CAN) and three unsupervised methods described below.

For the CHROM, ICA and POS methods face detection was first performed using MATLAB's face detection (\texttt{vision.CascadeObjectDetector()}). This was fixed for all methods, to avoid the influence of the face detector on performance. For the CAN methods following the implementation in~\cite{chen2018deepphys} we did not use face detection but rather we passed the full frame to the network after cropping the center portion to make the frame a square with W=H.

\textbf{CHROM} \citep{de2013robust}. This method uses a linear combination of the chrominance signals obtained from the RGB video.  The [\begin{math}x_R\end{math}, \begin{math}x_G\end{math}, \begin{math}x_B\end{math}] signals are filtered using a zero-phase, 3rd-order Butterworth bandpass filter with pass-band frequencies of [0.7 2.5] Hz. Following this, a moving window method of length 1.6 seconds (with overlapping windows and a step size of 0.8 seconds) is applied. Within each window the color signals are normalized by dividing by their mean value to give [\begin{math}\bar{x_r}\end{math}, \begin{math}\bar{x_g}\end{math}, \begin{math}\bar{x_b}\end{math}]. These signals are bandpass filtered using zero-phase forward and reverse 3rd-order Butterworth filters with pass-band frequencies of [0.7 2.5] Hz. The filtered signals [y$_{r}$, y$_{g}$, y$_{b}$] are then used to calculate \textit{S$_{win}$}:

\begin{equation}
S_{win} = 3( 1 - \frac{\alpha}{2} )y_{r} - 2(1 + \frac{\alpha}{2})y_{g} + \frac{3\alpha}{2}y_{b}
\end{equation}

Where $\alpha$ is the ratio of the standard deviations of the filtered versions of A and B:
\begin{equation}
    A = 3y_r - 2y_g
\end{equation}
\begin{equation}
B = 1.5y_r + y_g - 1.5y_b
\end{equation}
The resulting outputs are scaled using a Hanning Window and summed with the subsequent window (with 50\% overlap) to construct the final blood volume pulse (BVP) signal.

\textbf{ICA} \citep{poh2010non}. This approach involves spatial averaging the pixels by color channel in the region of interest (ROI) for each frame to form time varying signals [x$_{R}$, x$_{G}$, x$_{B}$]. Following this, the
observation signals are detrended. A
Z-transform is applied to each of the detrended signals. The Independent Component Analysis (ICA) (JADE implementation) is applied to the normalized color signals. 

\textbf{POS} \citep{wang2016algorithmic}. The intensity signals [\begin{math}x_R\end{math}, \begin{math}x_G\end{math}, \begin{math}x_B\end{math}] are computed. A moving window of length 1.6 seconds (with overlapping windows and with a step size of one frame), is applied. For each time window, the signal is divided by its mean to give [\begin{math}\bar{x_r}\end{math}, \begin{math}\bar{x_g}\end{math}, \begin{math}\bar{x_b}\end{math}]. Following this, \textit{X$_s$} and \textit{Y$_s$} are calculated where:
\begin{equation}
    X_s = \bar{x}_g - \bar{x}_b
\end{equation}
\begin{equation}
    Y_s = -2\bar{x}_r + \bar{x}_g + \bar{x}_b
\end{equation}
\textit{X$_s$} and \textit{Y$_s$} are then used to calculate \textit{S}$_{win}$, where:
\begin{equation}
    S_{win} = X_s + \frac{\sigma(X_s)}{\sigma(Y_s)}Y_s
\end{equation}
The resulting outputs of the window-based analysis are used to construct the final BVP signal in an overlap add fashion.

\section{Additional Experimental Results}

Table \ref{tab:SM_AFRL_MMSE} and Table \ref{tab:sm_tasks} shows the results of all the multi-task and non-multi-task architectures. Including the MT-3DCAN and MT-2DCAN for which we did not have space in the main paper.





\begin{table*}[t]
	\footnotesize
	\caption{Pulse and respiration measurement on the AFRL and MMSE-HR datasets.}
	\label{tab:SM_AFRL_MMSE}
	\centering
	\setlength\tabcolsep{3pt} \begin{tabular}{r|cccc|cccc|cccc|cc}
	\toprule
		& \multicolumn{8}{c}{\textbf{Heart Rate}} & \multicolumn{4}{c}{\textbf{Respiration Rate}} \\
		& \multicolumn{4}{c}{\textbf{AFRL (All Tasks) }} &  \multicolumn{4}{c}{\textbf{MMSE-HR}}  & \multicolumn{4}{c}{\textbf{AFRL (All Tasks) }} & \textbf{Time}\\
        \textbf{Method} & MAE & RMSE & $\rho$ & SNR & MAE & RMSE & $\rho$ & SNR & MAE & RMSE & $\rho$ & SNR & (ms)\\ \hline \hline
        MTTS-CAN & 1.45 &  3.72 & 0.94 & 8.64 & 3.00 & 5.66 & 0.92 & 2.37 & 2.30 & 4.52 & 0.40 & 18.7 & 6 \\
        MT-Hyb.-CAN & 1.15 & 2.69 & 0.97 & 10.2 & 3.43 & 6.98 & 0.88 & 4.70 & 2.17 & 4.24 & 0.45 & 19.1 & 13 \\ 
        MT-3D-CAN & 1.20 & 2.82 & 0.97 & 10.4 & 3.70 & 7.85 & 5.35 & 0.84 & 2.21 & 4.37 & 0.43 & 18.8 & 24\\
        MT-2D-CAN & 2.51 & 6.20 & 0.83 & 6.03 & 5.14 & 10.3 & 0.73 & 1.83 & 2.98 & 5.23 & 0.33 & 16.2 & 10\\
        TS-CAN & 1.32 &  3.25 & 0.95 & 8.86 & 3.41 & 7.82 & 0.84  & 2.92  & 2.25 & 4.47 & 0.41 & 18.9 & 12 \\
        Hyb.-CAN & 1.12 & 2.60 & 0.97 & 10.6 & 2.55 & 4.16 & 0.96 & 5.47  & 2.06 & 4.17 & 0.46 & 19.8 & 26 \\
        3D-CAN & 1.18 & 2.83 & 0.97 & 10.5 & 2.78 & 5.08 & 0.94 & 4.73 & 2.31 & 4.42 & 0.44 & 19.3 & 48  \\ \hdashline
        2D-CAN & 2.32 & 5.82 & 0.85 & 6.23 & 4.72 & 8.68 &  0.82 & 2.06  & 2.86 & 5.16 & 0.34 & 16.3 & 20  \\
        \bottomrule 
   \end{tabular}
   \\
   \tiny
   MAE = Mean Absolute Error, RMSE = Root Mean Squared Error, $\rho$ = Pearson Correlation, SNR = BVP Signal-to-Noise Ratio.
   \vspace{-0.4cm}
\end{table*}

\begin{table*}[t]
	\caption{Pulse and respiration measurement MAE on the AFRL by motion task.}
	\label{tab:sm_tasks}
	\centering
	\small
	\setlength\tabcolsep{3pt} \begin{tabular}{rc|cccccc|cccccc}
	\toprule
		&& \multicolumn{6}{c}{\textbf{Heart Rate}} &  \multicolumn{6}{c}{\textbf{Respiration Rate}}  \\
        \textbf{Method} && T1 & T2  & T3 & T4 & T5 & T6 &  T1 & T2  & T3 & T4 & T5 & T6 \\ \hline \hline
        MTTS-CAN && 1.08 & 1.23 & 0.94 & 1.27 & 1.07 & 3.12 & 0.68 & 0.98 & 2.12 & 3.81 & 3.31 & 2.89 \\
        MT-Hybrid-CAN && 1.04 & 1.24 & 0.95 & 1.23 & 0.88 & 1.53 & 0.77 & 0.89 & 2.23 & 3.28 & 3.03 & 2.80 \\
        MT-3D-CAN && 1.07 & 1.21 & 0.92 & 1.23 & 0.86 & 1.91 & 0.81 & 1.00 & 2.10 & 3.33 & 3.05 & 3.00 \\
        MT-2D-CAN && 1.08 & 1.28 & 1.13 & 1.52 & 2.60 & 7.46 & 1.47 & 1.24 & 3.77 & 4.53 & 3.58 & 3.32 \\
        TS-CAN && 1.07 & 1.25 & 0.96 & 1.24 & 1.01 & 2.36 & 0.69 & 1.14 & 2.27 & 3.70 & 3.18 & 2.53 \\
        Hybrid-CAN && 1.04 & 1.21 & 0.94 & 1.22 & 0.89 & 1.39 & 0.77 & 1.03 & 1.83 & 3.19 & 2.96 & 2.60 \\
        3D-CAN && 1.06 & 1.19 & 0.92 & 1.23 & 0.89 & 1.77 & 0.96 & 0.98 & 2.58 & 3.80 & 2.87 & 2.65 \\ \hdashline
        2D-CAN && 1.08 & 1.21 & 1.02 & 1.43 & 2.15 & 7.05 & 1.25 & 1.11 & 3.35 & 4.63 & 3.77 & 3.08 \\
        
   \end{tabular}
    \vspace{-0.3cm}
\end{table*}


\begin{figure*}[p]
  \includegraphics[width=\textwidth]{Figures/TS-CAN-Full.pdf}
  \caption{Architecture details of TS-CAN and MTTS-CAN}
  \label{fig:MTTS-CAN}
\end{figure*}

\begin{figure*}[p!]
  \includegraphics[width=\textwidth]{Figures/Hybrid-CAN.pdf}
  \caption{Architecture details of Hybrid-CAN and MT-Hybrid-CAN}
  \label{fig:Hybrid-CAN}
\end{figure*}

\begin{figure*}[p!]
  \includegraphics[width=\textwidth]{Figures/3D_CAN.pdf}
  \caption{Architecture details of 3D-CAN and MT-3DCAN}
  \label{fig:3D-CAN}
\end{figure*}

\section{Additional Figures of Results}

Figure \ref{fig:AFRL_1} and Figure \ref{fig:AFRL_2} demonstrate the relationship and distribution between estimated HR and ground-truth HR across all the subjects in the AFRL dataset. Figure \ref{fig:MMSE_1} and Figure \ref{fig:MMSE_2} demonstrate the relationship and distribution between estimated HR and ground-truth HR across all the subjects in the MMSE dataset. Figure \ref{fig:box_plot} illustrates the errors for 2D-CAN and MTTS-CAN on the AFRL Dataset by participant. 

\begin{figure*}[p!]
  \includegraphics[width=\textwidth]{Figures/AFRL_1.pdf}
  \caption{AFRL Dataset: Estimated HR and Gold-standard HR reference measurements in (beats-per-minute) and the corresponding Bland-Altman plots from 2D-CAN, 3D-CAN and Hybrid-CAN. All results computed for 30-second time windows.}
  \label{fig:AFRL_1}
\end{figure*}

\begin{figure*}[p!]
  \includegraphics[width=\textwidth]{Figures/AFRL_2.pdf}
  \caption{AFRL Dataset: Estimated HR and Gold-standard HR reference measurements in (beats-per-minute) and the corresponding Bland-Altman plots from MT-Hybrid-CAN and MTTS-CAN. All results computed for 30-second time windows.}
  \label{fig:AFRL_2}
\end{figure*}

\begin{figure*}[p!]
  \includegraphics[width=\textwidth]{Figures/MMSE_1.pdf}
  \caption{MMSE-HR Dataset: Estimated HR and Gold-standard HR reference measurements in (beats-per-minute) and the corresponding Bland-Altman plots from 2D-CAN, 3D-CAN and Hybrid-CAN. Note the following files were removed due to unreliable reference measurements: F006-T11, F013-T08, F013-T11, F014-T01, F014-T08, F014-T10, F014-T11, F015-T11, F022-T10, M013-T11}
  \label{fig:MMSE_1}
\end{figure*}

\begin{figure*}[p!]
  \includegraphics[width=\textwidth]{Figures/MMSE_2.pdf}
  \caption{MMSE-HR Dataset: Estimated HR and Gold-standard HR reference measurements in (beats-per-minute) and the corresponding Bland-Altman plots from MT-Hybrid-CAN and MTTS-CAN.}
  \label{fig:MMSE_2}
\end{figure*}

\begin{figure*}[h!]
  \includegraphics[width=\textwidth]{Figures/BoxPlotErrors.pdf}
  \caption{Box Plot of Errors for 2D-CAN and MTTS-CAN on the AFRL Dataset by Participant.}
  \label{fig:box_plot}
\end{figure*}


\label{headings}

\end{document}